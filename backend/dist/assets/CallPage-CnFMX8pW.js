const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/latency-chart-Bj5OSYzg.es-CRgRXBsT.js","assets/index-Bv7HPkaF.js","assets/index-D0OoSQN7.css"])))=>i.map(i=>d[i]);
import{k as id,m as rd,j as b,r as v,R as fc,_ as ad,n as od,o as cd,a as ld,P as ud,V as dd,p as hd,q as fd}from"./index-Bv7HPkaF.js";import{_ as Fs,a as Tn,b as tn,c as It,d as pd,e as pc,f as qi,g as md,h as gd,r as mc,i as Ne}from"./clsx-BXSS5MK1.js";function bd(t,e){for(var n=0;n<e.length;n++){const s=e[n];if(typeof s!="string"&&!Array.isArray(s)){for(const i in s)if(i!=="default"&&!(i in t)){const r=Object.getOwnPropertyDescriptor(s,i);r&&Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:()=>s[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}let gc=!0,bc=!0;function Ln(t,e,n){const s=t.match(e);return s&&s.length>=n&&parseFloat(s[n],10)}function an(t,e,n){if(!t.RTCPeerConnection)return;const s=t.RTCPeerConnection.prototype,i=s.addEventListener;s.addEventListener=function(a,o){if(a!==e)return i.apply(this,arguments);const l=u=>{const d=n(u);d&&(o.handleEvent?o.handleEvent(d):o(d))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(o,l),i.apply(this,[a,l])};const r=s.removeEventListener;s.removeEventListener=function(a,o){if(a!==e||!this._eventMap||!this._eventMap[e])return r.apply(this,arguments);if(!this._eventMap[e].has(o))return r.apply(this,arguments);const l=this._eventMap[e].get(o);return this._eventMap[e].delete(o),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,r.apply(this,[a,l])},Object.defineProperty(s,"on"+e,{get(){return this["_on"+e]},set(a){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),a&&this.addEventListener(e,this["_on"+e]=a)},enumerable:!0,configurable:!0})}function vd(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(gc=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function yd(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(bc=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function vc(){if(typeof window=="object"){if(gc)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Wr(t,e){bc&&console.warn(t+" is deprecated, please use "+e+" instead.")}function Sd(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(Ln(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(Ln(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(Ln(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=Ln(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function La(t){return Object.prototype.toString.call(t)==="[object Object]"}function yc(t){return La(t)?Object.keys(t).reduce(function(e,n){const s=La(t[n]),i=s?yc(t[n]):t[n],r=s&&!Object.keys(i).length;return i===void 0||r?e:Object.assign(e,{[n]:i})},{}):t}function br(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(s=>{s.endsWith("Id")?br(t,t.get(e[s]),n):s.endsWith("Ids")&&e[s].forEach(i=>{br(t,t.get(i),n)})}))}function ja(t,e,n){const s=n?"outbound-rtp":"inbound-rtp",i=new Map;if(e===null)return i;const r=[];return t.forEach(a=>{a.type==="track"&&a.trackIdentifier===e.id&&r.push(a)}),r.forEach(a=>{t.forEach(o=>{o.type===s&&o.trackId===a.id&&br(t,o,i)})}),i}const Ma=vc;function Sc(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const s=function(o){if(typeof o!="object"||o.mandatory||o.optional)return o;const l={};return Object.keys(o).forEach(u=>{if(u==="require"||u==="advanced"||u==="mediaSource")return;const d=typeof o[u]=="object"?o[u]:{ideal:o[u]};d.exact!==void 0&&typeof d.exact=="number"&&(d.min=d.max=d.exact);const f=function(c,h){return c?c+h.charAt(0).toUpperCase()+h.slice(1):h==="deviceId"?"sourceId":h};if(d.ideal!==void 0){l.optional=l.optional||[];let c={};typeof d.ideal=="number"?(c[f("min",u)]=d.ideal,l.optional.push(c),c={},c[f("max",u)]=d.ideal,l.optional.push(c)):(c[f("",u)]=d.ideal,l.optional.push(c))}d.exact!==void 0&&typeof d.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[f("",u)]=d.exact):["min","max"].forEach(c=>{d[c]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[f(c,u)]=d[c])})}),o.advanced&&(l.optional=(l.optional||[]).concat(o.advanced)),l},i=function(o,l){if(e.version>=61)return l(o);if(o=JSON.parse(JSON.stringify(o)),o&&typeof o.audio=="object"){const u=function(d,f,c){f in d&&!(c in d)&&(d[c]=d[f],delete d[f])};o=JSON.parse(JSON.stringify(o)),u(o.audio,"autoGainControl","googAutoGainControl"),u(o.audio,"noiseSuppression","googNoiseSuppression"),o.audio=s(o.audio)}if(o&&typeof o.video=="object"){let u=o.video.facingMode;u=u&&(typeof u=="object"?u:{ideal:u});const d=e.version<66;if(u&&(u.exact==="user"||u.exact==="environment"||u.ideal==="user"||u.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!d)){delete o.video.facingMode;let f;if(u.exact==="environment"||u.ideal==="environment"?f=["back","rear"]:(u.exact==="user"||u.ideal==="user")&&(f=["front"]),f)return n.mediaDevices.enumerateDevices().then(c=>{c=c.filter(m=>m.kind==="videoinput");let h=c.find(m=>f.some(p=>m.label.toLowerCase().includes(p)));return!h&&c.length&&f.includes("back")&&(h=c[c.length-1]),h&&(o.video.deviceId=u.exact?{exact:h.deviceId}:{ideal:h.deviceId}),o.video=s(o.video),Ma("chrome: "+JSON.stringify(o)),l(o)})}o.video=s(o.video)}return Ma("chrome: "+JSON.stringify(o)),l(o)},r=function(o){return e.version>=64?o:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[o.name]||o.name,message:o.message,constraint:o.constraint||o.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},a=function(o,l,u){i(o,d=>{n.webkitGetUserMedia(d,l,f=>{u&&u(r(f))})})};if(n.getUserMedia=a.bind(n),n.mediaDevices.getUserMedia){const o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(l){return i(l,u=>o(u).then(d=>{if(u.audio&&!d.getAudioTracks().length||u.video&&!d.getVideoTracks().length)throw d.getTracks().forEach(f=>{f.stop()}),new DOMException("","NotFoundError");return d},d=>Promise.reject(r(d))))}}}function Cd(t,e){if(!(t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices)&&t.navigator.mediaDevices){if(typeof e!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}t.navigator.mediaDevices.getDisplayMedia=function(s){return e(s).then(i=>{const r=s.video&&s.video.width,a=s.video&&s.video.height,o=s.video&&s.video.frameRate;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:o||3}},r&&(s.video.mandatory.maxWidth=r),a&&(s.video.mandatory.maxHeight=a),t.navigator.mediaDevices.getUserMedia(s)})}}}function Cc(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function Tc(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{s.stream.addEventListener("addtrack",i=>{let r;t.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(o=>o.track&&o.track.id===i.track.id):r={track:i.track};const a=new Event("track");a.track=i.track,a.receiver=r,a.transceiver={receiver:r},a.streams=[s.stream],this.dispatchEvent(a)}),s.stream.getTracks().forEach(i=>{let r;t.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(o=>o.track&&o.track.id===i.id):r={track:i};const a=new Event("track");a.track=i,a.receiver=r,a.transceiver={receiver:r},a.streams=[s.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else an(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function wc(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(i,r){return{track:r,get dtmf(){return this._dtmf===void 0&&(r.kind==="audio"?this._dtmf=i.createDTMFSender(r):this._dtmf=null),this._dtmf},_pc:i}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,l){let u=i.apply(this,arguments);return u||(u=e(this,o),this._senders.push(u)),u};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){r.apply(this,arguments);const l=this._senders.indexOf(o);l!==-1&&this._senders.splice(l,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(r){this._senders=this._senders||[],n.apply(this,[r]),r.getTracks().forEach(a=>{this._senders.push(e(this,a))})};const s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(r){this._senders=this._senders||[],s.apply(this,[r]),r.getTracks().forEach(a=>{const o=this._senders.find(l=>l.track===a);o&&this._senders.splice(this._senders.indexOf(o),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const s=e.apply(this,[]);return s.forEach(i=>i._pc=this),s},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function kc(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,i,r]=arguments;if(arguments.length>0&&typeof s=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof s!="function"))return e.apply(this,[]);const a=function(l){const u={};return l.result().forEach(f=>{const c={id:f.id,timestamp:f.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[f.type]||f.type};f.names().forEach(h=>{c[h]=f.stat(h)}),u[c.id]=c}),u},o=function(l){return new Map(Object.keys(l).map(u=>[u,l[u]]))};if(arguments.length>=2){const l=function(u){i(o(a(u)))};return e.apply(this,[l,s])}return new Promise((l,u)=>{e.apply(this,[function(d){l(o(a(d)))},u])}).then(i,r)}}function Rc(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=n.apply(this,[]);return r.forEach(a=>a._pc=this),r});const s=t.RTCPeerConnection.prototype.addTrack;s&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=s.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){const r=this;return this._pc.getStats().then(a=>ja(a,r.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(r=>r._pc=this),i}),an(t,"track",s=>(s.receiver._pc=s.srcElement,s)),t.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(r=>ja(r,i.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const s=arguments[0];let i,r,a;return this.getSenders().forEach(o=>{o.track===s&&(i?a=!0:i=o)}),this.getReceivers().forEach(o=>(o.track===s&&(r?a=!0:r=o),o.track===s)),a||i&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function Ec(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,o){if(!o)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=e.apply(this,arguments);return this._shimmedLocalStreams[o.id]?this._shimmedLocalStreams[o.id].indexOf(l)===-1&&this._shimmedLocalStreams[o.id].push(l):this._shimmedLocalStreams[o.id]=[o,l],l};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(u=>{if(this.getSenders().find(f=>f.track===u))throw new DOMException("Track already exists.","InvalidAccessError")});const o=this.getSenders();n.apply(this,arguments);const l=this.getSenders().filter(u=>o.indexOf(u)===-1);this._shimmedLocalStreams[a.id]=[a].concat(l)};const s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],s.apply(this,arguments)};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(o=>{const l=this._shimmedLocalStreams[o].indexOf(a);l!==-1&&this._shimmedLocalStreams[o].splice(l,1),this._shimmedLocalStreams[o].length===1&&delete this._shimmedLocalStreams[o]}),i.apply(this,arguments)}}function Ic(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return Ec(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const d=n.apply(this);return this._reverseStreams=this._reverseStreams||{},d.map(f=>this._reverseStreams[f.id])};const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(d){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.getTracks().forEach(f=>{if(this.getSenders().find(h=>h.track===f))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[d.id]){const f=new t.MediaStream(d.getTracks());this._streams[d.id]=f,this._reverseStreams[f.id]=d,d=f}s.apply(this,[d])};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(d){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[d.id]||d]),delete this._reverseStreams[this._streams[d.id]?this._streams[d.id].id:d.id],delete this._streams[d.id]},t.RTCPeerConnection.prototype.addTrack=function(d,f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const c=[].slice.call(arguments,1);if(c.length!==1||!c[0].getTracks().find(p=>p===d))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(p=>p.track===d))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const m=this._streams[f.id];if(m)m.addTrack(d),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const p=new t.MediaStream([d]);this._streams[f.id]=p,this._reverseStreams[p.id]=f,this.addStream(p)}return this.getSenders().find(p=>p.track===d)};function r(u,d){let f=d.sdp;return Object.keys(u._reverseStreams||[]).forEach(c=>{const h=u._reverseStreams[c],m=u._streams[h.id];f=f.replace(new RegExp(m.id,"g"),h.id)}),new RTCSessionDescription({type:d.type,sdp:f})}function a(u,d){let f=d.sdp;return Object.keys(u._reverseStreams||[]).forEach(c=>{const h=u._reverseStreams[c],m=u._streams[h.id];f=f.replace(new RegExp(h.id,"g"),m.id)}),new RTCSessionDescription({type:d.type,sdp:f})}["createOffer","createAnswer"].forEach(function(u){const d=t.RTCPeerConnection.prototype[u],f={[u](){const c=arguments;return arguments.length&&typeof arguments[0]=="function"?d.apply(this,[m=>{const p=r(this,m);c[0].apply(null,[p])},m=>{c[1]&&c[1].apply(null,m)},arguments[2]]):d.apply(this,arguments).then(m=>r(this,m))}};t.RTCPeerConnection.prototype[u]=f[u]});const o=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?o.apply(this,arguments):(arguments[0]=a(this,arguments[0]),o.apply(this,arguments))};const l=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const u=l.get.apply(this);return u.type===""?u:r(this,u)}}),t.RTCPeerConnection.prototype.removeTrack=function(d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!d._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(d._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let c;Object.keys(this._streams).forEach(h=>{this._streams[h].getTracks().find(p=>d.track===p)&&(c=this._streams[h])}),c&&(c.getTracks().length===1?this.removeStream(this._reverseStreams[c.id]):c.removeTrack(d.track),this.dispatchEvent(new Event("negotiationneeded")))}}function vr(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const s=t.RTCPeerConnection.prototype[n],i={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=i[n]})}function _c(t,e){an(t,"negotiationneeded",n=>{const s=n.target;if(!((e.version<72||s.getConfiguration&&s.getConfiguration().sdpSemantics==="plan-b")&&s.signalingState!=="stable"))return n})}const Fa=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:_c,shimAddTrackRemoveTrack:Ic,shimAddTrackRemoveTrackWithNative:Ec,shimGetDisplayMedia:Cd,shimGetSendersWithDtmf:wc,shimGetStats:kc,shimGetUserMedia:Sc,shimMediaStream:Cc,shimOnTrack:Tc,shimPeerConnection:vr,shimSenderReceiverGetStats:Rc},Symbol.toStringTag,{value:"Module"}));function xc(t,e){const n=t&&t.navigator,s=t&&t.MediaStreamTrack;if(n.getUserMedia=function(i,r,a){Wr("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(i).then(r,a)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const i=function(a,o,l){o in a&&!(l in a)&&(a[l]=a[o],delete a[o])},r=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),i(a.audio,"autoGainControl","mozAutoGainControl"),i(a.audio,"noiseSuppression","mozNoiseSuppression")),r(a)},s&&s.prototype.getSettings){const a=s.prototype.getSettings;s.prototype.getSettings=function(){const o=a.apply(this,arguments);return i(o,"mozAutoGainControl","autoGainControl"),i(o,"mozNoiseSuppression","noiseSuppression"),o}}if(s&&s.prototype.applyConstraints){const a=s.prototype.applyConstraints;s.prototype.applyConstraints=function(o){return this.kind==="audio"&&typeof o=="object"&&(o=JSON.parse(JSON.stringify(o)),i(o,"autoGainControl","mozAutoGainControl"),i(o,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[o])}}}}function Td(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(s){if(!(s&&s.video)){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return s.video===!0?s.video={mediaSource:e}:s.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(s)})}function Pc(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function yr(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const r=t.RTCPeerConnection.prototype[i],a={[i](){return arguments[0]=new(i==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};t.RTCPeerConnection.prototype[i]=a[i]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[r,a,o]=arguments;return s.apply(this,[r||null]).then(l=>{if(e.version<53&&!a)try{l.forEach(u=>{u.type=n[u.type]||u.type})}catch(u){if(u.name!=="TypeError")throw u;l.forEach((d,f)=>{l.set(f,Object.assign({},d,{type:n[d.type]||d.type}))})}return l}).then(a,o)}}function Oc(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Nc(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=e.apply(this,[]);return s.forEach(i=>i._pc=this),s}),an(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Ac(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){Wr("removeStream","removeTrack"),this.getSenders().forEach(s=>{s.track&&n.getTracks().includes(s.track)&&this.removeTrack(s)})})}function Dc(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function Lc(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let s=arguments[1]&&arguments[1].sendEncodings;s===void 0&&(s=[]),s=[...s];const i=s.length>0;i&&s.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=e.apply(this,arguments);if(i){const{sender:a}=r,o=a.getParameters();(!("encodings"in o)||o.encodings.length===1&&Object.keys(o.encodings[0]).length===0)&&(o.encodings=s,a.sendEncodings=s,this.setParametersPromises.push(a.setParameters(o).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return r})}function jc(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const s=e.apply(this,arguments);return"encodings"in s||(s.encodings=[].concat(this.sendEncodings||[{}])),s})}function Mc(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function Fc(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const Ua=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:Lc,shimCreateAnswer:Fc,shimCreateOffer:Mc,shimGetDisplayMedia:Td,shimGetParameters:jc,shimGetUserMedia:xc,shimOnTrack:Pc,shimPeerConnection:yr,shimRTCDataChannel:Dc,shimReceiverGetStats:Nc,shimRemoveStream:Ac,shimSenderGetStats:Oc},Symbol.toStringTag,{value:"Module"}));function Uc(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(s){this._localStreams||(this._localStreams=[]),this._localStreams.includes(s)||this._localStreams.push(s),s.getAudioTracks().forEach(i=>e.call(this,i,s)),s.getVideoTracks().forEach(i=>e.call(this,i,s))},t.RTCPeerConnection.prototype.addTrack=function(s,...i){return i&&i.forEach(r=>{this._localStreams?this._localStreams.includes(r)||this._localStreams.push(r):this._localStreams=[r]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const s=this._localStreams.indexOf(n);if(s===-1)return;this._localStreams.splice(s,1);const i=n.getTracks();this.getSenders().forEach(r=>{i.includes(r.track)&&this.removeTrack(r)})})}}function $c(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=s=>{s.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const r=new Event("addstream");r.stream=i,this.dispatchEvent(r)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(r=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(r)>=0)return;s._remoteStreams.push(r);const a=new Event("addstream");a.stream=r,s.dispatchEvent(a)})}),e.apply(s,arguments)}}}function Vc(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,s=e.createAnswer,i=e.setLocalDescription,r=e.setRemoteDescription,a=e.addIceCandidate;e.createOffer=function(u,d){const f=arguments.length>=2?arguments[2]:arguments[0],c=n.apply(this,[f]);return d?(c.then(u,d),Promise.resolve()):c},e.createAnswer=function(u,d){const f=arguments.length>=2?arguments[2]:arguments[0],c=s.apply(this,[f]);return d?(c.then(u,d),Promise.resolve()):c};let o=function(l,u,d){const f=i.apply(this,[l]);return d?(f.then(u,d),Promise.resolve()):f};e.setLocalDescription=o,o=function(l,u,d){const f=r.apply(this,[l]);return d?(f.then(u,d),Promise.resolve()):f},e.setRemoteDescription=o,o=function(l,u,d){const f=a.apply(this,[l]);return d?(f.then(u,d),Promise.resolve()):f},e.addIceCandidate=o}function Bc(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,s=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=i=>s(Hc(i))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(s,i,r){e.mediaDevices.getUserMedia(s).then(i,r)}).bind(e))}function Hc(t){return t&&t.video!==void 0?Object.assign({},t,{video:yc(t.video)}):t}function qc(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(s,i){if(s&&s.iceServers){const r=[];for(let a=0;a<s.iceServers.length;a++){let o=s.iceServers[a];o.urls===void 0&&o.url?(Wr("RTCIceServer.url","RTCIceServer.urls"),o=JSON.parse(JSON.stringify(o)),o.urls=o.url,delete o.url,r.push(o)):r.push(s.iceServers[a])}s.iceServers=r}return new e(s,i)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function Wc(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Gc(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(s){if(s){typeof s.offerToReceiveAudio<"u"&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);const i=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):s.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio",{direction:"recvonly"}),typeof s.offerToReceiveVideo<"u"&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);const r=this.getTransceivers().find(a=>a.receiver.track.kind==="video");s.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):s.offerToReceiveVideo===!0&&!r&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function Kc(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}const $a=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:Kc,shimCallbacksAPI:Vc,shimConstraints:Hc,shimCreateOfferLegacy:Gc,shimGetUserMedia:Bc,shimLocalStreamsAPI:Uc,shimRTCIceServerUrls:qc,shimRemoteStreamsAPI:$c,shimTrackEventTransceiver:Wc},Symbol.toStringTag,{value:"Module"}));var Wi={exports:{}},Va;function wd(){return Va||(Va=1,function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(s=>s.trim())},e.splitSections=function(n){return n.split(`
m=`).map((i,r)=>(r>0?"m="+i:i).trim()+`\r
`)},e.getDescription=function(n){const s=e.splitSections(n);return s&&s[0]},e.getMediaSections=function(n){const s=e.splitSections(n);return s.shift(),s},e.matchPrefix=function(n,s){return e.splitLines(n).filter(i=>i.indexOf(s)===0)},e.parseCandidate=function(n){let s;n.indexOf("a=candidate:")===0?s=n.substring(12).split(" "):s=n.substring(10).split(" ");const i={foundation:s[0],component:{1:"rtp",2:"rtcp"}[s[1]]||s[1],protocol:s[2].toLowerCase(),priority:parseInt(s[3],10),ip:s[4],address:s[4],port:parseInt(s[5],10),type:s[7]};for(let r=8;r<s.length;r+=2)switch(s[r]){case"raddr":i.relatedAddress=s[r+1];break;case"rport":i.relatedPort=parseInt(s[r+1],10);break;case"tcptype":i.tcpType=s[r+1];break;case"ufrag":i.ufrag=s[r+1],i.usernameFragment=s[r+1];break;default:i[s[r]]===void 0&&(i[s[r]]=s[r+1]);break}return i},e.writeCandidate=function(n){const s=[];s.push(n.foundation);const i=n.component;i==="rtp"?s.push(1):i==="rtcp"?s.push(2):s.push(i),s.push(n.protocol.toUpperCase()),s.push(n.priority),s.push(n.address||n.ip),s.push(n.port);const r=n.type;return s.push("typ"),s.push(r),r!=="host"&&n.relatedAddress&&n.relatedPort&&(s.push("raddr"),s.push(n.relatedAddress),s.push("rport"),s.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(s.push("tcptype"),s.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(s.push("ufrag"),s.push(n.usernameFragment||n.ufrag)),"candidate:"+s.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let s=n.substring(9).split(" ");const i={payloadType:parseInt(s.shift(),10)};return s=s[0].split("/"),i.name=s[0],i.clockRate=parseInt(s[1],10),i.channels=s.length===3?parseInt(s[2],10):1,i.numChannels=i.channels,i},e.writeRtpMap=function(n){let s=n.payloadType;n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType);const i=n.channels||n.numChannels||1;return"a=rtpmap:"+s+" "+n.name+"/"+n.clockRate+(i!==1?"/"+i:"")+`\r
`},e.parseExtmap=function(n){const s=n.substring(9).split(" ");return{id:parseInt(s[0],10),direction:s[0].indexOf("/")>0?s[0].split("/")[1]:"sendrecv",uri:s[1],attributes:s.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const s={};let i;const r=n.substring(n.indexOf(" ")+1).split(";");for(let a=0;a<r.length;a++)i=r[a].trim().split("="),s[i[0].trim()]=i[1];return s},e.writeFmtp=function(n){let s="",i=n.payloadType;if(n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const r=[];Object.keys(n.parameters).forEach(a=>{n.parameters[a]!==void 0?r.push(a+"="+n.parameters[a]):r.push(a)}),s+="a=fmtp:"+i+" "+r.join(";")+`\r
`}return s},e.parseRtcpFb=function(n){const s=n.substring(n.indexOf(" ")+1).split(" ");return{type:s.shift(),parameter:s.join(" ")}},e.writeRtcpFb=function(n){let s="",i=n.payloadType;return n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(r=>{s+="a=rtcp-fb:"+i+" "+r.type+(r.parameter&&r.parameter.length?" "+r.parameter:"")+`\r
`}),s},e.parseSsrcMedia=function(n){const s=n.indexOf(" "),i={ssrc:parseInt(n.substring(7,s),10)},r=n.indexOf(":",s);return r>-1?(i.attribute=n.substring(s+1,r),i.value=n.substring(r+1)):i.attribute=n.substring(s+1),i},e.parseSsrcGroup=function(n){const s=n.substring(13).split(" ");return{semantics:s.shift(),ssrcs:s.map(i=>parseInt(i,10))}},e.getMid=function(n){const s=e.matchPrefix(n,"a=mid:")[0];if(s)return s.substring(6)},e.parseFingerprint=function(n){const s=n.substring(14).split(" ");return{algorithm:s[0].toLowerCase(),value:s[1].toUpperCase()}},e.getDtlsParameters=function(n,s){return{role:"auto",fingerprints:e.matchPrefix(n+s,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,s){let i="a=setup:"+s+`\r
`;return n.fingerprints.forEach(r=>{i+="a=fingerprint:"+r.algorithm+" "+r.value+`\r
`}),i},e.parseCryptoLine=function(n){const s=n.substring(9).split(" ");return{tag:parseInt(s[0],10),cryptoSuite:s[1],keyParams:s[2],sessionParams:s.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const s=n.substring(7).split("|");return{keyMethod:"inline",keySalt:s[0],lifeTime:s[1],mkiValue:s[2]?s[2].split(":")[0]:void 0,mkiLength:s[2]?s[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,s){return e.matchPrefix(n+s,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,s){const i=e.matchPrefix(n+s,"a=ice-ufrag:")[0],r=e.matchPrefix(n+s,"a=ice-pwd:")[0];return i&&r?{usernameFragment:i.substring(12),password:r.substring(10)}:null},e.writeIceParameters=function(n){let s="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(s+=`a=ice-lite\r
`),s},e.parseRtpParameters=function(n){const s={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=e.splitLines(n)[0].split(" ");s.profile=r[2];for(let o=3;o<r.length;o++){const l=r[o],u=e.matchPrefix(n,"a=rtpmap:"+l+" ")[0];if(u){const d=e.parseRtpMap(u),f=e.matchPrefix(n,"a=fmtp:"+l+" ");switch(d.parameters=f.length?e.parseFmtp(f[0]):{},d.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+l+" ").map(e.parseRtcpFb),s.codecs.push(d),d.name.toUpperCase()){case"RED":case"ULPFEC":s.fecMechanisms.push(d.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(o=>{s.headerExtensions.push(e.parseExtmap(o))});const a=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return s.codecs.forEach(o=>{a.forEach(l=>{o.rtcpFeedback.find(d=>d.type===l.type&&d.parameter===l.parameter)||o.rtcpFeedback.push(l)})}),s},e.writeRtpDescription=function(n,s){let i="";i+="m="+n+" ",i+=s.codecs.length>0?"9":"0",i+=" "+(s.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=s.codecs.map(a=>a.preferredPayloadType!==void 0?a.preferredPayloadType:a.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,s.codecs.forEach(a=>{i+=e.writeRtpMap(a),i+=e.writeFmtp(a),i+=e.writeRtcpFb(a)});let r=0;return s.codecs.forEach(a=>{a.maxptime>r&&(r=a.maxptime)}),r>0&&(i+="a=maxptime:"+r+`\r
`),s.headerExtensions&&s.headerExtensions.forEach(a=>{i+=e.writeExtmap(a)}),i},e.parseRtpEncodingParameters=function(n){const s=[],i=e.parseRtpParameters(n),r=i.fecMechanisms.indexOf("RED")!==-1,a=i.fecMechanisms.indexOf("ULPFEC")!==-1,o=e.matchPrefix(n,"a=ssrc:").map(c=>e.parseSsrcMedia(c)).filter(c=>c.attribute==="cname"),l=o.length>0&&o[0].ssrc;let u;const d=e.matchPrefix(n,"a=ssrc-group:FID").map(c=>c.substring(17).split(" ").map(m=>parseInt(m,10)));d.length>0&&d[0].length>1&&d[0][0]===l&&(u=d[0][1]),i.codecs.forEach(c=>{if(c.name.toUpperCase()==="RTX"&&c.parameters.apt){let h={ssrc:l,codecPayloadType:parseInt(c.parameters.apt,10)};l&&u&&(h.rtx={ssrc:u}),s.push(h),r&&(h=JSON.parse(JSON.stringify(h)),h.fec={ssrc:l,mechanism:a?"red+ulpfec":"red"},s.push(h))}}),s.length===0&&l&&s.push({ssrc:l});let f=e.matchPrefix(n,"b=");return f.length&&(f[0].indexOf("b=TIAS:")===0?f=parseInt(f[0].substring(7),10):f[0].indexOf("b=AS:")===0?f=parseInt(f[0].substring(5),10)*1e3*.95-50*40*8:f=void 0,s.forEach(c=>{c.maxBitrate=f})),s},e.parseRtcpParameters=function(n){const s={},i=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="cname")[0];i&&(s.cname=i.value,s.ssrc=i.ssrc);const r=e.matchPrefix(n,"a=rtcp-rsize");s.reducedSize=r.length>0,s.compound=r.length===0;const a=e.matchPrefix(n,"a=rtcp-mux");return s.mux=a.length>0,s},e.writeRtcpParameters=function(n){let s="";return n.reducedSize&&(s+=`a=rtcp-rsize\r
`),n.mux&&(s+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(s+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),s},e.parseMsid=function(n){let s;const i=e.matchPrefix(n,"a=msid:");if(i.length===1)return s=i[0].substring(7).split(" "),{stream:s[0],track:s[1]};const r=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="msid");if(r.length>0)return s=r[0].value.split(" "),{stream:s[0],track:s[1]}},e.parseSctpDescription=function(n){const s=e.parseMLine(n),i=e.matchPrefix(n,"a=max-message-size:");let r;i.length>0&&(r=parseInt(i[0].substring(19),10)),isNaN(r)&&(r=65536);const a=e.matchPrefix(n,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:s.fmt,maxMessageSize:r};const o=e.matchPrefix(n,"a=sctpmap:");if(o.length>0){const l=o[0].substring(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:r}}},e.writeSctpDescription=function(n,s){let i=[];return n.protocol!=="DTLS/SCTP"?i=["m="+n.kind+" 9 "+n.protocol+" "+s.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+s.port+`\r
`]:i=["m="+n.kind+" 9 "+n.protocol+" "+s.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+s.port+" "+s.protocol+` 65535\r
`],s.maxMessageSize!==void 0&&i.push("a=max-message-size:"+s.maxMessageSize+`\r
`),i.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,s,i){let r;const a=s!==void 0?s:2;return n?r=n:r=e.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+r+" "+a+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,s){const i=e.splitLines(n);for(let r=0;r<i.length;r++)switch(i[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[r].substring(2)}return s?e.getDirection(s):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const i=e.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},e.parseOLine=function(n){const i=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const s=e.splitLines(n);for(let i=0;i<s.length;i++)if(s[i].length<2||s[i].charAt(1)!=="=")return!1;return!0},t.exports=e}(Wi)),Wi.exports}var Jc=wd();const bn=id(Jc),kd=bd({__proto__:null,default:bn},[Jc]);function Es(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(s){if(typeof s=="object"&&s.candidate&&s.candidate.indexOf("a=")===0&&(s=JSON.parse(JSON.stringify(s)),s.candidate=s.candidate.substring(2)),s.candidate&&s.candidate.length){const i=new e(s),r=bn.parseCandidate(s.candidate);for(const a in r)a in i||Object.defineProperty(i,a,{value:r[a]});return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new e(s)},t.RTCIceCandidate.prototype=e.prototype,an(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function Sr(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||an(t,"icecandidate",e=>{if(e.candidate){const n=bn.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function Is(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(o){if(!o||!o.sdp)return!1;const l=bn.splitSections(o.sdp);return l.shift(),l.some(u=>{const d=bn.parseMLine(u);return d&&d.kind==="application"&&d.protocol.indexOf("SCTP")!==-1})},s=function(o){const l=o.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const u=parseInt(l[1],10);return u!==u?-1:u},i=function(o){let l=65536;return e.browser==="firefox"&&(e.version<57?o===-1?l=16384:l=2147483637:e.version<60?l=e.version===57?65535:65536:l=2147483637),l},r=function(o,l){let u=65536;e.browser==="firefox"&&e.version===57&&(u=65535);const d=bn.matchPrefix(o.sdp,"a=max-message-size:");return d.length>0?u=parseInt(d[0].substring(19),10):e.browser==="firefox"&&l!==-1&&(u=2147483637),u},a=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const l=s(arguments[0]),u=i(l),d=r(arguments[0],l);let f;u===0&&d===0?f=Number.POSITIVE_INFINITY:u===0||d===0?f=Math.max(u,d):f=Math.min(u,d);const c={};Object.defineProperty(c,"maxMessageSize",{get(){return f}}),this._sctp=c}return a.apply(this,arguments)}}function _s(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(s,i){const r=s.send;s.send=function(){const o=arguments[0],l=o.length||o.size||o.byteLength;if(s.readyState==="open"&&i.sctp&&l>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return r.apply(s,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return e(i,this),i},an(t,"datachannel",s=>(e(s.channel,s.target),s))}function Cr(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const s=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const r=i.target;if(r._lastConnectionState!==r.connectionState){r._lastConnectionState=r.connectionState;const a=new Event("connectionstatechange",i);r.dispatchEvent(a)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),s.apply(this,arguments)}})}function Tr(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const r=i.sdp.split(`
`).filter(a=>a.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&i instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:i.type,sdp:r}):i.sdp=r}return n.apply(this,arguments)}}function xs(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Ps(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer";break}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>n.apply(this,[a]))})}const Rd=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:Tr,shimAddIceCandidateNullOrEmpty:xs,shimConnectionState:Cr,shimMaxMessageSize:Is,shimParameterlessSetLocalDescription:Ps,shimRTCIceCandidate:Es,shimRTCIceCandidateRelayProtocol:Sr,shimSendThrowTypeError:_s},Symbol.toStringTag,{value:"Module"}));function Ed({window:t}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const n=vc,s=Sd(t),i={browserDetails:s,commonShim:Rd,extractVersion:Ln,disableLog:vd,disableWarnings:yd,sdp:kd};switch(s.browser){case"chrome":if(!Fa||!vr||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(s.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=Fa,xs(t,s),Ps(t),Sc(t,s),Cc(t),vr(t,s),Tc(t),Ic(t,s),wc(t),kc(t),Rc(t),_c(t,s),Es(t),Sr(t),Cr(t),Is(t,s),_s(t),Tr(t,s);break;case"firefox":if(!Ua||!yr||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=Ua,xs(t,s),Ps(t),xc(t,s),yr(t,s),Pc(t),Ac(t),Oc(t),Nc(t),Dc(t),Lc(t),jc(t),Mc(t),Fc(t),Es(t),Cr(t),Is(t,s),_s(t);break;case"safari":if(!$a||!e.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=$a,xs(t,s),Ps(t),qc(t),Gc(t),Vc(t),Uc(t),$c(t),Wc(t),Bc(t),Kc(t),Es(t),Sr(t),Is(t,s),_s(t),Tr(t,s);break;default:n("Unsupported browser!");break}return i}Ed({window:typeof window>"u"?void 0:window});function _n(t){let e=typeof t;if(e=="object"){if(Array.isArray(t))return"array";if(t===null)return"null"}return e}function Us(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}let Nt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),bi=[];for(let t=0;t<Nt.length;t++)bi[Nt[t].charCodeAt(0)]=t;bi[45]=Nt.indexOf("+");bi[95]=Nt.indexOf("/");function Id(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),s=0,i=0,r,a=0;for(let o=0;o<t.length;o++){if(r=bi[t.charCodeAt(o)],r===void 0)switch(t[o]){case"=":i=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(i){case 0:a=r,i=1;break;case 1:n[s++]=a<<2|(r&48)>>4,a=r,i=2;break;case 2:n[s++]=(a&15)<<4|(r&60)>>2,a=r,i=3;break;case 3:n[s++]=(a&3)<<6|r,i=0;break}}if(i==1)throw Error("invalid base64 string.");return n.subarray(0,s)}function _d(t){let e="",n=0,s,i=0;for(let r=0;r<t.length;r++)switch(s=t[r],n){case 0:e+=Nt[s>>2],i=(s&3)<<4,n=1;break;case 1:e+=Nt[i|s>>4],i=(s&15)<<2,n=2;break;case 2:e+=Nt[i|s>>6],e+=Nt[s&63],n=0;break}return n&&(e+=Nt[i],e+="=",n==1&&(e+="=")),e}var $s;(function(t){t.symbol=Symbol.for("protobuf-ts/unknown"),t.onRead=(n,s,i,r,a)=>{(e(s)?s[t.symbol]:s[t.symbol]=[]).push({no:i,wireType:r,data:a})},t.onWrite=(n,s,i)=>{for(let{no:r,wireType:a,data:o}of t.list(s))i.tag(r,a).raw(o)},t.list=(n,s)=>{if(e(n)){let i=n[t.symbol];return s?i.filter(r=>r.no==s):i}return[]},t.last=(n,s)=>t.list(n,s).slice(-1)[0];const e=n=>n&&Array.isArray(n[t.symbol])})($s||($s={}));function xd(t,e){return Object.assign(Object.assign({},t),e)}var Ie;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(Ie||(Ie={}));function Pd(){let t=0,e=0;for(let s=0;s<28;s+=7){let i=this.buf[this.pos++];if(t|=(i&127)<<s,(i&128)==0)return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,(n&128)==0)return this.assertBounds(),[t,e];for(let s=3;s<=31;s+=7){let i=this.buf[this.pos++];if(e|=(i&127)<<s,(i&128)==0)return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function Gi(t,e,n){for(let r=0;r<28;r=r+7){const a=t>>>r,o=!(!(a>>>7)&&e==0),l=(o?a|128:a)&255;if(n.push(l),!o)return}const s=t>>>28&15|(e&7)<<4,i=e>>3!=0;if(n.push((i?s|128:s)&255),!!i){for(let r=3;r<31;r=r+7){const a=e>>>r,o=!!(a>>>7),l=(o?a|128:a)&255;if(n.push(l),!o)return}n.push(e>>>31&1)}}const Os=65536*65536;function zc(t){let e=t[0]=="-";e&&(t=t.slice(1));const n=1e6;let s=0,i=0;function r(a,o){const l=Number(t.slice(a,o));i*=n,s=s*n+l,s>=Os&&(i=i+(s/Os|0),s=s%Os)}return r(-24,-18),r(-18,-12),r(-12,-6),r(-6),[e,s,i]}function wr(t,e){if(e>>>0<=2097151)return""+(Os*e+(t>>>0));let n=t&16777215,s=(t>>>24|e<<8)>>>0&16777215,i=e>>16&65535,r=n+s*6777216+i*6710656,a=s+i*8147497,o=i*2,l=1e7;r>=l&&(a+=Math.floor(r/l),r%=l),a>=l&&(o+=Math.floor(a/l),a%=l);function u(d,f){let c=d?String(d):"";return f?"0000000".slice(c.length)+c:c}return u(o,0)+u(a,o)+u(r,1)}function Ba(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function Od(){let t=this.buf[this.pos++],e=t&127;if((t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,(t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,(t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,(t&128)==0)return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;(t&128)!==0&&n<10;n++)t=this.buf[this.pos++];if((t&128)!=0)throw new Error("invalid varint");return this.assertBounds(),e>>>0}let be;function Nd(){const t=new DataView(new ArrayBuffer(8));be=globalThis.BigInt!==void 0&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"?{MIN:BigInt("-9223372036854775808"),MAX:BigInt("9223372036854775807"),UMIN:BigInt("0"),UMAX:BigInt("18446744073709551615"),C:BigInt,V:t}:void 0}Nd();function Yc(t){if(!t)throw new Error("BigInt unavailable, see https://github.com/timostamm/protobuf-ts/blob/v1.0.8/MANUAL.md#bigint-support")}const Xc=/^-?[0-9]+$/,Vs=4294967296,hs=2147483648;class Zc{constructor(e,n){this.lo=e|0,this.hi=n|0}isZero(){return this.lo==0&&this.hi==0}toNumber(){let e=this.hi*Vs+(this.lo>>>0);if(!Number.isSafeInteger(e))throw new Error("cannot convert to safe number");return e}}class He extends Zc{static from(e){if(be)switch(typeof e){case"string":if(e=="0")return this.ZERO;if(e=="")throw new Error("string is no integer");e=be.C(e);case"number":if(e===0)return this.ZERO;e=be.C(e);case"bigint":if(!e)return this.ZERO;if(e<be.UMIN)throw new Error("signed value for ulong");if(e>be.UMAX)throw new Error("ulong too large");return be.V.setBigUint64(0,e,!0),new He(be.V.getInt32(0,!0),be.V.getInt32(4,!0))}else switch(typeof e){case"string":if(e=="0")return this.ZERO;if(e=e.trim(),!Xc.test(e))throw new Error("string is no integer");let[n,s,i]=zc(e);if(n)throw new Error("signed value for ulong");return new He(s,i);case"number":if(e==0)return this.ZERO;if(!Number.isSafeInteger(e))throw new Error("number is no integer");if(e<0)throw new Error("signed value for ulong");return new He(e,e/Vs)}throw new Error("unknown value "+typeof e)}toString(){return be?this.toBigInt().toString():wr(this.lo,this.hi)}toBigInt(){return Yc(be),be.V.setInt32(0,this.lo,!0),be.V.setInt32(4,this.hi,!0),be.V.getBigUint64(0,!0)}}He.ZERO=new He(0,0);class Se extends Zc{static from(e){if(be)switch(typeof e){case"string":if(e=="0")return this.ZERO;if(e=="")throw new Error("string is no integer");e=be.C(e);case"number":if(e===0)return this.ZERO;e=be.C(e);case"bigint":if(!e)return this.ZERO;if(e<be.MIN)throw new Error("signed long too small");if(e>be.MAX)throw new Error("signed long too large");return be.V.setBigInt64(0,e,!0),new Se(be.V.getInt32(0,!0),be.V.getInt32(4,!0))}else switch(typeof e){case"string":if(e=="0")return this.ZERO;if(e=e.trim(),!Xc.test(e))throw new Error("string is no integer");let[n,s,i]=zc(e);if(n){if(i>hs||i==hs&&s!=0)throw new Error("signed long too small")}else if(i>=hs)throw new Error("signed long too large");let r=new Se(s,i);return n?r.negate():r;case"number":if(e==0)return this.ZERO;if(!Number.isSafeInteger(e))throw new Error("number is no integer");return e>0?new Se(e,e/Vs):new Se(-e,-e/Vs).negate()}throw new Error("unknown value "+typeof e)}isNegative(){return(this.hi&hs)!==0}negate(){let e=~this.hi,n=this.lo;return n?n=~n+1:e+=1,new Se(n,e)}toString(){if(be)return this.toBigInt().toString();if(this.isNegative()){let e=this.negate();return"-"+wr(e.lo,e.hi)}return wr(this.lo,this.hi)}toBigInt(){return Yc(be),be.V.setInt32(0,this.lo,!0),be.V.setInt32(4,this.hi,!0),be.V.getBigInt64(0,!0)}}Se.ZERO=new Se(0,0);const Ha={readUnknownField:!0,readerFactory:t=>new Dd(t)};function Ad(t){return t?Object.assign(Object.assign({},Ha),t):Ha}class Dd{constructor(e,n){this.varint64=Pd,this.uint32=Od,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0})}tag(){let e=this.uint32(),n=e>>>3,s=e&7;if(n<=0||s<0||s>5)throw new Error("illegal tag: field no "+n+" wire type "+s);return[n,s]}skip(e){let n=this.pos;switch(e){case Ie.Varint:for(;this.buf[this.pos++]&128;);break;case Ie.Bit64:this.pos+=4;case Ie.Bit32:this.pos+=4;break;case Ie.LengthDelimited:let s=this.uint32();this.pos+=s;break;case Ie.StartGroup:let i;for(;(i=this.tag()[1])!==Ie.EndGroup;)this.skip(i);break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(n,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return new Se(...this.varint64())}uint64(){return new He(...this.varint64())}sint64(){let[e,n]=this.varint64(),s=-(e&1);return e=(e>>>1|(n&1)<<31)^s,n=n>>>1^s,new Se(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return new He(this.sfixed32(),this.sfixed32())}sfixed64(){return new Se(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function de(t,e){if(!t)throw new Error(e)}const Ld=34028234663852886e22,jd=-34028234663852886e22,Md=4294967295,Fd=2147483647,Ud=-2147483648;function Un(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>Fd||t<Ud)throw new Error("invalid int 32: "+t)}function Bs(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>Md||t<0)throw new Error("invalid uint 32: "+t)}function Gr(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>Ld||t<jd))throw new Error("invalid float 32: "+t)}const qa={writeUnknownFields:!0,writerFactory:()=>new Vd};function $d(t){return t?Object.assign(Object.assign({},qa),t):qa}class Vd{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let i=0;i<this.chunks.length;i++)e+=this.chunks[i].length;let n=new Uint8Array(e),s=0;for(let i=0;i<this.chunks.length;i++)n.set(this.chunks[i],s),s+=this.chunks[i].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(Bs(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return Un(e),Ba(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){Gr(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){Bs(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){Un(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return Un(e),e=(e<<1^e>>31)>>>0,Ba(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),s=new DataView(n.buffer),i=Se.from(e);return s.setInt32(0,i.lo,!0),s.setInt32(4,i.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),s=new DataView(n.buffer),i=He.from(e);return s.setInt32(0,i.lo,!0),s.setInt32(4,i.hi,!0),this.raw(n)}int64(e){let n=Se.from(e);return Gi(n.lo,n.hi,this.buf),this}sint64(e){let n=Se.from(e),s=n.hi>>31,i=n.lo<<1^s,r=(n.hi<<1|n.lo>>>31)^s;return Gi(i,r,this.buf),this}uint64(e){let n=He.from(e);return Gi(n.lo,n.hi,this.buf),this}}const Wa={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0},Ga={ignoreUnknownFields:!1};function Bd(t){return t?Object.assign(Object.assign({},Ga),t):Ga}function Hd(t){return t?Object.assign(Object.assign({},Wa),t):Wa}function qd(t,e){var n,s;let i=Object.assign(Object.assign({},t),e);return i.typeRegistry=[...(n=t==null?void 0:t.typeRegistry)!==null&&n!==void 0?n:[],...(s=e==null?void 0:e.typeRegistry)!==null&&s!==void 0?s:[]],i}const Qc=Symbol.for("protobuf-ts/message-type");function Hs(t){let e=!1;const n=[];for(let s=0;s<t.length;s++){let i=t.charAt(s);i=="_"?e=!0:/\d/.test(i)?(n.push(i),e=!0):e?(n.push(i.toUpperCase()),e=!1):s==0?n.push(i.toLowerCase()):n.push(i)}return n.join("")}var E;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(E||(E={}));var kt;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING",t[t.NUMBER=2]="NUMBER"})(kt||(kt={}));var qs;(function(t){t[t.NO=0]="NO",t[t.PACKED=1]="PACKED",t[t.UNPACKED=2]="UNPACKED"})(qs||(qs={}));function Wd(t){var e,n,s,i;return t.localName=(e=t.localName)!==null&&e!==void 0?e:Hs(t.name),t.jsonName=(n=t.jsonName)!==null&&n!==void 0?n:Hs(t.name),t.repeat=(s=t.repeat)!==null&&s!==void 0?s:qs.NO,t.opt=(i=t.opt)!==null&&i!==void 0?i:t.repeat||t.oneof?!1:t.kind=="message",t}function Gd(t){if(typeof t!="object"||t===null||!t.hasOwnProperty("oneofKind"))return!1;switch(typeof t.oneofKind){case"string":return t[t.oneofKind]===void 0?!1:Object.keys(t).length==2;case"undefined":return Object.keys(t).length==1;default:return!1}}class Kd{constructor(e){var n;this.fields=(n=e.fields)!==null&&n!==void 0?n:[]}prepare(){if(this.data)return;const e=[],n=[],s=[];for(let i of this.fields)if(i.oneof)s.includes(i.oneof)||(s.push(i.oneof),e.push(i.oneof),n.push(i.oneof));else switch(n.push(i.localName),i.kind){case"scalar":case"enum":(!i.opt||i.repeat)&&e.push(i.localName);break;case"message":i.repeat&&e.push(i.localName);break;case"map":e.push(i.localName);break}this.data={req:e,known:n,oneofs:Object.values(s)}}is(e,n,s=!1){if(n<0)return!0;if(e==null||typeof e!="object")return!1;this.prepare();let i=Object.keys(e),r=this.data;if(i.length<r.req.length||r.req.some(a=>!i.includes(a))||!s&&i.some(a=>!r.known.includes(a)))return!1;if(n<1)return!0;for(const a of r.oneofs){const o=e[a];if(!Gd(o))return!1;if(o.oneofKind===void 0)continue;const l=this.fields.find(u=>u.localName===o.oneofKind);if(!l||!this.field(o[o.oneofKind],l,s,n))return!1}for(const a of this.fields)if(a.oneof===void 0&&!this.field(e[a.localName],a,s,n))return!1;return!0}field(e,n,s,i){let r=n.repeat;switch(n.kind){case"scalar":return e===void 0?n.opt:r?this.scalars(e,n.T,i,n.L):this.scalar(e,n.T,n.L);case"enum":return e===void 0?n.opt:r?this.scalars(e,E.INT32,i):this.scalar(e,E.INT32);case"message":return e===void 0?!0:r?this.messages(e,n.T(),s,i):this.message(e,n.T(),s,i);case"map":if(typeof e!="object"||e===null)return!1;if(i<2)return!0;if(!this.mapKeys(e,n.K,i))return!1;switch(n.V.kind){case"scalar":return this.scalars(Object.values(e),n.V.T,i,n.V.L);case"enum":return this.scalars(Object.values(e),E.INT32,i);case"message":return this.messages(Object.values(e),n.V.T(),s,i)}break}return!0}message(e,n,s,i){return s?n.isAssignable(e,i):n.is(e,i)}messages(e,n,s,i){if(!Array.isArray(e))return!1;if(i<2)return!0;if(s){for(let r=0;r<e.length&&r<i;r++)if(!n.isAssignable(e[r],i-1))return!1}else for(let r=0;r<e.length&&r<i;r++)if(!n.is(e[r],i-1))return!1;return!0}scalar(e,n,s){let i=typeof e;switch(n){case E.UINT64:case E.FIXED64:case E.INT64:case E.SFIXED64:case E.SINT64:switch(s){case kt.BIGINT:return i=="bigint";case kt.NUMBER:return i=="number"&&!isNaN(e);default:return i=="string"}case E.BOOL:return i=="boolean";case E.STRING:return i=="string";case E.BYTES:return e instanceof Uint8Array;case E.DOUBLE:case E.FLOAT:return i=="number"&&!isNaN(e);default:return i=="number"&&Number.isInteger(e)}}scalars(e,n,s,i){if(!Array.isArray(e))return!1;if(s<2)return!0;if(Array.isArray(e)){for(let r=0;r<e.length&&r<s;r++)if(!this.scalar(e[r],n,i))return!1}return!0}mapKeys(e,n,s){let i=Object.keys(e);switch(n){case E.INT32:case E.FIXED32:case E.SFIXED32:case E.SINT32:case E.UINT32:return this.scalars(i.slice(0,s).map(r=>parseInt(r)),n,s);case E.BOOL:return this.scalars(i.slice(0,s).map(r=>r=="true"?!0:r=="false"?!1:r),n,s);default:return this.scalars(i,n,s,kt.STRING)}}}function mt(t,e){switch(e){case kt.BIGINT:return t.toBigInt();case kt.NUMBER:return t.toNumber();default:return t.toString()}}class Jd{constructor(e){this.info=e}prepare(){var e;if(this.fMap===void 0){this.fMap={};const n=(e=this.info.fields)!==null&&e!==void 0?e:[];for(const s of n)this.fMap[s.name]=s,this.fMap[s.jsonName]=s,this.fMap[s.localName]=s}}assert(e,n,s){if(!e){let i=_n(s);throw(i=="number"||i=="boolean")&&(i=s.toString()),new Error(`Cannot parse JSON ${i} for ${this.info.typeName}#${n}`)}}read(e,n,s){this.prepare();const i=[];for(const[r,a]of Object.entries(e)){const o=this.fMap[r];if(!o){if(!s.ignoreUnknownFields)throw new Error(`Found unknown field while reading ${this.info.typeName} from JSON format. JSON key: ${r}`);continue}const l=o.localName;let u;if(o.oneof){if(a===null&&(o.kind!=="enum"||o.T()[0]!=="google.protobuf.NullValue"))continue;if(i.includes(o.oneof))throw new Error(`Multiple members of the oneof group "${o.oneof}" of ${this.info.typeName} are present in JSON.`);i.push(o.oneof),u=n[o.oneof]={oneofKind:l}}else u=n;if(o.kind=="map"){if(a===null)continue;this.assert(Us(a),o.name,a);const d=u[l];for(const[f,c]of Object.entries(a)){this.assert(c!==null,o.name+" map value",null);let h;switch(o.V.kind){case"message":h=o.V.T().internalJsonRead(c,s);break;case"enum":if(h=this.enum(o.V.T(),c,o.name,s.ignoreUnknownFields),h===!1)continue;break;case"scalar":h=this.scalar(c,o.V.T,o.V.L,o.name);break}this.assert(h!==void 0,o.name+" map value",c);let m=f;o.K==E.BOOL&&(m=m=="true"?!0:m=="false"?!1:m),m=this.scalar(m,o.K,kt.STRING,o.name).toString(),d[m]=h}}else if(o.repeat){if(a===null)continue;this.assert(Array.isArray(a),o.name,a);const d=u[l];for(const f of a){this.assert(f!==null,o.name,null);let c;switch(o.kind){case"message":c=o.T().internalJsonRead(f,s);break;case"enum":if(c=this.enum(o.T(),f,o.name,s.ignoreUnknownFields),c===!1)continue;break;case"scalar":c=this.scalar(f,o.T,o.L,o.name);break}this.assert(c!==void 0,o.name,a),d.push(c)}}else switch(o.kind){case"message":if(a===null&&o.T().typeName!="google.protobuf.Value"){this.assert(o.oneof===void 0,o.name+" (oneof member)",null);continue}u[l]=o.T().internalJsonRead(a,s,u[l]);break;case"enum":if(a===null)continue;let d=this.enum(o.T(),a,o.name,s.ignoreUnknownFields);if(d===!1)continue;u[l]=d;break;case"scalar":if(a===null)continue;u[l]=this.scalar(a,o.T,o.L,o.name);break}}}enum(e,n,s,i){if(e[0]=="google.protobuf.NullValue"&&de(n===null||n==="NULL_VALUE",`Unable to parse field ${this.info.typeName}#${s}, enum ${e[0]} only accepts null.`),n===null)return 0;switch(typeof n){case"number":return de(Number.isInteger(n),`Unable to parse field ${this.info.typeName}#${s}, enum can only be integral number, got ${n}.`),n;case"string":let r=n;e[2]&&n.substring(0,e[2].length)===e[2]&&(r=n.substring(e[2].length));let a=e[1][r];return typeof a>"u"&&i?!1:(de(typeof a=="number",`Unable to parse field ${this.info.typeName}#${s}, enum ${e[0]} has no value for "${n}".`),a)}de(!1,`Unable to parse field ${this.info.typeName}#${s}, cannot parse enum value from ${typeof n}".`)}scalar(e,n,s,i){let r;try{switch(n){case E.DOUBLE:case E.FLOAT:if(e===null)return 0;if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""){r="empty string";break}if(typeof e=="string"&&e.trim().length!==e.length){r="extra whitespace";break}if(typeof e!="string"&&typeof e!="number")break;let a=Number(e);if(Number.isNaN(a)){r="not a number";break}if(!Number.isFinite(a)){r="too large or small";break}return n==E.FLOAT&&Gr(a),a;case E.INT32:case E.FIXED32:case E.SFIXED32:case E.SINT32:case E.UINT32:if(e===null)return 0;let o;if(typeof e=="number"?o=e:e===""?r="empty string":typeof e=="string"&&(e.trim().length!==e.length?r="extra whitespace":o=Number(e)),o===void 0)break;return n==E.UINT32?Bs(o):Un(o),o;case E.INT64:case E.SFIXED64:case E.SINT64:if(e===null)return mt(Se.ZERO,s);if(typeof e!="number"&&typeof e!="string")break;return mt(Se.from(e),s);case E.FIXED64:case E.UINT64:if(e===null)return mt(He.ZERO,s);if(typeof e!="number"&&typeof e!="string")break;return mt(He.from(e),s);case E.BOOL:if(e===null)return!1;if(typeof e!="boolean")break;return e;case E.STRING:if(e===null)return"";if(typeof e!="string"){r="extra whitespace";break}try{encodeURIComponent(e)}catch(l){l="invalid UTF8";break}return e;case E.BYTES:if(e===null||e==="")return new Uint8Array(0);if(typeof e!="string")break;return Id(e)}}catch(a){r=a.message}this.assert(!1,i+(r?" - "+r:""),e)}}class zd{constructor(e){var n;this.fields=(n=e.fields)!==null&&n!==void 0?n:[]}write(e,n){const s={},i=e;for(const r of this.fields){if(!r.oneof){let u=this.field(r,i[r.localName],n);u!==void 0&&(s[n.useProtoFieldName?r.name:r.jsonName]=u);continue}const a=i[r.oneof];if(a.oneofKind!==r.localName)continue;const o=r.kind=="scalar"||r.kind=="enum"?Object.assign(Object.assign({},n),{emitDefaultValues:!0}):n;let l=this.field(r,a[r.localName],o);de(l!==void 0),s[n.useProtoFieldName?r.name:r.jsonName]=l}return s}field(e,n,s){let i;if(e.kind=="map"){de(typeof n=="object"&&n!==null);const r={};switch(e.V.kind){case"scalar":for(const[l,u]of Object.entries(n)){const d=this.scalar(e.V.T,u,e.name,!1,!0);de(d!==void 0),r[l.toString()]=d}break;case"message":const a=e.V.T();for(const[l,u]of Object.entries(n)){const d=this.message(a,u,e.name,s);de(d!==void 0),r[l.toString()]=d}break;case"enum":const o=e.V.T();for(const[l,u]of Object.entries(n)){de(u===void 0||typeof u=="number");const d=this.enum(o,u,e.name,!1,!0,s.enumAsInteger);de(d!==void 0),r[l.toString()]=d}break}(s.emitDefaultValues||Object.keys(r).length>0)&&(i=r)}else if(e.repeat){de(Array.isArray(n));const r=[];switch(e.kind){case"scalar":for(let l=0;l<n.length;l++){const u=this.scalar(e.T,n[l],e.name,e.opt,!0);de(u!==void 0),r.push(u)}break;case"enum":const a=e.T();for(let l=0;l<n.length;l++){de(n[l]===void 0||typeof n[l]=="number");const u=this.enum(a,n[l],e.name,e.opt,!0,s.enumAsInteger);de(u!==void 0),r.push(u)}break;case"message":const o=e.T();for(let l=0;l<n.length;l++){const u=this.message(o,n[l],e.name,s);de(u!==void 0),r.push(u)}break}(s.emitDefaultValues||r.length>0||s.emitDefaultValues)&&(i=r)}else switch(e.kind){case"scalar":i=this.scalar(e.T,n,e.name,e.opt,s.emitDefaultValues);break;case"enum":i=this.enum(e.T(),n,e.name,e.opt,s.emitDefaultValues,s.enumAsInteger);break;case"message":i=this.message(e.T(),n,e.name,s);break}return i}enum(e,n,s,i,r,a){if(e[0]=="google.protobuf.NullValue")return!r&&!i?void 0:null;if(n===void 0){de(i);return}if(!(n===0&&!r&&!i))return de(typeof n=="number"),de(Number.isInteger(n)),a||!e[1].hasOwnProperty(n)?n:e[2]?e[2]+e[1][n]:e[1][n]}message(e,n,s,i){return n===void 0?i.emitDefaultValues?null:void 0:e.internalJsonWrite(n,i)}scalar(e,n,s,i,r){if(n===void 0){de(i);return}const a=r||i;switch(e){case E.INT32:case E.SFIXED32:case E.SINT32:return n===0?a?0:void 0:(Un(n),n);case E.FIXED32:case E.UINT32:return n===0?a?0:void 0:(Bs(n),n);case E.FLOAT:Gr(n);case E.DOUBLE:return n===0?a?0:void 0:(de(typeof n=="number"),Number.isNaN(n)?"NaN":n===Number.POSITIVE_INFINITY?"Infinity":n===Number.NEGATIVE_INFINITY?"-Infinity":n);case E.STRING:return n===""?a?"":void 0:(de(typeof n=="string"),n);case E.BOOL:return n===!1?a?!1:void 0:(de(typeof n=="boolean"),n);case E.UINT64:case E.FIXED64:de(typeof n=="number"||typeof n=="string"||typeof n=="bigint");let o=He.from(n);return o.isZero()&&!a?void 0:o.toString();case E.INT64:case E.SFIXED64:case E.SINT64:de(typeof n=="number"||typeof n=="string"||typeof n=="bigint");let l=Se.from(n);return l.isZero()&&!a?void 0:l.toString();case E.BYTES:return de(n instanceof Uint8Array),n.byteLength?_d(n):a?"":void 0}}}function kr(t,e=kt.STRING){switch(t){case E.BOOL:return!1;case E.UINT64:case E.FIXED64:return mt(He.ZERO,e);case E.INT64:case E.SFIXED64:case E.SINT64:return mt(Se.ZERO,e);case E.DOUBLE:case E.FLOAT:return 0;case E.BYTES:return new Uint8Array(0);case E.STRING:return"";default:return 0}}class Yd{constructor(e){this.info=e}prepare(){var e;if(!this.fieldNoToField){const n=(e=this.info.fields)!==null&&e!==void 0?e:[];this.fieldNoToField=new Map(n.map(s=>[s.no,s]))}}read(e,n,s,i){this.prepare();const r=i===void 0?e.len:e.pos+i;for(;e.pos<r;){const[a,o]=e.tag(),l=this.fieldNoToField.get(a);if(!l){let c=s.readUnknownField;if(c=="throw")throw new Error(`Unknown field ${a} (wire type ${o}) for ${this.info.typeName}`);let h=e.skip(o);c!==!1&&(c===!0?$s.onRead:c)(this.info.typeName,n,a,o,h);continue}let u=n,d=l.repeat,f=l.localName;switch(l.oneof&&(u=u[l.oneof],u.oneofKind!==f&&(u=n[l.oneof]={oneofKind:f})),l.kind){case"scalar":case"enum":let c=l.kind=="enum"?E.INT32:l.T,h=l.kind=="scalar"?l.L:void 0;if(d){let g=u[f];if(o==Ie.LengthDelimited&&c!=E.STRING&&c!=E.BYTES){let y=e.uint32()+e.pos;for(;e.pos<y;)g.push(this.scalar(e,c,h))}else g.push(this.scalar(e,c,h))}else u[f]=this.scalar(e,c,h);break;case"message":if(d){let g=u[f],y=l.T().internalBinaryRead(e,e.uint32(),s);g.push(y)}else u[f]=l.T().internalBinaryRead(e,e.uint32(),s,u[f]);break;case"map":let[m,p]=this.mapEntry(l,e,s);u[f][m]=p;break}}}mapEntry(e,n,s){let i=n.uint32(),r=n.pos+i,a,o;for(;n.pos<r;){let[l,u]=n.tag();switch(l){case 1:e.K==E.BOOL?a=n.bool().toString():a=this.scalar(n,e.K,kt.STRING);break;case 2:switch(e.V.kind){case"scalar":o=this.scalar(n,e.V.T,e.V.L);break;case"enum":o=n.int32();break;case"message":o=e.V.T().internalBinaryRead(n,n.uint32(),s);break}break;default:throw new Error(`Unknown field ${l} (wire type ${u}) in map entry for ${this.info.typeName}#${e.name}`)}}if(a===void 0){let l=kr(e.K);a=e.K==E.BOOL?l.toString():l}if(o===void 0)switch(e.V.kind){case"scalar":o=kr(e.V.T,e.V.L);break;case"enum":o=0;break;case"message":o=e.V.T().create();break}return[a,o]}scalar(e,n,s){switch(n){case E.INT32:return e.int32();case E.STRING:return e.string();case E.BOOL:return e.bool();case E.DOUBLE:return e.double();case E.FLOAT:return e.float();case E.INT64:return mt(e.int64(),s);case E.UINT64:return mt(e.uint64(),s);case E.FIXED64:return mt(e.fixed64(),s);case E.FIXED32:return e.fixed32();case E.BYTES:return e.bytes();case E.UINT32:return e.uint32();case E.SFIXED32:return e.sfixed32();case E.SFIXED64:return mt(e.sfixed64(),s);case E.SINT32:return e.sint32();case E.SINT64:return mt(e.sint64(),s)}}}class Xd{constructor(e){this.info=e}prepare(){if(!this.fields){const e=this.info.fields?this.info.fields.concat():[];this.fields=e.sort((n,s)=>n.no-s.no)}}write(e,n,s){this.prepare();for(const r of this.fields){let a,o,l=r.repeat,u=r.localName;if(r.oneof){const d=e[r.oneof];if(d.oneofKind!==u)continue;a=d[u],o=!0}else a=e[u],o=!1;switch(r.kind){case"scalar":case"enum":let d=r.kind=="enum"?E.INT32:r.T;if(l)if(de(Array.isArray(a)),l==qs.PACKED)this.packed(n,d,r.no,a);else for(const f of a)this.scalar(n,d,r.no,f,!0);else a===void 0?de(r.opt):this.scalar(n,d,r.no,a,o||r.opt);break;case"message":if(l){de(Array.isArray(a));for(const f of a)this.message(n,s,r.T(),r.no,f)}else this.message(n,s,r.T(),r.no,a);break;case"map":de(typeof a=="object"&&a!==null);for(const[f,c]of Object.entries(a))this.mapEntry(n,s,r,f,c);break}}let i=s.writeUnknownFields;i!==!1&&(i===!0?$s.onWrite:i)(this.info.typeName,e,n)}mapEntry(e,n,s,i,r){e.tag(s.no,Ie.LengthDelimited),e.fork();let a=i;switch(s.K){case E.INT32:case E.FIXED32:case E.UINT32:case E.SFIXED32:case E.SINT32:a=Number.parseInt(i);break;case E.BOOL:de(i=="true"||i=="false"),a=i=="true";break}switch(this.scalar(e,s.K,1,a,!0),s.V.kind){case"scalar":this.scalar(e,s.V.T,2,r,!0);break;case"enum":this.scalar(e,E.INT32,2,r,!0);break;case"message":this.message(e,n,s.V.T(),2,r);break}e.join()}message(e,n,s,i,r){r!==void 0&&(s.internalBinaryWrite(r,e.tag(i,Ie.LengthDelimited).fork(),n),e.join())}scalar(e,n,s,i,r){let[a,o,l]=this.scalarInfo(n,i);(!l||r)&&(e.tag(s,a),e[o](i))}packed(e,n,s,i){if(!i.length)return;de(n!==E.BYTES&&n!==E.STRING),e.tag(s,Ie.LengthDelimited),e.fork();let[,r]=this.scalarInfo(n);for(let a=0;a<i.length;a++)e[r](i[a]);e.join()}scalarInfo(e,n){let s=Ie.Varint,i,r=n===void 0,a=n===0;switch(e){case E.INT32:i="int32";break;case E.STRING:a=r||!n.length,s=Ie.LengthDelimited,i="string";break;case E.BOOL:a=n===!1,i="bool";break;case E.UINT32:i="uint32";break;case E.DOUBLE:s=Ie.Bit64,i="double";break;case E.FLOAT:s=Ie.Bit32,i="float";break;case E.INT64:a=r||Se.from(n).isZero(),i="int64";break;case E.UINT64:a=r||He.from(n).isZero(),i="uint64";break;case E.FIXED64:a=r||He.from(n).isZero(),s=Ie.Bit64,i="fixed64";break;case E.BYTES:a=r||!n.byteLength,s=Ie.LengthDelimited,i="bytes";break;case E.FIXED32:s=Ie.Bit32,i="fixed32";break;case E.SFIXED32:s=Ie.Bit32,i="sfixed32";break;case E.SFIXED64:a=r||Se.from(n).isZero(),s=Ie.Bit64,i="sfixed64";break;case E.SINT32:i="sint32";break;case E.SINT64:a=r||Se.from(n).isZero(),i="sint64";break}return[s,i,r||a]}}function Zd(t){const e=t.messagePrototype?Object.create(t.messagePrototype):Object.defineProperty({},Qc,{value:t});for(let n of t.fields){let s=n.localName;if(!n.opt)if(n.oneof)e[n.oneof]={oneofKind:void 0};else if(n.repeat)e[s]=[];else switch(n.kind){case"scalar":e[s]=kr(n.T,n.L);break;case"enum":e[s]=0;break;case"map":e[s]={};break}}return e}function Ki(t,e,n){let s,i=n,r;for(let a of t.fields){let o=a.localName;if(a.oneof){const l=i[a.oneof];if((l==null?void 0:l.oneofKind)==null)continue;if(s=l[o],r=e[a.oneof],r.oneofKind=l.oneofKind,s==null){delete r[o];continue}}else if(s=i[o],r=e,s==null)continue;switch(a.repeat&&(r[o].length=s.length),a.kind){case"scalar":case"enum":if(a.repeat)for(let u=0;u<s.length;u++)r[o][u]=s[u];else r[o]=s;break;case"message":let l=a.T();if(a.repeat)for(let u=0;u<s.length;u++)r[o][u]=l.create(s[u]);else r[o]===void 0?r[o]=l.create(s):l.mergePartial(r[o],s);break;case"map":switch(a.V.kind){case"scalar":case"enum":Object.assign(r[o],s);break;case"message":let u=a.V.T();for(let d of Object.keys(s))r[o][d]=u.create(s[d]);break}break}}}function Qd(t,e,n){if(e===n)return!0;if(!e||!n)return!1;for(let s of t.fields){let i=s.localName,r=s.oneof?e[s.oneof][i]:e[i],a=s.oneof?n[s.oneof][i]:n[i];switch(s.kind){case"enum":case"scalar":let o=s.kind=="enum"?E.INT32:s.T;if(!(s.repeat?Ka(o,r,a):el(o,r,a)))return!1;break;case"map":if(!(s.V.kind=="message"?Ja(s.V.T(),fs(r),fs(a)):Ka(s.V.kind=="enum"?E.INT32:s.V.T,fs(r),fs(a))))return!1;break;case"message":let l=s.T();if(!(s.repeat?Ja(l,r,a):l.equals(r,a)))return!1;break}}return!0}const fs=Object.values;function el(t,e,n){if(e===n)return!0;if(t!==E.BYTES)return!1;let s=e,i=n;if(s.length!==i.length)return!1;for(let r=0;r<s.length;r++)if(s[r]!=i[r])return!1;return!0}function Ka(t,e,n){if(e.length!==n.length)return!1;for(let s=0;s<e.length;s++)if(!el(t,e[s],n[s]))return!1;return!0}function Ja(t,e,n){if(e.length!==n.length)return!1;for(let s=0;s<e.length;s++)if(!t.equals(e[s],n[s]))return!1;return!0}const eh=Object.getOwnPropertyDescriptors(Object.getPrototypeOf({}));class P{constructor(e,n,s){this.defaultCheckDepth=16,this.typeName=e,this.fields=n.map(Wd),this.options=s??{},this.messagePrototype=Object.create(null,Object.assign(Object.assign({},eh),{[Qc]:{value:this}})),this.refTypeCheck=new Kd(this),this.refJsonReader=new Jd(this),this.refJsonWriter=new zd(this),this.refBinReader=new Yd(this),this.refBinWriter=new Xd(this)}create(e){let n=Zd(this);return e!==void 0&&Ki(this,n,e),n}clone(e){let n=this.create();return Ki(this,n,e),n}equals(e,n){return Qd(this,e,n)}is(e,n=this.defaultCheckDepth){return this.refTypeCheck.is(e,n,!1)}isAssignable(e,n=this.defaultCheckDepth){return this.refTypeCheck.is(e,n,!0)}mergePartial(e,n){Ki(this,e,n)}fromBinary(e,n){let s=Ad(n);return this.internalBinaryRead(s.readerFactory(e),e.byteLength,s)}fromJson(e,n){return this.internalJsonRead(e,Bd(n))}fromJsonString(e,n){let s=JSON.parse(e);return this.fromJson(s,n)}toJson(e,n){return this.internalJsonWrite(e,Hd(n))}toJsonString(e,n){var s;let i=this.toJson(e,n);return JSON.stringify(i,null,(s=n==null?void 0:n.prettySpaces)!==null&&s!==void 0?s:0)}toBinary(e,n){let s=$d(n);return this.internalBinaryWrite(e,s.writerFactory(),s).finish()}internalJsonRead(e,n,s){if(e!==null&&typeof e=="object"&&!Array.isArray(e)){let i=s??this.create();return this.refJsonReader.read(e,i,n),i}throw new Error(`Unable to parse message ${this.typeName} from JSON ${_n(e)}.`)}internalJsonWrite(e,n){return this.refJsonWriter.write(e,n)}internalBinaryWrite(e,n,s){return this.refBinWriter.write(e,n,s),n}internalBinaryRead(e,n,s,i){let r=i??this.create();return this.refBinReader.read(e,r,s,n),r}}function th(t,e){var n,s,i;let r=t;return r.service=e,r.localName=(n=r.localName)!==null&&n!==void 0?n:Hs(r.name),r.serverStreaming=!!r.serverStreaming,r.clientStreaming=!!r.clientStreaming,r.options=(s=r.options)!==null&&s!==void 0?s:{},r.idempotency=(i=r.idempotency)!==null&&i!==void 0?i:void 0,r}class nh{constructor(e,n,s){this.typeName=e,this.methods=n.map(i=>th(i,this)),this.options=s??{}}}class Ze extends Error{constructor(e,n="UNKNOWN",s){super(e),this.name="RpcError",Object.setPrototypeOf(this,new.target.prototype),this.code=n,this.meta=s??{}}toString(){const e=[this.name+": "+this.message];this.code&&(e.push(""),e.push("Code: "+this.code)),this.serviceName&&this.methodName&&e.push("Method: "+this.serviceName+"/"+this.methodName);let n=Object.entries(this.meta);if(n.length){e.push(""),e.push("Meta:");for(let[s,i]of n)e.push(`  ${s}: ${i}`)}return e.join(`
`)}}function sh(t,e){if(!e)return t;let n={};ps(t,n),ps(e,n);for(let s of Object.keys(e)){let i=e[s];switch(s){case"jsonOptions":n.jsonOptions=qd(t.jsonOptions,n.jsonOptions);break;case"binaryOptions":n.binaryOptions=xd(t.binaryOptions,n.binaryOptions);break;case"meta":n.meta={},ps(t.meta,n.meta),ps(e.meta,n.meta);break;case"interceptors":n.interceptors=t.interceptors?t.interceptors.concat(i):i.concat();break}}return n}function ps(t,e){if(!t)return;let n=e;for(let[s,i]of Object.entries(t))i instanceof Date?n[s]=new Date(i.getTime()):Array.isArray(i)?n[s]=i.concat():n[s]=i}var pt;(function(t){t[t.PENDING=0]="PENDING",t[t.REJECTED=1]="REJECTED",t[t.RESOLVED=2]="RESOLVED"})(pt||(pt={}));class ms{constructor(e=!0){this._state=pt.PENDING,this._promise=new Promise((n,s)=>{this._resolve=n,this._reject=s}),e&&this._promise.catch(n=>{})}get state(){return this._state}get promise(){return this._promise}resolve(e){if(this.state!==pt.PENDING)throw new Error(`cannot resolve ${pt[this.state].toLowerCase()}`);this._resolve(e),this._state=pt.RESOLVED}reject(e){if(this.state!==pt.PENDING)throw new Error(`cannot reject ${pt[this.state].toLowerCase()}`);this._reject(e),this._state=pt.REJECTED}resolvePending(e){this._state===pt.PENDING&&this.resolve(e)}rejectPending(e){this._state===pt.PENDING&&this.reject(e)}}var ih=function(t,e,n,s){function i(r){return r instanceof n?r:new n(function(a){a(r)})}return new(n||(n=Promise))(function(r,a){function o(d){try{u(s.next(d))}catch(f){a(f)}}function l(d){try{u(s.throw(d))}catch(f){a(f)}}function u(d){d.done?r(d.value):i(d.value).then(o,l)}u((s=s.apply(t,e||[])).next())})};class rh{constructor(e,n,s,i,r,a,o){this.method=e,this.requestHeaders=n,this.request=s,this.headers=i,this.response=r,this.status=a,this.trailers=o}then(e,n){return this.promiseFinished().then(s=>e?Promise.resolve(e(s)):s,s=>n?Promise.resolve(n(s)):Promise.reject(s))}promiseFinished(){return ih(this,void 0,void 0,function*(){let[e,n,s,i]=yield Promise.all([this.headers,this.response,this.status,this.trailers]);return{method:this.method,requestHeaders:this.requestHeaders,request:this.request,headers:e,response:n,status:s,trailers:i}})}}function Pt(t,e,n,s,i){var r;{let a=(o,l,u)=>e.unary(o,l,u);for(const o of((r=s.interceptors)!==null&&r!==void 0?r:[]).filter(l=>l.interceptUnary).reverse()){const l=a;a=(u,d,f)=>o.interceptUnary(l,u,d,f)}return a(n,i,s)}}var we;(function(t){t[t.cancelled=0]="cancelled",t[t.unknown=1]="unknown",t[t.invalid_argument=2]="invalid_argument",t[t.malformed=3]="malformed",t[t.deadline_exceeded=4]="deadline_exceeded",t[t.not_found=5]="not_found",t[t.bad_route=6]="bad_route",t[t.already_exists=7]="already_exists",t[t.permission_denied=8]="permission_denied",t[t.unauthenticated=9]="unauthenticated",t[t.resource_exhausted=10]="resource_exhausted",t[t.failed_precondition=11]="failed_precondition",t[t.aborted=12]="aborted",t[t.out_of_range=13]="out_of_range",t[t.unimplemented=14]="unimplemented",t[t.internal=15]="internal",t[t.unavailable=16]="unavailable",t[t.dataloss=17]="dataloss"})(we||(we={}));function ah(t,e,n){if(n)for(let[s,i]of Object.entries(n))if(typeof i=="string")t.append(s,i);else for(let r of i)t.append(s,r);return t.set("Content-Type",e?"application/json":"application/protobuf"),t.set("Accept",e?"application/json":"application/protobuf, application/json"),t}function oh(t){if(!Us(t)||typeof t.code!="string"||typeof t.msg!="string")return new Ze("cannot read twirp error response",we[we.internal]);let e={};if(Us(t.meta))for(let[n,s]of Object.entries(t.meta))typeof s=="string"&&(e[n]=s);return new Ze(t.msg,t.code,e)}function ch(t){let e={};return t.forEach((n,s)=>{s.toLowerCase()!=="content-type"&&s.toLowerCase()!=="content-length"&&(e.hasOwnProperty(s)?e[s].push(n):e[s]=n)}),e}class lh{constructor(e){this.defaultOptions=e}mergeOptions(e){return sh(this.defaultOptions,e)}unary(e,n,s){var i,r,a;let o=s,l=this.makeUrl(e,o),u=(i=o.fetchInit)!==null&&i!==void 0?i:{},d=o.sendJson?e.I.toJsonString(n,o.jsonOptions):e.I.toBinary(n,o.binaryOptions),f=new ms,c=new ms,h=new ms,m=new ms;return globalThis.fetch(l,Object.assign(Object.assign({},u),{method:"POST",headers:ah(new globalThis.Headers,!!o.sendJson,o.meta),body:d,signal:(r=s.abort)!==null&&r!==void 0?r:null})).then(p=>{f.resolve(ch(p.headers));let g;try{g=p.type}catch{}switch(g){case"error":case"opaque":case"opaqueredirect":throw new Ze(`fetch response type ${p.type}`,we[we.unknown])}return p.ok?o.sendJson?p.json().then(y=>e.O.fromJson(y,o.jsonOptions),()=>{throw new Ze("unable to read response body as json",we[we.dataloss])}):p.arrayBuffer().then(y=>e.O.fromBinary(new Uint8Array(y),o.binaryOptions),()=>{throw new Ze("unable to read response body",we[we.dataloss])}):p.json().then(y=>{throw oh(y)},()=>{throw new Ze("received HTTP "+p.status+", unable to read response body as json",we[we.internal])})},p=>{throw p instanceof Error&&p.name==="AbortError"?new Ze(p.message,we[we.cancelled]):new Ze(p instanceof Error?p.message:p)}).then(p=>{c.resolve(p),h.resolve({code:"OK",detail:""}),m.resolve({})}).catch(p=>{let g=p instanceof Ze?p:new Ze(p instanceof Error?p.message:p,we[we.internal]);g.methodName=e.name,g.serviceName=e.service.typeName,f.rejectPending(g),c.rejectPending(g),h.rejectPending(g),m.rejectPending(g)}),new rh(e,(a=o.meta)!==null&&a!==void 0?a:{},n,f.promise,c.promise,h.promise,m.promise)}makeUrl(e,n){let s=n.baseUrl;s.endsWith("/")&&(s=s.substring(0,s.length-1));let i=e.name;return n.useProtoMethodName!==!0&&(i=Hs(i),i=i.substring(0,1).toUpperCase()+i.substring(1)),`${s}/${e.service.typeName}/${i}`}clientStreaming(e){const n=new Ze("Client streaming is not supported by Twirp",we[we.unimplemented]);throw n.methodName=e.name,n.serviceName=e.service.typeName,n}duplex(e){const n=new Ze("Duplex streaming is not supported by Twirp",we[we.unimplemented]);throw n.methodName=e.name,n.serviceName=e.service.typeName,n}serverStreaming(e){const n=new Ze("Server streaming is not supported by Twirp",we[we.unimplemented]);throw n.methodName=e.name,n.serviceName=e.service.typeName,n}}function pe(t){return typeof t=="function"}function tl(t){var e=function(s){Error.call(s),s.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var Ji=tl(function(t){return function(n){t(this),this.message=n?n.length+` errors occurred during unsubscription:
`+n.map(function(s,i){return i+1+") "+s.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=n}});function Ws(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var ns=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,s,i,r;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var o=Fs(a),l=o.next();!l.done;l=o.next()){var u=l.value;u.remove(this)}}catch(p){e={error:p}}finally{try{l&&!l.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}else a.remove(this);var d=this.initialTeardown;if(pe(d))try{d()}catch(p){r=p instanceof Ji?p.errors:[p]}var f=this._finalizers;if(f){this._finalizers=null;try{for(var c=Fs(f),h=c.next();!h.done;h=c.next()){var m=h.value;try{za(m)}catch(p){r=r??[],p instanceof Ji?r=Tn(Tn([],tn(r)),tn(p.errors)):r.push(p)}}}catch(p){s={error:p}}finally{try{h&&!h.done&&(i=c.return)&&i.call(c)}finally{if(s)throw s.error}}}if(r)throw new Ji(r)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)za(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&Ws(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&Ws(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),nl=ns.EMPTY;function sl(t){return t instanceof ns||t&&"closed"in t&&pe(t.remove)&&pe(t.add)&&pe(t.unsubscribe)}function za(t){pe(t)?t():t.unsubscribe()}var uh={Promise:void 0},dh={setTimeout:function(t,e){for(var n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];return setTimeout.apply(void 0,Tn([t,e],tn(n)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function il(t){dh.setTimeout(function(){throw t})}function Ya(){}function Ns(t){t()}var Kr=function(t){It(e,t);function e(n){var s=t.call(this)||this;return s.isStopped=!1,n?(s.destination=n,sl(n)&&n.add(s)):s.destination=ph,s}return e.create=function(n,s,i){return new Hn(n,s,i)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(ns),hh=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(s){gs(s)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(s){gs(s)}else gs(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){gs(n)}},t}(),Hn=function(t){It(e,t);function e(n,s,i){var r=t.call(this)||this,a;return pe(n)||!n?a={next:n??void 0,error:s??void 0,complete:i??void 0}:a=n,r.destination=new hh(a),r}return e}(Kr);function gs(t){il(t)}function fh(t){throw t}var ph={closed:!0,next:Ya,error:fh,complete:Ya},Jr=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function ss(t){return t}function mh(t){return t.length===0?ss:t.length===1?t[0]:function(n){return t.reduce(function(s,i){return i(s)},n)}}var ze=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,s){var i=this,r=bh(e)?e:new Hn(e,n,s);return Ns(function(){var a=i,o=a.operator,l=a.source;r.add(o?o.call(r,l):l?i._subscribe(r):i._trySubscribe(r))}),r},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var s=this;return n=Xa(n),new n(function(i,r){var a=new Hn({next:function(o){try{e(o)}catch(l){r(l),a.unsubscribe()}},error:r,complete:i});s.subscribe(a)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[Jr]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return mh(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=Xa(e),new e(function(s,i){var r;n.subscribe(function(a){return r=a},function(a){return i(a)},function(){return s(r)})})},t.create=function(e){return new t(e)},t}();function Xa(t){var e;return(e=t??uh.Promise)!==null&&e!==void 0?e:Promise}function gh(t){return t&&pe(t.next)&&pe(t.error)&&pe(t.complete)}function bh(t){return t&&t instanceof Kr||gh(t)&&sl(t)}function vh(t){return pe(t==null?void 0:t.lift)}function _t(t){return function(e){if(vh(e))return e.lift(function(n){try{return t(n,this)}catch(s){this.error(s)}});throw new TypeError("Unable to lift unknown Observable type")}}function Lt(t,e,n,s,i){return new yh(t,e,n,s,i)}var yh=function(t){It(e,t);function e(n,s,i,r,a,o){var l=t.call(this,n)||this;return l.onFinalize=a,l.shouldUnsubscribe=o,l._next=s?function(u){try{s(u)}catch(d){n.error(d)}}:t.prototype._next,l._error=r?function(u){try{r(u)}catch(d){n.error(d)}finally{this.unsubscribe()}}:t.prototype._error,l._complete=i?function(){try{i()}catch(u){n.error(u)}finally{this.unsubscribe()}}:t.prototype._complete,l}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var s=this.closed;t.prototype.unsubscribe.call(this),!s&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e}(Kr),Sh=tl(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),vi=function(t){It(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var s=new Za(this,this);return s.operator=n,s},e.prototype._throwIfClosed=function(){if(this.closed)throw new Sh},e.prototype.next=function(n){var s=this;Ns(function(){var i,r;if(s._throwIfClosed(),!s.isStopped){s.currentObservers||(s.currentObservers=Array.from(s.observers));try{for(var a=Fs(s.currentObservers),o=a.next();!o.done;o=a.next()){var l=o.value;l.next(n)}}catch(u){i={error:u}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}}})},e.prototype.error=function(n){var s=this;Ns(function(){if(s._throwIfClosed(),!s.isStopped){s.hasError=s.isStopped=!0,s.thrownError=n;for(var i=s.observers;i.length;)i.shift().error(n)}})},e.prototype.complete=function(){var n=this;Ns(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var s=n.observers;s.length;)s.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var s=this,i=this,r=i.hasError,a=i.isStopped,o=i.observers;return r||a?nl:(this.currentObservers=null,o.push(n),new ns(function(){s.currentObservers=null,Ws(o,n)}))},e.prototype._checkFinalizedStatuses=function(n){var s=this,i=s.hasError,r=s.thrownError,a=s.isStopped;i?n.error(r):a&&n.complete()},e.prototype.asObservable=function(){var n=new ze;return n.source=this,n},e.create=function(n,s){return new Za(n,s)},e}(ze),Za=function(t){It(e,t);function e(n,s){var i=t.call(this)||this;return i.destination=n,i.source=s,i}return e.prototype.next=function(n){var s,i;(i=(s=this.destination)===null||s===void 0?void 0:s.next)===null||i===void 0||i.call(s,n)},e.prototype.error=function(n){var s,i;(i=(s=this.destination)===null||s===void 0?void 0:s.error)===null||i===void 0||i.call(s,n)},e.prototype.complete=function(){var n,s;(s=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||s===void 0||s.call(n)},e.prototype._subscribe=function(n){var s,i;return(i=(s=this.source)===null||s===void 0?void 0:s.subscribe(n))!==null&&i!==void 0?i:nl},e}(vi),ee=function(t){It(e,t);function e(n){var s=t.call(this)||this;return s._value=n,s}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var s=t.prototype._subscribe.call(this,n);return!s.closed&&n.next(this._value),s},e.prototype.getValue=function(){var n=this,s=n.hasError,i=n.thrownError,r=n._value;if(s)throw i;return this._throwIfClosed(),r},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e}(vi),zr={now:function(){return(zr.delegate||Date).now()},delegate:void 0},Rr=function(t){It(e,t);function e(n,s,i){n===void 0&&(n=1/0),s===void 0&&(s=1/0),i===void 0&&(i=zr);var r=t.call(this)||this;return r._bufferSize=n,r._windowTime=s,r._timestampProvider=i,r._buffer=[],r._infiniteTimeWindow=!0,r._infiniteTimeWindow=s===1/0,r._bufferSize=Math.max(1,n),r._windowTime=Math.max(1,s),r}return e.prototype.next=function(n){var s=this,i=s.isStopped,r=s._buffer,a=s._infiniteTimeWindow,o=s._timestampProvider,l=s._windowTime;i||(r.push(n),!a&&r.push(o.now()+l)),this._trimBuffer(),t.prototype.next.call(this,n)},e.prototype._subscribe=function(n){this._throwIfClosed(),this._trimBuffer();for(var s=this._innerSubscribe(n),i=this,r=i._infiniteTimeWindow,a=i._buffer,o=a.slice(),l=0;l<o.length&&!n.closed;l+=r?1:2)n.next(o[l]);return this._checkFinalizedStatuses(n),s},e.prototype._trimBuffer=function(){var n=this,s=n._bufferSize,i=n._timestampProvider,r=n._buffer,a=n._infiniteTimeWindow,o=(a?1:2)*s;if(s<1/0&&o<r.length&&r.splice(0,r.length-o),!a){for(var l=i.now(),u=0,d=1;d<r.length&&r[d]<=l;d+=2)u=d;u&&r.splice(0,u+1)}},e}(vi),Ch=function(t){It(e,t);function e(n,s){return t.call(this)||this}return e.prototype.schedule=function(n,s){return this},e}(ns),Qa={setInterval:function(t,e){for(var n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];return setInterval.apply(void 0,Tn([t,e],tn(n)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},Th=function(t){It(e,t);function e(n,s){var i=t.call(this,n,s)||this;return i.scheduler=n,i.work=s,i.pending=!1,i}return e.prototype.schedule=function(n,s){var i;if(s===void 0&&(s=0),this.closed)return this;this.state=n;var r=this.id,a=this.scheduler;return r!=null&&(this.id=this.recycleAsyncId(a,r,s)),this.pending=!0,this.delay=s,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(a,this.id,s),this},e.prototype.requestAsyncId=function(n,s,i){return i===void 0&&(i=0),Qa.setInterval(n.flush.bind(n,this),i)},e.prototype.recycleAsyncId=function(n,s,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return s;s!=null&&Qa.clearInterval(s)},e.prototype.execute=function(n,s){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(n,s);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,s){var i=!1,r;try{this.work(n)}catch(a){i=!0,r=a||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,s=n.id,i=n.scheduler,r=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Ws(r,this),s!=null&&(this.id=this.recycleAsyncId(i,s,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(Ch),eo=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,s){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(s,n)},t.now=zr.now,t}(),wh=function(t){It(e,t);function e(n,s){s===void 0&&(s=eo.now);var i=t.call(this,n,s)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(n){var s=this.actions;if(this._active){s.push(n);return}var i;this._active=!0;do if(i=n.execute(n.state,n.delay))break;while(n=s.shift());if(this._active=!1,i){for(;n=s.shift();)n.unsubscribe();throw i}},e}(eo),kh=new wh(Th),Rh=new ze(function(t){return t.complete()});function Eh(t){return t&&pe(t.schedule)}function Yr(t){return t[t.length-1]}function Ih(t){return pe(Yr(t))?t.pop():void 0}function is(t){return Eh(Yr(t))?t.pop():void 0}function _h(t,e){return typeof Yr(t)=="number"?t.pop():e}var Xr=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function rl(t){return pe(t==null?void 0:t.then)}function al(t){return pe(t[Jr])}function ol(t){return Symbol.asyncIterator&&pe(t==null?void 0:t[Symbol.asyncIterator])}function cl(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function xh(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var ll=xh();function ul(t){return pe(t==null?void 0:t[ll])}function dl(t){return pd(this,arguments,function(){var n,s,i,r;return pc(this,function(a){switch(a.label){case 0:n=t.getReader(),a.label=1;case 1:a.trys.push([1,,9,10]),a.label=2;case 2:return[4,qi(n.read())];case 3:return s=a.sent(),i=s.value,r=s.done,r?[4,qi(void 0)]:[3,5];case 4:return[2,a.sent()];case 5:return[4,qi(i)];case 6:return[4,a.sent()];case 7:return a.sent(),[3,2];case 8:return[3,10];case 9:return n.releaseLock(),[7];case 10:return[2]}})})}function hl(t){return pe(t==null?void 0:t.getReader)}function Ft(t){if(t instanceof ze)return t;if(t!=null){if(al(t))return Ph(t);if(Xr(t))return Oh(t);if(rl(t))return Nh(t);if(ol(t))return fl(t);if(ul(t))return Ah(t);if(hl(t))return Dh(t)}throw cl(t)}function Ph(t){return new ze(function(e){var n=t[Jr]();if(pe(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Oh(t){return new ze(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function Nh(t){return new ze(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,il)})}function Ah(t){return new ze(function(e){var n,s;try{for(var i=Fs(t),r=i.next();!r.done;r=i.next()){var a=r.value;if(e.next(a),e.closed)return}}catch(o){n={error:o}}finally{try{r&&!r.done&&(s=i.return)&&s.call(i)}finally{if(n)throw n.error}}e.complete()})}function fl(t){return new ze(function(e){Lh(t,e).catch(function(n){return e.error(n)})})}function Dh(t){return fl(dl(t))}function Lh(t,e){var n,s,i,r;return md(this,void 0,void 0,function(){var a,o;return pc(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),n=gd(t),l.label=1;case 1:return[4,n.next()];case 2:if(s=l.sent(),!!s.done)return[3,4];if(a=s.value,e.next(a),e.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return o=l.sent(),i={error:o},[3,11];case 6:return l.trys.push([6,,9,10]),s&&!s.done&&(r=n.return)?[4,r.call(n)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function Bt(t,e,n,s,i){s===void 0&&(s=0),i===void 0&&(i=!1);var r=e.schedule(function(){n(),i?t.add(this.schedule(null,s)):this.unsubscribe()},s);if(t.add(r),!i)return r}function pl(t,e){return e===void 0&&(e=0),_t(function(n,s){n.subscribe(Lt(s,function(i){return Bt(s,t,function(){return s.next(i)},e)},function(){return Bt(s,t,function(){return s.complete()},e)},function(i){return Bt(s,t,function(){return s.error(i)},e)}))})}function ml(t,e){return e===void 0&&(e=0),_t(function(n,s){s.add(t.schedule(function(){return n.subscribe(s)},e))})}function jh(t,e){return Ft(t).pipe(ml(e),pl(e))}function Mh(t,e){return Ft(t).pipe(ml(e),pl(e))}function Fh(t,e){return new ze(function(n){var s=0;return e.schedule(function(){s===t.length?n.complete():(n.next(t[s++]),n.closed||this.schedule())})})}function Uh(t,e){return new ze(function(n){var s;return Bt(n,e,function(){s=t[ll](),Bt(n,e,function(){var i,r,a;try{i=s.next(),r=i.value,a=i.done}catch(o){n.error(o);return}a?n.complete():n.next(r)},0,!0)}),function(){return pe(s==null?void 0:s.return)&&s.return()}})}function gl(t,e){if(!t)throw new Error("Iterable cannot be null");return new ze(function(n){Bt(n,e,function(){var s=t[Symbol.asyncIterator]();Bt(n,e,function(){s.next().then(function(i){i.done?n.complete():n.next(i.value)})},0,!0)})})}function $h(t,e){return gl(dl(t),e)}function Vh(t,e){if(t!=null){if(al(t))return jh(t,e);if(Xr(t))return Fh(t,e);if(rl(t))return Mh(t,e);if(ol(t))return gl(t,e);if(ul(t))return Uh(t,e);if(hl(t))return $h(t,e)}throw cl(t)}function on(t,e){return e?Vh(t,e):Ft(t)}function Gs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=is(t);return on(t,n)}function Be(t,e){return _t(function(n,s){var i=0;n.subscribe(Lt(s,function(r){s.next(t.call(e,r,i++))}))})}var Bh=Array.isArray;function Hh(t,e){return Bh(e)?t.apply(void 0,Tn([],tn(e))):t(e)}function bl(t){return Be(function(e){return Hh(t,e)})}var qh=Array.isArray,Wh=Object.getPrototypeOf,Gh=Object.prototype,Kh=Object.keys;function Jh(t){if(t.length===1){var e=t[0];if(qh(e))return{args:e,keys:null};if(zh(e)){var n=Kh(e);return{args:n.map(function(s){return e[s]}),keys:n}}}return{args:t,keys:null}}function zh(t){return t&&typeof t=="object"&&Wh(t)===Gh}function Yh(t,e){return t.reduce(function(n,s,i){return n[s]=e[i],n},{})}function nn(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=is(t),s=Ih(t),i=Jh(t),r=i.args,a=i.keys;if(r.length===0)return on([],n);var o=new ze(Xh(r,n,a?function(l){return Yh(a,l)}:ss));return s?o.pipe(bl(s)):o}function Xh(t,e,n){return n===void 0&&(n=ss),function(s){to(e,function(){for(var i=t.length,r=new Array(i),a=i,o=i,l=function(d){to(e,function(){var f=on(t[d],e),c=!1;f.subscribe(Lt(s,function(h){r[d]=h,c||(c=!0,o--),o||s.next(n(r.slice()))},function(){--a||s.complete()}))},s)},u=0;u<i;u++)l(u)},s)}}function to(t,e,n){t?Bt(n,t,e):e()}function Zh(t,e,n,s,i,r,a,o){var l=[],u=0,d=0,f=!1,c=function(){f&&!l.length&&!u&&e.complete()},h=function(p){return u<s?m(p):l.push(p)},m=function(p){u++;var g=!1;Ft(n(p,d++)).subscribe(Lt(e,function(y){e.next(y)},function(){g=!0},void 0,function(){if(g)try{u--;for(var y=function(){var C=l.shift();a||m(C)};l.length&&u<s;)y();c()}catch(C){e.error(C)}}))};return t.subscribe(Lt(e,h,function(){f=!0,c()})),function(){}}function qn(t,e,n){return n===void 0&&(n=1/0),pe(e)?qn(function(s,i){return Be(function(r,a){return e(s,r,i,a)})(Ft(t(s,i)))},n):(typeof e=="number"&&(n=e),_t(function(s,i){return Zh(s,i,t,n)}))}function vl(t){return t===void 0&&(t=1/0),qn(ss,t)}function Qh(){return vl(1)}function no(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Qh()(on(t,is(t)))}var ef=["addListener","removeListener"],tf=["addEventListener","removeEventListener"],nf=["on","off"];function Er(t,e,n,s){if(pe(n)&&(s=n,n=void 0),s)return Er(t,e,n).pipe(bl(s));var i=tn(af(t)?tf.map(function(o){return function(l){return t[o](e,l,n)}}):sf(t)?ef.map(so(t,e)):rf(t)?nf.map(so(t,e)):[],2),r=i[0],a=i[1];if(!r&&Xr(t))return qn(function(o){return Er(o,e,n)})(Ft(t));if(!r)throw new TypeError("Invalid event target");return new ze(function(o){var l=function(){for(var u=[],d=0;d<arguments.length;d++)u[d]=arguments[d];return o.next(1<u.length?u:u[0])};return r(l),function(){return a(l)}})}function so(t,e){return function(n){return function(s){return t[n](e,s)}}}function sf(t){return pe(t.addListener)&&pe(t.removeListener)}function rf(t){return pe(t.on)&&pe(t.off)}function af(t){return pe(t.addEventListener)&&pe(t.removeEventListener)}function of(t,e,n){return new ze(function(s){var i=function(){for(var a=[],o=0;o<arguments.length;o++)a[o]=arguments[o];return s.next(a.length===1?a[0]:a)},r=t(i);return pe(e)?function(){return e(i,r)}:void 0})}function Zr(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=is(t),s=_h(t,1/0),i=t;return i.length?i.length===1?Ft(i[0]):vl(s)(on(i,n)):Rh}function yi(t,e){return pe(e)?qn(t,e,1):qn(t,1)}function cf(t,e){return e===void 0&&(e=kh),_t(function(n,s){var i=null,r=null,a=null,o=function(){if(i){i.unsubscribe(),i=null;var u=r;r=null,s.next(u)}};function l(){var u=a+t,d=e.now();if(d<u){i=this.schedule(void 0,u-d),s.add(i);return}o()}n.subscribe(Lt(s,function(u){r=u,a=e.now(),i||(i=e.schedule(l,t),s.add(i))},function(){o(),s.complete()},void 0,function(){r=i=null}))})}function Je(t,e){return e===void 0&&(e=ss),t=t??lf,_t(function(n,s){var i,r=!0;n.subscribe(Lt(s,function(a){var o=e(a);(r||!t(i,o))&&(r=!1,i=o,s.next(a))}))})}function lf(t,e){return t===e}function bs(t,e){return Je(function(n,s){return n[t]===s[t]})}function uf(){return _t(function(t,e){var n,s=!1;t.subscribe(Lt(e,function(i){var r=n;n=i,s&&e.next([r,i]),s=!0}))})}function df(t){t===void 0&&(t={});var e=t.connector,n=e===void 0?function(){return new vi}:e,s=t.resetOnError,i=s===void 0?!0:s,r=t.resetOnComplete,a=r===void 0?!0:r,o=t.resetOnRefCountZero,l=o===void 0?!0:o;return function(u){var d,f,c,h=0,m=!1,p=!1,g=function(){f==null||f.unsubscribe(),f=void 0},y=function(){g(),d=c=void 0,m=p=!1},C=function(){var S=d;y(),S==null||S.unsubscribe()};return _t(function(S,T){h++,!p&&!m&&g();var w=c=c??n();T.add(function(){h--,h===0&&!p&&!m&&(f=zi(C,l))}),w.subscribe(T),!d&&h>0&&(d=new Hn({next:function(k){return w.next(k)},error:function(k){p=!0,g(),f=zi(y,i,k),w.error(k)},complete:function(){m=!0,g(),f=zi(y,a),w.complete()}}),Ft(S).subscribe(d))})(u)}}function zi(t,e){for(var n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];if(e===!0){t();return}if(e!==!1){var i=new Hn({next:function(){i.unsubscribe(),t()}});return Ft(e.apply(void 0,Tn([],tn(n)))).subscribe(i)}}function Ke(t,e,n){var s,i,r,a,o=!1;return t&&typeof t=="object"?(s=t.bufferSize,a=s===void 0?1/0:s,i=t.windowTime,e=i===void 0?1/0:i,r=t.refCount,o=r===void 0?!1:r,n=t.scheduler):a=t??1/0,df({connector:function(){return new Rr(a,e,n)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:o})}function Si(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=is(t);return _t(function(s,i){(n?no(t,s,n):no(t,s)).subscribe(i)})}function Ir(t,e){return e===void 0&&(e=!1),_t(function(n,s){var i=0;n.subscribe(Lt(s,function(r){var a=t(r,i++);(a||e)&&s.next(r),!a&&s.complete()}))})}var jn={exports:{}},hf=jn.exports,io;function ff(){return io||(io=1,function(t,e){(function(n,s){var i="1.0.40",r="",a="?",o="function",l="undefined",u="object",d="string",f="major",c="model",h="name",m="type",p="vendor",g="version",y="architecture",C="console",S="mobile",T="tablet",w="smarttv",k="wearable",_="embedded",L=500,$="Amazon",N="Apple",F="ASUS",D="BlackBerry",j="Browser",x="Chrome",R="Edge",U="Firefox",V="Google",I="Huawei",A="LG",Y="Microsoft",ve="Motorola",G="Opera",Pe="Samsung",Oe="Sharp",We="Sony",ye="Xiaomi",je="Zebra",ot="Facebook",St="Chromium OS",ct="Mac OS",te=" Browser",ie=function(B,q){var X={};for(var ue in B)q[ue]&&q[ue].length%2===0?X[ue]=q[ue].concat(B[ue]):X[ue]=B[ue];return X},Q=function(B){for(var q={},X=0;X<B.length;X++)q[B[X].toUpperCase()]=B[X];return q},ae=function(B,q){return typeof B===d?oe(q).indexOf(oe(B))!==-1:!1},oe=function(B){return B.toLowerCase()},Ye=function(B){return typeof B===d?B.replace(/[^\d\.]/g,r).split(".")[0]:s},Ce=function(B,q){if(typeof B===d)return B=B.replace(/^\s\s*/,r),typeof q===l?B:B.substring(0,L)},me=function(B,q){for(var X=0,ue,Ge,ke,re,J,nt;X<q.length&&!J;){var dn=q[X],Xt=q[X+1];for(ue=Ge=0;ue<dn.length&&!J&&dn[ue];)if(J=dn[ue++].exec(B),J)for(ke=0;ke<Xt.length;ke++)nt=J[++Ge],re=Xt[ke],typeof re===u&&re.length>0?re.length===2?typeof re[1]==o?this[re[0]]=re[1].call(this,nt):this[re[0]]=re[1]:re.length===3?typeof re[1]===o&&!(re[1].exec&&re[1].test)?this[re[0]]=nt?re[1].call(this,nt,re[2]):s:this[re[0]]=nt?nt.replace(re[1],re[2]):s:re.length===4&&(this[re[0]]=nt?re[3].call(this,nt.replace(re[1],re[2])):s):this[re]=nt||s;X+=2}},le=function(B,q){for(var X in q)if(typeof q[X]===u&&q[X].length>0){for(var ue=0;ue<q[X].length;ue++)if(ae(q[X][ue],B))return X===a?s:X}else if(ae(q[X],B))return X===a?s:X;return q.hasOwnProperty("*")?q["*"]:B},ge={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},Xe={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},K={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[g,[h,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[g,[h,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[h,g],[/opios[\/ ]+([\w\.]+)/i],[g,[h,G+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[g,[h,G+" GX"]],[/\bopr\/([\w\.]+)/i],[g,[h,G]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[g,[h,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[g,[h,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[h,g],[/quark(?:pc)?\/([-\w\.]+)/i],[g,[h,"Quark"]],[/\bddg\/([\w\.]+)/i],[g,[h,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[g,[h,"UC"+j]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[g,[h,"WeChat"]],[/konqueror\/([\w\.]+)/i],[g,[h,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[g,[h,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[g,[h,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[g,[h,"Smart Lenovo "+j]],[/(avast|avg)\/([\w\.]+)/i],[[h,/(.+)/,"$1 Secure "+j],g],[/\bfocus\/([\w\.]+)/i],[g,[h,U+" Focus"]],[/\bopt\/([\w\.]+)/i],[g,[h,G+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[g,[h,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[g,[h,"Dolphin"]],[/coast\/([\w\.]+)/i],[g,[h,G+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[g,[h,"MIUI"+te]],[/fxios\/([\w\.-]+)/i],[g,[h,U]],[/\bqihoobrowser\/?([\w\.]*)/i],[g,[h,"360"]],[/\b(qq)\/([\w\.]+)/i],[[h,/(.+)/,"$1Browser"],g],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[h,/(.+)/,"$1"+te],g],[/samsungbrowser\/([\w\.]+)/i],[g,[h,Pe+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[g,[h,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[h,"Sogou Mobile"],g],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[h,g],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[h],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[g,h],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[h,ot],g],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[h,g],[/\bgsa\/([\w\.]+) .*safari\//i],[g,[h,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[g,[h,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[g,[h,x+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[h,x+" WebView"],g],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[g,[h,"Android "+j]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[h,g],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[g,[h,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[g,h],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[h,[g,le,ge]],[/(webkit|khtml)\/([\w\.]+)/i],[h,g],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[h,"Netscape"],g],[/(wolvic|librewolf)\/([\w\.]+)/i],[h,g],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[g,[h,U+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[h,[g,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[h,[g,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[y,"amd64"]],[/(ia32(?=;))/i],[[y,oe]],[/((?:i[346]|x)86)[;\)]/i],[[y,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[y,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[y,"armhf"]],[/windows (ce|mobile); ppc;/i],[[y,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[y,/ower/,r,oe]],[/(sun4\w)[;\)]/i],[[y,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[y,oe]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[c,[p,Pe],[m,T]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[c,[p,Pe],[m,S]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[c,[p,N],[m,S]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[c,[p,N],[m,T]],[/(macintosh);/i],[c,[p,N]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[c,[p,Oe],[m,S]],[/(?:honor)([-\w ]+)[;\)]/i],[c,[p,"Honor"],[m,S]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[c,[p,I],[m,T]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[c,[p,I],[m,S]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[c,/_/g," "],[p,ye],[m,S]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[c,/_/g," "],[p,ye],[m,T]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[c,[p,"OPPO"],[m,S]],[/\b(opd2\d{3}a?) bui/i],[c,[p,"OPPO"],[m,T]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[c,[p,"Vivo"],[m,S]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[c,[p,"Realme"],[m,S]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[c,[p,ve],[m,S]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[c,[p,ve],[m,T]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[c,[p,A],[m,T]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[c,[p,A],[m,S]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[c,[p,"Lenovo"],[m,T]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[c,/_/g," "],[p,"Nokia"],[m,S]],[/(pixel c)\b/i],[c,[p,V],[m,T]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[c,[p,V],[m,S]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[c,[p,We],[m,S]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[c,"Xperia Tablet"],[p,We],[m,T]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[c,[p,"OnePlus"],[m,S]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[c,[p,$],[m,T]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[c,/(.+)/g,"Fire Phone $1"],[p,$],[m,S]],[/(playbook);[-\w\),; ]+(rim)/i],[c,p,[m,T]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[c,[p,D],[m,S]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[c,[p,F],[m,T]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[c,[p,F],[m,S]],[/(nexus 9)/i],[c,[p,"HTC"],[m,T]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[p,[c,/_/g," "],[m,S]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[c,[p,"TCL"],[m,T]],[/(itel) ((\w+))/i],[[p,oe],c,[m,le,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[c,[p,"Acer"],[m,T]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[c,[p,"Meizu"],[m,S]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[c,[p,"Ulefone"],[m,S]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[c,[p,"Energizer"],[m,S]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[c,[p,"Cat"],[m,S]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[c,[p,"Smartfren"],[m,S]],[/droid.+; (a(?:015|06[35]|142p?))/i],[c,[p,"Nothing"],[m,S]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[p,c,[m,S]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[p,c,[m,T]],[/(surface duo)/i],[c,[p,Y],[m,T]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[c,[p,"Fairphone"],[m,S]],[/(u304aa)/i],[c,[p,"AT&T"],[m,S]],[/\bsie-(\w*)/i],[c,[p,"Siemens"],[m,S]],[/\b(rct\w+) b/i],[c,[p,"RCA"],[m,T]],[/\b(venue[\d ]{2,7}) b/i],[c,[p,"Dell"],[m,T]],[/\b(q(?:mv|ta)\w+) b/i],[c,[p,"Verizon"],[m,T]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[c,[p,"Barnes & Noble"],[m,T]],[/\b(tm\d{3}\w+) b/i],[c,[p,"NuVision"],[m,T]],[/\b(k88) b/i],[c,[p,"ZTE"],[m,T]],[/\b(nx\d{3}j) b/i],[c,[p,"ZTE"],[m,S]],[/\b(gen\d{3}) b.+49h/i],[c,[p,"Swiss"],[m,S]],[/\b(zur\d{3}) b/i],[c,[p,"Swiss"],[m,T]],[/\b((zeki)?tb.*\b) b/i],[c,[p,"Zeki"],[m,T]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[p,"Dragon Touch"],c,[m,T]],[/\b(ns-?\w{0,9}) b/i],[c,[p,"Insignia"],[m,T]],[/\b((nxa|next)-?\w{0,9}) b/i],[c,[p,"NextBook"],[m,T]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[p,"Voice"],c,[m,S]],[/\b(lvtel\-)?(v1[12]) b/i],[[p,"LvTel"],c,[m,S]],[/\b(ph-1) /i],[c,[p,"Essential"],[m,S]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[c,[p,"Envizen"],[m,T]],[/\b(trio[-\w\. ]+) b/i],[c,[p,"MachSpeed"],[m,T]],[/\btu_(1491) b/i],[c,[p,"Rotor"],[m,T]],[/(shield[\w ]+) b/i],[c,[p,"Nvidia"],[m,T]],[/(sprint) (\w+)/i],[p,c,[m,S]],[/(kin\.[onetw]{3})/i],[[c,/\./g," "],[p,Y],[m,S]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[c,[p,je],[m,T]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[c,[p,je],[m,S]],[/smart-tv.+(samsung)/i],[p,[m,w]],[/hbbtv.+maple;(\d+)/i],[[c,/^/,"SmartTV"],[p,Pe],[m,w]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[p,A],[m,w]],[/(apple) ?tv/i],[p,[c,N+" TV"],[m,w]],[/crkey/i],[[c,x+"cast"],[p,V],[m,w]],[/droid.+aft(\w+)( bui|\))/i],[c,[p,$],[m,w]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[c,[p,Oe],[m,w]],[/(bravia[\w ]+)( bui|\))/i],[c,[p,We],[m,w]],[/(mitv-\w{5}) bui/i],[c,[p,ye],[m,w]],[/Hbbtv.*(technisat) (.*);/i],[p,c,[m,w]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[p,Ce],[c,Ce],[m,w]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[m,w]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[p,c,[m,C]],[/droid.+; (shield) bui/i],[c,[p,"Nvidia"],[m,C]],[/(playstation [345portablevi]+)/i],[c,[p,We],[m,C]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[c,[p,Y],[m,C]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[c,[p,Pe],[m,k]],[/((pebble))app/i],[p,c,[m,k]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[c,[p,N],[m,k]],[/droid.+; (glass) \d/i],[c,[p,V],[m,k]],[/droid.+; (wt63?0{2,3})\)/i],[c,[p,je],[m,k]],[/droid.+; (glass) \d/i],[c,[p,V],[m,k]],[/(pico) (4|neo3(?: link|pro)?)/i],[p,c,[m,k]],[/; (quest( \d| pro)?)/i],[c,[p,ot],[m,k]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[p,[m,_]],[/(aeobc)\b/i],[c,[p,$],[m,_]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[c,[m,S]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[c,[m,T]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[m,T]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[m,S]],[/(android[-\w\. ]{0,9});.+buil/i],[c,[p,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[g,[h,R+"HTML"]],[/(arkweb)\/([\w\.]+)/i],[h,g],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[g,[h,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[h,g],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[g,h]],os:[[/microsoft (windows) (vista|xp)/i],[h,g],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[h,[g,le,Xe]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[g,le,Xe],[h,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[g,/_/g,"."],[h,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[h,ct],[g,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[g,h],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[h,g],[/\(bb(10);/i],[g,[h,D]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[g,[h,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[g,[h,U+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[g,[h,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[g,[h,"watchOS"]],[/crkey\/([\d\.]+)/i],[g,[h,x+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[h,St],g],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[h,g],[/(sunos) ?([\w\.\d]*)/i],[[h,"Solaris"],g],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[h,g]]},ne=function(B,q){if(typeof B===u&&(q=B,B=s),!(this instanceof ne))return new ne(B,q).getResult();var X=typeof n!==l&&n.navigator?n.navigator:s,ue=B||(X&&X.userAgent?X.userAgent:r),Ge=X&&X.userAgentData?X.userAgentData:s,ke=q?ie(K,q):K,re=X&&X.userAgent==ue;return this.getBrowser=function(){var J={};return J[h]=s,J[g]=s,me.call(J,ue,ke.browser),J[f]=Ye(J[g]),re&&X&&X.brave&&typeof X.brave.isBrave==o&&(J[h]="Brave"),J},this.getCPU=function(){var J={};return J[y]=s,me.call(J,ue,ke.cpu),J},this.getDevice=function(){var J={};return J[p]=s,J[c]=s,J[m]=s,me.call(J,ue,ke.device),re&&!J[m]&&Ge&&Ge.mobile&&(J[m]=S),re&&J[c]=="Macintosh"&&X&&typeof X.standalone!==l&&X.maxTouchPoints&&X.maxTouchPoints>2&&(J[c]="iPad",J[m]=T),J},this.getEngine=function(){var J={};return J[h]=s,J[g]=s,me.call(J,ue,ke.engine),J},this.getOS=function(){var J={};return J[h]=s,J[g]=s,me.call(J,ue,ke.os),re&&!J[h]&&Ge&&Ge.platform&&Ge.platform!="Unknown"&&(J[h]=Ge.platform.replace(/chrome os/i,St).replace(/macos/i,ct)),J},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return ue},this.setUA=function(J){return ue=typeof J===d&&J.length>L?Ce(J,L):J,this},this.setUA(ue),this};ne.VERSION=i,ne.BROWSER=Q([h,g,f]),ne.CPU=Q([y]),ne.DEVICE=Q([c,p,m,C,S,w,T,k,_]),ne.ENGINE=ne.OS=Q([h,g]),t.exports&&(e=t.exports=ne),e.UAParser=ne;var H=typeof n!==l&&(n.jQuery||n.Zepto);if(H&&!H.ua){var fe=new ne;H.ua=fe.getResult(),H.ua.get=function(){return fe.getUA()},H.ua.set=function(B){fe.setUA(B);var q=fe.getResult();for(var X in q)H.ua[X]=q[X]}}})(typeof window=="object"?window:hf)}(jn,jn.exports)),jn.exports}var pf=ff(),ft={},Yi={},Xi={exports:{}},ro;function Qr(){if(ro)return Xi.exports;ro=1;var t=Xi.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(s){s.reg||(s.reg=/(.*)/),s.format||(s.format="%s")})}),Xi.exports}var ao;function mf(){return ao||(ao=1,function(t){var e=function(o){return String(Number(o))===o?Number(o):o},n=function(o,l,u,d){if(d&&!u)l[d]=e(o[1]);else for(var f=0;f<u.length;f+=1)o[f+1]!=null&&(l[u[f]]=e(o[f+1]))},s=function(o,l,u){var d=o.name&&o.names;o.push&&!l[o.push]?l[o.push]=[]:d&&!l[o.name]&&(l[o.name]={});var f=o.push?{}:d?l[o.name]:l;n(u.match(o.reg),f,o.names,o.name),o.push&&l[o.push].push(f)},i=Qr(),r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(o){var l={},u=[],d=l;return o.split(/(\r\n|\r|\n)/).filter(r).forEach(function(f){var c=f[0],h=f.slice(2);c==="m"&&(u.push({rtp:[],fmtp:[]}),d=u[u.length-1]);for(var m=0;m<(i[c]||[]).length;m+=1){var p=i[c][m];if(p.reg.test(h))return s(p,d,h)}}),l.media=u,l};var a=function(o,l){var u=l.split(/=(.+)/,2);return u.length===2?o[u[0]]=e(u[1]):u.length===1&&l.length>1&&(o[u[0]]=void 0),o};t.parseParams=function(o){return o.split(/;\s?/).reduce(a,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(o){return o.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(o){for(var l=[],u=o.split(" ").map(e),d=0;d<u.length;d+=3)l.push({component:u[d],ip:u[d+1],port:u[d+2]});return l},t.parseImageAttributes=function(o){return o.split(" ").map(function(l){return l.substring(1,l.length-1).split(",").reduce(a,{})})},t.parseSimulcastStreamList=function(o){return o.split(";").map(function(l){return l.split(",").map(function(u){var d,f=!1;return u[0]!=="~"?d=e(u):(d=e(u.substring(1,u.length)),f=!0),{scid:d,paused:f}})})}}(Yi)),Yi}var Zi,oo;function gf(){if(oo)return Zi;oo=1;var t=Qr(),e=/%[sdv%]/g,n=function(a){var o=1,l=arguments,u=l.length;return a.replace(e,function(d){if(o>=u)return d;var f=l[o];switch(o+=1,d){case"%%":return"%";case"%s":return String(f);case"%d":return Number(f);case"%v":return""}})},s=function(a,o,l){var u=o.format instanceof Function?o.format(o.push?l:l[o.name]):o.format,d=[a+"="+u];if(o.names)for(var f=0;f<o.names.length;f+=1){var c=o.names[f];o.name?d.push(l[o.name][c]):d.push(l[o.names[f]])}else d.push(l[o.name]);return n.apply(null,d)},i=["v","o","s","i","u","e","p","c","b","t","r","z","a"],r=["i","c","b","a"];return Zi=function(a,o){o=o||{},a.version==null&&(a.version=0),a.name==null&&(a.name=" "),a.media.forEach(function(f){f.payloads==null&&(f.payloads="")});var l=o.outerOrder||i,u=o.innerOrder||r,d=[];return l.forEach(function(f){t[f].forEach(function(c){c.name in a&&a[c.name]!=null?d.push(s(f,c,a)):c.push in a&&a[c.push]!=null&&a[c.push].forEach(function(h){d.push(s(f,c,h))})})}),a.media.forEach(function(f){d.push(s("m",t.m[0],f)),u.forEach(function(c){t[c].forEach(function(h){h.name in f&&f[h.name]!=null?d.push(s(c,h,f)):h.push in f&&f[h.push]!=null&&f[h.push].forEach(function(m){d.push(s(c,h,m))})})})}),d.join(`\r
`)+`\r
`},Zi}var co;function bf(){if(co)return ft;co=1;var t=mf(),e=gf(),n=Qr();return ft.grammar=n,ft.write=e,ft.parse=t.parse,ft.parseParams=t.parseParams,ft.parseFmtpConfig=t.parseFmtpConfig,ft.parsePayloads=t.parsePayloads,ft.parseRemoteCandidates=t.parseRemoteCandidates,ft.parseImageAttributes=t.parseImageAttributes,ft.parseSimulcastStreamList=t.parseSimulcastStreamList,ft}var vf=bf();class ea{constructor(e){this.buffer=[],this.enabled=!0,this.setEnabled=n=>{this.enabled!==n&&(this.enabled=n,this.buffer=[])},this.trace=(n,s)=>{this.enabled&&this.buffer.push([n,this.id,s,Date.now()])},this.take=()=>{const n=this.buffer;return this.buffer=[],{snapshot:n,rollback:()=>{this.buffer.unshift(...n)}}},this.dispose=()=>{this.buffer=[]},this.id=e}}const Wn=new ea(null);if(typeof navigator<"u"&&typeof navigator.mediaDevices<"u"){const t=s=>({id:s.id,tracks:s.getTracks().map(i=>({id:i.id,kind:i.kind,label:i.label,enabled:i.enabled,muted:i.muted,readyState:i.readyState}))}),e=Wn.trace,n=navigator.mediaDevices;for(const s of["getUserMedia","getDisplayMedia"]){const i=n[s];i&&(n[s]=async function(a){const o=`navigator.mediaDevices.${s}`;e(o,a);try{const l=await i.call(n,a);return e(`${o}OnSuccess`,t(l)),l}catch(l){throw e(`${o}OnFailure`,l.name),l}})}}const Qi={AVAILABLE:"available",DISABLED:"disabled",AUTO_ON:"auto-on"},z={BLOCK_USERS:"block-users",CHANGE_MAX_DURATION:"change-max-duration",CREATE_CALL:"create-call",CREATE_REACTION:"create-reaction",ENABLE_NOISE_CANCELLATION:"enable-noise-cancellation",END_CALL:"end-call",JOIN_BACKSTAGE:"join-backstage",JOIN_CALL:"join-call",JOIN_ENDED_CALL:"join-ended-call",MUTE_USERS:"mute-users",PIN_FOR_EVERYONE:"pin-for-everyone",READ_CALL:"read-call",REMOVE_CALL_MEMBER:"remove-call-member",SCREENSHARE:"screenshare",SEND_AUDIO:"send-audio",SEND_VIDEO:"send-video",START_BROADCAST_CALL:"start-broadcast-call",START_CLOSED_CAPTIONS_CALL:"start-closed-captions-call",START_FRAME_RECORD_CALL:"start-frame-record-call",START_RECORD_CALL:"start-record-call",START_TRANSCRIPTION_CALL:"start-transcription-call",STOP_BROADCAST_CALL:"stop-broadcast-call",STOP_CLOSED_CAPTIONS_CALL:"stop-closed-captions-call",STOP_FRAME_RECORD_CALL:"stop-frame-record-call",STOP_RECORD_CALL:"stop-record-call",STOP_TRANSCRIPTION_CALL:"stop-transcription-call",UPDATE_CALL:"update-call",UPDATE_CALL_MEMBER:"update-call-member",UPDATE_CALL_PERMISSIONS:"update-call-permissions",UPDATE_CALL_SETTINGS:"update-call-settings"};class yl extends Error{}var Ks;(function(t){t[t.NULL_VALUE=0]="NULL_VALUE"})(Ks||(Ks={}));class yf extends P{constructor(){super("google.protobuf.Struct",[{no:1,name:"fields",kind:"map",K:9,V:{kind:"message",T:()=>vn}}])}internalJsonWrite(e,n){let s={};for(let[i,r]of Object.entries(e.fields))s[i]=vn.toJson(r);return s}internalJsonRead(e,n,s){if(!Us(e))throw new globalThis.Error("Unable to parse message "+this.typeName+" from JSON "+_n(e)+".");s||(s=this.create());for(let[i,r]of globalThis.Object.entries(e))s.fields[i]=vn.fromJson(r);return s}}const Js=new yf;class Sf extends P{constructor(){super("google.protobuf.Value",[{no:1,name:"null_value",kind:"enum",oneof:"kind",T:()=>["google.protobuf.NullValue",Ks]},{no:2,name:"number_value",kind:"scalar",oneof:"kind",T:1},{no:3,name:"string_value",kind:"scalar",oneof:"kind",T:9},{no:4,name:"bool_value",kind:"scalar",oneof:"kind",T:8},{no:5,name:"struct_value",kind:"message",oneof:"kind",T:()=>Js},{no:6,name:"list_value",kind:"message",oneof:"kind",T:()=>lo}])}internalJsonWrite(e,n){if(e.kind.oneofKind===void 0)throw new globalThis.Error;switch(e.kind.oneofKind){case void 0:throw new globalThis.Error;case"boolValue":return e.kind.boolValue;case"nullValue":return null;case"numberValue":let s=e.kind.numberValue;if(typeof s=="number"&&!Number.isFinite(s))throw new globalThis.Error;return s;case"stringValue":return e.kind.stringValue;case"listValue":let i=this.fields.find(a=>a.no===6);if((i==null?void 0:i.kind)!=="message")throw new globalThis.Error;return i.T().toJson(e.kind.listValue);case"structValue":let r=this.fields.find(a=>a.no===5);if((r==null?void 0:r.kind)!=="message")throw new globalThis.Error;return r.T().toJson(e.kind.structValue)}}internalJsonRead(e,n,s){switch(s||(s=this.create()),typeof e){case"number":s.kind={oneofKind:"numberValue",numberValue:e};break;case"string":s.kind={oneofKind:"stringValue",stringValue:e};break;case"boolean":s.kind={oneofKind:"boolValue",boolValue:e};break;case"object":e===null?s.kind={oneofKind:"nullValue",nullValue:Ks.NULL_VALUE}:globalThis.Array.isArray(e)?s.kind={oneofKind:"listValue",listValue:lo.fromJson(e)}:s.kind={oneofKind:"structValue",structValue:Js.fromJson(e)};break;default:throw new globalThis.Error("Unable to parse "+this.typeName+" from JSON "+_n(e))}return s}}const vn=new Sf;class Cf extends P{constructor(){super("google.protobuf.ListValue",[{no:1,name:"values",kind:"message",repeat:1,T:()=>vn}])}internalJsonWrite(e,n){return e.values.map(s=>vn.toJson(s))}internalJsonRead(e,n,s){if(!globalThis.Array.isArray(e))throw new globalThis.Error("Unable to parse "+this.typeName+" from JSON "+_n(e));s||(s=this.create());let i=e.map(r=>vn.fromJson(r));return s.values.push(...i),s}}const lo=new Cf;class Tf extends P{constructor(){super("google.protobuf.Timestamp",[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}])}now(){const e=this.create(),n=Date.now();return e.seconds=Se.from(Math.floor(n/1e3)).toString(),e.nanos=n%1e3*1e6,e}toDate(e){return new Date(Se.from(e.seconds).toNumber()*1e3+Math.ceil(e.nanos/1e6))}fromDate(e){const n=this.create(),s=e.getTime();return n.seconds=Se.from(Math.floor(s/1e3)).toString(),n.nanos=(s%1e3+(s<0&&s%1e3!==0?1e3:0))*1e6,n}internalJsonWrite(e,n){let s=Se.from(e.seconds).toNumber()*1e3;if(s<Date.parse("0001-01-01T00:00:00Z")||s>Date.parse("9999-12-31T23:59:59Z"))throw new Error("Unable to encode Timestamp to JSON. Must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive.");if(e.nanos<0)throw new Error("Unable to encode invalid Timestamp to JSON. Nanos must not be negative.");let i="Z";if(e.nanos>0){let r=(e.nanos+1e9).toString().substring(1);r.substring(3)==="000000"?i="."+r.substring(0,3)+"Z":r.substring(6)==="000"?i="."+r.substring(0,6)+"Z":i="."+r+"Z"}return new Date(s).toISOString().replace(".000Z",i)}internalJsonRead(e,n,s){if(typeof e!="string")throw new Error("Unable to parse Timestamp from JSON "+_n(e)+".");let i=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("Unable to parse Timestamp from JSON. Invalid format.");let r=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(r))throw new Error("Unable to parse Timestamp from JSON. Invalid value.");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new globalThis.Error("Unable to parse Timestamp from JSON. Must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive.");return s||(s=this.create()),s.seconds=Se.from(r/1e3).toString(),s.nanos=0,i[7]&&(s.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),s}}const Gn=new Tf;var Le;(function(t){t[t.PUBLISHER_UNSPECIFIED=0]="PUBLISHER_UNSPECIFIED",t[t.SUBSCRIBER=1]="SUBSCRIBER"})(Le||(Le={}));var Kn;(function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.POOR=1]="POOR",t[t.GOOD=2]="GOOD",t[t.EXCELLENT=3]="EXCELLENT"})(Kn||(Kn={}));var Ht;(function(t){t[t.LOW_UNSPECIFIED=0]="LOW_UNSPECIFIED",t[t.MID=1]="MID",t[t.HIGH=2]="HIGH",t[t.OFF=3]="OFF"})(Ht||(Ht={}));var O;(function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.AUDIO=1]="AUDIO",t[t.VIDEO=2]="VIDEO",t[t.SCREEN_SHARE=3]="SCREEN_SHARE",t[t.SCREEN_SHARE_AUDIO=4]="SCREEN_SHARE_AUDIO"})(O||(O={}));var wn;(function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.PUBLISH_TRACK_NOT_FOUND=100]="PUBLISH_TRACK_NOT_FOUND",t[t.PUBLISH_TRACKS_MISMATCH=101]="PUBLISH_TRACKS_MISMATCH",t[t.PUBLISH_TRACK_OUT_OF_ORDER=102]="PUBLISH_TRACK_OUT_OF_ORDER",t[t.PUBLISH_TRACK_VIDEO_LAYER_NOT_FOUND=103]="PUBLISH_TRACK_VIDEO_LAYER_NOT_FOUND",t[t.LIVE_ENDED=104]="LIVE_ENDED",t[t.PARTICIPANT_NOT_FOUND=200]="PARTICIPANT_NOT_FOUND",t[t.PARTICIPANT_MIGRATING_OUT=201]="PARTICIPANT_MIGRATING_OUT",t[t.PARTICIPANT_MIGRATION_FAILED=202]="PARTICIPANT_MIGRATION_FAILED",t[t.PARTICIPANT_MIGRATING=203]="PARTICIPANT_MIGRATING",t[t.PARTICIPANT_RECONNECT_FAILED=204]="PARTICIPANT_RECONNECT_FAILED",t[t.PARTICIPANT_MEDIA_TRANSPORT_FAILURE=205]="PARTICIPANT_MEDIA_TRANSPORT_FAILURE",t[t.CALL_NOT_FOUND=300]="CALL_NOT_FOUND",t[t.REQUEST_VALIDATION_FAILED=400]="REQUEST_VALIDATION_FAILED",t[t.UNAUTHENTICATED=401]="UNAUTHENTICATED",t[t.PERMISSION_DENIED=403]="PERMISSION_DENIED",t[t.TOO_MANY_REQUESTS=429]="TOO_MANY_REQUESTS",t[t.INTERNAL_SERVER_ERROR=500]="INTERNAL_SERVER_ERROR",t[t.SFU_SHUTTING_DOWN=600]="SFU_SHUTTING_DOWN",t[t.SFU_FULL=700]="SFU_FULL"})(wn||(wn={}));var Gt;(function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.REACT=1]="REACT",t[t.ANGULAR=2]="ANGULAR",t[t.ANDROID=3]="ANDROID",t[t.IOS=4]="IOS",t[t.FLUTTER=5]="FLUTTER",t[t.REACT_NATIVE=6]="REACT_NATIVE",t[t.UNITY=7]="UNITY",t[t.GO=8]="GO",t[t.PLAIN_JAVASCRIPT=9]="PLAIN_JAVASCRIPT"})(Gt||(Gt={}));var Jn;(function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.USER_MUTED=1]="USER_MUTED",t[t.PERMISSION_REVOKED=2]="PERMISSION_REVOKED",t[t.MODERATION=3]="MODERATION"})(Jn||(Jn={}));var zs;(function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.SHUTTING_DOWN=1]="SHUTTING_DOWN",t[t.REBALANCE=2]="REBALANCE"})(zs||(zs={}));var zn;(function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.ENDED=1]="ENDED",t[t.LIVE_ENDED=2]="LIVE_ENDED",t[t.KICKED=3]="KICKED",t[t.SESSION_ENDED=4]="SESSION_ENDED"})(zn||(zn={}));var se;(function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.DISCONNECT=1]="DISCONNECT",t[t.FAST=2]="FAST",t[t.REJOIN=3]="REJOIN",t[t.MIGRATE=4]="MIGRATE"})(se||(se={}));var Ys;(function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.NONE=1]="NONE",t[t.LIGHT=2]="LIGHT",t[t.MODERATE=3]="MODERATE",t[t.SEVERE=4]="SEVERE",t[t.CRITICAL=5]="CRITICAL",t[t.EMERGENCY=6]="EMERGENCY",t[t.SHUTDOWN=7]="SHUTDOWN"})(Ys||(Ys={}));var Xs;(function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.NOMINAL=1]="NOMINAL",t[t.FAIR=2]="FAIR",t[t.SERIOUS=3]="SERIOUS",t[t.CRITICAL=4]="CRITICAL"})(Xs||(Xs={}));class wf extends P{constructor(){super("stream.video.sfu.models.CallState",[{no:1,name:"participants",kind:"message",repeat:1,T:()=>cn},{no:2,name:"started_at",kind:"message",T:()=>Gn},{no:3,name:"participant_count",kind:"message",T:()=>ta},{no:4,name:"pins",kind:"message",repeat:1,T:()=>na}])}}const Sl=new wf;class kf extends P{constructor(){super("stream.video.sfu.models.ParticipantCount",[{no:1,name:"total",kind:"scalar",T:13},{no:2,name:"anonymous",kind:"scalar",T:13}])}}const ta=new kf;class Rf extends P{constructor(){super("stream.video.sfu.models.Pin",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9}])}}const na=new Rf;class Ef extends P{constructor(){super("stream.video.sfu.models.Participant",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"published_tracks",kind:"enum",repeat:1,T:()=>["stream.video.sfu.models.TrackType",O,"TRACK_TYPE_"]},{no:4,name:"joined_at",kind:"message",T:()=>Gn},{no:5,name:"track_lookup_prefix",kind:"scalar",T:9},{no:6,name:"connection_quality",kind:"enum",T:()=>["stream.video.sfu.models.ConnectionQuality",Kn,"CONNECTION_QUALITY_"]},{no:7,name:"is_speaking",kind:"scalar",T:8},{no:8,name:"is_dominant_speaker",kind:"scalar",T:8},{no:9,name:"audio_level",kind:"scalar",T:2},{no:10,name:"name",kind:"scalar",T:9},{no:11,name:"image",kind:"scalar",T:9},{no:12,name:"custom",kind:"message",T:()=>Js},{no:13,name:"roles",kind:"scalar",repeat:2,T:9}])}}const cn=new Ef;class If extends P{constructor(){super("stream.video.sfu.models.StreamQuality",[{no:1,name:"video_quality",kind:"enum",T:()=>["stream.video.sfu.models.VideoQuality",Ht,"VIDEO_QUALITY_"]},{no:2,name:"user_id",kind:"scalar",T:9}])}}const _f=new If;class xf extends P{constructor(){super("stream.video.sfu.models.VideoDimension",[{no:1,name:"width",kind:"scalar",T:13},{no:2,name:"height",kind:"scalar",T:13}])}}const Ci=new xf;class Pf extends P{constructor(){super("stream.video.sfu.models.VideoLayer",[{no:1,name:"rid",kind:"scalar",T:9},{no:2,name:"video_dimension",kind:"message",T:()=>Ci},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"fps",kind:"scalar",T:13},{no:6,name:"quality",kind:"enum",T:()=>["stream.video.sfu.models.VideoQuality",Ht,"VIDEO_QUALITY_"]}])}}const Cl=new Pf;class Of extends P{constructor(){super("stream.video.sfu.models.SubscribeOption",[{no:1,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",O,"TRACK_TYPE_"]},{no:2,name:"codecs",kind:"message",repeat:1,T:()=>zt}])}}const sa=new Of;class Nf extends P{constructor(){super("stream.video.sfu.models.PublishOption",[{no:1,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",O,"TRACK_TYPE_"]},{no:2,name:"codec",kind:"message",T:()=>zt},{no:3,name:"bitrate",kind:"scalar",T:5},{no:4,name:"fps",kind:"scalar",T:5},{no:5,name:"max_spatial_layers",kind:"scalar",T:5},{no:6,name:"max_temporal_layers",kind:"scalar",T:5},{no:7,name:"video_dimension",kind:"message",T:()=>Ci},{no:8,name:"id",kind:"scalar",T:5}])}}const kn=new Nf;class Af extends P{constructor(){super("stream.video.sfu.models.Codec",[{no:16,name:"payload_type",kind:"scalar",T:13},{no:10,name:"name",kind:"scalar",T:9},{no:14,name:"clock_rate",kind:"scalar",T:13},{no:15,name:"encoding_parameters",kind:"scalar",T:9},{no:12,name:"fmtp",kind:"scalar",T:9}])}}const zt=new Af;let Df=class extends P{constructor(){super("stream.video.sfu.models.ICETrickle",[{no:1,name:"peer_type",kind:"enum",T:()=>["stream.video.sfu.models.PeerType",Le,"PEER_TYPE_"]},{no:2,name:"ice_candidate",kind:"scalar",T:9},{no:3,name:"session_id",kind:"scalar",T:9}])}};const ia=new Df;class Lf extends P{constructor(){super("stream.video.sfu.models.TrackInfo",[{no:1,name:"track_id",kind:"scalar",T:9},{no:2,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",O,"TRACK_TYPE_"]},{no:5,name:"layers",kind:"message",repeat:1,T:()=>Cl},{no:6,name:"mid",kind:"scalar",T:9},{no:7,name:"dtx",kind:"scalar",T:8},{no:8,name:"stereo",kind:"scalar",T:8},{no:9,name:"red",kind:"scalar",T:8},{no:10,name:"muted",kind:"scalar",T:8},{no:11,name:"codec",kind:"message",T:()=>zt},{no:12,name:"publish_option_id",kind:"scalar",T:5}])}}const Ti=new Lf;let jf=class extends P{constructor(){super("stream.video.sfu.models.Error",[{no:1,name:"code",kind:"enum",T:()=>["stream.video.sfu.models.ErrorCode",wn,"ERROR_CODE_"]},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"should_retry",kind:"scalar",T:8}])}};const yt=new jf;class Mf extends P{constructor(){super("stream.video.sfu.models.ClientDetails",[{no:1,name:"sdk",kind:"message",T:()=>wl},{no:2,name:"os",kind:"message",T:()=>kl},{no:3,name:"browser",kind:"message",T:()=>Rl},{no:4,name:"device",kind:"message",T:()=>Il}])}}const Tl=new Mf;class Ff extends P{constructor(){super("stream.video.sfu.models.Sdk",[{no:1,name:"type",kind:"enum",T:()=>["stream.video.sfu.models.SdkType",Gt,"SDK_TYPE_"]},{no:2,name:"major",kind:"scalar",T:9},{no:3,name:"minor",kind:"scalar",T:9},{no:4,name:"patch",kind:"scalar",T:9}])}}const wl=new Ff;class Uf extends P{constructor(){super("stream.video.sfu.models.OS",[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"architecture",kind:"scalar",T:9}])}}const kl=new Uf;class $f extends P{constructor(){super("stream.video.sfu.models.Browser",[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"version",kind:"scalar",T:9}])}}const Rl=new $f;class Vf extends P{constructor(){super("stream.video.sfu.models.RTMPIngress",[{no:1,name:"width",kind:"scalar",T:13},{no:2,name:"height",kind:"scalar",T:13},{no:3,name:"frame_rate",kind:"scalar",T:1},{no:4,name:"software",kind:"scalar",T:9},{no:5,name:"version",kind:"scalar",T:9},{no:6,name:"encoder",kind:"scalar",T:9},{no:7,name:"remote_addr",kind:"scalar",T:9}])}}const El=new Vf;class Bf extends P{constructor(){super("stream.video.sfu.models.Device",[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"version",kind:"scalar",T:9}])}}const Il=new Bf;class Hf extends P{constructor(){super("stream.video.sfu.models.Call",[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:9},{no:3,name:"created_by_user_id",kind:"scalar",T:9},{no:4,name:"host_user_id",kind:"scalar",T:9},{no:5,name:"custom",kind:"message",T:()=>Js},{no:6,name:"created_at",kind:"message",T:()=>Gn},{no:7,name:"updated_at",kind:"message",T:()=>Gn}])}}const qf=new Hf;class Wf extends P{constructor(){super("stream.video.sfu.models.CallGrants",[{no:1,name:"can_publish_audio",kind:"scalar",T:8},{no:2,name:"can_publish_video",kind:"scalar",T:8},{no:3,name:"can_screenshare",kind:"scalar",T:8}])}}const _l=new Wf;class Gf extends P{constructor(){super("stream.video.sfu.models.InputDevices",[{no:1,name:"available_devices",kind:"scalar",repeat:2,T:9},{no:2,name:"current_device",kind:"scalar",T:9},{no:3,name:"is_permitted",kind:"scalar",T:8}])}}const _r=new Gf;class Kf extends P{constructor(){super("stream.video.sfu.models.AndroidState",[{no:1,name:"thermal_state",kind:"enum",T:()=>["stream.video.sfu.models.AndroidThermalState",Ys,"ANDROID_THERMAL_STATE_"]},{no:2,name:"is_power_saver_mode",kind:"scalar",T:8}])}}const xl=new Kf;class Jf extends P{constructor(){super("stream.video.sfu.models.AppleState",[{no:1,name:"thermal_state",kind:"enum",T:()=>["stream.video.sfu.models.AppleThermalState",Xs,"APPLE_THERMAL_STATE_"]},{no:2,name:"is_low_power_mode_enabled",kind:"scalar",T:8}])}}const Pl=new Jf;var xr=Object.freeze({__proto__:null,AndroidState:xl,get AndroidThermalState(){return Ys},AppleState:Pl,get AppleThermalState(){return Xs},Browser:Rl,Call:qf,get CallEndedReason(){return zn},CallGrants:_l,CallState:Sl,ClientDetails:Tl,Codec:zt,get ConnectionQuality(){return Kn},Device:Il,Error:yt,get ErrorCode(){return wn},get GoAwayReason(){return zs},ICETrickle:ia,InputDevices:_r,OS:kl,Participant:cn,ParticipantCount:ta,get PeerType(){return Le},Pin:na,PublishOption:kn,RTMPIngress:El,Sdk:wl,get SdkType(){return Gt},StreamQuality:_f,SubscribeOption:sa,TrackInfo:Ti,get TrackType(){return O},get TrackUnpublishReason(){return Jn},VideoDimension:Ci,VideoLayer:Cl,get VideoQuality(){return Ht},get WebsocketReconnectStrategy(){return se}});class zf extends P{constructor(){super("stream.video.sfu.signal.StartNoiseCancellationRequest",[{no:1,name:"session_id",kind:"scalar",T:9}])}}const Yf=new zf;class Xf extends P{constructor(){super("stream.video.sfu.signal.StartNoiseCancellationResponse",[{no:1,name:"error",kind:"message",T:()=>yt}])}}const Zf=new Xf;class Qf extends P{constructor(){super("stream.video.sfu.signal.StopNoiseCancellationRequest",[{no:1,name:"session_id",kind:"scalar",T:9}])}}const ep=new Qf;class tp extends P{constructor(){super("stream.video.sfu.signal.StopNoiseCancellationResponse",[{no:1,name:"error",kind:"message",T:()=>yt}])}}const np=new tp;class sp extends P{constructor(){super("stream.video.sfu.signal.Reconnection",[{no:1,name:"time_seconds",kind:"scalar",T:2},{no:2,name:"strategy",kind:"enum",T:()=>["stream.video.sfu.models.WebsocketReconnectStrategy",se,"WEBSOCKET_RECONNECT_STRATEGY_"]}])}}const ip=new sp;class rp extends P{constructor(){super("stream.video.sfu.signal.Telemetry",[{no:1,name:"connection_time_seconds",kind:"scalar",oneof:"data",T:2},{no:2,name:"reconnection",kind:"message",oneof:"data",T:()=>ip}])}}const ap=new rp;class op extends P{constructor(){super("stream.video.sfu.signal.SendStatsRequest",[{no:1,name:"session_id",kind:"scalar",T:9},{no:2,name:"subscriber_stats",kind:"scalar",T:9},{no:3,name:"publisher_stats",kind:"scalar",T:9},{no:4,name:"webrtc_version",kind:"scalar",T:9},{no:5,name:"sdk",kind:"scalar",T:9},{no:6,name:"sdk_version",kind:"scalar",T:9},{no:7,name:"audio_devices",kind:"message",T:()=>_r},{no:8,name:"video_devices",kind:"message",T:()=>_r},{no:9,name:"android",kind:"message",oneof:"deviceState",T:()=>xl},{no:10,name:"apple",kind:"message",oneof:"deviceState",T:()=>Pl},{no:11,name:"telemetry",kind:"message",T:()=>ap},{no:12,name:"rtmp",kind:"message",T:()=>El},{no:13,name:"subscriber_rtc_stats",kind:"scalar",T:9},{no:14,name:"publisher_rtc_stats",kind:"scalar",T:9}])}}const cp=new op;class lp extends P{constructor(){super("stream.video.sfu.signal.SendStatsResponse",[{no:1,name:"error",kind:"message",T:()=>yt}])}}const up=new lp;class dp extends P{constructor(){super("stream.video.sfu.signal.ICERestartRequest",[{no:1,name:"session_id",kind:"scalar",T:9},{no:2,name:"peer_type",kind:"enum",T:()=>["stream.video.sfu.models.PeerType",Le,"PEER_TYPE_"]}])}}const hp=new dp;class fp extends P{constructor(){super("stream.video.sfu.signal.ICERestartResponse",[{no:1,name:"error",kind:"message",T:()=>yt}])}}const pp=new fp;class mp extends P{constructor(){super("stream.video.sfu.signal.UpdateMuteStatesRequest",[{no:1,name:"session_id",kind:"scalar",T:9},{no:3,name:"mute_states",kind:"message",repeat:1,T:()=>Sp}])}}const gp=new mp;class bp extends P{constructor(){super("stream.video.sfu.signal.UpdateMuteStatesResponse",[{no:4,name:"error",kind:"message",T:()=>yt}])}}const vp=new bp;class yp extends P{constructor(){super("stream.video.sfu.signal.TrackMuteState",[{no:1,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",O,"TRACK_TYPE_"]},{no:2,name:"muted",kind:"scalar",T:8}])}}const Sp=new yp;class Cp extends P{constructor(){super("stream.video.sfu.signal.AudioMuteChanged",[{no:1,name:"muted",kind:"scalar",T:8}])}}new Cp;class Tp extends P{constructor(){super("stream.video.sfu.signal.VideoMuteChanged",[{no:2,name:"muted",kind:"scalar",T:8}])}}new Tp;class wp extends P{constructor(){super("stream.video.sfu.signal.UpdateSubscriptionsRequest",[{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"tracks",kind:"message",repeat:1,T:()=>ra}])}}const kp=new wp;class Rp extends P{constructor(){super("stream.video.sfu.signal.UpdateSubscriptionsResponse",[{no:4,name:"error",kind:"message",T:()=>yt}])}}const Ep=new Rp;class Ip extends P{constructor(){super("stream.video.sfu.signal.TrackSubscriptionDetails",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",O,"TRACK_TYPE_"]},{no:4,name:"dimension",kind:"message",T:()=>Ci}])}}const ra=new Ip;class _p extends P{constructor(){super("stream.video.sfu.signal.SendAnswerRequest",[{no:1,name:"peer_type",kind:"enum",T:()=>["stream.video.sfu.models.PeerType",Le,"PEER_TYPE_"]},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"session_id",kind:"scalar",T:9}])}}const xp=new _p;class Pp extends P{constructor(){super("stream.video.sfu.signal.SendAnswerResponse",[{no:4,name:"error",kind:"message",T:()=>yt}])}}const Op=new Pp;class Np extends P{constructor(){super("stream.video.sfu.signal.ICETrickleResponse",[{no:4,name:"error",kind:"message",T:()=>yt}])}}const Ap=new Np;class Dp extends P{constructor(){super("stream.video.sfu.signal.SetPublisherRequest",[{no:1,name:"sdp",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"tracks",kind:"message",repeat:1,T:()=>Ti}])}}const Lp=new Dp;class jp extends P{constructor(){super("stream.video.sfu.signal.SetPublisherResponse",[{no:1,name:"sdp",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"ice_restart",kind:"scalar",T:8},{no:4,name:"error",kind:"message",T:()=>yt}])}}const Mp=new jp,er=new nh("stream.video.sfu.signal.SignalServer",[{name:"SetPublisher",options:{},I:Lp,O:Mp},{name:"SendAnswer",options:{},I:xp,O:Op},{name:"IceTrickle",options:{},I:ia,O:Ap},{name:"UpdateSubscriptions",options:{},I:kp,O:Ep},{name:"UpdateMuteStates",options:{},I:gp,O:vp},{name:"IceRestart",options:{},I:hp,O:pp},{name:"SendStats",options:{},I:cp,O:up},{name:"StartNoiseCancellation",options:{},I:Yf,O:Zf},{name:"StopNoiseCancellation",options:{},I:ep,O:np}]);class Fp extends P{constructor(){super("stream.video.sfu.event.SfuEvent",[{no:1,name:"subscriber_offer",kind:"message",oneof:"eventPayload",T:()=>Tm},{no:2,name:"publisher_answer",kind:"message",oneof:"eventPayload",T:()=>km},{no:3,name:"connection_quality_changed",kind:"message",oneof:"eventPayload",T:()=>Em},{no:4,name:"audio_level_changed",kind:"message",oneof:"eventPayload",T:()=>Dm},{no:5,name:"ice_trickle",kind:"message",oneof:"eventPayload",T:()=>ia},{no:6,name:"change_publish_quality",kind:"message",oneof:"eventPayload",T:()=>Bm},{no:10,name:"participant_joined",kind:"message",oneof:"eventPayload",T:()=>gm},{no:11,name:"participant_left",kind:"message",oneof:"eventPayload",T:()=>vm},{no:12,name:"dominant_speaker_changed",kind:"message",oneof:"eventPayload",T:()=>Pm},{no:13,name:"join_response",kind:"message",oneof:"eventPayload",T:()=>pm},{no:14,name:"health_check_response",kind:"message",oneof:"eventPayload",T:()=>sm},{no:16,name:"track_published",kind:"message",oneof:"eventPayload",T:()=>rm},{no:17,name:"track_unpublished",kind:"message",oneof:"eventPayload",T:()=>om},{no:18,name:"error",kind:"message",oneof:"eventPayload",T:()=>Kp},{no:19,name:"call_grants_updated",kind:"message",oneof:"eventPayload",T:()=>qm},{no:20,name:"go_away",kind:"message",oneof:"eventPayload",T:()=>Gm},{no:21,name:"ice_restart",kind:"message",oneof:"eventPayload",T:()=>Yp},{no:22,name:"pins_updated",kind:"message",oneof:"eventPayload",T:()=>Wp},{no:23,name:"call_ended",kind:"message",oneof:"eventPayload",T:()=>Jm},{no:24,name:"participant_updated",kind:"message",oneof:"eventPayload",T:()=>Sm},{no:25,name:"participant_migration_complete",kind:"message",oneof:"eventPayload",T:()=>Hp},{no:27,name:"change_publish_options",kind:"message",oneof:"eventPayload",T:()=>$p}])}}const uo=new Fp;class Up extends P{constructor(){super("stream.video.sfu.event.ChangePublishOptions",[{no:1,name:"publish_options",kind:"message",repeat:1,T:()=>kn},{no:2,name:"reason",kind:"scalar",T:9}])}}const $p=new Up;class Vp extends P{constructor(){super("stream.video.sfu.event.ChangePublishOptionsComplete",[])}}new Vp;class Bp extends P{constructor(){super("stream.video.sfu.event.ParticipantMigrationComplete",[])}}const Hp=new Bp;class qp extends P{constructor(){super("stream.video.sfu.event.PinsChanged",[{no:1,name:"pins",kind:"message",repeat:1,T:()=>na}])}}const Wp=new qp;class Gp extends P{constructor(){super("stream.video.sfu.event.Error",[{no:4,name:"error",kind:"message",T:()=>yt},{no:5,name:"reconnect_strategy",kind:"enum",T:()=>["stream.video.sfu.models.WebsocketReconnectStrategy",se,"WEBSOCKET_RECONNECT_STRATEGY_"]}])}}const Kp=new Gp;class Jp extends P{constructor(){super("stream.video.sfu.event.ICETrickle",[{no:1,name:"peer_type",kind:"enum",T:()=>["stream.video.sfu.models.PeerType",Le,"PEER_TYPE_"]},{no:2,name:"ice_candidate",kind:"scalar",T:9}])}}new Jp;class zp extends P{constructor(){super("stream.video.sfu.event.ICERestart",[{no:1,name:"peer_type",kind:"enum",T:()=>["stream.video.sfu.models.PeerType",Le,"PEER_TYPE_"]}])}}const Yp=new zp;class Xp extends P{constructor(){super("stream.video.sfu.event.SfuRequest",[{no:1,name:"join_request",kind:"message",oneof:"requestPayload",T:()=>Ol},{no:2,name:"health_check_request",kind:"message",oneof:"requestPayload",T:()=>tm},{no:3,name:"leave_call_request",kind:"message",oneof:"requestPayload",T:()=>Qp}])}}const On=new Xp;class Zp extends P{constructor(){super("stream.video.sfu.event.LeaveCallRequest",[{no:1,name:"session_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9}])}}const Qp=new Zp;class em extends P{constructor(){super("stream.video.sfu.event.HealthCheckRequest",[])}}const tm=new em;class nm extends P{constructor(){super("stream.video.sfu.event.HealthCheckResponse",[{no:1,name:"participant_count",kind:"message",T:()=>ta}])}}const sm=new nm;class im extends P{constructor(){super("stream.video.sfu.event.TrackPublished",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",O,"TRACK_TYPE_"]},{no:4,name:"participant",kind:"message",T:()=>cn}])}}const rm=new im;class am extends P{constructor(){super("stream.video.sfu.event.TrackUnpublished",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",O,"TRACK_TYPE_"]},{no:4,name:"cause",kind:"enum",T:()=>["stream.video.sfu.models.TrackUnpublishReason",Jn,"TRACK_UNPUBLISH_REASON_"]},{no:5,name:"participant",kind:"message",T:()=>cn}])}}const om=new am;class cm extends P{constructor(){super("stream.video.sfu.event.JoinRequest",[{no:1,name:"token",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"subscriber_sdp",kind:"scalar",T:9},{no:8,name:"publisher_sdp",kind:"scalar",T:9},{no:4,name:"client_details",kind:"message",T:()=>Tl},{no:5,name:"migration",kind:"message",T:()=>hm},{no:6,name:"fast_reconnect",kind:"scalar",T:8},{no:7,name:"reconnect_details",kind:"message",T:()=>um},{no:9,name:"preferred_publish_options",kind:"message",repeat:1,T:()=>kn},{no:10,name:"preferred_subscribe_options",kind:"message",repeat:1,T:()=>sa}])}}const Ol=new cm;class lm extends P{constructor(){super("stream.video.sfu.event.ReconnectDetails",[{no:1,name:"strategy",kind:"enum",T:()=>["stream.video.sfu.models.WebsocketReconnectStrategy",se,"WEBSOCKET_RECONNECT_STRATEGY_"]},{no:3,name:"announced_tracks",kind:"message",repeat:1,T:()=>Ti},{no:4,name:"subscriptions",kind:"message",repeat:1,T:()=>ra},{no:5,name:"reconnect_attempt",kind:"scalar",T:13},{no:6,name:"from_sfu_id",kind:"scalar",T:9},{no:7,name:"previous_session_id",kind:"scalar",T:9},{no:8,name:"reason",kind:"scalar",T:9}])}}const um=new lm;class dm extends P{constructor(){super("stream.video.sfu.event.Migration",[{no:1,name:"from_sfu_id",kind:"scalar",T:9},{no:2,name:"announced_tracks",kind:"message",repeat:1,T:()=>Ti},{no:3,name:"subscriptions",kind:"message",repeat:1,T:()=>ra}])}}const hm=new dm;class fm extends P{constructor(){super("stream.video.sfu.event.JoinResponse",[{no:1,name:"call_state",kind:"message",T:()=>Sl},{no:2,name:"reconnected",kind:"scalar",T:8},{no:3,name:"fast_reconnect_deadline_seconds",kind:"scalar",T:5},{no:4,name:"publish_options",kind:"message",repeat:1,T:()=>kn}])}}const pm=new fm;class mm extends P{constructor(){super("stream.video.sfu.event.ParticipantJoined",[{no:1,name:"call_cid",kind:"scalar",T:9},{no:2,name:"participant",kind:"message",T:()=>cn}])}}const gm=new mm;class bm extends P{constructor(){super("stream.video.sfu.event.ParticipantLeft",[{no:1,name:"call_cid",kind:"scalar",T:9},{no:2,name:"participant",kind:"message",T:()=>cn}])}}const vm=new bm;class ym extends P{constructor(){super("stream.video.sfu.event.ParticipantUpdated",[{no:1,name:"call_cid",kind:"scalar",T:9},{no:2,name:"participant",kind:"message",T:()=>cn}])}}const Sm=new ym;class Cm extends P{constructor(){super("stream.video.sfu.event.SubscriberOffer",[{no:1,name:"ice_restart",kind:"scalar",T:8},{no:2,name:"sdp",kind:"scalar",T:9}])}}const Tm=new Cm;class wm extends P{constructor(){super("stream.video.sfu.event.PublisherAnswer",[{no:1,name:"sdp",kind:"scalar",T:9}])}}const km=new wm;class Rm extends P{constructor(){super("stream.video.sfu.event.ConnectionQualityChanged",[{no:1,name:"connection_quality_updates",kind:"message",repeat:1,T:()=>_m}])}}const Em=new Rm;class Im extends P{constructor(){super("stream.video.sfu.event.ConnectionQualityInfo",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"connection_quality",kind:"enum",T:()=>["stream.video.sfu.models.ConnectionQuality",Kn,"CONNECTION_QUALITY_"]}])}}const _m=new Im;class xm extends P{constructor(){super("stream.video.sfu.event.DominantSpeakerChanged",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9}])}}const Pm=new xm;class Om extends P{constructor(){super("stream.video.sfu.event.AudioLevel",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"level",kind:"scalar",T:2},{no:4,name:"is_speaking",kind:"scalar",T:8}])}}const Nm=new Om;class Am extends P{constructor(){super("stream.video.sfu.event.AudioLevelChanged",[{no:1,name:"audio_levels",kind:"message",repeat:1,T:()=>Nm}])}}const Dm=new Am;class Lm extends P{constructor(){super("stream.video.sfu.event.AudioSender",[{no:2,name:"codec",kind:"message",T:()=>zt},{no:3,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",O,"TRACK_TYPE_"]},{no:4,name:"publish_option_id",kind:"scalar",T:5}])}}const jm=new Lm;class Mm extends P{constructor(){super("stream.video.sfu.event.VideoLayerSetting",[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"active",kind:"scalar",T:8},{no:3,name:"max_bitrate",kind:"scalar",T:5},{no:4,name:"scale_resolution_down_by",kind:"scalar",T:2},{no:6,name:"codec",kind:"message",T:()=>zt},{no:7,name:"max_framerate",kind:"scalar",T:13},{no:8,name:"scalability_mode",kind:"scalar",T:9}])}}const Fm=new Mm;class Um extends P{constructor(){super("stream.video.sfu.event.VideoSender",[{no:2,name:"codec",kind:"message",T:()=>zt},{no:3,name:"layers",kind:"message",repeat:1,T:()=>Fm},{no:4,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",O,"TRACK_TYPE_"]},{no:5,name:"publish_option_id",kind:"scalar",T:5}])}}const $m=new Um;class Vm extends P{constructor(){super("stream.video.sfu.event.ChangePublishQuality",[{no:1,name:"audio_senders",kind:"message",repeat:1,T:()=>jm},{no:2,name:"video_senders",kind:"message",repeat:1,T:()=>$m}])}}const Bm=new Vm;class Hm extends P{constructor(){super("stream.video.sfu.event.CallGrantsUpdated",[{no:1,name:"current_grants",kind:"message",T:()=>_l},{no:2,name:"message",kind:"scalar",T:9}])}}const qm=new Hm;class Wm extends P{constructor(){super("stream.video.sfu.event.GoAway",[{no:1,name:"reason",kind:"enum",T:()=>["stream.video.sfu.models.GoAwayReason",zs,"GO_AWAY_REASON_"]}])}}const Gm=new Wm;class Km extends P{constructor(){super("stream.video.sfu.event.CallEnded",[{no:1,name:"reason",kind:"enum",T:()=>["stream.video.sfu.models.CallEndedReason",zn,"CALL_ENDED_REASON_"]}])}}const Jm=new Km;var Re;(function(t){t.UNKNOWN="UNKNOWN",t.VISIBLE="VISIBLE",t.INVISIBLE="INVISIBLE"})(Re||(Re={}));var Ct;(function(t){t[t.IMMEDIATE=20]="IMMEDIATE",t[t.FAST=100]="FAST",t[t.MEDIUM=600]="MEDIUM",t[t.SLOW=1200]="SLOW"})(Ct||(Ct={}));class zm{constructor(e){this._transport=e,this.typeName=er.typeName,this.methods=er.methods,this.options=er.options}setPublisher(e,n){const s=this.methods[0],i=this._transport.mergeOptions(n);return Pt("unary",this._transport,s,i,e)}sendAnswer(e,n){const s=this.methods[1],i=this._transport.mergeOptions(n);return Pt("unary",this._transport,s,i,e)}iceTrickle(e,n){const s=this.methods[2],i=this._transport.mergeOptions(n);return Pt("unary",this._transport,s,i,e)}updateSubscriptions(e,n){const s=this.methods[3],i=this._transport.mergeOptions(n);return Pt("unary",this._transport,s,i,e)}updateMuteStates(e,n){const s=this.methods[4],i=this._transport.mergeOptions(n);return Pt("unary",this._transport,s,i,e)}iceRestart(e,n){const s=this.methods[5],i=this._transport.mergeOptions(n);return Pt("unary",this._transport,s,i,e)}sendStats(e,n){const s=this.methods[6],i=this._transport.mergeOptions(n);return Pt("unary",this._transport,s,i,e)}startNoiseCancellation(e,n){const s=this.methods[7],i=this._transport.mergeOptions(n);return Pt("unary",this._transport,s,i,e)}stopNoiseCancellation(e,n){const s=this.methods[8],i=this._transport.mergeOptions(n);return Pt("unary",this._transport,s,i,e)}}const Ym={baseUrl:"",sendJson:!0,timeout:5*1e3,jsonOptions:{ignoreUnknownFields:!0}},Xm=t=>({interceptUnary(e,n,s,i){return i.meta={...i.meta,...t},e(n,s,i)}}),Zm=(t,e)=>({interceptUnary:(n,s,i,r)=>{let a;try{a=n(s,i,r)}finally{t(e,`Invoked SFU RPC method ${s.name}`,{request:a==null?void 0:a.request,headers:a==null?void 0:a.requestHeaders,response:a==null?void 0:a.response})}return a}}),Qm=t=>{const e={SendStats:!0};return{interceptUnary(n,s,i,r){if(e[s.name])return n(s,i,r);try{return t(s.name,i),n(s,i,r)}catch(a){throw t(`${s.name}OnFailure`,[i,a]),a}}}},eg=t=>{const e=new lh({...Ym,...t});return new zm(e)},qt=t=>new Promise(e=>setTimeout(e,t));function Pr(t){return t&&(Object.prototype.toString.call(t)==="[object Function]"||typeof t=="function"||t instanceof Function)}const mn={TOKEN_EXPIRED:40,WS_CLOSED_SUCCESS:1e3};function rs(t){const e=Math.min(500+t*2e3,5e3),n=Math.min(Math.max(250,(t-1)*2e3),5e3);return Math.floor(Math.random()*(e-n)+n)}function Nn(t){let e="";for(let n=0;n<t.length;n++)e+=t[n].toString(16).padStart(2,"0");return e}function Or(){const t=ng(16);return t[6]=t[6]&15|64,t[8]=t[8]&191|128,[Nn(t.subarray(0,4)),Nn(t.subarray(4,6)),Nn(t.subarray(6,8)),Nn(t.subarray(8,10)),Nn(t.subarray(10,16))].join("-")}const tg=typeof crypto<"u"&&crypto.getRandomValues?crypto.getRandomValues.bind(crypto):function(e){const n=Math.pow(2,8*e.byteLength/e.length);for(let s=0;s<e.length;s++)e[s]=Math.random()*n};function ng(t){const e=new Uint8Array(t);return tg(e),e}function Nr(t){typeof window<"u"&&window.addEventListener&&(window.addEventListener("offline",t),window.addEventListener("online",t))}function Nl(t){typeof window<"u"&&window.removeEventListener&&(window.removeEventListener("offline",t),window.removeEventListener("online",t))}function sg(t){return!t.status||t.status<200||300<=t.status}function ig(t){return t.code!==void 0}const De=()=>{var t;return typeof navigator>"u"?!1:((t=navigator.product)==null?void 0:t.toLowerCase())==="reactnative"},ho=Object.freeze({trace:0,debug:1,info:2,warn:3,error:4});let Al,aa="info";const Dl=(t,e,...n)=>{let s;switch(t){case"error":if(De()){e=`ERROR: ${e}`,s=console.info;break}s=console.error;break;case"warn":if(De()){e=`WARN: ${e}`,s=console.info;break}s=console.warn;break;case"info":s=console.info;break;case"trace":s=console.trace;break;default:s=console.log;break}s(e,...n)},rg=(t,e)=>{Al=t,ag(e)},ag=t=>{aa=t},Ar=()=>aa,he=t=>{const e=Al||Dl,n=(t||[]).filter(Boolean).join(":");return(i,r,...a)=>{ho[i]>=ho[aa]&&e(i,`[${n}]: ${r}`,...a)}},Ot=async(t,e)=>{var i;let n=0,s;do{n>0&&await qt(rs(n));try{s=await t()}catch(r){const a=r instanceof Ze&&r.code===we[we.cancelled],o=(e==null?void 0:e.aborted)??!1;if(a||o)throw r;he(["sfu-client","rpc"])("debug",`rpc failed (${n})`,r),n++}}while(!s||(i=s.response.error)!=null&&i.shouldRetry);return s},fo=async t=>{const e=new RTCPeerConnection;e.addTransceiver("video",{direction:t}),e.addTransceiver("audio",{direction:t});const s=(await e.createOffer()).sdp??"";return e.getTransceivers().forEach(i=>{var r;(r=i.stop)==null||r.call(i)}),e.close(),s},Dr=t=>t?(t=t.toLowerCase(),t==="vp9"||t==="av1"||t==="video/vp9"||t==="video/av1"):!1,og={subscriberOffer:void 0,publisherAnswer:void 0,connectionQualityChanged:void 0,audioLevelChanged:void 0,iceTrickle:void 0,changePublishQuality:void 0,participantJoined:void 0,participantLeft:void 0,dominantSpeakerChanged:void 0,joinResponse:void 0,healthCheckResponse:void 0,trackPublished:void 0,trackUnpublished:void 0,error:void 0,callGrantsUpdated:void 0,goAway:void 0,iceRestart:void 0,pinsUpdated:void 0,callEnded:void 0,participantUpdated:void 0,participantMigrationComplete:void 0,changePublishOptions:void 0},po=t=>Object.prototype.hasOwnProperty.call(og,t);class cg{constructor(){this.logger=he(["Dispatcher"]),this.subscribers={},this.dispatch=(e,n="0")=>{const s=e.eventPayload.oneofKind;if(!s)return;const i=e.eventPayload[s];this.logger("debug",`Dispatching ${s}, tag=${n}`,i);const r=this.subscribers[s];if(r)for(const a of r)try{a(i)}catch(o){this.logger("warn","Listener failed with error",o)}},this.on=(e,n)=>{var s;return((s=this.subscribers)[e]??(s[e]=[])).push(n),()=>{this.off(e,n)}},this.off=(e,n)=>{this.subscribers[e]=(this.subscribers[e]||[]).filter(s=>s!==n)}}}class lg{constructor(){this.subscriberCandidates=new Rr,this.publisherCandidates=new Rr,this.push=e=>{const n=ug(e);n&&(e.peerType===Le.SUBSCRIBER?this.subscriberCandidates.next(n):e.peerType===Le.PUBLISHER_UNSPECIFIED?this.publisherCandidates.next(n):he(["sfu-client"])("warn","ICETrickle, Unknown peer type",e))},this.dispose=()=>{this.subscriberCandidates.complete(),this.publisherCandidates.complete()}}}const ug=t=>{try{return JSON.parse(t.iceCandidate)}catch(e){he(["sfu-client"])("error","Failed to parse ICE Trickle",e,t);return}},tt=Ll(fg),tr=Ll(pg),Rn=new Map;function dg(t){return Rn.has(t)}async function hg(t){let e;for(;e=Rn.get(t);)await e.promise}function Ll(t){return function(n,s){const{cb:i,onContinued:r}=t(n,s),a=Rn.get(n);a==null||a.onContinued();const o=a?a.promise.then(i,i):i();return Rn.set(n,{promise:o,onContinued:r}),o}}function fg(t,e){let n=!1;return{cb:()=>e().finally(()=>{n||Rn.delete(t)}),onContinued:()=>n=!0}}function pg(t,e){const n=new AbortController;return{cb:()=>n.signal.aborted?Promise.resolve("canceled"):e(n.signal).finally(()=>{n.signal.aborted||Rn.delete(t)}),onContinued:()=>n.abort()}}const mg=t=>typeof t=="function",ht=t=>{let e,n;if(nn([t]).subscribe({next:([s])=>{e=s},error:s=>{n=s}}).unsubscribe(),n)throw n;return e},Et=(t,e)=>{const n=mg(e)?e(ht(t)):e;return t.next(n),n},jl=(t,e)=>{const n=t.getValue(),s=Et(t,e);return{lastValue:n,value:s,rollback:()=>Et(t,n)}},ut=(t,e,n=s=>he(["RxUtils"])("warn","An observable emitted an error",s))=>{const s=t.subscribe({next:e,error:n});return()=>{s.unsubscribe()}},wi=(t,e)=>{const n=Symbol();return ut(t,s=>{tt(n,()=>e(s))})};var mo=Object.freeze({__proto__:null,createSafeAsyncSubscription:wi,createSubscription:ut,getCurrentValue:ht,setCurrentValue:Et,updateValue:jl}),M;(function(t){t.UNKNOWN="unknown",t.IDLE="idle",t.RINGING="ringing",t.JOINING="joining",t.JOINED="joined",t.LEFT="left",t.RECONNECTING="reconnecting",t.MIGRATING="migrating",t.RECONNECTING_FAILED="reconnecting-failed",t.OFFLINE="offline"})(M||(M={}));class gg{constructor(){this.connectedUserSubject=new ee(void 0),this.callsSubject=new ee([]),this.setConnectedUser=e=>Et(this.connectedUserSubject,e),this.setCalls=e=>Et(this.callsSubject,e),this.registerCall=e=>{this.calls.find(n=>n.cid===e.cid)||this.setCalls(n=>[...n,e])},this.unregisterCall=e=>(he(["client-state"])("trace",`Unregistering call: ${e.cid}`),this.setCalls(s=>s.filter(i=>i!==e))),this.findCall=(e,n)=>this.calls.find(s=>s.type===e&&s.id===n),this.connectedUserSubject.subscribe(async e=>{if(!e){const n=he(["client-state"]);for(const s of this.calls)s.state.callingState!==M.LEFT&&(n("info",`User disconnected, leaving call: ${s.cid}`),await s.leave({reason:"client.disconnectUser() called"}).catch(i=>{n("error",`Error leaving call: ${s.cid}`,i)}))}})}get connectedUser(){return ht(this.connectedUserSubject)}get calls(){return ht(this.callsSubject)}}class bg{constructor(e){this.getCurrentValue=ht,this.connectedUser$=e.connectedUserSubject.asObservable(),this.calls$=e.callsSubject.asObservable()}get connectedUser(){return ht(this.connectedUser$)}get calls(){return ht(this.calls$)}}const jt=(...t)=>(e,n)=>{for(const s of t){const i=s(e,n);if(i!==0)return i}return 0},Ml=t=>e=>(n,s)=>t(n,s)?e(n,s):0,gt=t=>t.publishedTracks.includes(O.VIDEO),At=t=>t.publishedTracks.includes(O.AUDIO),bt=t=>t.publishedTracks.includes(O.SCREEN_SHARE),ki=t=>t.publishedTracks.includes(O.SCREEN_SHARE_AUDIO),vg=t=>!!t.pin&&(t.pin.isLocalPin||t.pin.pinnedAt>0),Ri=(t,e)=>t.isDominantSpeaker&&!e.isDominantSpeaker?-1:!t.isDominantSpeaker&&e.isDominantSpeaker?1:0,Ei=(t,e)=>t.isSpeaking&&!e.isSpeaking?-1:!t.isSpeaking&&e.isSpeaking?1:0,oa=(t,e)=>bt(t)&&!bt(e)?-1:!bt(t)&&bt(e)?1:0,Ii=(t,e)=>gt(t)&&!gt(e)?-1:!gt(t)&&gt(e)?1:0,_i=(t,e)=>At(t)&&!At(e)?-1:!At(t)&&At(e)?1:0,ca=(t,e)=>{if(t.pin&&e.pin){if(!t.pin.isLocalPin&&e.pin.isLocalPin)return-1;if(t.pin.isLocalPin&&!e.pin.isLocalPin)return 1;if(t.pin.pinnedAt>e.pin.pinnedAt)return-1;if(t.pin.pinnedAt<e.pin.pinnedAt)return 1}return t.pin&&!e.pin?-1:!t.pin&&e.pin?1:0},xi=t=>(e,n)=>{var s,i,r,a;return((s=e.reaction)==null?void 0:s.type)===t&&((i=n.reaction)==null?void 0:i.type)!==t?-1:((r=e.reaction)==null?void 0:r.type)!==t&&((a=n.reaction)==null?void 0:a.type)===t?1:0},yg=(...t)=>(e,n)=>vs(e,t)&&!vs(n,t)?-1:!vs(e,t)&&vs(n,t)?1:0,vs=(t,e)=>(t.roles||[]).some(n=>e.includes(n)),la=Ml((t,e)=>{var n,s;return((n=t.viewportVisibilityState)==null?void 0:n.videoTrack)===Re.INVISIBLE||((s=e.viewportVisibilityState)==null?void 0:s.videoTrack)===Re.INVISIBLE}),Sg=Ml((t,e)=>{var n,s,i,r;return((n=t.viewportVisibilityState)==null?void 0:n.videoTrack)===Re.INVISIBLE||((s=t.viewportVisibilityState)==null?void 0:s.videoTrack)===Re.UNKNOWN||((i=e.viewportVisibilityState)==null?void 0:i.videoTrack)===Re.INVISIBLE||((r=e.viewportVisibilityState)==null?void 0:r.videoTrack)===Re.UNKNOWN}),Yn=jt(ca,oa,la(jt(Ri,Ei,xi("raised-hand"),Ii,_i))),Cg=jt(ca,oa,Ri,la(jt(Ei,xi("raised-hand"),Ii,_i)));jt(ca,Sg(jt(Ri,Ei,xi("raised-hand"),Ii,_i)));const go=jt(la(jt(Ri,Ei,xi("raised-hand"),Ii,_i)),yg("admin","host","speaker")),bo={broadcasting:!1,hls:{playlist_url:"",status:""},rtmps:[]};class Fl{constructor(){this.backstageSubject=new ee(!0),this.blockedUserIdsSubject=new ee([]),this.createdAtSubject=new ee(new Date),this.endedAtSubject=new ee(void 0),this.startsAtSubject=new ee(void 0),this.updatedAtSubject=new ee(new Date),this.createdBySubject=new ee(void 0),this.customSubject=new ee({}),this.egressSubject=new ee(void 0),this.ingressSubject=new ee(void 0),this.recordingSubject=new ee(!1),this.sessionSubject=new ee(void 0),this.settingsSubject=new ee(void 0),this.transcribingSubject=new ee(!1),this.captioningSubject=new ee(!1),this.endedBySubject=new ee(void 0),this.thumbnailsSubject=new ee(void 0),this.membersSubject=new ee([]),this.ownCapabilitiesSubject=new ee([]),this.callingStateSubject=new ee(M.UNKNOWN),this.startedAtSubject=new ee(void 0),this.participantCountSubject=new ee(0),this.anonymousParticipantCountSubject=new ee(0),this.participantsSubject=new ee([]),this.callStatsReportSubject=new ee(void 0),this.closedCaptionsSubject=new ee([]),this.orphanedTracks=[],this.logger=he(["CallState"]),this.sortParticipantsBy=Yn,this.closedCaptionsTasks=new Map,this.dispose=()=>{for(const[s,i]of this.closedCaptionsTasks.entries())clearTimeout(i),this.closedCaptionsTasks.delete(s)},this.setSortParticipantsBy=s=>{this.sortParticipantsBy=s,this.setCurrentValue(this.participantsSubject,i=>i)},this.getCurrentValue=ht,this.setCurrentValue=Et,this.setParticipantCount=s=>this.setCurrentValue(this.participantCountSubject,s),this.setStartedAt=s=>this.setCurrentValue(this.startedAtSubject,s),this.setCaptioning=s=>jl(this.captioningSubject,s),this.setAnonymousParticipantCount=s=>this.setCurrentValue(this.anonymousParticipantCountSubject,s),this.setParticipants=s=>this.setCurrentValue(this.participantsSubject,s),this.setCallingState=s=>this.setCurrentValue(this.callingStateSubject,s),this.setCallStatsReport=s=>this.setCurrentValue(this.callStatsReportSubject,s),this.setMembers=s=>{this.setCurrentValue(this.membersSubject,s)},this.setOwnCapabilities=s=>this.setCurrentValue(this.ownCapabilitiesSubject,s),this.setBackstage=s=>this.setCurrentValue(this.backstageSubject,s),this.setEndedAt=s=>this.setCurrentValue(this.endedAtSubject,s),this.findParticipantBySessionId=s=>this.participants.find(i=>i.sessionId===s),this.getParticipantLookupBySessionId=()=>this.participants.reduce((s,i)=>(s[i.sessionId]=i,s),{}),this.updateParticipant=(s,i)=>{const r=this.findParticipantBySessionId(s);if(!r){this.logger("warn",`Participant with sessionId ${s} not found`);return}const a=typeof i=="function"?i(r):i,o={...r,...a};return this.setParticipants(l=>l.map(u=>u.sessionId===s?o:u))},this.updateOrAddParticipant=(s,i)=>this.setParticipants(r=>{let a=!0;const o=r.map(l=>l.sessionId===s?(a=!1,{...l,...i}):l);return a&&o.push(i),o}),this.updateParticipants=s=>Object.keys(s).length===0?this.participants:this.setParticipants(i=>i.map(r=>{const a=s[r.sessionId];return a?{...r,...a}:r})),this.updateParticipantTracks=(s,i)=>this.updateParticipants(Object.entries(i).reduce((r,[a,o])=>{o.dimension&&(o.dimension.height=Math.ceil(o.dimension.height),o.dimension.width=Math.ceil(o.dimension.width));const l=s==="videoTrack"?"videoDimension":s==="screenShareTrack"?"screenShareDimension":void 0;return l&&(r[a]={[l]:o.dimension}),r},{})),this.updateFromEvent=s=>{const i=this.eventHandlers[s.type];i&&i(s)},this.setServerSidePins=s=>{const i=s.reduce((r,a)=>(r[a.sessionId]=Date.now(),r),{});return this.setParticipants(r=>r.map(a=>{const o=i[a.sessionId];return o?{...a,pin:{isLocalPin:!1,pinnedAt:o}}:a.pin&&!a.pin.isLocalPin?{...a,pin:void 0}:a}))},this.registerOrphanedTrack=s=>{this.orphanedTracks.push(s)},this.removeOrphanedTrack=s=>{this.orphanedTracks=this.orphanedTracks.filter(i=>i.id!==s)},this.takeOrphanedTracks=s=>{const i=this.orphanedTracks.filter(r=>r.trackLookupPrefix===s);return i.length>0&&(this.orphanedTracks=this.orphanedTracks.filter(r=>r.trackLookupPrefix!==s)),i},this.updateClosedCaptionSettings=s=>{this.closedCaptionsSettings={...this.closedCaptionsSettings,...s}},this.updateFromCallResponse=s=>{this.setBackstage(s.backstage),this.setCurrentValue(this.blockedUserIdsSubject,s.blocked_user_ids),this.setCurrentValue(this.createdAtSubject,new Date(s.created_at)),this.setCurrentValue(this.updatedAtSubject,new Date(s.updated_at)),this.setCurrentValue(this.startsAtSubject,s.starts_at?new Date(s.starts_at):void 0),this.setEndedAt(s.ended_at?new Date(s.ended_at):void 0),this.setCurrentValue(this.createdBySubject,s.created_by),this.setCurrentValue(this.customSubject,s.custom),this.setCurrentValue(this.egressSubject,s.egress),this.setCurrentValue(this.ingressSubject,s.ingress),this.setCurrentValue(this.recordingSubject,s.recording);const i=this.setCurrentValue(this.sessionSubject,s.session);this.updateParticipantCountFromSession(i),this.setCurrentValue(this.settingsSubject,s.settings),this.setCurrentValue(this.transcribingSubject,s.transcribing),this.setCurrentValue(this.captioningSubject,s.captioning),this.setCurrentValue(this.thumbnailsSubject,s.thumbnails)},this.updateFromSfuCallState=(s,i,r)=>{const{participants:a,participantCount:o,startedAt:l,pins:u}=s,d=(r==null?void 0:r.announcedTracks.map(f=>f.trackType))??[];this.setParticipants(()=>{const f=this.getParticipantLookupBySessionId();return a.map(c=>{const h=f[c.sessionId],m=c.sessionId===i;return Object.assign({},h,c,{isLocalParticipant:m,publishedTracks:m?d:c.publishedTracks,viewportVisibilityState:(h==null?void 0:h.viewportVisibilityState)??{videoTrack:Re.UNKNOWN,screenShareTrack:Re.UNKNOWN}})})}),this.setParticipantCount((o==null?void 0:o.total)||0),this.setAnonymousParticipantCount((o==null?void 0:o.anonymous)||0),this.setStartedAt(l?Gn.toDate(l):new Date),this.setServerSidePins(u)},this.updateFromMemberRemoved=s=>{this.updateFromCallResponse(s.call),this.setCurrentValue(this.membersSubject,i=>i.filter(r=>s.members.indexOf(r.user_id)===-1))},this.updateFromMemberAdded=s=>{this.updateFromCallResponse(s.call),this.setCurrentValue(this.membersSubject,i=>[...i,...s.members])},this.updateFromHLSBroadcastStopped=()=>{this.setCurrentValue(this.egressSubject,(s=bo)=>({...s,broadcasting:!1,hls:{...s.hls,status:""}}))},this.updateFromHLSBroadcastingFailed=()=>{this.setCurrentValue(this.egressSubject,(s=bo)=>({...s,broadcasting:!1,hls:{...s.hls,status:""}}))},this.updateParticipantCountFromSession=s=>{if(!s||this.callingState===M.JOINED)return;const i=Object.values(s.participants_count_by_role).reduce((a,o)=>a+o,0),r=Math.max(i,s.participants.length);this.setParticipantCount(r),this.setAnonymousParticipantCount(s.anonymous_participant_count||0)},this.updateFromSessionParticipantCountUpdate=s=>{const i=this.setCurrentValue(this.sessionSubject,r=>r&&{...r,anonymous_participant_count:s.anonymous_participant_count,participants_count_by_role:s.participants_count_by_role});this.updateParticipantCountFromSession(i)},this.updateFromSessionParticipantLeft=s=>{const i=this.setCurrentValue(this.sessionSubject,r=>{if(!r)return r;const{participants:a,participants_count_by_role:o}=r,{user:l,user_session_id:u}=s.participant;return{...r,participants:a.filter(d=>d.user_session_id!==u),participants_count_by_role:{...o,[l.role]:Math.max(0,(o[l.role]||0)-1)}}});this.updateParticipantCountFromSession(i)},this.updateFromSessionParticipantJoined=s=>{const i=this.setCurrentValue(this.sessionSubject,r=>{if(!r)return r;const{participants:a,participants_count_by_role:o}=r,{user:l,user_session_id:u}=s.participant;let d=!0;const f=a.map(h=>h.user_session_id===u?(d=!1,s.participant):h);d&&f.push(s.participant);const c=d?1:0;return{...r,participants:f,participants_count_by_role:{...o,[l.role]:(o[l.role]||0)+c}}});this.updateParticipantCountFromSession(i)},this.updateMembers=s=>{this.updateFromCallResponse(s.call),this.setCurrentValue(this.membersSubject,i=>i.map(r=>{const a=s.members.find(o=>o.user_id===r.user_id);return a||r}))},this.updateParticipantReaction=s=>{const{user:i,custom:r,type:a,emoji_code:o}=s.reaction;this.setParticipants(l=>l.map(u=>u.userId!==i.id?u:{...u,reaction:{type:a,emoji_code:o,custom:r}}))},this.unblockUser=s=>{this.setCurrentValue(this.blockedUserIdsSubject,i=>i&&i.filter(r=>r!==s.user.id))},this.blockUser=s=>{this.setCurrentValue(this.blockedUserIdsSubject,i=>[...i||[],s.user.id])},this.updateOwnCapabilities=s=>{var i;s.user.id===((i=this.localParticipant)==null?void 0:i.userId)&&this.setCurrentValue(this.ownCapabilitiesSubject,s.own_capabilities)},this.updateFromClosedCaptions=s=>{this.setCurrentValue(this.closedCaptionsSubject,i=>{const{closed_caption:r}=s,a=c=>`${c.speaker_id}/${c.start_time}`,o=a(r);if(i.some(c=>a(c)===o))return i;const u=[...i,r],{visibilityDurationMs:d=2700,maxVisibleCaptions:f=2}=this.closedCaptionsSettings||{};if(d>0){const c=setTimeout(()=>{this.setCurrentValue(this.closedCaptionsSubject,h=>h.filter(m=>m!==r)),this.closedCaptionsTasks.delete(o)},d);this.closedCaptionsTasks.set(o,c);for(let h=0;h<u.length-f;h++){const m=a(u[h]),p=this.closedCaptionsTasks.get(m);clearTimeout(p),this.closedCaptionsTasks.delete(m)}}return u.slice(-f)})},this.participants$=this.participantsSubject.asObservable().pipe(Be(s=>s.sort(this.sortParticipantsBy)),Ke({bufferSize:1,refCount:!0})),this.localParticipant$=this.participants$.pipe(Be(s=>s.find(i=>i.isLocalParticipant)),Ke({bufferSize:1,refCount:!0})),this.remoteParticipants$=this.participants$.pipe(Be(s=>s.filter(i=>!i.isLocalParticipant)),Ke({bufferSize:1,refCount:!0})),this.pinnedParticipants$=this.participants$.pipe(Be(s=>s.filter(i=>!!i.pin)),Ke({bufferSize:1,refCount:!0})),this.dominantSpeaker$=this.participants$.pipe(Be(s=>s.find(i=>i.isDominantSpeaker)),Ke({bufferSize:1,refCount:!0})),this.hasOngoingScreenShare$=this.participants$.pipe(Be(s=>s.some(i=>bt(i))),Je(),Ke({bufferSize:1,refCount:!0})),this.createdAt$=this.createdAtSubject.asObservable(),this.endedAt$=this.endedAtSubject.asObservable(),this.startsAt$=this.startsAtSubject.asObservable(),this.startedAt$=this.startedAtSubject.asObservable(),this.updatedAt$=this.updatedAtSubject.asObservable(),this.callStatsReport$=this.callStatsReportSubject.asObservable(),this.members$=this.membersSubject.asObservable(),this.createdBy$=this.createdBySubject.asObservable(),this.custom$=this.customSubject.asObservable(),this.egress$=this.egressSubject.asObservable(),this.ingress$=this.ingressSubject.asObservable(),this.session$=this.sessionSubject.asObservable(),this.settings$=this.settingsSubject.asObservable(),this.endedBy$=this.endedBySubject.asObservable(),this.thumbnails$=this.thumbnailsSubject.asObservable(),this.closedCaptions$=this.closedCaptionsSubject.asObservable();const e=(s,i)=>{if(s.length!==i.length)return!1;for(const r of s)if(!i.includes(r))return!1;for(const r of i)if(!s.includes(r))return!1;return!0},n=(s,i)=>s.asObservable().pipe(Je(i));this.anonymousParticipantCount$=n(this.anonymousParticipantCountSubject),this.blockedUserIds$=n(this.blockedUserIdsSubject,e),this.backstage$=n(this.backstageSubject),this.callingState$=n(this.callingStateSubject),this.ownCapabilities$=n(this.ownCapabilitiesSubject,e),this.participantCount$=n(this.participantCountSubject),this.recording$=n(this.recordingSubject),this.transcribing$=n(this.transcribingSubject),this.captioning$=n(this.captioningSubject),this.eventHandlers={"call.frame_recording_ready":void 0,"call.permission_request":void 0,"call.recording_ready":void 0,"call.rtmp_broadcast_failed":void 0,"call.rtmp_broadcast_started":void 0,"call.rtmp_broadcast_stopped":void 0,"call.transcription_ready":void 0,"call.user_muted":void 0,"connection.error":void 0,"connection.ok":void 0,"health.check":void 0,"user.updated":void 0,custom:void 0,"call.accepted":s=>this.updateFromCallResponse(s.call),"call.blocked_user":this.blockUser,"call.closed_caption":this.updateFromClosedCaptions,"call.closed_captions_failed":()=>{this.setCurrentValue(this.captioningSubject,!1)},"call.closed_captions_started":()=>{this.setCurrentValue(this.captioningSubject,!0)},"call.closed_captions_stopped":()=>{this.setCurrentValue(this.captioningSubject,!1)},"call.created":s=>this.updateFromCallResponse(s.call),"call.deleted":s=>this.updateFromCallResponse(s.call),"call.ended":s=>{this.updateFromCallResponse(s.call),this.setCurrentValue(this.endedBySubject,s.user)},"call.frame_recording_failed":s=>{this.updateFromCallResponse(s.call)},"call.frame_recording_started":s=>{this.updateFromCallResponse(s.call)},"call.frame_recording_stopped":s=>{this.updateFromCallResponse(s.call)},"call.hls_broadcasting_failed":this.updateFromHLSBroadcastingFailed,"call.hls_broadcasting_started":s=>{this.updateFromCallResponse(s.call)},"call.hls_broadcasting_stopped":this.updateFromHLSBroadcastStopped,"call.live_started":s=>this.updateFromCallResponse(s.call),"call.member_added":this.updateFromMemberAdded,"call.member_removed":this.updateFromMemberRemoved,"call.member_updated_permission":this.updateMembers,"call.member_updated":this.updateMembers,"call.notification":s=>{this.updateFromCallResponse(s.call),this.setMembers(s.members)},"call.permissions_updated":this.updateOwnCapabilities,"call.reaction_new":this.updateParticipantReaction,"call.recording_started":()=>this.setCurrentValue(this.recordingSubject,!0),"call.recording_stopped":()=>this.setCurrentValue(this.recordingSubject,!1),"call.recording_failed":()=>this.setCurrentValue(this.recordingSubject,!1),"call.rejected":s=>this.updateFromCallResponse(s.call),"call.ring":s=>this.updateFromCallResponse(s.call),"call.missed":s=>this.updateFromCallResponse(s.call),"call.session_ended":s=>this.updateFromCallResponse(s.call),"call.session_participant_count_updated":this.updateFromSessionParticipantCountUpdate,"call.session_participant_joined":this.updateFromSessionParticipantJoined,"call.session_participant_left":this.updateFromSessionParticipantLeft,"call.session_started":s=>this.updateFromCallResponse(s.call),"call.transcription_started":()=>{this.setCurrentValue(this.transcribingSubject,!0)},"call.transcription_stopped":()=>{this.setCurrentValue(this.transcribingSubject,!1)},"call.transcription_failed":()=>{this.setCurrentValue(this.transcribingSubject,!1)},"call.unblocked_user":this.unblockUser,"call.updated":s=>this.updateFromCallResponse(s.call)}}get participantCount(){return this.getCurrentValue(this.participantCount$)}get startedAt(){return this.getCurrentValue(this.startedAt$)}get captioning(){return this.getCurrentValue(this.captioning$)}get anonymousParticipantCount(){return this.getCurrentValue(this.anonymousParticipantCount$)}get participants(){return this.getCurrentValue(this.participants$)}get localParticipant(){return this.getCurrentValue(this.localParticipant$)}get remoteParticipants(){return this.getCurrentValue(this.remoteParticipants$)}get dominantSpeaker(){return this.getCurrentValue(this.dominantSpeaker$)}get pinnedParticipants(){return this.getCurrentValue(this.pinnedParticipants$)}get hasOngoingScreenShare(){return this.getCurrentValue(this.hasOngoingScreenShare$)}get callingState(){return this.getCurrentValue(this.callingState$)}get callStatsReport(){return this.getCurrentValue(this.callStatsReport$)}get members(){return this.getCurrentValue(this.members$)}get ownCapabilities(){return this.getCurrentValue(this.ownCapabilities$)}get backstage(){return this.getCurrentValue(this.backstage$)}get blockedUserIds(){return this.getCurrentValue(this.blockedUserIds$)}get createdAt(){return this.getCurrentValue(this.createdAt$)}get endedAt(){return this.getCurrentValue(this.endedAt$)}get startsAt(){return this.getCurrentValue(this.startsAt$)}get updatedAt(){return this.getCurrentValue(this.updatedAt$)}get createdBy(){return this.getCurrentValue(this.createdBy$)}get custom(){return this.getCurrentValue(this.custom$)}get egress(){return this.getCurrentValue(this.egress$)}get ingress(){return this.getCurrentValue(this.ingress$)}get recording(){return this.getCurrentValue(this.recording$)}get session(){return this.getCurrentValue(this.session$)}get settings(){return this.getCurrentValue(this.settings$)}get transcribing(){return this.getCurrentValue(this.transcribing$)}get endedBy(){return this.getCurrentValue(this.endedBy$)}get thumbnails(){return this.getCurrentValue(this.thumbnails$)}get closedCaptions(){return this.getCurrentValue(this.closedCaptions$)}}const Zs=t=>{const e=[];return t.forEach(n=>{e.push(n)}),e},Tg=t=>{const{sdk:e,...n}=t,s=Ul(e),i=$l(e);return{sdkName:s,sdkVersion:i,...n}},Ul=t=>t&&t.type===Gt.REACT?"stream-react":t&&t.type===Gt.REACT_NATIVE?"stream-react-native":"stream-js",$l=t=>t?`${t.major}.${t.minor}.${t.patch}`:"0.0.0-development",Vl=()=>typeof navigator>"u"?!1:/^((?!chrome|android).)*safari/i.test(navigator.userAgent||""),Pi=()=>{var t;return typeof navigator>"u"?!1:(t=navigator.userAgent)==null?void 0:t.includes("Firefox")},wg=()=>{var t;return typeof navigator>"u"?!1:(t=navigator.userAgent)==null?void 0:t.includes("Chrome")};var vo=Object.freeze({__proto__:null,isChrome:wg,isFirefox:Pi,isSafari:Vl});const kg=({subscriber:t,publisher:e,state:n,datacenter:s,pollingIntervalInMs:i=2e3})=>{const r=he(["stats"]),a=async(m,p)=>m==="subscriber"&&t?t.getStats(p):m==="publisher"&&e?e.getStats(p):void 0,o=async(m,p)=>{const g=m==="subscriber"?t:e;if(!g)return[];const y=[];for(const C of p){const S=await g.getStats(C),T=nr(S,{trackKind:C.kind,kind:m,publisher:void 0});y.push(T)}return y},l=m=>{d.add(m),f()},u=m=>{d.delete(m),f()},d=new Set,f=async()=>{const m={};if(d.size>0){const S=new Set(d);for(const T of n.participants){if(!S.has(T.sessionId))continue;const{audioStream:w,isLocalParticipant:k,sessionId:_,userId:L,videoStream:$}=T,N=k?"publisher":"subscriber";try{const F=k?(e==null?void 0:e.getPublishedTracks())||[]:[...($==null?void 0:$.getVideoTracks())||[],...(w==null?void 0:w.getAudioTracks())||[]];m[_]=await o(N,F)}catch(F){r("warn",`Failed to collect ${N} stats for ${L}`,F)}}}const[p,g]=await Promise.all([t.getStats().then(S=>nr(S,{kind:"subscriber",trackKind:"video",publisher:e})).then(yo),e?e.getStats().then(S=>nr(S,{kind:"publisher",trackKind:"video",publisher:e})).then(yo):Bl()]),[y,C]=await Promise.all([a("subscriber"),e?a("publisher"):void 0]);n.setCallStatsReport({datacenter:s,publisherStats:g,subscriberStats:p,subscriberRawStats:y,publisherRawStats:C,participants:m,timestamp:Date.now()})};let c;if(i>0){const m=async()=>{await f().catch(p=>{r("debug","Failed to collect stats",p)}),c=setTimeout(m,i)};m()}return{getRawStatsForTrack:a,getStatsForStream:o,startReportingStatsFor:l,stopReportingStatsFor:u,stop:()=>{c&&clearTimeout(c)}}},nr=(t,e)=>{const{trackKind:n,kind:s,publisher:i}=e,r=s==="subscriber"?"inbound-rtp":"outbound-rtp",a=Zs(t),o=a.filter(l=>l.type===r&&l.kind===n).map(l=>{const u=l,d=a.find(m=>m.type==="codec"&&m.id===u.codecId),f=a.find(m=>m.type==="transport"&&m.id===u.transportId);let c;if(f&&f.dtlsState==="connected"){const m=a.find(p=>p.type==="candidate-pair"&&p.id===f.selectedCandidatePairId);c=m==null?void 0:m.currentRoundTripTime}let h;if(s==="publisher"&&i){const m=Pi(),p=a.find(g=>g.type==="media-source"&&(m?!0:g.id===u.mediaSourceId));p&&(h=i.getTrackType(p.trackIdentifier))}return{bytesSent:u.bytesSent,bytesReceived:u.bytesReceived,codec:d==null?void 0:d.mimeType,currentRoundTripTime:c,frameHeight:u.frameHeight,frameWidth:u.frameWidth,framesPerSecond:u.framesPerSecond,jitter:u.jitter,kind:u.kind,mediaSourceId:u.mediaSourceId,qualityLimitationReason:u.qualityLimitationReason,rid:u.rid,ssrc:u.ssrc,trackType:h}});return{rawStats:t,streams:o,timestamp:Date.now()}},Bl=t=>({rawReport:t??{streams:[],timestamp:Date.now()},totalBytesSent:0,totalBytesReceived:0,averageJitterInMs:0,averageRoundTripTimeInMs:0,qualityLimitationReasons:"none",highestFrameWidth:0,highestFrameHeight:0,highestFramesPerSecond:0,codec:"",codecPerTrackType:{},timestamp:Date.now()}),yo=t=>{const e=Bl(t);let n=-1;const s=(l,u)=>l*u,i=new Set,r=t.streams,a=r.reduce((l,u)=>{l.totalBytesSent+=u.bytesSent||0,l.totalBytesReceived+=u.bytesReceived||0,l.averageJitterInMs+=u.jitter||0,l.averageRoundTripTimeInMs+=u.currentRoundTripTime||0;const d=s(u.frameWidth||0,u.frameHeight||0);return d>n&&(l.highestFrameWidth=u.frameWidth||0,l.highestFrameHeight=u.frameHeight||0,l.highestFramesPerSecond=u.framesPerSecond||0,n=d),i.add(u.qualityLimitationReason||""),l},e);r.length>0&&(a.averageJitterInMs=Math.round(a.averageJitterInMs/r.length*1e3),a.averageRoundTripTimeInMs=Math.round(a.averageRoundTripTimeInMs/r.length*1e3),a.codec=r[0].codec||"",a.codecPerTrackType=r.reduce((l,u)=>(u.trackType&&(l[u.trackType]=u.codec||""),l),{}));const o=[i.has("cpu")&&"cpu",i.has("bandwidth")&&"bandwidth",i.has("other")&&"other"].filter(Boolean).join(", ");return o&&(a.qualityLimitationReasons=o),a},Rg="1.20.0",[Eg,Ig,_g]=Rg.split(".");let Qs={type:Gt.PLAIN_JAVASCRIPT,major:Eg,minor:Ig,patch:_g},xg,Pg,Og={oneofKind:void 0};const Ng=t=>{Qs=t},Ag=()=>Qs,Dg=()=>Og,So=async()=>{if(De())return{sdk:Qs,os:xg,device:Pg};const t=navigator.userAgentData;let e;if(t&&t.getHighEntropyValues)try{e=await t.getHighEntropyValues(["platform","platformVersion"])}catch{}const n=new pf.UAParser(navigator.userAgent),{browser:s,os:i,device:r,cpu:a}=n.getResult();return{sdk:Qs,browser:{name:s.name||navigator.userAgent,version:s.version||""},os:{name:(e==null?void 0:e.platform)||i.name||"",version:(e==null?void 0:e.platformVersion)||i.version||"",architecture:a.architecture||""},device:{name:[r.vendor,r.model,r.type].filter(Boolean).join(" "),version:""}}};class Lg{constructor(e,{options:n,clientDetails:s,subscriber:i,publisher:r,microphone:a,camera:o,state:l}){this.logger=he(["SfuStatsReporter"]),this.inputDevices=new Map,this.observeDevice=(f,c)=>{var m;const{hasBrowserPermission$:h}=f.state;(m=this.unsubscribeDevicePermissionsSubscription)==null||m.call(this),this.unsubscribeDevicePermissionsSubscription=ut(nn([h,this.state.ownCapabilities$]),([p,g])=>{var C;(C=this.unsubscribeListDevicesSubscription)==null||C.call(this);const y=c==="mic"?g.includes(z.SEND_AUDIO):g.includes(z.SEND_VIDEO);if(!p||!y){this.inputDevices.set(c,{currentDevice:"",availableDevices:[],isPermitted:!1});return}this.unsubscribeListDevicesSubscription=ut(nn([f.listDevices(),f.state.selectedDevice$]),([S,T])=>{const w=S.find(k=>k.deviceId===T);this.inputDevices.set(c,{currentDevice:(w==null?void 0:w.label)||T||"",availableDevices:S.map(k=>k.label),isPermitted:!0})})})},this.sendConnectionTime=f=>{this.sendTelemetryData({data:{oneofKind:"connectionTimeSeconds",connectionTimeSeconds:f}})},this.sendReconnectionTime=(f,c)=>{this.sendTelemetryData({data:{oneofKind:"reconnection",reconnection:{strategy:f,timeSeconds:c}}})},this.sendTelemetryData=f=>{this.run(f).catch(c=>{this.logger("warn","Failed to send telemetry data",c)})},this.run=async f=>{var S,T;const[c,h]=await Promise.all([this.subscriber.getStats().then(Zs).then(JSON.stringify),((S=this.publisher)==null?void 0:S.getStats().then(Zs).then(JSON.stringify))??"[]"]),m=this.subscriber.getTrace(),p=(T=this.publisher)==null?void 0:T.getTrace(),g=Wn.take(),y=this.sfuClient.getTrace(),C=[...g.snapshot,...(y==null?void 0:y.snapshot)??[],...(p==null?void 0:p.snapshot)??[]];try{await this.sfuClient.sendStats({sdk:this.sdkName,sdkVersion:this.sdkVersion,webrtcVersion:this.webRTCVersion,subscriberStats:c,subscriberRtcStats:m?JSON.stringify(m.snapshot):"",publisherStats:h,publisherRtcStats:C.length>0?JSON.stringify(C):"",audioDevices:this.inputDevices.get("mic"),videoDevices:this.inputDevices.get("camera"),deviceState:Dg(),telemetry:f})}catch(w){throw p==null||p.rollback(),m==null||m.rollback(),g.rollback(),y==null||y.rollback(),w}},this.start=()=>{this.options.reporting_interval_ms<=0||(this.observeDevice(this.microphone,"mic"),this.observeDevice(this.camera,"camera"),clearInterval(this.intervalId),this.intervalId=setInterval(()=>{this.run().catch(f=>{this.logger("warn","Failed to report stats",f)})},this.options.reporting_interval_ms))},this.stop=()=>{var f,c;(f=this.unsubscribeDevicePermissionsSubscription)==null||f.call(this),this.unsubscribeDevicePermissionsSubscription=void 0,(c=this.unsubscribeListDevicesSubscription)==null||c.call(this),this.unsubscribeListDevicesSubscription=void 0,this.inputDevices.clear(),clearInterval(this.intervalId),this.intervalId=void 0},this.sfuClient=e,this.options=n,this.subscriber=i,this.publisher=r,this.microphone=a,this.camera=o,this.state=l;const{sdk:u,browser:d}=s;this.sdkName=Ul(u),this.sdkVersion=$l(u),this.webRTCVersion=`${(d==null?void 0:d.name)||""}-${(d==null?void 0:d.version)||""}`||"N/A"}}const jg=(t,e)=>{t.addEventListener("icecandidate",a=>{e("onicecandidate",a.candidate)}),t.addEventListener("track",a=>{const o=a.streams.map(l=>`stream:${l.id}`);e("ontrack",`${a.track.kind}:${a.track.id} ${o}`)}),t.addEventListener("signalingstatechange",()=>{e("onsignalingstatechange",t.signalingState)}),t.addEventListener("iceconnectionstatechange",()=>{e("oniceconnectionstatechange",t.iceConnectionState)}),t.addEventListener("icegatheringstatechange",()=>{e("onicegatheringstatechange",t.iceGatheringState)}),t.addEventListener("connectionstatechange",()=>{e("onconnectionstatechange",t.connectionState)}),t.addEventListener("negotiationneeded",()=>{e("onnegotiationneeded",void 0)}),t.addEventListener("datachannel",({channel:a})=>{e("ondatachannel",[a.id,a.label])});let n={};const s=()=>{t.getStats(null).then(a=>{const o=Mg(a);e("getstats",Fg(n,o)),n=o}).catch(a=>{e("getstatsOnFailure",a.toString())})},i=setInterval(()=>{s()},8e3);t.addEventListener("connectionstatechange",()=>{const a=t.connectionState;(a==="connected"||a==="failed")&&s()});const r=t.close;t.close=function(){return clearInterval(i),e("close",void 0),r.call(this)};for(const a of["createOffer","createAnswer","setLocalDescription","setRemoteDescription","addIceCandidate"]){const o=t[a];o&&(t[a]=async function(...u){try{e(a,u);const d=await o.apply(this,u);return e(`${a}OnSuccess`,d),d}catch(d){throw e(`${a}OnFailure`,d.toString()),d}})}},Mg=t=>{const e={};return t.forEach((n,s)=>{e[s]=n}),e},Fg=(t,e)=>{e=JSON.parse(JSON.stringify(e));for(const[s,i]of Object.entries(e))if(delete i.id,!!t[s])for(const[r,a]of Object.entries(i))a===t[s][r]&&delete i[r];let n=-1/0;for(const s of Object.values(e))s.timestamp>n&&(n=s.timestamp);for(const s of Object.values(e))s.timestamp===n&&(s.timestamp=0);return e.timestamp=n,e};class Hl{constructor(e,{sfuClient:n,connectionConfig:s,state:i,dispatcher:r,onUnrecoverableError:a,logTag:o,clientDetails:l,enableTracing:u}){if(this.isIceRestarting=!1,this.isDisposed=!1,this.subscriptions=[],this.on=(d,f)=>{this.subscriptions.push(this.dispatcher.on(d,c=>{tt(`pc.${d}`,async()=>f(c)).catch(h=>{this.isDisposed||this.logger("warn",`Error handling ${d}`,h)})}))},this.addTrickledIceCandidates=()=>{var c;const{iceTrickleBuffer:d}=this.sfuClient,f=this.peerType===Le.SUBSCRIBER?d.subscriberCandidates:d.publisherCandidates;(c=this.unsubscribeIceTrickle)==null||c.call(this),this.unsubscribeIceTrickle=wi(f,async h=>this.pc.addIceCandidate(h).catch(m=>{this.isDisposed||this.logger("warn","ICE candidate error",m,h)}))},this.setSfuClient=d=>{this.sfuClient=d},this.getStats=d=>this.pc.getStats(d),this.getTrace=()=>{var d;return(d=this.tracer)==null?void 0:d.take()},this.onIceCandidate=d=>{const{candidate:f}=d;if(!f){this.logger("debug","null ice candidate");return}const c=this.asJSON(f);this.sfuClient.iceTrickle({peerType:this.peerType,iceCandidate:c}).catch(h=>{this.isDisposed||this.logger("warn","ICETrickle failed",h)})},this.asJSON=d=>{if(!d.usernameFragment){const f=d.candidate.split(" "),c=f.findIndex(m=>m==="ufrag")+1,h=f[c];return JSON.stringify({...d,usernameFragment:h})}return JSON.stringify(d.toJSON())},this.onIceConnectionStateChange=()=>{const d=this.pc.iceConnectionState;this.logger("debug","ICE connection state changed",d),this.state.callingState!==M.OFFLINE&&this.state.callingState!==M.RECONNECTING&&(this.isIceRestarting||(d==="failed"||d==="disconnected")&&(this.logger("debug","Attempting to restart ICE"),this.restartIce().catch(f=>{var h;if(this.isDisposed)return;const c="ICE restart failed";this.logger("error",c,f),(h=this.onUnrecoverableError)==null||h.call(this,`${c}: ${f}`)})))},this.onIceCandidateError=d=>{const f=d instanceof RTCPeerConnectionIceErrorEvent&&`${d.errorCode}: ${d.errorText}`,c=this.pc.iceConnectionState,h=c==="connected"||c==="checking"?"debug":"warn";this.logger(h,"ICE Candidate error",f)},this.onIceGatherChange=()=>{this.logger("debug","ICE Gathering State",this.pc.iceGatheringState)},this.onSignalingChange=()=>{this.logger("debug","Signaling state changed",this.pc.signalingState)},this.peerType=e,this.sfuClient=n,this.state=i,this.dispatcher=r,this.onUnrecoverableError=a,this.logger=he([e===Le.SUBSCRIBER?"Subscriber":"Publisher",o]),this.pc=new RTCPeerConnection(s),u){const d=`${o}-${e===Le.SUBSCRIBER?"sub":"pub"}`;this.tracer=new ea(d),this.tracer.trace("clientDetails",l),this.tracer.trace("create",s),jg(this.pc,this.tracer.trace)}this.pc.addEventListener("icecandidate",this.onIceCandidate),this.pc.addEventListener("icecandidateerror",this.onIceCandidateError),this.pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.pc.addEventListener("icegatheringstatechange",this.onIceGatherChange),this.pc.addEventListener("signalingstatechange",this.onSignalingChange)}dispose(){var e;this.onUnrecoverableError=void 0,this.isDisposed=!0,this.detachEventHandlers(),this.pc.close(),(e=this.tracer)==null||e.dispose()}detachEventHandlers(){var e;this.pc.removeEventListener("icecandidate",this.onIceCandidate),this.pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this.pc.removeEventListener("signalingstatechange",this.onSignalingChange),this.pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.pc.removeEventListener("icegatheringstatechange",this.onIceGatherChange),(e=this.unsubscribeIceTrickle)==null||e.call(this),this.subscriptions.forEach(n=>n())}}class Ug{constructor(){this.cache=[],this.layers=[],this.transceiverOrder=[],this.add=(e,n)=>{this.cache.push({publishOption:e,transceiver:n}),this.transceiverOrder.push(n)},this.get=e=>{var n;return(n=this.findTransceiver(e))==null?void 0:n.transceiver},this.has=e=>!!this.get(e),this.find=e=>this.cache.find(e),this.items=()=>this.cache,this.indexOf=e=>this.transceiverOrder.indexOf(e),this.getLayers=e=>{const n=this.layers.find(s=>s.publishOption.id===e.id&&s.publishOption.trackType===e.trackType);return n==null?void 0:n.layers},this.setLayers=(e,n=[])=>{const s=this.findLayer(e);s?s.layers=n:this.layers.push({publishOption:e,layers:n})},this.findTransceiver=e=>this.cache.find(n=>n.publishOption.id===e.id&&n.publishOption.trackType===e.trackType),this.findLayer=e=>this.layers.find(n=>n.publishOption.id===e.id&&n.publishOption.trackType===e.trackType)}}const Xn=(t,e)=>{he(["helpers"])("warn",e,t)},ua=t=>{switch(t){case O.SCREEN_SHARE:return"screenShareStream";case O.SCREEN_SHARE_AUDIO:return"screenShareAudioStream";case O.VIDEO:return"videoStream";case O.AUDIO:return"audioStream";case O.UNSPECIFIED:throw new Error("Track type is unspecified");default:Xn(t,"Unknown track type")}},$g=t=>{switch(t){case"audio":return O.AUDIO;case"video":return O.VIDEO;case"screenshare":return O.SCREEN_SHARE;case"screenshare_audio":return O.SCREEN_SHARE_AUDIO;default:Xn(t,"Unknown mute type")}},Vg=t=>{switch(t){case"TRACK_TYPE_AUDIO":return O.AUDIO;case"TRACK_TYPE_VIDEO":return O.VIDEO;case"TRACK_TYPE_SCREEN_SHARE":return O.SCREEN_SHARE;case"TRACK_TYPE_SCREEN_SHARE_AUDIO":return O.SCREEN_SHARE_AUDIO;default:return}},da=t=>t===O.AUDIO||t===O.SCREEN_SHARE_AUDIO,Bg={q:3e5,h:75e4,f:125e4},Hg=t=>{if(!t)return;const e=s=>i=>i.rid===s;return[{...t.find(e("f"))||t.find(e("h"))||t.find(e("q")),rid:"q"}]},qg=t=>t==="q"?Ht.LOW_UNSPECIFIED:t==="h"?Ht.MID:Ht.HIGH,Wg=(t=[])=>t.map(e=>({rid:e.rid||"",bitrate:e.maxBitrate||0,fps:e.maxFramerate||0,quality:qg(e.rid||""),videoDimension:{width:e.width,height:e.height}})),Gg=(t,e)=>`L${t}T${e}${t>1?"_KEY":""}`,Co=(t,e)=>{if(da(e.trackType))return;const n=[],s=t.getSettings(),{width:i=0,height:r=0}=s,{bitrate:a,codec:o,fps:l,maxSpatialLayers:u=3,maxTemporalLayers:d=3,videoDimension:f={width:1280,height:720}}=e,c=Kg(f,i,r,a);let h=1,m=1;const p=Dr(o==null?void 0:o.name);for(const g of["f","h","q"].slice(0,u)){const y={active:!0,rid:g,width:Math.round(i/h),height:Math.round(r/h),maxBitrate:Math.round(c/m)||Bg[g],maxFramerate:l};p?y.scalabilityMode=Gg(u,d):y.scaleResolutionDownBy=h,h*=2,m*=2,n.unshift(y)}return Jg(s,n)},Kg=(t,e,n,s)=>{const{width:i,height:r}=t;if(e<i||n<r){const a=e*n,o=i*r,l=a/o;return Math.round(s*l)}return s},Jg=(t,e)=>{let n;const s=Math.max(t.width||0,t.height||0);s<=320?n=e.filter(r=>r.rid==="f"):s<=640?n=e.filter(r=>r.rid!=="h"):n=e;const i=["q","h","f"];return n.map((r,a)=>({...r,rid:i[a]}))},zg=(t,e,n)=>{if(t.mid)return t.mid;if(!n)return String(e);const s=t.sender.track,r=vf.parse(n).media.find(a=>{var o;return a.type===s.kind&&(((o=a.msid)==null?void 0:o.includes(s.id))??!0)});return typeof(r==null?void 0:r.mid)<"u"?String(r.mid):e<0?"":String(e)};class Yg extends Hl{constructor({publishOptions:e,...n}){super(Le.PUBLISHER_UNSPECIFIED,n),this.transceiverCache=new Ug,this.clonedTracks=new Set,this.publish=async(s,i)=>{if(!this.publishOptions.some(r=>r.trackType===i))throw new Error(`No publish options found for ${O[i]}`);for(const r of this.publishOptions){if(r.trackType!==i)continue;const a=this.cloneTrack(s),o=this.transceiverCache.get(r);if(!o)await this.addTransceiver(a,r);else{const l=o.sender.track;await o.sender.replaceTrack(a),De()||this.stopTrack(l)}}},this.addTransceiver=async(s,i)=>{var u;const r=Co(s,i),a=Dr((u=i.codec)==null?void 0:u.name)?Hg(r):r,o=this.pc.addTransceiver(s,{direction:"sendonly",sendEncodings:a}),l=i.trackType;this.logger("debug",`Added ${O[l]} transceiver`),this.transceiverCache.add(i,o),await this.negotiate()},this.syncPublishOptions=async()=>{for(const s of this.publishOptions){const{trackType:i}=s;if(!this.isPublishing(i)||this.transceiverCache.has(s))continue;const r=this.transceiverCache.find(o=>!!o.transceiver.sender.track&&o.publishOption.trackType===i);if(!r||!r.transceiver)continue;const a=this.cloneTrack(r.transceiver.sender.track);await this.addTransceiver(a,s)}for(const s of this.transceiverCache.items()){const{publishOption:i,transceiver:r}=s;this.publishOptions.some(o=>o.id===i.id&&o.trackType===i.trackType)||(this.stopTrack(r.sender.track),await r.sender.replaceTrack(null))}},this.isPublishing=s=>{for(const i of this.transceiverCache.items()){if(i.publishOption.trackType!==s)continue;const r=i.transceiver.sender.track;if(r&&r.readyState==="live"&&r.enabled)return!0}return!1},this.getTrackType=s=>{var i;for(const r of this.transceiverCache.items()){const{publishOption:a,transceiver:o}=r;if(((i=o.sender.track)==null?void 0:i.id)===s)return a.trackType}},this.stopTracks=(...s)=>{for(const i of this.transceiverCache.items()){const{publishOption:r,transceiver:a}=i;s.includes(r.trackType)&&this.stopTrack(a.sender.track)}},this.stopAllTracks=()=>{for(const{transceiver:s}of this.transceiverCache.items())this.stopTrack(s.sender.track);for(const s of this.clonedTracks)this.stopTrack(s)},this.changePublishQuality=async s=>{var g;const{trackType:i,layers:r,publishOptionId:a}=s,o=r.filter(y=>y.active),l="Update publish quality:";this.logger("info",`${l} requested layers by SFU:`,o);const u=this.transceiverCache.find(y=>y.publishOption.id===a&&y.publishOption.trackType===i),d=u==null?void 0:u.transceiver.sender;if(!d)return this.logger("warn",`${l} no video sender found.`);const f=d.getParameters();if(f.encodings.length===0)return this.logger("warn",`${l} there are no encodings set.`);const c=(g=u==null?void 0:u.publishOption.codec)==null?void 0:g.name,h=c&&Dr(c);let m=!1;for(const y of f.encodings){const C=h?o[0]:o.find(L=>L.name===y.rid)??(f.encodings.length===1?o[0]:void 0),S=!!(C!=null&&C.active);if(S!==y.active&&(y.active=S,m=!0),!C)continue;const{maxFramerate:T,scaleResolutionDownBy:w,maxBitrate:k,scalabilityMode:_}=C;w>=1&&w!==y.scaleResolutionDownBy&&(y.scaleResolutionDownBy=w,m=!0),k>0&&k!==y.maxBitrate&&(y.maxBitrate=k,m=!0),T>0&&T!==y.maxFramerate&&(y.maxFramerate=T,m=!0),_&&_!==y.scalabilityMode&&(y.scalabilityMode=_,m=!0)}const p=f.encodings.filter(y=>y.active);if(!m)return this.logger("info",`${l} no change:`,p);await d.setParameters(f),this.logger("info",`${l} enabled rids:`,p)},this.restartIce=async()=>{this.logger("debug","Restarting ICE connection");const s=this.pc.signalingState;if(this.isIceRestarting||s==="have-local-offer"){this.logger("debug","ICE restart is already in progress");return}await this.negotiate({iceRestart:!0})},this.negotiate=async s=>tt("publisher.negotiate",async()=>{const i=await this.pc.createOffer(s),r=this.getAnnouncedTracks(i.sdp);if(!r.length)throw new Error("Can't negotiate without any tracks");try{this.isIceRestarting=(s==null?void 0:s.iceRestart)??!1,await this.pc.setLocalDescription(i);const{sdp:a=""}=i,{response:o}=await this.sfuClient.setPublisher({sdp:a,tracks:r});if(o.error)throw new Error(o.error.message);const{sdp:l}=o;await this.pc.setRemoteDescription({type:"answer",sdp:l})}finally{this.isIceRestarting=!1}this.addTrickledIceCandidates()}),this.getPublishedTracks=()=>{const s=[];for(const{transceiver:i}of this.transceiverCache.items()){const r=i.sender.track;r&&r.readyState==="live"&&s.push(r)}return s},this.getAnnouncedTracks=s=>{const i=[];for(const r of this.transceiverCache.items()){const{transceiver:a,publishOption:o}=r;a.sender.track&&i.push(this.toTrackInfo(a,o,s))}return i},this.getAnnouncedTracksForReconnect=()=>{var r;const s=(r=this.pc.localDescription)==null?void 0:r.sdp,i=[];for(const a of this.publishOptions){const o=this.transceiverCache.get(a);!o||!o.sender.track||i.push(this.toTrackInfo(o,a,s))}return i},this.toTrackInfo=(s,i,r)=>{var h;const a=s.sender.track,o=a.readyState==="live",l=o?Co(a,i):this.transceiverCache.getLayers(i);this.transceiverCache.setLayers(i,l);const u=da(i.trackType),d=u&&a.getSettings().channelCount===2,f=this.transceiverCache.indexOf(s),c=(h=this.state.settings)==null?void 0:h.audio;return{trackId:a.id,layers:Wg(l),trackType:i.trackType,mid:zg(s,f,r),stereo:d,dtx:u&&!!(c!=null&&c.opus_dtx_enabled),red:u&&!!(c!=null&&c.redundant_coding_enabled),muted:!o,codec:i.codec,publishOptionId:i.id}},this.cloneTrack=s=>{const i=s.clone();return this.clonedTracks.add(i),i},this.stopTrack=s=>{s&&(s.stop(),this.clonedTracks.delete(s))},this.publishOptions=e,this.on("iceRestart",s=>{s.peerType===Le.PUBLISHER_UNSPECIFIED&&this.restartIce().catch(i=>{var a;const r="ICE restart failed";this.logger("warn",r,i),(a=this.onUnrecoverableError)==null||a.call(this,`${r}: ${i}`)})}),this.on("changePublishQuality",async s=>{for(const i of s.videoSenders)await this.changePublishQuality(i)}),this.on("changePublishOptions",s=>(this.publishOptions=s.publishOptions,this.syncPublishOptions()))}dispose(){super.dispose(),this.stopAllTracks(),this.clonedTracks.clear()}}class Xg extends Hl{constructor(e){super(Le.SUBSCRIBER,e),this.restartIce=async()=>{if(this.logger("debug","Restarting ICE connection"),this.pc.signalingState==="have-remote-offer"){this.logger("debug","ICE restart is already in progress");return}if(this.pc.connectionState==="new"){this.logger("debug","ICE connection is not yet established, skipping restart.");return}const n=this.isIceRestarting;try{this.isIceRestarting=!0,await this.sfuClient.iceRestart({peerType:Le.SUBSCRIBER})}catch(s){throw this.isIceRestarting=n,s}},this.handleOnTrack=n=>{const[s]=n.streams,[i,r]=s.id.split(":"),a=this.state.participants.find(f=>f.trackLookupPrefix===i);this.logger("debug",`[onTrack]: Got remote ${r} track for userId: ${a==null?void 0:a.userId}`,n.track.id,n.track);const o=`${a==null?void 0:a.userId} ${r}:${i}`;n.track.addEventListener("mute",()=>{this.logger("info",`[onTrack]: Track muted: ${o}`)}),n.track.addEventListener("unmute",()=>{this.logger("info",`[onTrack]: Track unmuted: ${o}`)}),n.track.addEventListener("ended",()=>{this.logger("info",`[onTrack]: Track ended: ${o}`),this.state.removeOrphanedTrack(s.id)});const l=Vg(r);if(!l)return this.logger("error",`Unknown track type: ${r}`);if(!a){this.logger("warn",`[onTrack]: Received track for unknown participant: ${i}`,n),this.state.registerOrphanedTrack({id:s.id,trackLookupPrefix:i,track:s,trackType:l});return}const u=ua(l);if(!u){this.logger("error",`Unknown track type: ${r}`);return}const d=a[u];this.state.updateParticipant(a.sessionId,{[u]:s}),d&&(this.logger("info",`[onTrack]: Cleaning up previous remote ${n.track.kind} tracks for userId: ${a.userId}`),d.getTracks().forEach(f=>{f.stop(),d.removeTrack(f)}))},this.negotiate=async n=>{await this.pc.setRemoteDescription({type:"offer",sdp:n.sdp}),this.addTrickledIceCandidates();const s=await this.pc.createAnswer();await this.pc.setLocalDescription(s),await this.sfuClient.sendAnswer({peerType:Le.SUBSCRIBER,sdp:s.sdp||""}),this.isIceRestarting=!1},this.pc.addEventListener("track",this.handleOnTrack),this.on("subscriberOffer",async n=>this.negotiate(n).catch(s=>{this.logger("error","Negotiation failed.",s)}))}detachEventHandlers(){super.detachEventHandlers(),this.pc.removeEventListener("track",this.handleOnTrack)}}const Zg=t=>{const{endpoint:e,onMessage:n,logTag:s}=t,i=he(["SfuClientWS",s]);i("debug","Creating signaling WS channel:",e);const r=new WebSocket(e);return r.binaryType="arraybuffer",r.addEventListener("error",a=>{i("error","Signaling WS channel error",a)}),r.addEventListener("close",a=>{i("info","Signaling WS channel is closed",a)}),r.addEventListener("open",a=>{i("info","Signaling WS channel is open",a)}),r.addEventListener("message",a=>{try{const o=a.data instanceof ArrayBuffer?uo.fromBinary(new Uint8Array(a.data)):uo.fromJsonString(a.data.toString());n(o)}catch(o){i("error","Failed to decode a message. Check whether the Proto models match.",{event:a,error:o})}}),r},Qg=t=>({bundlePolicy:"max-bundle",iceServers:t.map(e=>({urls:e.urls,username:e.username,credential:e.password}))});function Zn(t){let e=!0;const n=t.then(i=>({status:"resolved",result:i}),i=>({status:"rejected",error:i})).finally(()=>e=!1),s=()=>n.then(i=>{if(i.status==="rejected")throw i.error;return i.result});return s.checkPending=()=>e,s}const Mn=()=>{let t,e;const n=new Promise((o,l)=>{t=o,e=l});let s=!1,i=!1;return{promise:n,resolve:o=>{s=!0,t(o)},reject:o=>{i=!0,e(o)},isResolved:()=>s,isRejected:()=>i}},To=Symbol("uninitialized");function ln(t){let e=To;return()=>(e===To&&(e=t()),e)}const eb={src:`const timerIdMapping = new Map();
self.addEventListener('message', (event) => {
    const request = event.data;
    switch (request.type) {
        case 'setTimeout':
        case 'setInterval':
            timerIdMapping.set(request.id, (request.type === 'setTimeout' ? setTimeout : setInterval)(() => {
                tick(request.id);
                if (request.type === 'setTimeout') {
                    timerIdMapping.delete(request.id);
                }
            }, request.timeout));
            break;
        case 'clearTimeout':
        case 'clearInterval':
            (request.type === 'clearTimeout' ? clearTimeout : clearInterval)(timerIdMapping.get(request.id));
            timerIdMapping.delete(request.id);
            break;
    }
});
function tick(id) {
    const message = { type: 'tick', id };
    self.postMessage(message);
}`};class tb{constructor(){this.currentTimerId=1,this.callbacks=new Map,this.fallback=!1}setup({useTimerWorker:e=!0}={}){if(!e){this.fallback=!0;return}try{const n=eb.src,s=new Blob([n],{type:"application/javascript; charset=utf-8"}),i=URL.createObjectURL(s);this.worker=new Worker(i,{name:"str-timer-worker"}),this.worker.addEventListener("message",r=>{var l;const{type:a,id:o}=r.data;a==="tick"&&((l=this.callbacks.get(o))==null||l())})}catch(n){he(["timer-worker"])("error",n),this.fallback=!0}}destroy(){var e;this.callbacks.clear(),(e=this.worker)==null||e.terminate(),this.worker=void 0,this.fallback=!1}get ready(){return this.fallback||!!this.worker}setInterval(e,n){return this.setTimer("setInterval",e,n)}clearInterval(e){this.clearTimer("clearInterval",e)}setTimeout(e,n){return this.setTimer("setTimeout",e,n)}clearTimeout(e){this.clearTimer("clearTimeout",e)}setTimer(e,n,s){if(this.ready||this.setup(),this.fallback)return(e==="setTimeout"?setTimeout:setInterval)(n,s);const i=this.getTimerId();return this.callbacks.set(i,()=>{n(),e==="setTimeout"&&this.callbacks.delete(i)}),this.sendMessage({type:e,id:i,timeout:s}),i}clearTimer(e,n){if(n){if(this.ready||this.setup(),this.fallback){(e==="clearTimeout"?clearTimeout:clearInterval)(n);return}this.callbacks.delete(n),this.sendMessage({type:e,id:n})}}getTimerId(){return this.currentTimerId++}sendMessage(e){if(!this.worker)throw new Error("Cannot use timer worker before it's set up");this.worker.postMessage(e)}}let ql=!1;const nb=()=>{ql=!0},ei=ln(()=>{const t=new tb;return t.setup({useTimerWorker:ql}),t});class dt{constructor({dispatcher:e,credentials:n,sessionId:s,logTag:i,joinResponseTimeout:r=5e3,onSignalClose:a,streamClient:o,enableTracing:l}){this.iceTrickleBuffer=new lg,this.isLeaving=!1,this.isClosing=!1,this.pingIntervalInMs=10*1e3,this.unhealthyTimeoutInMs=this.pingIntervalInMs+5*1e3,this.joinResponseTask=Mn(),this.abortController=new AbortController,this.createWebSocket=()=>{this.signalWs=Zg({logTag:this.logTag,endpoint:`${this.credentials.server.ws_endpoint}?tag=${this.logTag}`,onMessage:f=>{this.lastMessageTimestamp=new Date,this.scheduleConnectionCheck(),this.dispatcher.dispatch(f,this.logTag)}}),this.signalReady=Zn(Promise.race([new Promise((f,c)=>{const h=()=>{this.signalWs.removeEventListener("open",h),f(this.signalWs)};this.signalWs.addEventListener("open",h),this.signalWs.addEventListener("close",m=>{this.handleWebSocketClose(m),c(new Error("SFU WS closed unexpectedly"))})}),new Promise((f,c)=>{setTimeout(()=>c(new Error("SFU WS connection timed out")),this.joinResponseTimeout)})]))},this.cleanUpWebSocket=()=>{this.signalWs.removeEventListener("close",this.handleWebSocketClose)},this.handleWebSocketClose=f=>{var c;this.signalWs.removeEventListener("close",this.handleWebSocketClose),ei().clearInterval(this.keepAliveInterval),clearTimeout(this.connectionCheckTimeout),(c=this.onSignalClose)==null||c.call(this,`${f.code} ${f.reason}`)},this.close=(f=dt.NORMAL_CLOSURE,c)=>{this.isClosing=!0,this.signalWs.readyState===WebSocket.OPEN&&(this.logger("debug",`Closing SFU WS connection: ${f} - ${c}`),this.signalWs.close(f,`js-client: ${c}`),this.cleanUpWebSocket()),this.dispose()},this.dispose=()=>{var f;this.logger("debug","Disposing SFU client"),this.unsubscribeIceTrickle(),this.unsubscribeNetworkChanged(),clearInterval(this.keepAliveInterval),clearTimeout(this.connectionCheckTimeout),clearTimeout(this.migrateAwayTimeout),this.abortController.abort(),(f=this.migrationTask)==null||f.resolve(),this.iceTrickleBuffer.dispose()},this.getTrace=()=>{var f;return(f=this.tracer)==null?void 0:f.take()},this.leaveAndClose=async f=>{await this.joinTask;try{this.isLeaving=!0,await this.notifyLeave(f)}catch(c){this.logger("debug","Error notifying SFU about leaving call",c)}this.close(dt.NORMAL_CLOSURE,f.substring(0,115))},this.updateSubscriptions=async f=>(await this.joinTask,Ot(()=>this.rpc.updateSubscriptions({sessionId:this.sessionId,tracks:f}),this.abortController.signal)),this.setPublisher=async f=>(await this.joinTask,Ot(()=>this.rpc.setPublisher({...f,sessionId:this.sessionId}),this.abortController.signal)),this.sendAnswer=async f=>(await this.joinTask,Ot(()=>this.rpc.sendAnswer({...f,sessionId:this.sessionId}),this.abortController.signal)),this.iceTrickle=async f=>(await this.joinTask,Ot(()=>this.rpc.iceTrickle({...f,sessionId:this.sessionId}),this.abortController.signal)),this.iceRestart=async f=>(await this.joinTask,Ot(()=>this.rpc.iceRestart({...f,sessionId:this.sessionId}),this.abortController.signal)),this.updateMuteStates=async f=>(await this.joinTask,Ot(()=>this.rpc.updateMuteStates({muteStates:f,sessionId:this.sessionId}),this.abortController.signal)),this.sendStats=async f=>(await this.joinTask,Ot(()=>this.rpc.sendStats({...f,sessionId:this.sessionId}),this.abortController.signal)),this.startNoiseCancellation=async()=>(await this.joinTask,Ot(()=>this.rpc.startNoiseCancellation({sessionId:this.sessionId}),this.abortController.signal)),this.stopNoiseCancellation=async()=>(await this.joinTask,Ot(()=>this.rpc.stopNoiseCancellation({sessionId:this.sessionId}),this.abortController.signal)),this.enterMigration=async(f={})=>{var p;this.isLeaving=!0;const{timeout:c=7*1e3}=f;(p=this.migrationTask)==null||p.reject(new Error("Cancelled previous migration"));const h=this.migrationTask=Mn(),m=this.dispatcher.on("participantMigrationComplete",()=>{m(),clearTimeout(this.migrateAwayTimeout),h.resolve()});return this.migrateAwayTimeout=setTimeout(()=>{m(),h.reject(new Error(`Migration (${this.logTag}) failed to complete in ${c}ms`))},c),h.promise},this.join=async f=>{await this.signalReady(),(this.joinResponseTask.isResolved()||this.joinResponseTask.isRejected())&&(this.joinResponseTask=Mn());const c=this.joinResponseTask;let h;const m=this.dispatcher.on("joinResponse",p=>{this.logger("debug","Received joinResponse",p),clearTimeout(h),m(),this.keepAlive(),c.resolve(p)});return h=setTimeout(()=>{m(),c.reject(new Error('Waiting for "joinResponse" has timed out'))},this.joinResponseTimeout),await this.send(On.create({requestPayload:{oneofKind:"joinRequest",joinRequest:Ol.create({...f,sessionId:this.sessionId,token:this.credentials.token})}})),c.promise},this.ping=async()=>this.send(On.create({requestPayload:{oneofKind:"healthCheckRequest",healthCheckRequest:{}}})),this.notifyLeave=async f=>this.send(On.create({requestPayload:{oneofKind:"leaveCallRequest",leaveCallRequest:{sessionId:this.sessionId,reason:f}}})),this.send=async f=>{await this.signalReady();const c=On.toJson(f);if(this.signalWs.readyState!==WebSocket.OPEN){this.logger("debug","Signal WS is not open. Skipping message",c);return}this.logger("debug",`Sending message to: ${this.edgeName}`,c),this.signalWs.send(On.toBinary(f))},this.keepAlive=()=>{const f=ei();f.clearInterval(this.keepAliveInterval),this.keepAliveInterval=f.setInterval(()=>{this.ping().catch(c=>{this.logger("error","Error sending healthCheckRequest to SFU",c)})},this.pingIntervalInMs)},this.scheduleConnectionCheck=()=>{clearTimeout(this.connectionCheckTimeout),this.connectionCheckTimeout=setTimeout(()=>{this.lastMessageTimestamp&&new Date().getTime()-this.lastMessageTimestamp.getTime()>this.unhealthyTimeoutInMs&&this.close(dt.ERROR_CONNECTION_UNHEALTHY,`SFU connection unhealthy. Didn't receive any message for ${this.unhealthyTimeoutInMs}ms`)},this.unhealthyTimeoutInMs)},this.dispatcher=e,this.sessionId=s||Or(),this.onSignalClose=a,this.credentials=n;const{server:u,token:d}=n;this.edgeName=u.edge_name,this.joinResponseTimeout=r,this.logTag=i,this.logger=he(["SfuClient",i]),this.tracer=l?new ea(i):void 0,this.rpc=eg({baseUrl:u.url,interceptors:[Xm({Authorization:`Bearer ${d}`}),this.tracer&&Qm(this.tracer.trace),Ar()==="trace"&&Zm(this.logger,"trace")].filter(f=>!!f)}),this.unsubscribeIceTrickle=e.on("iceTrickle",f=>{this.iceTrickleBuffer.push(f)}),this.unsubscribeNetworkChanged=o.on("network.changed",f=>{var c;f.online?(c=this.networkAvailableTask)==null||c.resolve():this.networkAvailableTask=Mn()}),this.createWebSocket()}get isHealthy(){return this.signalWs.readyState===WebSocket.OPEN&&this.joinResponseTask.isResolved()}get joinTask(){return this.joinResponseTask.promise}}dt.NORMAL_CLOSURE=1e3;dt.ERROR_CONNECTION_UNHEALTHY=4001;dt.DISPOSE_OLD_SOCKET=4002;const sb=t=>async function(n){if(n.user.id===t.currentUserId)return;const{state:s}=t;n.call.created_by.id===t.currentUserId&&s.callingState===M.RINGING&&await t.join()},ib=t=>async function(n){if(n.user.id===t.currentUserId)return;const{call:s}=n,{session:i}=s;if(!i){t.logger("warn","No call session provided. Ignoring call.rejected event.",n);return}const r=i.rejected_by,{members:a,callingState:o}=t.state;if(o!==M.RINGING){t.logger("info","Call is not in ringing mode (it is either accepted or rejected already). Ignoring call.rejected event.",n);return}t.isCreatedByMe?a.filter(u=>u.user_id!==t.currentUserId).every(u=>r[u.user_id])&&(t.logger("info","everyone rejected, leaving the call"),await t.leave({reason:"ring: everyone rejected"})):r[s.created_by.id]&&(t.logger("info","call creator rejected, leaving call"),await t.leave({reason:"ring: creator rejected"}))},rb=t=>function(){const{callingState:n}=t.state;n!==M.IDLE&&n!==M.LEFT&&t.leave({reason:"call.ended event received",reject:!1}).catch(s=>{t.logger("error","Failed to leave call after call.ended ",s)})},ab=t=>t.on("callEnded",async e=>{if(t.state.callingState!==M.LEFT)try{t.state.setEndedAt(new Date);const n=zn[e.reason];await t.leave({reason:`callEnded received: ${n}`})}catch(n){t.logger("error","Failed to leave call after being ended by the SFU",n)}}),ob=t=>function(n){const{currentGrants:s}=n;if(s){const{canPublishAudio:i,canPublishVideo:r,canScreenshare:a}=s,o={[z.SEND_AUDIO]:i,[z.SEND_VIDEO]:r,[z.SCREENSHARE]:a},l=t.ownCapabilities.filter(u=>o[u]!==!1);Object.entries(o).forEach(([u,d])=>{d&&!l.includes(u)&&l.push(u)}),t.setOwnCapabilities(l)}},cb=(t,e)=>t.on("connectionQualityChanged",n=>{const{connectionQualityUpdates:s}=n;s&&e.updateParticipants(s.reduce((i,r)=>{const{sessionId:a,connectionQuality:o}=r;return i[a]={connectionQuality:o},i},{}))}),lb=(t,e)=>t.on("healthCheckResponse",n=>{const{participantCount:s}=n;s&&(e.setParticipantCount(s.total),e.setAnonymousParticipantCount(s.anonymous))}),ub=(t,e)=>t.on("error",n=>{n.error&&n.error.code!==wn.LIVE_ENDED||(e.state.setBackstage(!0),e.permissionsContext.hasPermission(z.JOIN_BACKSTAGE)||e.leave({reason:"live ended"}).catch(s=>{e.logger("error","Failed to leave call after live ended",s)}))}),db=t=>t.on("error",e=>{if(!e.error)return;const n=he(["SfuClient"]),{error:s,reconnectStrategy:i}=e;n("error","SFU reported error",{code:wn[s.code],reconnectStrategy:se[i],message:s.message,shouldRetry:s.shouldRetry})}),hb=t=>function(n){const{pins:s}=n;t.setServerSidePins(s)},fb=t=>t.on("trackUnpublished",async e=>{const{cause:n,type:s,sessionId:i}=e,{localParticipant:r}=t.state;if(n===Jn.MODERATION&&i===(r==null?void 0:r.sessionId)){const a=t.logger;a("info",`Local participant's ${O[s]} track is muted remotely`);try{s===O.VIDEO?await t.camera.disable():s===O.AUDIO?await t.microphone.disable():s===O.SCREEN_SHARE||s===O.SCREEN_SHARE_AUDIO?await t.screenShare.disable():a("warn","Unsupported track type to soft mute",O[s])}catch(o){a("error","Failed to stop publishing",o)}}}),As=(t,...e)=>{for(const n of e)t.includes(n)||t.push(n);return t},pb=t=>function(n){const{participant:s}=n;if(!s)return;const i=ha(t,s);t.updateOrAddParticipant(s.sessionId,Object.assign(s,i,{viewportVisibilityState:{videoTrack:Re.UNKNOWN,screenShareTrack:Re.UNKNOWN}}))},mb=t=>function(n){const{participant:s}=n;s&&t.setParticipants(i=>i.filter(r=>r.sessionId!==s.sessionId))},gb=t=>function(n){const{participant:s}=n;s&&t.updateParticipant(s.sessionId,s)},bb=t=>function(n){const{type:s,sessionId:i}=n;if(n.participant){const r=ha(t,n.participant),a=Object.assign(n.participant,r);t.updateOrAddParticipant(i,a)}else t.updateParticipant(i,r=>({publishedTracks:As([...r.publishedTracks],s)}))},vb=t=>function(n){const{type:s,sessionId:i}=n;if(n.participant){const r=ha(t,n.participant),a=Object.assign(n.participant,r);t.updateOrAddParticipant(i,a)}else t.updateParticipant(i,r=>({publishedTracks:r.publishedTracks.filter(a=>a!==s)}))},ha=(t,e)=>{const n=t.takeOrphanedTracks(e.trackLookupPrefix);if(!n.length)return;const s={};for(const i of n){const r=ua(i.trackType);r&&(s[r]=i.track)}return s},yb=(t,e)=>t.on("dominantSpeakerChanged",n=>{var i;const{sessionId:s}=n;s!==((i=e.dominantSpeaker)==null?void 0:i.sessionId)&&e.setParticipants(r=>r.map(a=>a.sessionId===s?{...a,isDominantSpeaker:!0}:a.isDominantSpeaker?{...a,isDominantSpeaker:!1}:a))}),Sb=(t,e)=>t.on("audioLevelChanged",n=>{const{audioLevels:s}=n;e.updateParticipants(s.reduce((i,r)=>(i[r.sessionId]={audioLevel:r.level,isSpeaking:r.isSpeaking},i),{}))}),Cb=(t,e)=>{const n=t.state,s=[t.on("call.ended",rb(t)),ab(t),ub(e,t),db(e),cb(e,n),lb(e,n),t.on("participantJoined",pb(n)),t.on("participantLeft",mb(n)),t.on("participantUpdated",gb(n)),t.on("trackPublished",bb(n)),t.on("trackUnpublished",vb(n)),Sb(e,n),yb(e,n),t.on("callGrantsUpdated",ob(n)),t.on("pinsUpdated",hb(n)),fb(t)];return t.ringing&&s.push(Wl(t)),()=>{s.forEach(i=>i())}},Wl=t=>{const e={"call.accepted":sb(t),"call.rejected":ib(t)},n=Object.keys(e).map(s=>{const i=s;return t.on(i,e[i])});return()=>{n.forEach(s=>s())}},Tb=.35;class wb{constructor(){this.elementHandlerMap=new Map,this.observer=null,this.queueSet=new Set,this.setViewport=(e,n)=>{const s=()=>{var i;(i=this.observer)==null||i.disconnect(),this.observer=null,this.elementHandlerMap.clear()};return this.observer=new IntersectionObserver(i=>{i.forEach(r=>{const a=this.elementHandlerMap.get(r.target);a==null||a(r)})},{root:e,...n,threshold:(n==null?void 0:n.threshold)??Tb}),this.queueSet.size&&(this.queueSet.forEach(([i,r])=>{e.contains(i)&&(this.observer.observe(i),this.elementHandlerMap.set(i,r))}),this.queueSet.clear()),s},this.observe=(e,n)=>{const s=[e,n],i=()=>{var r;this.elementHandlerMap.delete(e),(r=this.observer)==null||r.unobserve(e),this.queueSet.delete(s)};return this.elementHandlerMap.has(e)?i:this.observer?(this.observer.root.contains(e)&&(this.elementHandlerMap.set(e,n),this.observer.observe(e)),i):(this.queueSet.add(s),i)}}}const wo={videoTrack:Re.UNKNOWN,screenShareTrack:Re.UNKNOWN},ys=Symbol("globalOverrideKey");class kb{constructor(e,n){this.viewportTracker=new wb,this.logger=he(["DynascaleManager"]),this.pendingSubscriptionsUpdate=null,this.videoTrackSubscriptionOverridesSubject=new ee({}),this.videoTrackSubscriptionOverrides$=this.videoTrackSubscriptionOverridesSubject.asObservable(),this.incomingVideoSettings$=this.videoTrackSubscriptionOverrides$.pipe(Be(s=>{const{[ys]:i,...r}=s;return{enabled:(i==null?void 0:i.enabled)!==!1,preferredResolution:i!=null&&i.enabled?i.dimension:void 0,participants:Object.fromEntries(Object.entries(r).map(([a,o])=>[a,{enabled:(o==null?void 0:o.enabled)!==!1,preferredResolution:o!=null&&o.enabled?o.dimension:void 0}])),isParticipantVideoEnabled:a=>{var o,l;return((o=s[a])==null?void 0:o.enabled)??((l=s[ys])==null?void 0:l.enabled)??!0}}}),Ke(1)),this.setVideoTrackSubscriptionOverrides=(s,i)=>i?Et(this.videoTrackSubscriptionOverridesSubject,r=>({...r,...Object.fromEntries(i.map(a=>[a,s]))})):Et(this.videoTrackSubscriptionOverridesSubject,s?{[ys]:s}:{}),this.applyTrackSubscriptions=(s=Ct.SLOW)=>{this.pendingSubscriptionsUpdate&&clearTimeout(this.pendingSubscriptionsUpdate);const i=()=>{var r;this.pendingSubscriptionsUpdate=null,(r=this.sfuClient)==null||r.updateSubscriptions(this.trackSubscriptions).catch(a=>{this.logger("debug","Failed to update track subscriptions",a)})};s?this.pendingSubscriptionsUpdate=setTimeout(i,s):i()},this.trackElementVisibility=(s,i,r)=>{const a=this.viewportTracker.observe(s,o=>{this.callState.updateParticipant(i,l=>{const u=l.viewportVisibilityState??wo,d=o.isIntersecting||document.fullscreenElement===s?Re.VISIBLE:Re.INVISIBLE;return{...l,viewportVisibilityState:{...u,[r]:d}}})});return()=>{a(),this.callState.updateParticipant(i,o=>{const l=o.viewportVisibilityState??wo;return{...o,viewportVisibilityState:{...l,[r]:Re.UNKNOWN}}})}},this.setViewport=s=>this.viewportTracker.setViewport(s),this.bindVideoElement=(s,i,r)=>{const a=this.callState.findParticipantBySessionId(i);if(!a)return;const o=(p,g)=>{g&&(g.width===0||g.height===0)&&(this.logger("debug","Ignoring 0x0 dimension",a),g=void 0),this.callState.updateParticipantTracks(r,{[i]:{dimension:g}}),this.applyTrackSubscriptions(p)},l=this.callState.participants$.pipe(Be(p=>p.find(g=>g.sessionId===i)),Ir(p=>!!p),Je(),Ke({bufferSize:1,refCount:!0}));let u;const d=a.isLocalParticipant?null:l.pipe(Be(p=>{var g;return(g=p.viewportVisibilityState)==null?void 0:g[r]}),Je()).subscribe(p=>{if(!u){u=p??Re.UNKNOWN;return}if(u=p??Re.UNKNOWN,p===Re.INVISIBLE)return o(Ct.MEDIUM,void 0);o(Ct.MEDIUM,{width:s.clientWidth,height:s.clientHeight})});let f;const c=a.isLocalParticipant?null:new ResizeObserver(()=>{const p={width:s.clientWidth,height:s.clientHeight};if(!f){f=p;return}if(f.width===p.width&&f.height===p.height||u===Re.INVISIBLE)return;const y=Math.max(p.width/f.width,p.height/f.height)>1.2?Ct.IMMEDIATE:Ct.MEDIUM;o(y,{width:s.clientWidth,height:s.clientHeight}),f=p});c==null||c.observe(s);const h=a.isLocalParticipant?null:l.pipe(bs("publishedTracks"),Be(p=>r==="videoTrack"?gt(p):bt(p)),Je()).subscribe(p=>{p?o(Ct.IMMEDIATE,{width:s.clientWidth,height:s.clientHeight}):o(Ct.FAST,void 0)});s.autoplay=!0,s.playsInline=!0,s.muted=!0;const m=l.pipe(bs(r==="videoTrack"?"videoStream":"screenShareStream")).subscribe(p=>{const g=r==="videoTrack"?p.videoStream:p.screenShareStream;s.srcObject!==g&&(s.srcObject=g??null,(Vl()||Pi())&&setTimeout(()=>{s.srcObject=g??null,s.play().catch(y=>{this.logger("warn","Failed to play stream",y)})},25))});return()=>{o(Ct.FAST,void 0),d==null||d.unsubscribe(),h==null||h.unsubscribe(),m.unsubscribe(),c==null||c.disconnect()}},this.bindAudioElement=(s,i,r)=>{const a=this.callState.findParticipantBySessionId(i);if(!a||a.isLocalParticipant)return;const o=this.callState.participants$.pipe(Be(f=>f.find(c=>c.sessionId===i)),Ir(f=>!!f),Je(),Ke({bufferSize:1,refCount:!0})),l=o.pipe(bs(r==="screenShareAudioTrack"?"screenShareAudioStream":"audioStream")).subscribe(f=>{const c=r==="screenShareAudioTrack"?f.screenShareAudioStream:f.audioStream;s.srcObject!==c&&setTimeout(()=>{if(s.srcObject=c??null,s.srcObject){s.play().catch(m=>{this.logger("warn","Failed to play stream",m)});const{selectedDevice:h}=this.speaker.state;h&&"setSinkId"in s&&(s.setSinkId(h),Wn.trace("navigator.mediaDevices.setSinkId",h))}})}),u="setSinkId"in s?this.speaker.state.selectedDevice$.subscribe(f=>{f&&(s.setSinkId(f),Wn.trace("navigator.mediaDevices.setSinkId",f))}):null,d=nn([this.speaker.state.volume$,o.pipe(bs("audioVolume"))]).subscribe(([f,c])=>{s.volume=c.audioVolume??f});return s.autoplay=!0,()=>{u==null||u.unsubscribe(),d.unsubscribe(),l.unsubscribe()}},this.callState=e,this.speaker=n}setSfuClient(e){this.sfuClient=e}get trackSubscriptions(){const e=[];for(const n of this.callState.remoteParticipants){if(n.videoDimension&&gt(n)){const s=this.videoTrackSubscriptionOverrides[n.sessionId]??this.videoTrackSubscriptionOverrides[ys];(s==null?void 0:s.enabled)!==!1&&e.push({userId:n.userId,sessionId:n.sessionId,trackType:O.VIDEO,dimension:(s==null?void 0:s.dimension)??n.videoDimension})}n.screenShareDimension&&bt(n)&&e.push({userId:n.userId,sessionId:n.sessionId,trackType:O.SCREEN_SHARE,dimension:n.screenShareDimension}),ki(n)&&e.push({userId:n.userId,sessionId:n.sessionId,trackType:O.SCREEN_SHARE_AUDIO})}return e}get videoTrackSubscriptionOverrides(){return ht(this.videoTrackSubscriptionOverrides$)}}class Rb{constructor(){this.permissions=[],this.setPermissions=e=>{this.permissions=e||[]},this.setCallSettings=e=>{this.settings=e},this.hasPermission=e=>this.permissions.includes(e),this.canPublish=e=>{switch(e){case O.AUDIO:return this.hasPermission(z.SEND_AUDIO);case O.VIDEO:return this.hasPermission(z.SEND_VIDEO);case O.SCREEN_SHARE:case O.SCREEN_SHARE_AUDIO:return this.hasPermission(z.SCREENSHARE);case O.UNSPECIFIED:return!1;default:Xn(e,"Unknown track type")}},this.canRequest=(e,n=this.settings)=>{if(!n)return!1;const{audio:s,video:i,screensharing:r}=n;switch(e){case z.SEND_AUDIO:return s.access_request_enabled;case z.SEND_VIDEO:return i.access_request_enabled;case z.SCREENSHARE:return r.access_request_enabled;default:return!1}}}}class Fn{constructor(e,n={sortParticipantsBy:Yn}){this.name=e,this.options=n}}class Eb{constructor(e){this.register=n=>{this.callTypes[n.name]=n},this.unregister=n=>{delete this.callTypes[n]},this.get=n=>(this.callTypes[n]||this.register(new Fn(n)),this.callTypes[n]),this.callTypes=e.reduce((n,s)=>(n[s.name]=s,n),{})}}const Gl=new Eb([new Fn("default",{sortParticipantsBy:Yn}),new Fn("development",{sortParticipantsBy:Yn}),new Fn("livestream",{sortParticipantsBy:go}),new Fn("audio_room",{sortParticipantsBy:go})]);class Kl{constructor(e){this.permission=e,this.disposeController=new AbortController,this.wasPrompted=!1,this.listeners=new Set,this.logger=he(["permissions"]);const n=this.disposeController.signal;this.ready=(async()=>{const s=()=>{this.setState("prompt")};if(!Ib())return s();try{const i=await navigator.permissions.query({name:e.queryName});n.aborted||(this.setState(i.state),i.addEventListener("change",()=>this.setState(i.state),{signal:n}))}catch(i){this.logger("debug","Failed to query permission status",i),s()}})()}dispose(){this.state=void 0,this.disposeController.abort()}async getState(){if(await this.ready,!this.state)throw new Error("BrowserPermission instance possibly disposed");return this.state}async prompt({forcePrompt:e=!1,throwOnNotAllowed:n=!1}={}){return await tt(`permission-prompt-${this.permission.queryName}`,async()=>{if(await this.getState()!=="prompt"||this.wasPrompted&&!e){const s=this.state==="granted";if(!s&&n)throw new Error("Permission was not granted previously, and prompting again is not allowed");return s}try{this.wasPrompted=!0,this.setState("prompting");const s=await navigator.mediaDevices.getUserMedia(this.permission.constraints);return Ab(s),this.setState("granted"),!0}catch(s){if(s&&typeof s=="object"&&"name"in s&&(s.name==="NotAllowedError"||s.name==="SecurityError")){if(this.logger("info","Browser permission was not granted",{permission:this.permission}),this.setState("denied"),n)throw s;return!1}throw this.logger("error","Failed to getUserMedia",{error:s,permission:this.permission}),this.setState("prompt"),s}})}listen(e){return this.listeners.add(e),this.state&&e(this.state),()=>this.listeners.delete(e)}asObservable(){return this.getStateObservable().pipe(Be(e=>e!=="denied"))}getIsPromptingObservable(){return this.getStateObservable().pipe(Be(e=>e==="prompting"))}getStateObservable(){return of(e=>this.listen(e),(e,n)=>n())}setState(e){this.state!==e&&(this.state=e,this.listeners.forEach(n=>n(e)))}}function Ib(){var t;return!De()&&typeof navigator<"u"&&!!((t=navigator.permissions)!=null&&t.query)}const fa=(t,e)=>on((async()=>{let n=await navigator.mediaDevices.enumerateDevices();return n.some(i=>i.kind===e&&i.label==="")&&await t.prompt()&&(n=await navigator.mediaDevices.enumerateDevices()),n.filter(i=>i.kind===e&&i.label!==""&&i.deviceId!=="default")})()),_b=()=>typeof document>"u"?!1:"setSinkId"in document.createElement("audio"),Jl={audio:{autoGainControl:!0,noiseSuppression:!0,echoCancellation:!0}},zl={video:{width:1280,height:720}},En=ln(()=>new Kl({constraints:Jl,queryName:"microphone"})),ti=ln(()=>new Kl({constraints:zl,queryName:"camera"})),Oi=ln(()=>navigator.mediaDevices.addEventListener?Er(navigator.mediaDevices,"devicechange").pipe(Be(()=>{}),cf(500)):on([])),xb=ln(()=>Zr(Oi(),En().asObservable()).pipe(Si(void 0),yi(()=>fa(En(),"audioinput")),Ke(1))),Pb=ln(()=>Zr(Oi(),ti().asObservable()).pipe(Si(void 0),yi(()=>fa(ti(),"videoinput")),Ke(1))),Ob=ln(()=>Zr(Oi(),En().asObservable()).pipe(Si(void 0),yi(()=>fa(En(),"audiooutput")),Ke(1))),Yl=async t=>{const e=await navigator.mediaDevices.getUserMedia(t);return Pi()&&navigator.mediaDevices.dispatchEvent(new Event("devicechange")),e};function Xl(t){if(!t||typeof t!="object")return!1;if("name"in t&&typeof t.name=="string"){const e=t.name;if(["OverconstrainedError","NotFoundError"].includes(e))return!0}return!!("message"in t&&typeof t.message=="string"&&t.message.startsWith("OverconstrainedError"))}const Zl=async t=>{const e={audio:{...Jl.audio,...t}};try{return await En().prompt({throwOnNotAllowed:!0,forcePrompt:!0}),await Yl(e)}catch(n){if(Xl(n)&&(t!=null&&t.deviceId)){const{deviceId:s,...i}=t;return he(["devices"])("warn","Failed to get audio stream, will try again with relaxed constraints",{error:n,constraints:e,relaxedConstraints:i}),Zl(i)}throw he(["devices"])("error","Failed to get audio stream",{error:n,constraints:e}),n}},Ql=async t=>{const e={video:{...zl.video,...t}};try{return await ti().prompt({throwOnNotAllowed:!0,forcePrompt:!0}),await Yl(e)}catch(n){if(Xl(n)&&(t!=null&&t.deviceId)){const{deviceId:s,...i}=t;return he(["devices"])("warn","Failed to get video stream, will try again with relaxed constraints",{error:n,constraints:e,relaxedConstraints:i}),Ql(i)}throw he(["devices"])("error","Failed to get video stream",{error:n,constraints:e}),n}},Nb=async t=>{try{return await navigator.mediaDevices.getDisplayMedia({video:!0,audio:{channelCount:{ideal:2},echoCancellation:!1,autoGainControl:!1,noiseSuppression:!1},systemAudio:"include",...t})}catch(e){throw he(["devices"])("error","Failed to get screen share stream",e),e}},ni=typeof navigator<"u"&&typeof navigator.mediaDevices<"u"?Oi().pipe(Si(void 0),yi(()=>navigator.mediaDevices.enumerateDevices()),Ke(1)):void 0,Ab=t=>{t.active&&(t.getTracks().forEach(e=>{e.stop()}),typeof t.release=="function"&&t.release())},eu=()=>/Mobi/i.test(navigator.userAgent);class pa{constructor(e,n,s){this.call=e,this.state=n,this.trackType=s,this.stopOnLeave=!0,this.subscriptions=[],this.isTrackStoppedDueToTrackEnd=!1,this.filters=[],this.statusChangeConcurrencyTag=Symbol("statusChangeConcurrencyTag"),this.filterRegistrationConcurrencyTag=Symbol("filterRegistrationConcurrencyTag"),this.dispose=()=>{this.subscriptions.forEach(i=>i())},this.logger=he([`${O[s].toLowerCase()} manager`]),ni&&!De()&&(this.trackType===O.AUDIO||this.trackType===O.VIDEO)&&this.handleDisconnectedOrReplacedDevices()}listDevices(){return this.getDevices()}get enabled(){return this.state.status==="enabled"}async enable(){this.state.prevStatus=this.state.optimisticStatus,this.state.optimisticStatus!=="enabled"&&(this.state.setPendingStatus("enabled"),await tr(this.statusChangeConcurrencyTag,async e=>{try{await this.unmuteStream(),this.state.setStatus("enabled")}finally{e.aborted||this.state.setPendingStatus(this.state.status)}}))}async disable(e=!1){this.state.prevStatus=this.state.optimisticStatus,!(!e&&this.state.optimisticStatus==="disabled")&&(this.state.setPendingStatus("disabled"),await tr(this.statusChangeConcurrencyTag,async n=>{try{const s=e||this.state.disableMode==="stop-tracks";await this.muteStream(s),this.state.setStatus("disabled")}finally{n.aborted||this.state.setPendingStatus(this.state.status)}}))}async statusChangeSettled(){await hg(this.statusChangeConcurrencyTag)}async resume(){this.state.prevStatus==="enabled"&&this.state.status!=="enabled"&&await this.enable()}async toggle(){return this.state.optimisticStatus==="enabled"?await this.disable():await this.enable()}registerFilter(e){const n={start:e,stop:void 0};return{registered:tt(this.filterRegistrationConcurrencyTag,async()=>{this.filters.push(n),await this.applySettingsToStream()}),unregister:()=>tt(this.filterRegistrationConcurrencyTag,async()=>{var i;(i=n.stop)==null||i.call(n),this.filters=this.filters.filter(r=>r!==n),await this.applySettingsToStream()})}}setDefaultConstraints(e){this.state.setDefaultConstraints(e)}async select(e){if(De())throw new Error("This method is not supported in React Native. Please visit https://getstream.io/video/docs/reactnative/core/camera-and-microphone/#speaker-management for reference.");const n=this.state.selectedDevice;if(e!==n)try{this.state.setDevice(e),await this.applySettingsToStream()}catch(s){throw this.state.setDevice(n),s}}async applySettingsToStream(){await tr(this.statusChangeConcurrencyTag,async()=>{this.enabled&&(await this.muteStream(),await this.unmuteStream())})}publishStream(e){return this.call.publish(e,this.trackType)}stopPublishStream(){return this.call.stopPublish(this.trackType)}getTracks(){var e;return((e=this.state.mediaStream)==null?void 0:e.getTracks())??[]}async muteStream(e=!0){const n=this.state.mediaStream;if(!n)return;this.logger("debug",`${e?"Stopping":"Disabling"} stream`),this.call.state.callingState===M.JOINED&&await this.stopPublishStream(),this.muteLocalStream(e),this.getTracks().every(i=>i.readyState==="ended")&&(typeof n.release=="function"&&n.release(),this.state.setMediaStream(void 0,void 0),this.filters.forEach(i=>{var r;return(r=i.stop)==null?void 0:r.call(i)}))}disableTracks(){this.getTracks().forEach(e=>{e.enabled&&(e.enabled=!1)})}enableTracks(){this.getTracks().forEach(e=>{e.enabled||(e.enabled=!0)})}stopTracks(){this.getTracks().forEach(e=>{e.readyState==="live"&&e.stop()})}muteLocalStream(e){this.state.mediaStream&&(e?this.stopTracks():this.disableTracks())}async unmuteStream(){this.logger("debug","Starting stream");let e,n;if(this.state.mediaStream&&this.getTracks().every(s=>s.readyState==="live"))e=this.state.mediaStream,this.enableTracks();else{const i={...this.state.defaultConstraints,deviceId:this.state.selectedDevice?{exact:this.state.selectedDevice}:void 0},r=a=>async o=>{if(!a)return o;const l=await a;return o.getTracks().forEach(u=>{const d=u.stop;u.stop=function(){d.call(u),l.getTracks().forEach(c=>{c.kind===u.kind&&c.stop()})}}),l.getTracks().forEach(u=>{const d=()=>{o.getTracks().forEach(f=>{u.kind===f.kind&&(f.stop(),f.dispatchEvent(new Event("ended")))})};u.addEventListener("ended",d),this.subscriptions.push(()=>{u.removeEventListener("ended",d)})}),o};n=this.getStream(i),e=await this.filters.reduce((a,o)=>a.then(l=>{const{stop:u,output:d}=o.start(l);return o.stop=u,d}).then(r(a),l=>(this.logger("warn","Filter failed to start and will be ignored",l),a)),n)}if(this.call.state.callingState===M.JOINED&&await this.publishStream(e),this.state.mediaStream!==e){this.state.setMediaStream(e,await n);const s=async()=>{await this.statusChangeSettled(),this.enabled&&(this.isTrackStoppedDueToTrackEnd=!0,setTimeout(()=>{this.isTrackStoppedDueToTrackEnd=!1},2e3),await this.disable())},i=r=>()=>{!eu()||this.trackType!==O.VIDEO||this.call.notifyTrackMuteState(r,this.trackType).catch(a=>{this.logger("warn","Error while notifying track mute state",a)})};e.getTracks().forEach(r=>{const a=i(!0),o=i(!1);r.addEventListener("mute",a),r.addEventListener("unmute",o),r.addEventListener("ended",s),this.subscriptions.push(()=>{r.removeEventListener("mute",a),r.removeEventListener("unmute",o),r.removeEventListener("ended",s)})})}}get mediaDeviceKind(){return this.trackType===O.AUDIO?"audioinput":this.trackType===O.VIDEO?"videoinput":""}handleDisconnectedOrReplacedDevices(){this.subscriptions.push(ut(nn([ni.pipe(uf()),this.state.selectedDevice$]),async([[e,n],s])=>{try{if(!s)return;await this.statusChangeSettled();let i=!1,r=!1;const a=this.findDevice(n,s),o=this.findDevice(e,s);!a&&o?i=!0:a&&o&&a.deviceId===o.deviceId&&a.groupId!==o.groupId&&(r=!0),i&&(await this.disable(),await this.select(void 0)),r&&(this.isTrackStoppedDueToTrackEnd&&this.state.status==="disabled"?(await this.enable(),this.isTrackStoppedDueToTrackEnd=!1):await this.applySettingsToStream())}catch(i){this.logger("warn","Unexpected error while handling disconnected or replaced device",i)}}))}findDevice(e,n){const s=this.mediaDeviceKind;return e.find(i=>i.deviceId===n&&i.kind===s)}}class ma{constructor(e="stop-tracks",n){this.disableMode=e,this.statusSubject=new ee(void 0),this.optimisticStatusSubject=new ee(void 0),this.mediaStreamSubject=new ee(void 0),this.selectedDeviceSubject=new ee(void 0),this.defaultConstraintsSubject=new ee(void 0),this.mediaStream$=this.mediaStreamSubject.asObservable(),this.selectedDevice$=this.selectedDeviceSubject.asObservable().pipe(Je()),this.status$=this.statusSubject.asObservable().pipe(Je()),this.optimisticStatus$=this.optimisticStatusSubject.asObservable().pipe(Je()),this.defaultConstraints$=this.defaultConstraintsSubject.asObservable(),this.getCurrentValue=ht,this.setCurrentValue=Et,this.hasBrowserPermission$=n?n.asObservable().pipe(Ke(1)):Gs(!0),this.isPromptingPermission$=n?n.getIsPromptingObservable().pipe(Ke(1)):Gs(!1)}get status(){return this.getCurrentValue(this.status$)}get optimisticStatus(){return this.getCurrentValue(this.optimisticStatus$)}get selectedDevice(){return this.getCurrentValue(this.selectedDevice$)}get mediaStream(){return this.getCurrentValue(this.mediaStream$)}setStatus(e){this.setCurrentValue(this.statusSubject,e)}setPendingStatus(e){this.setCurrentValue(this.optimisticStatusSubject,e)}setMediaStream(e,n){this.setCurrentValue(this.mediaStreamSubject,e),n&&this.setDevice(this.getDeviceIdFromStream(n))}setDevice(e){this.setCurrentValue(this.selectedDeviceSubject,e)}get defaultConstraints(){return this.getCurrentValue(this.defaultConstraints$)}setDefaultConstraints(e){this.setCurrentValue(this.defaultConstraintsSubject,e)}}class Db extends ma{constructor(){super("stop-tracks",ti()),this.directionSubject=new ee(void 0),this.direction$=this.directionSubject.asObservable().pipe(Je())}get direction(){return this.getCurrentValue(this.direction$)}setDirection(e){this.setCurrentValue(this.directionSubject,e)}setMediaStream(e,n){var s;if(super.setMediaStream(e,n),e){const i=De()?this.direction:((s=e.getVideoTracks()[0])==null?void 0:s.getSettings().facingMode)==="environment"?"back":"front";this.setDirection(i)}}getDeviceIdFromStream(e){const[n]=e.getVideoTracks();return n==null?void 0:n.getSettings().deviceId}}class Lb extends pa{constructor(e){super(e,new Db,O.VIDEO),this.targetResolution={width:1280,height:720}}isDirectionSupportedByDevice(){return De()||eu()}async selectDirection(e){if(this.isDirectionSupportedByDevice())if(De()){const n=this.getTracks()[0];if(!n){this.logger("warn","No video track found to do direction selection");return}await n.applyConstraints({facingMode:e==="front"?"user":"environment"}),this.state.setDirection(e),this.state.setDevice(void 0)}else this.state.setDirection(e),this.state.setDevice(void 0),this.getTracks().forEach(n=>{n.stop()}),await this.unmuteStream();else this.logger("warn","Camera direction ignored for desktop devices")}async flip(){const e=this.state.direction==="front"?"back":"front";await this.selectDirection(e)}async selectTargetResolution(e){if(this.targetResolution.height=e.height,this.targetResolution.width=e.width,this.state.optimisticStatus==="enabled")try{await this.statusChangeSettled()}catch(n){this.logger("warn","could not apply target resolution",n)}if(this.enabled&&this.state.mediaStream){const[n]=this.state.mediaStream.getVideoTracks();if(!n)return;const{width:s,height:i}=n.getSettings();(s!==this.targetResolution.width||i!==this.targetResolution.height)&&(await this.applySettingsToStream(),this.logger("debug",`${s}x${i} target resolution applied to media stream`))}}async apply(e,n){var u;const s=!!((u=this.call.state.localParticipant)!=null&&u.videoStream),i=this.call.permissionsContext.hasPermission(z.SEND_AUDIO);if(s||!i)return;await this.statusChangeSettled();const{target_resolution:r,camera_facing:a,camera_default_on:o}=e;if(await this.selectTargetResolution(r),!this.state.direction&&!this.state.selectedDevice&&this.state.setDirection(a==="front"?"front":"back"),!n)return;const{mediaStream:l}=this.state;this.enabled&&l?await this.publishStream(l):this.state.status===void 0&&o&&await this.enable()}getDevices(){return Pb()}getStream(e){return e.width=this.targetResolution.width,e.height=this.targetResolution.height,!e.deviceId&&this.state.direction&&this.isDirectionSupportedByDevice()&&(e.facingMode=this.state.direction==="front"?"user":"environment"),Ql(e)}}class jb extends ma{constructor(e){super(e,En()),this.speakingWhileMutedSubject=new ee(!1),this.speakingWhileMuted$=this.speakingWhileMutedSubject.asObservable().pipe(Je())}get speakingWhileMuted(){return this.getCurrentValue(this.speakingWhileMuted$)}setSpeakingWhileMuted(e){this.setCurrentValue(this.speakingWhileMutedSubject,e)}getDeviceIdFromStream(e){const[n]=e.getAudioTracks();return n==null?void 0:n.getSettings().deviceId}}const Mb=500,Fb=150,Ub=128,$b=(t,e,n={})=>{const{detectionFrequencyInMs:s=Mb,audioLevelThreshold:i=Fb,fftSize:r=Ub,destroyStreamOnStop:a=!0}=n,o=new AudioContext,l=o.createAnalyser();l.fftSize=r;const u=o.createMediaStreamSource(t);u.connect(l);const d=setInterval(()=>{var p;const f=new Uint8Array(l.frequencyBinCount);l.getByteFrequencyData(f);const c=f.some(g=>g>=i),h=f.reduce((g,y)=>g+y,0)/f.length,m=h>i?100:Math.round(h/i*100);(p=t.getAudioTracks()[0])!=null&&p.enabled?e({isSoundDetected:c,audioLevel:m}):e({isSoundDetected:!1,audioLevel:0})},s);return async function(){clearInterval(d),u.disconnect(),l.disconnect(),o.state!=="closed"&&await o.close(),a&&t.getTracks().forEach(c=>{c.stop(),t.removeTrack(c)})}};class Vb{constructor(){this.pc1=new RTCPeerConnection({}),this.pc2=new RTCPeerConnection({})}async start(e){try{this.cleanupAudioStream();const n=await navigator.mediaDevices.getUserMedia({audio:!0});this.audioStream=n,this.pc1.addEventListener("icecandidate",async a=>{await this.pc2.addIceCandidate(a.candidate)}),this.pc2.addEventListener("icecandidate",async a=>{await this.pc1.addIceCandidate(a.candidate)}),this.pc2.addEventListener("track",a=>{a.streams[0].getTracks().forEach(o=>{o._setVolume(0)})}),n.getTracks().forEach(a=>this.pc1.addTrack(a,n));const s=await this.pc1.createOffer({});await this.pc2.setRemoteDescription(s),await this.pc1.setLocalDescription(s);const i=await this.pc2.createAnswer();await this.pc1.setRemoteDescription(i),await this.pc2.setLocalDescription(i);const r=this.onSpeakingDetectedStateChange(e);return()=>{r(),this.stop()}}catch(n){return he(["RNSpeechDetector"])("error","error handling permissions: ",n),()=>{}}}stop(){this.pc1.close(),this.pc2.close(),this.cleanupAudioStream()}onSpeakingDetectedStateChange(e){let s=.13,i=!1,r,a;const o=[],l=10,u=1.1,d=.9,f=500,c=5e3,m=setInterval(async()=>{try{const p=await this.pc1.getStats(),y=Zs(p).find(C=>C.type==="media-source"&&C.kind==="audio");if(y){const{audioLevel:C}=y;if(C){o.push(C),o.length>l&&o.shift();const S=o.reduce((T,w)=>T+w,0)/o.length;S<s*u?a||(a=setTimeout(()=>{s=Math.min(S*d,.13)},c)):(clearTimeout(a),a=void 0),S>s*1.5&&(i||(i=!0,e({isSoundDetected:!0,audioLevel:C})),clearTimeout(r),r=setTimeout(()=>{i=!1,e({isSoundDetected:!1,audioLevel:0})},f))}}}catch(p){he(["RNSpeechDetector"])("error","error checking audio level from stats",p)}},100);return()=>{clearInterval(m),clearTimeout(r),clearTimeout(a)}}cleanupAudioStream(){this.audioStream&&(this.audioStream.getTracks().forEach(e=>e.stop()),typeof this.audioStream.release=="function"&&this.audioStream.release())}}class Bb extends pa{constructor(e,n="stop-tracks"){super(e,new jb(n),O.AUDIO),this.speakingWhileMutedNotificationEnabled=!0,this.soundDetectorConcurrencyTag=Symbol("soundDetectorConcurrencyTag"),this.subscriptions.push(wi(nn([this.call.state.callingState$,this.call.state.ownCapabilities$,this.state.selectedDevice$,this.state.status$]),async([s,i,r,a])=>{try{if(s===M.LEFT&&await this.stopSpeakingWhileMutedDetection(),s!==M.JOINED||!this.speakingWhileMutedNotificationEnabled)return;i.includes(z.SEND_AUDIO)?a==="disabled"?await this.startSpeakingWhileMutedDetection(r):await this.stopSpeakingWhileMutedDetection():await this.stopSpeakingWhileMutedDetection()}catch(o){this.logger("warn","Could not enable speaking while muted",o)}})),this.subscriptions.push(ut(this.call.state.callingState$,s=>{var r,a;if(!this.noiseCancellationRegistration||!this.noiseCancellation)return;((a=(r=this.call.state.settings)==null?void 0:r.audio.noise_cancellation)==null?void 0:a.mode)===Qi.AUTO_ON&&s===M.JOINED?this.noiseCancellationRegistration.then(()=>{var o;return(o=this.noiseCancellation)==null?void 0:o.enable()}).catch(o=>(this.logger("warn","Failed to enable noise cancellation",o),this.call.notifyNoiseCancellationStopped())):s===M.LEFT&&this.noiseCancellationRegistration.then(()=>{var o;return(o=this.noiseCancellation)==null?void 0:o.disable()}).catch(o=>{this.logger("warn","Failed to disable noise cancellation",o)})}))}async enableNoiseCancellation(e){if(De())throw new Error("Noise cancellation is not supported in React Native");const{ownCapabilities:n,settings:s}=this.call.state;if(!n.includes(z.ENABLE_NOISE_CANCELLATION))throw new Error("Noise cancellation is not available.");const r=s==null?void 0:s.audio.noise_cancellation;if(!r||r.mode===Qi.DISABLED)throw new Error("Noise cancellation is disabled for this call type.");try{this.noiseCancellation=e,this.noiseCancellationChangeUnsubscribe=this.noiseCancellation.on("change",o=>{o?this.call.notifyNoiseCancellationStarting().catch(l=>{this.logger("warn","notifyNoiseCancellationStart failed",l)}):this.call.notifyNoiseCancellationStopped().catch(l=>{this.logger("warn","notifyNoiseCancellationStop failed",l)})});const a=this.registerFilter(e.toFilter());this.noiseCancellationRegistration=a.registered,this.unregisterNoiseCancellation=a.unregister,await this.noiseCancellationRegistration,r.mode===Qi.AUTO_ON&&this.call.state.callingState===M.JOINED&&e.enable()}catch(a){this.logger("warn","Failed to enable noise cancellation",a),await this.disableNoiseCancellation().catch(o=>{this.logger("warn","Failed to disable noise cancellation",o)})}}async disableNoiseCancellation(){var e;if(De())throw new Error("Noise cancellation is not supported in React Native");await(((e=this.unregisterNoiseCancellation)==null?void 0:e.call(this))??Promise.resolve()).then(()=>{var n;return(n=this.noiseCancellation)==null?void 0:n.disable()}).then(()=>{var n;return(n=this.noiseCancellationChangeUnsubscribe)==null?void 0:n.call(this)}).catch(n=>{this.logger("warn","Failed to unregister noise cancellation",n)}),await this.call.notifyNoiseCancellationStopped()}async enableSpeakingWhileMutedNotification(){this.speakingWhileMutedNotificationEnabled=!0,this.state.status==="disabled"&&await this.startSpeakingWhileMutedDetection(this.state.selectedDevice)}async disableSpeakingWhileMutedNotification(){this.speakingWhileMutedNotificationEnabled=!1,await this.stopSpeakingWhileMutedDetection()}async apply(e,n){var a;if(!n)return;const s=!!((a=this.call.state.localParticipant)!=null&&a.audioStream),i=this.call.permissionsContext.hasPermission(z.SEND_AUDIO);if(s||!i)return;await this.statusChangeSettled();const{mediaStream:r}=this.state;this.enabled&&r?await this.publishStream(r):this.state.status===void 0&&e.mic_default_on&&await this.enable()}getDevices(){return xb()}getStream(e){return Zl(e)}async startSpeakingWhileMutedDetection(e){await tt(this.soundDetectorConcurrencyTag,async()=>{if(await this.stopSpeakingWhileMutedDetection(),De()){this.rnSpeechDetector=new Vb;const n=await this.rnSpeechDetector.start(s=>{this.state.setSpeakingWhileMuted(s.isSoundDetected)});this.soundDetectorCleanup=()=>{n(),this.rnSpeechDetector=void 0}}else{const n=await this.getStream({deviceId:{exact:e}});this.soundDetectorCleanup=$b(n,s=>{this.state.setSpeakingWhileMuted(s.isSoundDetected)})}})}async stopSpeakingWhileMutedDetection(){await tt(this.soundDetectorConcurrencyTag,async()=>{if(!this.soundDetectorCleanup)return;const e=this.soundDetectorCleanup;this.soundDetectorCleanup=void 0,this.state.setSpeakingWhileMuted(!1),await e()})}}class Hb extends ma{constructor(){super(...arguments),this.audioEnabledSubject=new ee(!0),this.settingsSubject=new ee(void 0),this.audioEnabled$=this.audioEnabledSubject.asObservable().pipe(Je()),this.settings$=this.settingsSubject.asObservable(),this.getDeviceIdFromStream=e=>{const[n]=e.getTracks();return n==null?void 0:n.getSettings().deviceId}}get audioEnabled(){return this.getCurrentValue(this.audioEnabled$)}setAudioEnabled(e){this.setCurrentValue(this.audioEnabledSubject,e)}get settings(){return this.getCurrentValue(this.settings$)}setSettings(e){this.setCurrentValue(this.settingsSubject,e)}}class qb extends pa{constructor(e){super(e,new Hb,O.SCREEN_SHARE),this.subscriptions.push(ut(e.state.settings$,n=>{const s=n==null?void 0:n.screensharing.target_resolution;s&&this.setDefaultConstraints({video:{width:s.width,height:s.height}})}))}enableScreenShareAudio(){this.state.setAudioEnabled(!0)}async disableScreenShareAudio(){var e;this.state.setAudioEnabled(!1),(e=this.call.publisher)!=null&&e.isPublishing(O.SCREEN_SHARE_AUDIO)&&await this.call.stopPublish(O.SCREEN_SHARE_AUDIO)}getSettings(){return this.state.settings}setSettings(e){this.state.setSettings(e)}getDevices(){return Gs([])}getStream(e){return this.state.audioEnabled||(e.audio=!1),Nb(e)}async stopPublishStream(){return this.call.stopPublish(O.SCREEN_SHARE,O.SCREEN_SHARE_AUDIO)}async select(){throw new Error("This method is not supported in for Screen Share")}}class Wb{constructor(){this.selectedDeviceSubject=new ee(""),this.volumeSubject=new ee(1),this.isDeviceSelectionSupported=_b(),this.getCurrentValue=ht,this.setCurrentValue=Et,this.selectedDevice$=this.selectedDeviceSubject.asObservable().pipe(Je()),this.volume$=this.volumeSubject.asObservable().pipe(Je())}get selectedDevice(){return this.getCurrentValue(this.selectedDevice$)}get volume(){return this.getCurrentValue(this.volume$)}setDevice(e){this.setCurrentValue(this.selectedDeviceSubject,e)}setVolume(e){this.setCurrentValue(this.volumeSubject,e)}}class Gb{constructor(e){this.state=new Wb,this.subscriptions=[],this.dispose=()=>{this.subscriptions.forEach(n=>n.unsubscribe())},this.call=e,ni&&!De()&&this.subscriptions.push(nn([ni,this.state.selectedDevice$]).subscribe(([n,s])=>{if(!s)return;n.find(r=>r.deviceId===s&&r.kind==="audiooutput")||this.select("")}))}listDevices(){if(De())throw new Error("This feature is not supported in React Native. Please visit https://getstream.io/video/docs/reactnative/core/camera-and-microphone/#speaker-management for more details");return Ob()}select(e){if(De())throw new Error("This feature is not supported in React Native. Please visit https://getstream.io/video/docs/reactnative/core/camera-and-microphone/#speaker-management for more details");this.state.setDevice(e)}setVolume(e){if(De())throw new Error("This feature is not supported in React Native. Please visit https://getstream.io/video/docs/reactnative/core/camera-and-microphone/#speaker-management for more details");if(e&&(e<0||e>1))throw new Error("Volume must be between 0 and 1");this.state.setVolume(e)}setParticipantVolume(e,n){if(De())throw new Error("This feature is not supported in React Native. Please visit https://getstream.io/video/docs/reactnative/core/camera-and-microphone/#speaker-management for more details");if(n&&(n<0||n>1))throw new Error("Volume must be between 0 and 1, or undefined");this.call.state.updateParticipant(e,{audioVolume:n})}}class An{constructor({type:e,id:n,streamClient:s,members:i,ownCapabilities:r,sortParticipantsBy:a,clientStore:o,ringing:l=!1,watching:u=!1}){this.state=new Fl,this.permissionsContext=new Rb,this.dispatcher=new cg,this.sfuClientTag=0,this.reconnectConcurrencyTag=Symbol("reconnectConcurrencyTag"),this.reconnectAttempts=0,this.reconnectStrategy=se.UNSPECIFIED,this.reconnectReason="",this.fastReconnectDeadlineSeconds=0,this.disconnectionTimeoutSeconds=0,this.lastOfflineTimestamp=0,this.trackPublishOrder=[],this.hasJoinedOnce=!1,this.deviceSettingsAppliedOnce=!1,this.initialized=!1,this.joinLeaveConcurrencyTag=Symbol("joinLeaveConcurrencyTag"),this.leaveCallHooks=new Set,this.streamClientEventHandlers=new Map,this.setup=async()=>{await tt(this.joinLeaveConcurrencyTag,async()=>{this.initialized||(this.leaveCallHooks.add(this.on("all",c=>{this.state.updateFromEvent(c)})),this.leaveCallHooks.add(this.on("changePublishOptions",c=>{this.currentPublishOptions=c.publishOptions})),this.leaveCallHooks.add(Cb(this,this.dispatcher)),this.registerEffects(),this.registerReconnectHandlers(),this.state.callingState===M.LEFT&&this.state.setCallingState(M.IDLE),this.initialized=!0)})},this.registerEffects=()=>{this.leaveCallHooks.add(ut(this.state.settings$,c=>{c&&this.permissionsContext.setCallSettings(c)})),this.leaveCallHooks.add(wi(this.state.ownCapabilities$,this.handleOwnCapabilitiesUpdated)),this.leaveCallHooks.add(ut(this.state.blockedUserIds$,async c=>{if(!c||c.length===0)return;const h=this.currentUserId;h&&c.includes(h)&&(this.logger("info","Leaving call because of being blocked"),await this.leave({reason:"user blocked"}).catch(m=>{this.logger("error","Error leaving call after being blocked",m)}))})),this.leaveCallHooks.add(ut(this.state.session$,c=>{var y;if(!this.ringing)return;const h=(y=this.clientStore.connectedUser)==null?void 0:y.id;if(!h)return;const m=!!(c!=null&&c.accepted_by[h]),p=!!(c!=null&&c.rejected_by[h]);(m||p)&&this.cancelAutoDrop(),(m&&this.state.callingState===M.RINGING||p)&&!dg(this.joinLeaveConcurrencyTag)&&this.leave().catch(()=>{this.logger("error","Could not leave a call that was accepted or rejected elsewhere")})})),this.leaveCallHooks.add(ut(this.ringingSubject,c=>{var T,w;if(!c)return;const h=this.state.session,m=(T=this.clientStore.connectedUser)==null?void 0:T.id,p=h==null?void 0:h.ended_at,g=(w=this.state.createdBy)==null?void 0:w.id,y=h==null?void 0:h.rejected_by,C=h==null?void 0:h.accepted_by;let S=!1;p?S=!0:g&&y?y[g]&&(S=!0):m&&y?y[m]&&(S=!0):m&&C&&C[m]&&(S=!0),S?this.state.callingState!==M.IDLE&&this.state.setCallingState(M.IDLE):(this.state.callingState===M.IDLE&&this.state.setCallingState(M.RINGING),this.scheduleAutoDrop(),this.leaveCallHooks.add(Wl(this)))}))},this.handleOwnCapabilitiesUpdated=async c=>{if(this.permissionsContext.setPermissions(c),!this.publisher)return;const h={[z.SEND_AUDIO]:O.AUDIO,[z.SEND_VIDEO]:O.VIDEO,[z.SCREENSHARE]:O.SCREEN_SHARE};for(const[m,p]of Object.entries(h))if(!this.permissionsContext.hasPermission(m))try{switch(p){case O.AUDIO:this.microphone.enabled&&await this.microphone.disable();break;case O.VIDEO:this.camera.enabled&&await this.camera.disable();break;case O.SCREEN_SHARE:this.screenShare.enabled&&await this.screenShare.disable();break}}catch(y){this.logger("error","Can't disable mic/camera/screenshare after revoked permissions",y)}},this.on=(c,h)=>{if(po(c))return this.dispatcher.on(c,h);const m=this.streamClient.on(c,p=>{const g=p;g.call_cid&&g.call_cid===this.cid&&h(g)});return this.streamClientEventHandlers.set(h,m),()=>{this.off(c,h)}},this.off=(c,h)=>{if(po(c))return this.dispatcher.off(c,h);const m=this.streamClientEventHandlers.get(h);m&&m()},this.leave=async({reject:c,reason:h="user is leaving the call"}={})=>{await tt(this.joinLeaveConcurrencyTag,async()=>{var g,y,C,S,T;const m=this.state.callingState;if(m===M.LEFT)throw new Error("Cannot leave call that has already been left.");if(m===M.JOINING&&await new Promise(k=>{this.state.callingState$.pipe(Ir(_=>_!==M.JOINED,!0)).subscribe(()=>k())}),m===M.RINGING&&c!==!1)if(c)await this.reject("decline");else{const w=this.state.remoteParticipants.length>0;this.isCreatedByMe&&!w&&await this.reject("cancel")}(g=this.statsReporter)==null||g.stop(),this.statsReporter=void 0,(y=this.sfuStatsReporter)==null||y.stop(),this.sfuStatsReporter=void 0,(C=this.subscriber)==null||C.dispose(),this.subscriber=void 0,(S=this.publisher)==null||S.dispose(),this.publisher=void 0,await((T=this.sfuClient)==null?void 0:T.leaveAndClose(h)),this.sfuClient=void 0,this.dynascaleManager.setSfuClient(void 0),this.state.setCallingState(M.LEFT),this.state.setParticipants([]),this.state.dispose(),this.leaveCallHooks.forEach(w=>w()),this.initialized=!1,this.hasJoinedOnce=!1,this.ringingSubject.next(!1),this.cancelAutoDrop(),this.clientStore.unregisterCall(this),this.camera.dispose(),this.microphone.dispose(),this.screenShare.dispose(),this.speaker.dispose();const p=[];this.camera.stopOnLeave&&p.push(this.camera.disable(!0)),this.microphone.stopOnLeave&&p.push(this.microphone.disable(!0)),this.screenShare.stopOnLeave&&p.push(this.screenShare.disable(!0)),await Promise.all(p)})},this.updateFromRingingEvent=async c=>{await this.setup();const{created_by:h,settings:m}=c.call,p=this.state.members.find(y=>y.user.id===h.id);p?this.state.setMembers([p,...c.members]):this.state.setMembers(c.members),this.state.updateFromCallResponse(c.call),this.watching=!0,this.ringingSubject.next(!0);const g=this.clientStore.calls.filter(y=>y.cid!==this.cid);this.clientStore.setCalls([this,...g]),await this.applyDeviceConfig(m,!1)},this.get=async c=>{await this.setup();const h=await this.streamClient.get(this.streamClientBasePath,c);return this.state.updateFromCallResponse(h.call),this.state.setMembers(h.members),this.state.setOwnCapabilities(h.own_capabilities),c!=null&&c.ring&&this.ringingSubject.next(!0),this.streamClient._hasConnectionID()&&(this.watching=!0,this.clientStore.registerCall(this)),await this.applyDeviceConfig(h.call.settings,!1),h},this.getOrCreate=async c=>{await this.setup();const h=await this.streamClient.post(this.streamClientBasePath,c);return this.state.updateFromCallResponse(h.call),this.state.setMembers(h.members),this.state.setOwnCapabilities(h.own_capabilities),c!=null&&c.ring&&this.ringingSubject.next(!0),this.streamClient._hasConnectionID()&&(this.watching=!0,this.clientStore.registerCall(this)),await this.applyDeviceConfig(h.call.settings,!1),h},this.create=async c=>this.getOrCreate(c),this.delete=async(c={})=>this.streamClient.post(`${this.streamClientBasePath}/delete`,c),this.ring=async()=>await this.get({ring:!0}),this.notify=async()=>await this.get({notify:!0}),this.accept=async()=>this.streamClient.post(`${this.streamClientBasePath}/accept`),this.reject=async(c="decline")=>this.streamClient.post(`${this.streamClientBasePath}/reject`,{reason:c}),this.join=async({maxJoinRetries:c=3,...h}={})=>{await this.setup();const m=this.state.callingState;if([M.JOINED,M.JOINING].includes(m))throw new Error("Illegal State: call.join() shall be called only once");this.state.setCallingState(M.JOINING),c=Math.max(c,1);for(let p=0;p<c;p++){try{return this.logger("trace",`Joining call (${p})`,this.cid),await this.doJoin(h)}catch(g){if(this.logger("warn",`Failed to join call (${p})`,this.cid),p===c-1)throw this.state.setCallingState(m),g}await qt(rs(p))}},this.doJoin=async c=>{var L,$,N,F;const h=Date.now(),m=this.state.callingState;this.joinCallData=c,this.logger("debug","Starting join flow"),this.state.setCallingState(M.JOINING);const p=this.reconnectStrategy===se.MIGRATE,g=this.reconnectStrategy===se.REJOIN,y=this.reconnectStrategy===se.FAST;let C=(L=this.sfuStatsReporter)==null?void 0:L.options;if(!this.credentials||!C||g||p)try{const D=await this.doJoinRequest(c);this.credentials=D.credentials,C=D.stats_options}catch(D){throw this.state.callingState===M.OFFLINE||this.state.setCallingState(m),D}const S=this.sfuClient,T=S==null?void 0:S.sessionId,w=!!(S!=null&&S.isHealthy),k=g||p||!w?new dt({logTag:String(++this.sfuClientTag),dispatcher:this.dispatcher,credentials:this.credentials,streamClient:this.streamClient,enableTracing:C.enable_rtc_stats,sessionId:g?void 0:T,onSignalClose:D=>this.handleSfuSignalClose(k,D)}):S;this.sfuClient=k,this.dynascaleManager.setSfuClient(k);const _=await So();if(S!==k){const[D,j]=await Promise.all([fo("recvonly"),fo("sendonly")]),x=this.reconnectStrategy!==se.UNSPECIFIED,R=x?this.getReconnectDetails(c==null?void 0:c.migrating_from,T):void 0,U=x?this.currentPublishOptions||[]:this.getPreferredPublishOptions(),V=x?[]:this.getPreferredSubscribeOptions();try{const{callState:I,fastReconnectDeadlineSeconds:A,publishOptions:Y}=await k.join({subscriberSdp:D,publisherSdp:j,clientDetails:_,fastReconnect:y,reconnectDetails:R,preferredPublishOptions:U,preferredSubscribeOptions:V});this.currentPublishOptions=Y,this.fastReconnectDeadlineSeconds=A,I&&this.state.updateFromSfuCallState(I,k.sessionId,R)}catch(I){throw this.logger("warn","Join SFU request failed",I),k.close(dt.ERROR_CONNECTION_UNHEALTHY,"Join request failed, connection considered unhealthy"),this.state.setCallingState(m),I}}if(p||this.state.setCallingState(M.JOINED),this.hasJoinedOnce=!0,y)await this.restoreICE(k,{includeSubscriber:!1});else{const D=Qg(this.credentials.ice_servers);this.initPublisherAndSubscriber({sfuClient:k,connectionConfig:D,clientDetails:_,statsOptions:C,publishOptions:this.currentPublishOptions||[],closePreviousInstances:!p})}if(!g&&!y&&!p&&(($=this.sfuStatsReporter)==null||$.sendConnectionTime((Date.now()-h)/1e3)),g){const D=se[this.reconnectStrategy];await(S==null?void 0:S.leaveAndClose(`Closing previous WS after reconnect with strategy: ${D}`))}else w||S==null||S.close(dt.DISPOSE_OLD_SOCKET,"Closing unhealthy WS after reconnect");!this.deviceSettingsAppliedOnce&&this.state.settings&&(await this.applyDeviceConfig(this.state.settings,!0),this.deviceSettingsAppliedOnce=!0),(N=this.joinCallData)==null||delete N.ring,(F=this.joinCallData)==null||delete F.notify,this.reconnectStrategy=se.UNSPECIFIED,this.reconnectReason="",this.logger("info",`Joined call ${this.cid}`)},this.getReconnectDetails=(c,h)=>{var y;const m=this.reconnectStrategy,p=m===se.REJOIN,g=((y=this.publisher)==null?void 0:y.getAnnouncedTracksForReconnect())||[];return{strategy:m,announcedTracks:g,subscriptions:this.dynascaleManager.trackSubscriptions,reconnectAttempt:this.reconnectAttempts,fromSfuId:c||"",previousSessionId:p&&h||"",reason:this.reconnectReason}},this.getPreferredPublishOptions=()=>{const{preferredCodec:c,fmtpLine:h,preferredBitrate:m,maxSimulcastLayers:p}=this.clientPublishOptions||{};if(!c&&!m&&!p)return[];const g=c?zt.create({name:c.split("/").pop(),fmtp:h}):void 0,y=[kn.create({trackType:O.VIDEO,codec:g,bitrate:m,maxSpatialLayers:p})],C=this.screenShare.getSettings();return C&&y.push(kn.create({trackType:O.SCREEN_SHARE,fps:C.maxFramerate,bitrate:C.maxBitrate})),y},this.getPreferredSubscribeOptions=()=>{const{subscriberCodec:c,subscriberFmtpLine:h}=this.clientPublishOptions||{};return!c||!h?[]:[sa.create({trackType:O.VIDEO,codecs:[{name:c.split("/").pop(),fmtp:h}]})]},this.restoreICE=async(c,h={})=>{const{includeSubscriber:m=!0,includePublisher:p=!0}=h;this.subscriber&&(this.subscriber.setSfuClient(c),m&&await this.subscriber.restartIce()),this.publisher&&(this.publisher.setSfuClient(c),p&&await this.publisher.restartIce())},this.initPublisherAndSubscriber=c=>{var w,k,_;const{sfuClient:h,connectionConfig:m,clientDetails:p,statsOptions:g,publishOptions:y,closePreviousInstances:C}=c,{enable_rtc_stats:S}=g;C&&this.subscriber&&this.subscriber.dispose(),this.subscriber=new Xg({sfuClient:h,dispatcher:this.dispatcher,state:this.state,connectionConfig:m,logTag:String(this.sfuClientTag),clientDetails:p,enableTracing:S,onUnrecoverableError:L=>{this.reconnect(se.REJOIN,L).catch($=>{this.logger("warn",`[Reconnect] Error reconnecting after a subscriber error: ${L}`,$)})}}),((w=this.streamClient.user)==null?void 0:w.type)==="anonymous"||(C&&this.publisher&&this.publisher.dispose(),this.publisher=new Yg({sfuClient:h,dispatcher:this.dispatcher,state:this.state,connectionConfig:m,publishOptions:y,logTag:String(this.sfuClientTag),clientDetails:p,enableTracing:S,onUnrecoverableError:L=>{this.reconnect(se.REJOIN,L).catch($=>{this.logger("warn",`[Reconnect] Error reconnecting after a publisher error: ${L}`,$)})}})),Wn.setEnabled(S),(k=this.statsReporter)==null||k.stop(),this.statsReporter=kg({subscriber:this.subscriber,publisher:this.publisher,state:this.state,datacenter:h.edgeName}),(_=this.sfuStatsReporter)==null||_.stop(),(g==null?void 0:g.reporting_interval_ms)>0&&(this.sfuStatsReporter=new Lg(h,{clientDetails:p,options:g,subscriber:this.subscriber,publisher:this.publisher,microphone:this.microphone,camera:this.camera,state:this.state}),this.sfuStatsReporter.start())},this.doJoinRequest=async c=>{const h=await this.streamClient.getLocationHint(),m={...c,location:h},p=await this.streamClient.post(`${this.streamClientBasePath}/join`,m);return this.state.updateFromCallResponse(p.call),this.state.setMembers(p.members),this.state.setOwnCapabilities(p.own_capabilities),c!=null&&c.ring&&this.ringingSubject.next(!0),!(this.reconnectStrategy!==se.UNSPECIFIED)&&this.ringing&&!this.isCreatedByMe&&await this.accept(),this.streamClient._hasConnectionID()&&(this.watching=!0,this.clientStore.registerCall(this)),p},this.handleSfuSignalClose=(c,h)=>{this.logger("debug","[Reconnect] SFU signal connection closed");const{callingState:m}=this.state;m===M.JOINING||m===M.RECONNECTING||m===M.IDLE||m===M.LEFT||c.isLeaving||c.isClosing||this.reconnect(se.REJOIN,h).catch(p=>{this.logger("warn","[Reconnect] Error reconnecting",p)})},this.reconnect=async(c,h)=>{if(!(this.state.callingState===M.RECONNECTING||this.state.callingState===M.RECONNECTING_FAILED))return tt(this.reconnectConcurrencyTag,async()=>{var p;this.logger("info",`[Reconnect] Reconnecting with strategy ${se[c]}`);const m=Date.now();this.reconnectStrategy=c,this.reconnectReason=h;do{if(this.disconnectionTimeoutSeconds>0&&(Date.now()-m)/1e3>this.disconnectionTimeoutSeconds){this.logger("warn","[Reconnect] Stopping reconnection attempts after reaching disconnection timeout"),this.state.setCallingState(M.RECONNECTING_FAILED);return}this.reconnectStrategy!==se.FAST&&this.reconnectAttempts++;const g=se[this.reconnectStrategy];try{switch(await((p=this.networkAvailableTask)==null?void 0:p.promise),this.reconnectStrategy){case se.UNSPECIFIED:case se.DISCONNECT:this.logger("debug",`[Reconnect] No-op strategy ${g}`);break;case se.FAST:await this.reconnectFast();break;case se.REJOIN:await this.reconnectRejoin();break;case se.MIGRATE:await this.reconnectMigrate();break;default:Xn(this.reconnectStrategy,"Unknown reconnection strategy");break}break}catch(y){if(this.state.callingState===M.OFFLINE){this.logger("trace","[Reconnect] Can't reconnect while offline, stopping reconnection attempts");break}if(y instanceof yl&&y.unrecoverable){this.logger("warn","[Reconnect] Can't reconnect due to coordinator unrecoverable error",y),this.state.setCallingState(M.RECONNECTING_FAILED);return}this.logger("warn",`[Reconnect] ${g} (${this.reconnectAttempts}) failed. Attempting with REJOIN`,y),await qt(500),this.reconnectStrategy=se.REJOIN}}while(this.state.callingState!==M.JOINED&&this.state.callingState!==M.RECONNECTING_FAILED&&this.state.callingState!==M.LEFT)})},this.reconnectFast=async()=>{var h;const c=Date.now();this.reconnectStrategy=se.FAST,this.state.setCallingState(M.RECONNECTING),await this.doJoin(this.joinCallData),(h=this.sfuStatsReporter)==null||h.sendReconnectionTime(se.FAST,(Date.now()-c)/1e3)},this.reconnectRejoin=async()=>{var h;const c=Date.now();this.reconnectStrategy=se.REJOIN,this.state.setCallingState(M.RECONNECTING),await this.doJoin(this.joinCallData),await this.restorePublishedTracks(),this.restoreSubscribedTracks(),(h=this.sfuStatsReporter)==null||h.sendReconnectionTime(se.REJOIN,(Date.now()-c)/1e3)},this.reconnectMigrate=async()=>{var y,C;const c=Date.now(),h=this.sfuClient;if(!h)throw new Error("Cannot migrate without an active SFU client");this.reconnectStrategy=se.MIGRATE,this.state.setCallingState(M.MIGRATING);const m=this.subscriber,p=this.publisher;m==null||m.detachEventHandlers(),p==null||p.detachEventHandlers();const g=Zn(h.enterMigration());try{const S=h.edgeName;await this.doJoin({...this.joinCallData,migrating_from:S})}finally{(y=this.joinCallData)==null||delete y.migrating_from}await this.restorePublishedTracks(),this.restoreSubscribedTracks();try{await g(),this.state.setCallingState(M.JOINED)}finally{m==null||m.dispose(),p==null||p.dispose(),h.close(dt.NORMAL_CLOSURE,"Migrating away")}(C=this.sfuStatsReporter)==null||C.sendReconnectionTime(se.MIGRATE,(Date.now()-c)/1e3)},this.registerReconnectHandlers=()=>{const c=this.on("goAway",()=>{this.reconnect(se.MIGRATE,"goAway").catch(p=>this.logger("warn","[Reconnect] Error reconnecting",p))}),h=this.on("error",p=>{const{reconnectStrategy:g,error:y}=p;g!==se.UNSPECIFIED&&(g===se.DISCONNECT?this.leave({reason:"SFU instructed to disconnect"}).catch(C=>{this.logger("warn","Can't leave call after disconnect request",C)}):this.reconnect(g,(y==null?void 0:y.message)||"SFU Error").catch(C=>{this.logger("warn","[Reconnect] Error reconnecting",C)}))}),m=this.streamClient.on("network.changed",p=>{var g,y,C,S;if(p.online)this.logger("debug","[Reconnect] Going online"),(y=this.sfuClient)==null||y.close(dt.DISPOSE_OLD_SOCKET,"Closing WS to reconnect after going online"),(C=this.networkAvailableTask)==null||C.resolve(),this.networkAvailableTask=void 0,(S=this.sfuStatsReporter)==null||S.start();else{if(this.logger("debug","[Reconnect] Going offline"),!this.hasJoinedOnce)return;this.lastOfflineTimestamp=Date.now();const T=Mn();T.promise.then(()=>{let w=se.FAST;this.lastOfflineTimestamp&&(Date.now()-this.lastOfflineTimestamp)/1e3>this.fastReconnectDeadlineSeconds&&(w=se.REJOIN),this.reconnect(w,"Going online").catch(k=>{this.logger("warn","[Reconnect] Error reconnecting after going online",k)})}),this.networkAvailableTask=T,(g=this.sfuStatsReporter)==null||g.stop(),this.state.setCallingState(M.OFFLINE)}});this.leaveCallHooks.add(c).add(h).add(m)},this.restorePublishedTracks=async()=>{for(const c of this.trackPublishOrder){let h;switch(c){case O.AUDIO:h=this.microphone.state.mediaStream;break;case O.VIDEO:h=this.camera.state.mediaStream;break;case O.SCREEN_SHARE:h=this.screenShare.state.mediaStream;break;case O.SCREEN_SHARE_AUDIO:case O.UNSPECIFIED:break;default:Xn(c,"Unknown track type");break}h&&await this.publish(h,c)}},this.restoreSubscribedTracks=()=>{const{remoteParticipants:c}=this.state;c.length<=0||this.dynascaleManager.applyTrackSubscriptions(void 0)},this.publishVideoStream=async c=>{await this.publish(c,O.VIDEO)},this.publishAudioStream=async c=>{await this.publish(c,O.AUDIO)},this.publishScreenShareStream=async c=>{await this.publish(c,O.SCREEN_SHARE)},this.publish=async(c,h)=>{if(!this.sfuClient)throw new Error("Call not joined yet.");if(await this.sfuClient.joinTask,!this.permissionsContext.canPublish(h))throw new Error(`No permission to publish ${O[h]}`);if(!this.publisher)throw new Error("Publisher is not initialized");const[m]=da(h)?c.getAudioTracks():c.getVideoTracks();if(!m)throw new Error(`There is no ${O[h]} track in the stream`);if(m.readyState==="ended")throw new Error("Can't publish ended tracks.");As(this.trackPublishOrder,h),await this.publisher.publish(m,h);const p=[h];if(h===O.SCREEN_SHARE){const[g]=c.getAudioTracks();g&&(As(this.trackPublishOrder,O.SCREEN_SHARE_AUDIO),await this.publisher.publish(g,O.SCREEN_SHARE_AUDIO),p.push(O.SCREEN_SHARE_AUDIO))}await this.updateLocalStreamState(c,...p)},this.stopPublish=async(...c)=>{!this.sfuClient||!this.publisher||(this.publisher.stopTracks(...c),await this.updateLocalStreamState(void 0,...c))},this.updateLocalStreamState=async(c,...h)=>{if(!this.sfuClient||!this.sfuClient.sessionId)return;await this.notifyTrackMuteState(!c,...h);const{sessionId:m}=this.sfuClient;for(const p of h){const g=ua(p);g&&this.state.updateParticipant(m,y=>({publishedTracks:c?As([...y.publishedTracks],p):y.publishedTracks.filter(C=>C!==p),[g]:c}))}},this.updatePublishOptions=c=>{this.logger("warn","[call.updatePublishOptions]: You are manually overriding the publish options for this call. This is not recommended, and it can cause call stability/compatibility issues. Use with caution."),this.state.callingState===M.JOINED&&this.logger("warn","Updating publish options after joining the call does not have an effect"),this.clientPublishOptions={...this.clientPublishOptions,...c}},this.notifyNoiseCancellationStarting=async()=>{var c;return(c=this.sfuClient)==null?void 0:c.startNoiseCancellation().catch(h=>{this.logger("warn","Failed to notify start of noise cancellation",h)})},this.notifyNoiseCancellationStopped=async()=>{var c;return(c=this.sfuClient)==null?void 0:c.stopNoiseCancellation().catch(h=>{this.logger("warn","Failed to notify stop of noise cancellation",h)})},this.notifyTrackMuteState=async(c,...h)=>{this.sfuClient&&await this.sfuClient.updateMuteStates(h.map(m=>({trackType:m,muted:c})))},this.startReportingStatsFor=c=>{var h;return(h=this.statsReporter)==null?void 0:h.startReportingStatsFor(c)},this.stopReportingStatsFor=c=>{var h;return(h=this.statsReporter)==null?void 0:h.stopReportingStatsFor(c)},this.resetReaction=c=>{this.state.updateParticipant(c,{reaction:void 0})},this.setSortParticipantsBy=c=>this.state.setSortParticipantsBy(c),this.sendReaction=async c=>this.streamClient.post(`${this.streamClientBasePath}/reaction`,c),this.blockUser=async c=>this.streamClient.post(`${this.streamClientBasePath}/block`,{user_id:c}),this.unblockUser=async c=>this.streamClient.post(`${this.streamClientBasePath}/unblock`,{user_id:c}),this.muteSelf=c=>{const h=this.currentUserId;if(h)return this.muteUser(h,c)},this.muteOthers=c=>{const h=$g(c);if(!h)return;const m=[];for(const p of this.state.remoteParticipants)p.publishedTracks.includes(h)&&m.push(p.userId);if(m.length>0)return this.muteUser(m,c)},this.muteUser=(c,h)=>this.streamClient.post(`${this.streamClientBasePath}/mute_users`,{user_ids:Array.isArray(c)?c:[c],[h]:!0}),this.muteAllUsers=c=>this.streamClient.post(`${this.streamClientBasePath}/mute_users`,{mute_all_users:!0,[c]:!0}),this.startRecording=async c=>this.streamClient.post(`${this.streamClientBasePath}/start_recording`,c||{}),this.stopRecording=async()=>this.streamClient.post(`${this.streamClientBasePath}/stop_recording`,{}),this.startTranscription=async c=>this.streamClient.post(`${this.streamClientBasePath}/start_transcription`,c),this.stopTranscription=async()=>this.streamClient.post(`${this.streamClientBasePath}/stop_transcription`),this.startClosedCaptions=async c=>{const h=this.state.setCaptioning(!0);try{return await this.streamClient.post(`${this.streamClientBasePath}/start_closed_captions`,c)}catch(m){throw h.rollback(),m}},this.stopClosedCaptions=async c=>{const h=this.state.setCaptioning(!1);try{return await this.streamClient.post(`${this.streamClientBasePath}/stop_closed_captions`,c)}catch(m){throw h.rollback(),m}},this.updateClosedCaptionSettings=c=>{this.state.updateClosedCaptionSettings(c)},this.requestPermissions=async c=>{const{permissions:h}=c;if(!h.every(p=>this.permissionsContext.canRequest(p)))throw new Error(`You are not allowed to request permissions: ${h.join(", ")}`);return this.streamClient.post(`${this.streamClientBasePath}/request_permission`,c)},this.grantPermissions=async(c,h)=>this.updateUserPermissions({user_id:c,grant_permissions:h}),this.revokePermissions=async(c,h)=>this.updateUserPermissions({user_id:c,revoke_permissions:h}),this.updateUserPermissions=async c=>this.streamClient.post(`${this.streamClientBasePath}/user_permissions`,c),this.goLive=async(c={},h)=>this.streamClient.post(`${this.streamClientBasePath}/go_live`,c,h),this.stopLive=async(c={})=>this.streamClient.post(`${this.streamClientBasePath}/stop_live`,c),this.startHLS=async()=>this.streamClient.post(`${this.streamClientBasePath}/start_broadcasting`,{}),this.stopHLS=async()=>this.streamClient.post(`${this.streamClientBasePath}/stop_broadcasting`,{}),this.startRTMPBroadcasts=async c=>this.streamClient.post(`${this.streamClientBasePath}/rtmp_broadcasts`,c),this.stopAllRTMPBroadcasts=async()=>this.streamClient.post(`${this.streamClientBasePath}/rtmp_broadcasts/stop`),this.stopRTMPBroadcast=async c=>this.streamClient.post(`${this.streamClientBasePath}/rtmp_broadcasts/${c}/stop`),this.startFrameRecording=async c=>this.streamClient.post(`${this.streamClientBasePath}/start_frame_recording`,c),this.stopFrameRecording=async()=>this.streamClient.post(`${this.streamClientBasePath}/stop_frame_recording`),this.update=async c=>{const h=await this.streamClient.patch(`${this.streamClientBasePath}`,c),{call:m,members:p,own_capabilities:g}=h;return this.state.updateFromCallResponse(m),this.state.setMembers(p),this.state.setOwnCapabilities(g),h},this.endCall=async()=>this.streamClient.post(`${this.streamClientBasePath}/mark_ended`),this.pin=c=>{this.state.updateParticipant(c,{pin:{isLocalPin:!0,pinnedAt:Date.now()}})},this.unpin=c=>{this.state.updateParticipant(c,{pin:void 0})},this.pinForEveryone=async c=>this.streamClient.post(`${this.streamClientBasePath}/pin`,c),this.unpinForEveryone=async c=>this.streamClient.post(`${this.streamClientBasePath}/unpin`,c),this.queryMembers=c=>this.streamClient.post("/call/members",{...c||{},id:this.id,type:this.type}),this.updateCallMembers=async c=>this.streamClient.post(`${this.streamClientBasePath}/members`,c),this.scheduleAutoDrop=()=>{this.cancelAutoDrop();const c=this.state.settings;if(!c||this.state.callingState!==M.RINGING)return;const h=this.isCreatedByMe?c.ring.auto_cancel_timeout_ms:c.ring.incoming_call_timeout_ms;h<=0||(this.dropTimeout=setTimeout(()=>{this.state.callingState===M.RINGING&&this.leave({reject:!0,reason:"timeout"}).catch(m=>{this.logger("error","Failed to drop call",m)})},h))},this.cancelAutoDrop=()=>{clearTimeout(this.dropTimeout),this.dropTimeout=void 0},this.queryRecordings=async c=>{let h=this.streamClientBasePath;return c&&(h=`${h}/${c}`),this.streamClient.get(`${h}/recordings`)},this.queryTranscriptions=async()=>this.streamClient.get(`${this.streamClientBasePath}/transcriptions`),this.getCallStats=async c=>{const h=`${this.streamClientBasePath}/stats/${c}`;return this.streamClient.get(h)},this.getCallReport=async(c="")=>{const h=`${this.streamClientBasePath}/report`,m=c!==""?{session_id:c}:{};return this.streamClient.get(h,m)},this.submitFeedback=async(c,{reason:h,custom:m}={})=>{var C;const{sdkName:p,sdkVersion:g,...y}=Tg(await So());return this.streamClient.post(`${this.streamClientBasePath}/feedback`,{rating:c,reason:h,user_session_id:(C=this.sfuClient)==null?void 0:C.sessionId,sdk:p,sdk_version:g,custom:{...m,"x-stream-platform-data":y}})},this.sendCustomEvent=async c=>this.streamClient.post(`${this.streamClientBasePath}/event`,{custom:c}),this.applyDeviceConfig=async(c,h)=>{await this.camera.apply(c.video,h).catch(m=>{this.logger("warn","Camera init failed",m)}),await this.microphone.apply(c.audio,h).catch(m=>{this.logger("warn","Mic init failed",m)})},this.trackElementVisibility=(c,h,m)=>this.dynascaleManager.trackElementVisibility(c,h,m),this.setViewport=c=>this.dynascaleManager.setViewport(c),this.bindVideoElement=(c,h,m)=>{const p=this.dynascaleManager.bindVideoElement(c,h,m);if(p)return this.leaveCallHooks.add(p),()=>{this.leaveCallHooks.delete(p),p()}},this.bindAudioElement=(c,h,m="audioTrack")=>{const p=this.dynascaleManager.bindAudioElement(c,h,m);if(p)return this.leaveCallHooks.add(p),()=>{this.leaveCallHooks.delete(p),p()}},this.bindCallThumbnailElement=(c,h={})=>{const m=()=>{c.src=h.fallbackImageSource||"https://getstream.io/random_svg/?name=x&id=x"},p=ut(this.state.thumbnails$,g=>{if(!g)return;c.addEventListener("error",m);const y=new URL(g.image_url);y.searchParams.set("w",String(c.clientWidth)),y.searchParams.set("h",String(c.clientHeight)),c.src=y.toString()});return()=>{p(),c.removeEventListener("error",m)}},this.setPreferredIncomingVideoResolution=(c,h)=>{this.dynascaleManager.setVideoTrackSubscriptionOverrides(c?{enabled:!0,dimension:c}:void 0,h),this.dynascaleManager.applyTrackSubscriptions()},this.setIncomingVideoEnabled=c=>{this.dynascaleManager.setVideoTrackSubscriptionOverrides(c?void 0:{enabled:!1}),this.dynascaleManager.applyTrackSubscriptions()},this.setDisconnectionTimeout=c=>{this.disconnectionTimeoutSeconds=c},this.type=e,this.id=n,this.cid=`${e}:${n}`,this.ringingSubject=new ee(l),this.watching=u,this.streamClient=s,this.clientStore=o,this.streamClientBasePath=`/call/${this.type}/${this.id}`,this.logger=he(["Call"]);const d=Gl.get(e),f=a||d.options.sortParticipantsBy;f&&this.state.setSortParticipantsBy(f),this.state.setMembers(i||[]),this.state.setOwnCapabilities(r||[]),this.state.setCallingState(l?M.RINGING:M.IDLE),this.camera=new Lb(this),this.microphone=new Bb(this),this.speaker=new Gb(this),this.screenShare=new qb(this),this.dynascaleManager=new kb(this.state,this.speaker)}get ringing(){return ht(this.ringingSubject)}get currentUserId(){var e;return(e=this.clientStore.connectedUser)==null?void 0:e.id}get isCreatedByMe(){var e;return((e=this.state.createdBy)==null?void 0:e.id)===this.currentUserId}}var Kb=null;class Jb{constructor(e){this._log=(n,s={},i="info")=>{this.client.logger(i,`connection:${n}`,s)},this.setClient=n=>{this.client=n},this._buildUrl=()=>{const n=new URLSearchParams;return n.set("api_key",this.client.key),n.set("stream-auth-type",this.client.getAuthType()),n.set("X-Stream-Client",this.client.getUserAgent()),`${this.client.wsBaseURL}/connect?${n.toString()}`},this.onlineStatusChanged=n=>{n.type==="offline"?(this._log("onlineStatusChanged() - Status changing to offline"),this._setHealth(!1,!0)):n.type==="online"&&(this._log(`onlineStatusChanged() - Status changing to online. isHealthy: ${this.isHealthy}`),this.isHealthy||this._reconnect({interval:10}))},this.onopen=n=>{var a;if(this.wsID!==n)return;const s=this.client.user;if(!s){this.client.logger("error","User not set, can't connect to WS");return}const i=this.client._getToken();if(!i){this.client.logger("error","Token not set, can't connect authenticate");return}const r=JSON.stringify({token:i,user_details:{id:s.id,name:s.name,image:s.image,custom:s.custom}});this._log(`onopen() - Sending auth message ${r}`,{},"trace"),(a=this.ws)==null||a.send(r),this._log("onopen() - onopen callback",{wsID:n})},this.onmessage=(n,s)=>{var r,a;if(this.wsID!==n)return;this._log("onmessage() - onmessage callback",{event:s,wsID:n});const i=typeof s.data=="string"?JSON.parse(s.data):null;if(!this.isConnectionOpenResolved&&i&&i.type==="connection.error"&&(this.isConnectionOpenResolved=!0,i.error)){(r=this.rejectConnectionOpen)==null||r.call(this,this._errorFromWSEvent(i,!1));return}if(this.lastEvent=new Date,i&&(i.type==="health.check"||i.type==="connection.ok")&&this.scheduleNextPing(),i&&i.type==="connection.ok"&&((a=this.resolveConnectionOpen)==null||a.call(this,i),this._setHealth(!0)),i&&i.type==="connection.error"&&i.error){const{code:o}=i.error;this.isHealthy=!1,this.isConnecting=!1,this.consecutiveFailures+=1,o===mn.TOKEN_EXPIRED&&!this.client.tokenManager.isStatic()&&(clearTimeout(this.connectionCheckTimeoutRef),this._log("connect() - WS failure due to expired token, so going to try to reload token and reconnect"),this._reconnect({refreshToken:!0}))}i&&(i.received_at=new Date,this.client.dispatchEvent(i)),this.scheduleConnectionCheck()},this.onclose=(n,s)=>{var i,r;if(this.wsID===n)if(this._log("onclose() - onclose callback - "+s.code,{event:s,wsID:n}),s.code===mn.WS_CLOSED_SUCCESS){const a=new Error(`WS connection reject with error ${s.reason}`);a.reason=s.reason,a.code=s.code,a.wasClean=s.wasClean,a.target=s.target,(i=this.rejectConnectionOpen)==null||i.call(this,a),this._log(`onclose() - WS connection reject with error ${s.reason}`,{event:s})}else this.consecutiveFailures+=1,this.totalFailures+=1,this._setHealth(!1),this.isConnecting=!1,(r=this.rejectConnectionOpen)==null||r.call(this,this._errorFromWSEvent(s)),this._log("onclose() - WS connection closed. Calling reconnect ...",{event:s}),this._reconnect()},this.onerror=(n,s)=>{var i;this.wsID===n&&(this.consecutiveFailures+=1,this.totalFailures+=1,this._setHealth(!1),this.isConnecting=!1,(i=this.rejectConnectionOpen)==null||i.call(this,new Error(`WebSocket error: ${s}`)),this._log("onerror() - WS connection resulted into error",{event:s}),this._reconnect())},this._setHealth=(n,s=!1)=>{if(n!==this.isHealthy){if(this.isHealthy=n,this.isHealthy||s){this.client.dispatchEvent({type:"connection.changed",online:this.isHealthy});return}setTimeout(()=>{this.isHealthy||this.client.dispatchEvent({type:"connection.changed",online:this.isHealthy})},5e3)}},this._errorFromWSEvent=(n,s=!0)=>{let i,r,a;if(ig(n))i=n.code,a=n.reason,r=0;else{const{error:u}=n;i=u.code,a=u.message,r=u.StatusCode}const o=`WS failed with code: ${i} and reason: ${a}`;this._log(o,{event:n},"warn");const l=new Error(o);return l.code=i,l.StatusCode=r,l.isWSFailure=s,l},this._setupConnectionPromise=()=>{this.isConnectionOpenResolved=!1,this.connectionOpenSafe=Zn(new Promise((n,s)=>{this.resolveConnectionOpen=n,this.rejectConnectionOpen=s}))},this.scheduleNextPing=()=>{const n=ei();this.healthCheckTimeoutRef&&n.clearTimeout(this.healthCheckTimeoutRef),this.healthCheckTimeoutRef=n.setTimeout(()=>{var i;const s=[{type:"health.check",client_id:this.client.clientID}];try{(i=this.ws)==null||i.send(JSON.stringify(s))}catch{}},this.pingInterval)},this.scheduleConnectionCheck=()=>{clearTimeout(this.connectionCheckTimeoutRef),this.connectionCheckTimeoutRef=setTimeout(()=>{const n=new Date;this.lastEvent&&n.getTime()-this.lastEvent.getTime()>this.connectionCheckTimeout&&(this._log("scheduleConnectionCheck - going to reconnect"),this._setHealth(!1),this._reconnect())},this.connectionCheckTimeout)},this.client=e,this.consecutiveFailures=0,this.totalFailures=0,this.isConnecting=!1,this.isDisconnected=!1,this.isConnectionOpenResolved=!1,this.isHealthy=!1,this.wsID=1,this.lastEvent=null,this.pingInterval=25*1e3,this.connectionCheckTimeout=this.pingInterval+10*1e3,Nr(this.onlineStatusChanged)}async connect(e=15e3){if(this.isConnecting)throw Error("You've called connect twice, can only attempt 1 connection at the time");this.isDisconnected=!1;try{const n=await this._connect();this.consecutiveFailures=0,this._log(`connect() - Established ws connection with healthcheck: ${n}`)}catch(n){if(this.isHealthy=!1,this.consecutiveFailures+=1,n.code===mn.TOKEN_EXPIRED&&!this.client.tokenManager.isStatic())this._log("connect() - WS failure due to expired token, so going to try to reload token and reconnect"),this._reconnect({refreshToken:!0});else if(!n.isWSFailure)throw new Error(JSON.stringify({code:n.code,StatusCode:n.StatusCode,message:n.message,isWSFailure:n.isWSFailure}))}return await this._waitForHealthy(e)}async _waitForHealthy(e=15e3){return Promise.race([(async()=>{for(let s=0;s<=e;s+=50)try{return await this.connectionOpen}catch(i){if(s===e)throw new Error(JSON.stringify({code:i.code,StatusCode:i.StatusCode,message:i.message,isWSFailure:i.isWSFailure}));await qt(50)}})(),(async()=>{throw await qt(e),this.isConnecting=!1,new Error(JSON.stringify({code:"",StatusCode:"",message:"initial WS connection could not be established",isWSFailure:!0}))})()])}disconnect(e){this._log(`disconnect() - Closing the websocket connection for wsID ${this.wsID}`),this.wsID+=1,this.isConnecting=!1,this.isDisconnected=!0,this.healthCheckTimeoutRef&&ei().clearInterval(this.healthCheckTimeoutRef),this.connectionCheckTimeoutRef&&clearInterval(this.connectionCheckTimeoutRef),Nl(this.onlineStatusChanged),this.isHealthy=!1;let n;const{ws:s}=this;return s&&s.close&&s.readyState===s.OPEN?(n=new Promise(i=>{const r=a=>{this._log(`disconnect() - resolving isClosedPromise ${a?"with":"without"} close frame`,{event:a}),i()};s.onclose=r,setTimeout(r,e??1e3)}),this._log("disconnect() - Manually closed connection by calling client.disconnect()"),s.close(mn.WS_CLOSED_SUCCESS,"Manually closed connection by calling client.disconnect()")):(this._log("disconnect() - ws connection doesn't exist or it is already closed."),n=Promise.resolve()),delete this.ws,n}async _connect(){var n,s,i,r;if(this.isConnecting)return;this.isConnecting=!0;let e=!1;try{this._log("_connect() - waiting for token"),await this.client.tokenManager.tokenReady(),e=!0}catch{}try{e||(this._log("_connect() - tokenProvider failed before, so going to retry"),await this.client.tokenManager.loadToken()),this.client.isConnectionIsPromisePending||this.client._setupConnectionIdPromise(),this._setupConnectionPromise();const a=this._buildUrl();this._log(`_connect() - Connecting to ${a}`);const o=this.client.options.WebSocketImpl??WebSocket;this.ws=new o(a),this.ws.onopen=this.onopen.bind(this,this.wsID),this.ws.onclose=this.onclose.bind(this,this.wsID),this.ws.onerror=this.onerror.bind(this,this.wsID),this.ws.onmessage=this.onmessage.bind(this,this.wsID);const l=await this.connectionOpen;if(this.isConnecting=!1,l)return this.connectionID=l.connection_id,(s=(n=this.client).resolveConnectionId)==null||s.call(n,this.connectionID),l}catch(a){throw this.client._setupConnectionIdPromise(),this.isConnecting=!1,this._log("_connect() - Error - ",a),(r=(i=this.client).rejectConnectionId)==null||r.call(i,a),a}}async _reconnect(e={}){if(this._log("_reconnect() - Initiating the reconnect"),this.isConnecting||this.isHealthy){this._log("_reconnect() - Abort (1) since already connecting or healthy");return}let n=e.interval;if(n||(n=rs(this.consecutiveFailures)),await qt(n),this.isConnecting||this.isHealthy){this._log("_reconnect() - Abort (2) since already connecting or healthy");return}if(this.isDisconnected){this._log("_reconnect() - Abort (3) since disconnect() is called");return}this._log("_reconnect() - Destroying current WS connection"),this._destroyCurrentWSConnection(),e.refreshToken&&await this.client.tokenManager.loadToken();try{await this._connect(),this._log("_reconnect() - Waiting for recoverCallBack"),this._log("_reconnect() - Finished recoverCallBack"),this.consecutiveFailures=0}catch(s){if(this.isHealthy=!1,this.consecutiveFailures+=1,s.code===mn.TOKEN_EXPIRED&&!this.client.tokenManager.isStatic())return this._log("_reconnect() - WS failure due to expired token, so going to try to reload token and reconnect"),this._reconnect({refreshToken:!0});s.isWSFailure&&(this._log("_reconnect() - WS failure, so going to try to reconnect"),this._reconnect())}this._log("_reconnect() - == END ==")}_destroyCurrentWSConnection(){var e;this.wsID+=1;try{(e=this==null?void 0:this.ws)==null||e.close()}catch{}}get connectionOpen(){var e;return(e=this.connectionOpenSafe)==null?void 0:e.call(this)}}function zb(t){const e=t.split(".");if(e.length!==3)return"";const n=e[1],s=Yb(n);return JSON.parse(s).user_id}const Yb=t=>{const e={},n=String.fromCharCode,s=t.length;let i,r=0,a,o,l=0,u,d="";const f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(i=0;i<64;i++)e[f.charAt(i)]=i;for(o=0;o<s;o++)for(a=e[t.charAt(o)],r=(r<<6)+a,l+=6;l>=8;)((u=r>>>(l-=8)&255)||o<s-2)&&(d+=n(u));return d};class Xb{constructor(e){this.loadTokenPromise=null,this.type="static",this.setTokenOrProvider=async(n,s,i)=>{this.user=s,this.isAnonymous=i,this.validateToken(n),Pr(n)&&(this.tokenProvider=n,this.type="provider"),typeof n=="string"&&(this.token=n,this.type="static"),await this.loadToken()},this.reset=()=>{this.token=void 0,this.tokenProvider=void 0,this.type="static",this.user=void 0,this.loadTokenPromise=null},this.validateToken=n=>{if(!(this.user&&this.isAnonymous&&!n)){if(!this.secret&&!n)throw new Error("User token can not be empty");if(typeof n!="string"&&!Pr(n))throw new Error("User token should either be a string or a function");if(typeof n=="string"){if(this.isAnonymous&&n==="")return;const s=zb(n);if(n!=null&&(s==null||s===""||!this.isAnonymous&&s!==this.user.id))throw new Error("userToken does not have a user_id or is not matching with user.id")}}},this.tokenReady=()=>this.loadTokenPromise,this.loadToken=()=>(this.loadTokenPromise=new Promise(async(n,s)=>{if(this.type==="static")return n(this.token);if(this.tokenProvider&&typeof this.tokenProvider!="string"){try{const i=await this.tokenProvider();this.validateToken(i),this.token=i}catch(i){return s(new Error(`Call to tokenProvider failed with message: ${i}`))}n(this.token)}}),this.loadTokenPromise),this.getToken=()=>{if(this.token)return this.token;if(this.user&&!this.token)return this.token;throw new Error("User token is not set. Either client.connectUser wasn't called or client.disconnect was called")},this.isStatic=()=>this.type==="static",this.secret=e}}const ko=async(t="https://hint.stream-io-video.com/",e=2e3,n=3)=>{const s=he(["location-hint"]);let i=0,r="ERR";do{const a=new AbortController,o=setTimeout(()=>a.abort(),e);try{const u=(await fetch(t,{method:"HEAD",signal:a.signal})).headers.get("x-amz-cf-pop")||"ERR";s("debug",`Location header: ${u}`),r=u.substring(0,3)}catch(l){s("warn",`Failed to get location hint from ${t}`,l),r="ERR"}finally{clearTimeout(o)}}while(r==="ERR"&&++i<n);return r};class Zb{constructor(e,n){var i;this.listeners={},this.getAuthType=()=>this.anonymous?"anonymous":"jwt",this.setBaseURL=r=>{this.baseURL=r,this.wsBaseURL=this.baseURL.replace("http","ws").replace(":3030",":8800")},this.getLocationHint=async(r,a)=>{const o=await this.locationHint;return!o||o==="ERR"?(this.locationHint=ko(r??this.options.locationHintUrl,a??this.options.locationHintTimeout),this.locationHint):o},this._getConnectionID=()=>{var r;return(r=this.wsConnection)==null?void 0:r.connectionID},this._hasConnectionID=()=>!!this._getConnectionID(),this.connectUser=async(r,a)=>{if(!r.id)throw new Error('The "id" field on the user is missing');if(this.userID===r.id&&this.connectUserTask)return this.logger("warn","Consecutive calls to connectUser is detected, ideally you should only call this function once in your app."),this.connectUserTask;if(this.userID)throw new Error("Use client.disconnect() before trying to connect as a different user. connectUser was called twice.");(this.secret||this.node)&&!this.options.allowServerSideConnect&&this.logger("warn","Please do not use connectUser server side. Use our @stream-io/node-sdk instead: https://getstream.io/video/docs/api/"),this.userID=r.id,this.anonymous=!1,await this.tokenManager.setTokenOrProvider(a,r,!1),this._setUser(r),this.connectUserTask=this.openConnection();try{return Nr(this.updateNetworkConnectionStatus),await this.connectUserTask}catch(o){throw this.persistUserOnConnectionFailure?await this.closeConnection():await this.disconnectUser(),o}},this._setUser=r=>{this.user=r,this.userID=r.id,this._user={...r}},this.closeConnection=async r=>{var a;await((a=this.wsConnection)==null?void 0:a.disconnect(r))},this.openConnection=async()=>{var o,l,u;if(!this.userID)throw Error("UserWithId is not set on client, use client.connectUser or client.connectAnonymousUser instead");const r=(o=this.wsPromiseSafe)==null?void 0:o.call(this);if((l=this.wsConnection)!=null&&l.isConnecting&&r)return this.logger("info","client:openConnection() - connection already in progress"),await r;if((u=this.wsConnection)!=null&&u.isHealthy&&this._hasConnectionID()){this.logger("info","client:openConnection() - openConnection called twice, healthy connection already exists");return}this._setupConnectionIdPromise(),this.clientID=`${this.userID}--${Or()}`;const a=this.connect();return this.wsPromiseSafe=Zn(a),await a},this.disconnectUser=async r=>{this.logger("info","client:disconnect() - Disconnecting the client"),delete this.user,delete this._user,delete this.userID,this.anonymous=!1,await this.closeConnection(r),Nl(this.updateNetworkConnectionStatus),this.tokenManager.reset(),this.connectionIdPromiseSafe=void 0,this.rejectConnectionId=void 0,this.resolveConnectionId=void 0},this.connectGuestUser=async r=>{this.guestUserCreatePromise=this.doAxiosRequest("post","/guest",{user:r},{publicEndpoint:!0});const a=await this.guestUserCreatePromise;return this.guestUserCreatePromise.finally(()=>this.guestUserCreatePromise=void 0),this.connectUser(a.user,a.access_token)},this.connectAnonymousUser=async(r,a)=>{var o;Nr(this.updateNetworkConnectionStatus),this._setupConnectionIdPromise(),this.anonymous=!0,await this.tokenManager.setTokenOrProvider(a,r,!0),this._setUser(r),(o=this.resolveConnectionId)==null||o.call(this)},this.on=(r,a)=>{var o;return this.listeners[r]||(this.listeners[r]=[]),this.logger("debug",`Adding listener for ${r} event`),(o=this.listeners[r])==null||o.push(a),()=>{this.off(r,a)}},this.off=(r,a)=>{var o;this.listeners[r]||(this.listeners[r]=[]),this.logger("debug",`Removing listener for ${r} event`),this.listeners[r]=(o=this.listeners[r])==null?void 0:o.filter(l=>l!==a)},this._setupConnectionIdPromise=()=>{this.connectionIdPromiseSafe=Zn(new Promise((r,a)=>{this.resolveConnectionId=r,this.rejectConnectionId=a}))},this._logApiRequest=(r,a,o,l)=>{Ar()==="trace"&&this.logger("trace",`client: ${r} - Request - ${a}`,{payload:o,config:l})},this._logApiResponse=(r,a,o)=>{Ar()==="trace"&&this.logger("trace",`client:${r} - Response - url: ${a} > status ${o.status}`,{response:o})},this._logApiError=(r,a,o)=>{this.logger("error",`client:${r} - Error - url: ${a}`,{url:a,error:o})},this.doAxiosRequest=async(r,a,o,l={})=>{var d,f;if(!l.publicEndpoint){await Promise.all([this.tokenManager.tokenReady(),this.guestUserCreatePromise]);try{await this.connectionIdPromise}catch{await((d=this.wsConnection)==null?void 0:d._waitForHealthy()),await this.connectionIdPromise}}const u=this._enrichAxiosOptions(l);try{let c;switch(this._logApiRequest(r,a,o,u),r){case"get":c=await this.axiosInstance.get(a,u);break;case"delete":c=await this.axiosInstance.delete(a,u);break;case"post":c=await this.axiosInstance.post(a,o,u);break;case"put":c=await this.axiosInstance.put(a,o,u);break;case"patch":c=await this.axiosInstance.patch(a,o,u);break;case"options":c=await this.axiosInstance.options(a,u);break;default:throw new Error("Invalid request type")}return this._logApiResponse(r,a,c),this.consecutiveFailures=0,this.handleResponse(c)}catch(c){if(c.client_request_id=(f=u.headers)==null?void 0:f["x-client-request-id"],this.consecutiveFailures+=1,c.response)return this._logApiError(r,a,c.response),c.response.data.code===mn.TOKEN_EXPIRED&&!this.tokenManager.isStatic()?(this.consecutiveFailures>1&&await qt(rs(this.consecutiveFailures)),await this.tokenManager.loadToken(),await this.doAxiosRequest(r,a,o,l)):this.handleResponse(c.response);throw this._logApiError(r,a,c),c}},this.get=(r,a)=>this.doAxiosRequest("get",r,null,{params:a}),this.put=(r,a,o)=>this.doAxiosRequest("put",r,a,{params:o}),this.post=(r,a,o)=>this.doAxiosRequest("post",r,a,{params:o}),this.patch=(r,a,o)=>this.doAxiosRequest("patch",r,a,{params:o}),this.delete=(r,a)=>this.doAxiosRequest("delete",r,null,{params:a}),this.errorFromResponse=r=>{const{data:a,status:o}=r,l=new yl;return l.message=`Stream error code ${a.code}: ${a.message}`,l.code=a.code,l.unrecoverable=a.unrecoverable,l.response=r,l.status=o,l},this.handleResponse=r=>{const a=r.data;if(sg(r))throw this.errorFromResponse(r);return a},this.dispatchEvent=r=>{if(this.logger("debug",`Dispatching event: ${r.type}`,r),!!this.listeners){for(const a of this.listeners.all||[])a(r);for(const a of this.listeners[r.type]||[])a(r)}},this.connect=async()=>{if(!this.userID||!this._user)throw Error("Call connectUser or connectAnonymousUser before starting the connection");if(!this.wsBaseURL)throw Error("Websocket base url not set");if(!this.clientID)throw Error("clientID is not set");return this.wsConnection=new Jb(this),this.logger("info","StreamClient.connect: this.wsConnection.connect()"),await this.wsConnection.connect(this.defaultWSTimeout)},this.getUserAgent=()=>{if(!this.cachedUserAgent){const{clientAppIdentifier:r={}}=this.options,{sdkName:a="js",sdkVersion:o="1.20.0",...l}=r;this.cachedUserAgent=[`stream-video-${a}-v${o}`,...Object.entries(l).map(([u,d])=>`${u}=${d}`),"client_bundle=browser-esm"].join("|")}return this.cachedUserAgent},this._enrichAxiosOptions=(r={params:{},headers:{},config:{}})=>{var l;const a=r.publicEndpoint&&!this.user?void 0:this._getToken(),o=a?{Authorization:a}:void 0;return(l=r.headers)!=null&&l["x-client-request-id"]||(r.headers={...r.headers,"x-client-request-id":Or()}),{params:{user_id:this.userID,connection_id:this._getConnectionID(),api_key:this.key,...r.params},headers:{...o,"stream-auth-type":r.publicEndpoint&&!this.user?"anonymous":this.getAuthType(),"X-Stream-Client":this.getUserAgent(),...r.headers},...r.config,...this.options.axiosRequestConfig}},this._getToken=()=>this.tokenManager?this.tokenManager.getToken():null,this.updateNetworkConnectionStatus=r=>{r.type==="offline"?(this.logger("debug","device went offline"),this.dispatchEvent({type:"network.changed",online:!1})):r.type==="online"&&(this.logger("debug","device went online"),this.dispatchEvent({type:"network.changed",online:!0}))},this.key=e,this.secret=n==null?void 0:n.secret;const s=n||{browser:typeof window<"u"};this.browser=s.browser||typeof window<"u",this.node=!this.browser,this.browser&&(this.locationHint=ko(n==null?void 0:n.locationHintUrl,n==null?void 0:n.locationHintTimeout,n==null?void 0:n.locationHintMaxAttempts)),this.options={timeout:5e3,withCredentials:!1,...s},this.node&&!this.options.httpsAgent&&(this.options.httpsAgent=new Kb.Agent({keepAlive:!0,keepAliveMsecs:3e3})),this.setBaseURL(this.options.baseURL||"https://video.stream-io-api.com/video"),this.axiosInstance=rd.create({...this.options,baseURL:this.baseURL}),this.wsConnection=null,this.wsPromiseSafe=null,this.connectUserTask=null,this.anonymous=!1,this.persistUserOnConnectionFailure=(i=this.options)==null?void 0:i.persistUserOnConnectionFailure,this.tokenManager=new Xb(this.secret),this.consecutiveFailures=0,this.defaultWSTimeout=this.options.defaultWsTimeout??15e3,this.logger=Pr(s.logger)?s.logger:()=>null}get connectionIdPromise(){var e;return(e=this.connectionIdPromiseSafe)==null?void 0:e.call(this)}get isConnectionIsPromisePending(){var e;return((e=this.connectionIdPromiseSafe)==null?void 0:e.checkPending())??!1}get wsPromise(){var e;return(e=this.wsPromiseSafe)==null?void 0:e.call(this)}}const sr=(t,e)=>`${t}/${e.id}`,Qb=t=>{const e=(t==null?void 0:t.clientAppIdentifier)||{},n=Ag();return n&&(e.sdkName=Gt[n.type].toLowerCase(),e.sdkVersion=`${n.major}.${n.minor}.${n.patch}`),e},ev=(t,e)=>{const n=Qb(e),s=he(["coordinator"]);return new Zb(t,{persistUserOnConnectionFailure:!0,...e,clientAppIdentifier:n,logger:s})},tv=t=>{const{token:e,tokenProvider:n}=t;if(e&&n){let s=!1;return async function(){return s?n():(s=!0,e)}}return e||n};class $t{constructor(e,n){this.effectsRegistered=!1,this.eventHandlersToUnregister=[],this.connectionConcurrencyTag=Symbol("connectionConcurrencyTag"),this.registerClientInstance=(a,o)=>{const l=sr(a,o);$t._instances.has(l)&&this.logger("warn",`A StreamVideoClient already exists for ${o.id}; Prefer using getOrCreateInstance method`),$t._instances.set(l,this)},this.registerEffects=()=>{this.effectsRegistered||(this.eventHandlersToUnregister.push(this.on("connection.changed",a=>{if(!a.online)return;const o=this.writeableStateStore.calls.filter(l=>l.watching).map(l=>l.cid);o.length<=0||(this.logger("info",`Rewatching calls ${o.join(", ")}`),this.queryCalls({watch:!0,filter_conditions:{cid:{$in:o}},sort:[{field:"cid",direction:1}]}).catch(l=>{this.logger("error","Failed to re-watch calls",l)}))})),this.eventHandlersToUnregister.push(this.on("call.created",a=>{var d;const{call:o,members:l}=a;if(((d=this.state.connectedUser)==null?void 0:d.id)===o.created_by.id){this.logger("warn","Received `call.created` sent by the current user");return}this.logger("info",`New call created and registered: ${o.cid}`);const u=new An({streamClient:this.streamClient,type:o.type,id:o.id,members:l,clientStore:this.writeableStateStore});u.state.updateFromCallResponse(o),this.writeableStateStore.registerCall(u)})),this.eventHandlersToUnregister.push(this.on("call.ring",async a=>{var d;const{call:o,members:l}=a;if(((d=this.state.connectedUser)==null?void 0:d.id)===o.created_by.id){this.logger("debug","Received `call.ring` sent by the current user so ignoring the event");return}const u=this.writeableStateStore.findCall(o.type,o.id);u?await u.updateFromRingingEvent(a):await new An({streamClient:this.streamClient,type:o.type,id:o.id,members:l,clientStore:this.writeableStateStore,ringing:!0}).get()})),this.effectsRegistered=!0)},this.connectUser=async(a,o)=>{if(a.type==="anonymous")return a.id="!anon",this.connectAnonymousUser(a,o);const l=await tt(this.connectionConcurrencyTag,async()=>{const u=this.streamClient,{onConnectUserError:d,persistUserOnConnectionFailure:f}=u.options;let{maxConnectUserRetries:c=5}=u.options;c=Math.max(c,1);const h=[];for(let m=0;m<c;m++)try{return this.logger("trace",`Connecting user (${m})`,a),a.type==="guest"?await u.connectGuestUser(a):await u.connectUser(a,o)}catch(p){if(this.logger("warn",`Failed to connect a user (${m})`,p),h.push(p),m===c-1)throw d==null||d(p,h),p;f&&await u.disconnectUser(),await qt(rs(m))}});return l!=null&&l.me&&this.writeableStateStore.setConnectedUser(l.me),this.registerEffects(),l},this.disconnectUser=async a=>{await tt(this.connectionConcurrencyTag,async()=>{const{user:o,key:l}=this.streamClient;o&&(await this.streamClient.disconnectUser(a),o.id&&$t._instances.delete(sr(l,o)),this.eventHandlersToUnregister.forEach(u=>u()),this.eventHandlersToUnregister=[],this.effectsRegistered=!1,this.writeableStateStore.setConnectedUser(void 0))})},this.on=(a,o)=>this.streamClient.on(a,o),this.off=(a,o)=>this.streamClient.off(a,o),this.call=(a,o)=>new An({streamClient:this.streamClient,id:o,type:a,clientStore:this.writeableStateStore}),this.createGuestUser=async a=>this.streamClient.doAxiosRequest("post","/guest",a,{publicEndpoint:!0}),this.queryCalls=async(a={})=>{const o=await this.streamClient.post("/calls",a),l=[];for(const u of o.calls){const d=new An({streamClient:this.streamClient,id:u.call.id,type:u.call.type,members:u.members,ownCapabilities:u.own_capabilities,watching:a.watch,clientStore:this.writeableStateStore});d.state.updateFromCallResponse(u.call),await d.applyDeviceConfig(u.call.settings,!1),a.watch&&(await d.setup(),this.writeableStateStore.registerCall(d)),l.push(d)}return{...o,calls:l}},this.queryCallStats=async(a={})=>this.streamClient.post("/call/stats",a),this.queryAggregateCallStats=async(a={})=>this.streamClient.post("/stats",a),this.edges=async()=>this.streamClient.get("/edges"),this.addDevice=async(a,o,l,u,d)=>await this.streamClient.post("/devices",{id:a,push_provider:o,voip_token:d,...u!=null?{user_id:u}:{},...l!=null?{push_provider_name:l}:{}}),this.addVoipDevice=async(a,o,l,u)=>await this.addDevice(a,o,l,u,!0),this.getDevices=async a=>await this.streamClient.get("/devices",a?{user_id:a}:{}),this.removeDevice=async(a,o)=>await this.streamClient.delete("/devices",{id:a,...o?{user_id:o}:{}}),this.onRingingCall=async a=>{let o=this.state.calls.find(l=>l.cid===a&&l.ringing);if(!o){const[l,u]=a.split(":");o=new An({streamClient:this.streamClient,type:l,id:u,clientStore:this.writeableStateStore,ringing:!0}),await o.get()}return o},this.connectAnonymousUser=async(a,o)=>tt(this.connectionConcurrencyTag,()=>this.streamClient.connectAnonymousUser(a,o));const s=typeof e=="string"?e:e.apiKey,i=typeof e=="string"?n:e.options;i!=null&&i.enableTimerWorker&&nb();const r=(i==null?void 0:i.logger)||Dl;if(rg(r,(i==null?void 0:i.logLevel)||"warn"),this.logger=he(["client"]),this.streamClient=ev(s,i),this.writeableStateStore=new gg,this.readOnlyStateStore=new bg(this.writeableStateStore),typeof e!="string"&&e.user){const a=e.user;a.type==="anonymous"&&(a.id="!anon"),a.id&&this.registerClientInstance(s,a);const o=tv(e);this.connectUser(a,o).catch(l=>{this.logger("error","Failed to connect",l)})}}static getOrCreateInstance(e){const{apiKey:n,user:s,token:i,tokenProvider:r}=e;if(!s.id&&s.type!=="anonymous")throw new Error("user.id is required for a non-anonymous user");if(!i&&!r&&s.type!=="anonymous"&&s.type!=="guest")throw new Error("tokenProvider or token is required for a authenticated users");return $t._instances.get(sr(n,s))||new $t(e)}get state(){return this.readOnlyStateStore}}$t._instances=new Map;const Z=t=>typeof t=="string",Dn=()=>{let t,e;const n=new Promise((s,i)=>{t=s,e=i});return n.resolve=t,n.reject=e,n},Ro=t=>t==null?"":""+t,nv=(t,e,n)=>{t.forEach(s=>{e[s]&&(n[s]=e[s])})},sv=/###/g,Eo=t=>t&&t.indexOf("###")>-1?t.replace(sv,"."):t,Io=t=>!t||Z(t),$n=(t,e,n)=>{const s=Z(e)?e.split("."):e;let i=0;for(;i<s.length-1;){if(Io(t))return{};const r=Eo(s[i]);!t[r]&&n&&(t[r]=new n),Object.prototype.hasOwnProperty.call(t,r)?t=t[r]:t={},++i}return Io(t)?{}:{obj:t,k:Eo(s[i])}},_o=(t,e,n)=>{const{obj:s,k:i}=$n(t,e,Object);if(s!==void 0||e.length===1){s[i]=n;return}let r=e[e.length-1],a=e.slice(0,e.length-1),o=$n(t,a,Object);for(;o.obj===void 0&&a.length;)r=`${a[a.length-1]}.${r}`,a=a.slice(0,a.length-1),o=$n(t,a,Object),o&&o.obj&&typeof o.obj[`${o.k}.${r}`]<"u"&&(o.obj=void 0);o.obj[`${o.k}.${r}`]=n},iv=(t,e,n,s)=>{const{obj:i,k:r}=$n(t,e,Object);i[r]=i[r]||[],i[r].push(n)},si=(t,e)=>{const{obj:n,k:s}=$n(t,e);if(n)return n[s]},rv=(t,e,n)=>{const s=si(t,n);return s!==void 0?s:si(e,n)},tu=(t,e,n)=>{for(const s in e)s!=="__proto__"&&s!=="constructor"&&(s in t?Z(t[s])||t[s]instanceof String||Z(e[s])||e[s]instanceof String?n&&(t[s]=e[s]):tu(t[s],e[s],n):t[s]=e[s]);return t},hn=t=>t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var av={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const ov=t=>Z(t)?t.replace(/[&<>"'\/]/g,e=>av[e]):t;class cv{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const n=this.regExpMap.get(e);if(n!==void 0)return n;const s=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,s),this.regExpQueue.push(e),s}}const lv=[" ",",","?","!",";"],uv=new cv(20),dv=(t,e,n)=>{e=e||"",n=n||"";const s=lv.filter(a=>e.indexOf(a)<0&&n.indexOf(a)<0);if(s.length===0)return!0;const i=uv.getRegExp(`(${s.map(a=>a==="?"?"\\?":a).join("|")})`);let r=!i.test(t);if(!r){const a=t.indexOf(n);a>0&&!i.test(t.substring(0,a))&&(r=!0)}return r},Lr=function(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:".";if(!t)return;if(t[e])return t[e];const s=e.split(n);let i=t;for(let r=0;r<s.length;){if(!i||typeof i!="object")return;let a,o="";for(let l=r;l<s.length;++l)if(l!==r&&(o+=n),o+=s[l],a=i[o],a!==void 0){if(["string","number","boolean"].indexOf(typeof a)>-1&&l<s.length-1)continue;r+=l-r+1;break}i=a}return i},ii=t=>t&&t.replace("_","-"),hv={type:"logger",log(t){this.output("log",t)},warn(t){this.output("warn",t)},error(t){this.output("error",t)},output(t,e){console&&console[t]&&console[t].apply(console,e)}};class ri{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.init(e,n)}init(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.prefix=n.prefix||"i18next:",this.logger=e||hv,this.options=n,this.debug=n.debug}log(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return this.forward(n,"log","",!0)}warn(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return this.forward(n,"warn","",!0)}error(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return this.forward(n,"error","")}deprecate(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return this.forward(n,"warn","WARNING DEPRECATED: ",!0)}forward(e,n,s,i){return i&&!this.debug?null:(Z(e[0])&&(e[0]=`${s}${this.prefix} ${e[0]}`),this.logger[n](e))}create(e){return new ri(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new ri(this.logger,e)}}var wt=new ri;class Ni{constructor(){this.observers={}}on(e,n){return e.split(" ").forEach(s=>{this.observers[s]||(this.observers[s]=new Map);const i=this.observers[s].get(n)||0;this.observers[s].set(n,i+1)}),this}off(e,n){if(this.observers[e]){if(!n){delete this.observers[e];return}this.observers[e].delete(n)}}emit(e){for(var n=arguments.length,s=new Array(n>1?n-1:0),i=1;i<n;i++)s[i-1]=arguments[i];this.observers[e]&&Array.from(this.observers[e].entries()).forEach(a=>{let[o,l]=a;for(let u=0;u<l;u++)o(...s)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(a=>{let[o,l]=a;for(let u=0;u<l;u++)o.apply(o,[e,...s])})}}class xo extends Ni{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=n,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const n=this.options.ns.indexOf(e);n>-1&&this.options.ns.splice(n,1)}getResource(e,n,s){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const r=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator,a=i.ignoreJSONStructure!==void 0?i.ignoreJSONStructure:this.options.ignoreJSONStructure;let o;e.indexOf(".")>-1?o=e.split("."):(o=[e,n],s&&(Array.isArray(s)?o.push(...s):Z(s)&&r?o.push(...s.split(r)):o.push(s)));const l=si(this.data,o);return!l&&!n&&!s&&e.indexOf(".")>-1&&(e=o[0],n=o[1],s=o.slice(2).join(".")),l||!a||!Z(s)?l:Lr(this.data&&this.data[e]&&this.data[e][n],s,r)}addResource(e,n,s,i){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{silent:!1};const a=r.keySeparator!==void 0?r.keySeparator:this.options.keySeparator;let o=[e,n];s&&(o=o.concat(a?s.split(a):s)),e.indexOf(".")>-1&&(o=e.split("."),i=n,n=o[1]),this.addNamespaces(n),_o(this.data,o,i),r.silent||this.emit("added",e,n,s,i)}addResources(e,n,s){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{silent:!1};for(const r in s)(Z(s[r])||Array.isArray(s[r]))&&this.addResource(e,n,r,s[r],{silent:!0});i.silent||this.emit("added",e,n,s)}addResourceBundle(e,n,s,i,r){let a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{silent:!1,skipCopy:!1},o=[e,n];e.indexOf(".")>-1&&(o=e.split("."),i=s,s=n,n=o[1]),this.addNamespaces(n);let l=si(this.data,o)||{};a.skipCopy||(s=JSON.parse(JSON.stringify(s))),i?tu(l,s,r):l={...l,...s},_o(this.data,o,l),a.silent||this.emit("added",e,n,s)}removeResourceBundle(e,n){this.hasResourceBundle(e,n)&&delete this.data[e][n],this.removeNamespaces(n),this.emit("removed",e,n)}hasResourceBundle(e,n){return this.getResource(e,n)!==void 0}getResourceBundle(e,n){return n||(n=this.options.defaultNS),this.options.compatibilityAPI==="v1"?{...this.getResource(e,n)}:this.getResource(e,n)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const n=this.getDataByLanguage(e);return!!(n&&Object.keys(n)||[]).find(i=>n[i]&&Object.keys(n[i]).length>0)}toJSON(){return this.data}}var nu={processors:{},addPostProcessor(t){this.processors[t.name]=t},handle(t,e,n,s,i){return t.forEach(r=>{this.processors[r]&&(e=this.processors[r].process(e,n,s,i))}),e}};const Po={};class ai extends Ni{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),nv(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=n,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=wt.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};if(e==null)return!1;const s=this.resolve(e,n);return s&&s.res!==void 0}extractFromKey(e,n){let s=n.nsSeparator!==void 0?n.nsSeparator:this.options.nsSeparator;s===void 0&&(s=":");const i=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator;let r=n.ns||this.options.defaultNS||[];const a=s&&e.indexOf(s)>-1,o=!this.options.userDefinedKeySeparator&&!n.keySeparator&&!this.options.userDefinedNsSeparator&&!n.nsSeparator&&!dv(e,s,i);if(a&&!o){const l=e.match(this.interpolator.nestingRegexp);if(l&&l.length>0)return{key:e,namespaces:Z(r)?[r]:r};const u=e.split(s);(s!==i||s===i&&this.options.ns.indexOf(u[0])>-1)&&(r=u.shift()),e=u.join(i)}return{key:e,namespaces:Z(r)?[r]:r}}translate(e,n,s){if(typeof n!="object"&&this.options.overloadTranslationOptionHandler&&(n=this.options.overloadTranslationOptionHandler(arguments)),typeof n=="object"&&(n={...n}),n||(n={}),e==null)return"";Array.isArray(e)||(e=[String(e)]);const i=n.returnDetails!==void 0?n.returnDetails:this.options.returnDetails,r=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator,{key:a,namespaces:o}=this.extractFromKey(e[e.length-1],n),l=o[o.length-1],u=n.lng||this.language,d=n.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(u&&u.toLowerCase()==="cimode"){if(d){const T=n.nsSeparator||this.options.nsSeparator;return i?{res:`${l}${T}${a}`,usedKey:a,exactUsedKey:a,usedLng:u,usedNS:l,usedParams:this.getUsedParamsDetails(n)}:`${l}${T}${a}`}return i?{res:a,usedKey:a,exactUsedKey:a,usedLng:u,usedNS:l,usedParams:this.getUsedParamsDetails(n)}:a}const f=this.resolve(e,n);let c=f&&f.res;const h=f&&f.usedKey||a,m=f&&f.exactUsedKey||a,p=Object.prototype.toString.apply(c),g=["[object Number]","[object Function]","[object RegExp]"],y=n.joinArrays!==void 0?n.joinArrays:this.options.joinArrays,C=!this.i18nFormat||this.i18nFormat.handleAsObject,S=!Z(c)&&typeof c!="boolean"&&typeof c!="number";if(C&&c&&S&&g.indexOf(p)<0&&!(Z(y)&&Array.isArray(c))){if(!n.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const T=this.options.returnedObjectHandler?this.options.returnedObjectHandler(h,c,{...n,ns:o}):`key '${a} (${this.language})' returned an object instead of string.`;return i?(f.res=T,f.usedParams=this.getUsedParamsDetails(n),f):T}if(r){const T=Array.isArray(c),w=T?[]:{},k=T?m:h;for(const _ in c)if(Object.prototype.hasOwnProperty.call(c,_)){const L=`${k}${r}${_}`;w[_]=this.translate(L,{...n,joinArrays:!1,ns:o}),w[_]===L&&(w[_]=c[_])}c=w}}else if(C&&Z(y)&&Array.isArray(c))c=c.join(y),c&&(c=this.extendTranslation(c,e,n,s));else{let T=!1,w=!1;const k=n.count!==void 0&&!Z(n.count),_=ai.hasDefaultValue(n),L=k?this.pluralResolver.getSuffix(u,n.count,n):"",$=n.ordinal&&k?this.pluralResolver.getSuffix(u,n.count,{ordinal:!1}):"",N=k&&!n.ordinal&&n.count===0&&this.pluralResolver.shouldUseIntlApi(),F=N&&n[`defaultValue${this.options.pluralSeparator}zero`]||n[`defaultValue${L}`]||n[`defaultValue${$}`]||n.defaultValue;!this.isValidLookup(c)&&_&&(T=!0,c=F),this.isValidLookup(c)||(w=!0,c=a);const j=(n.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&w?void 0:c,x=_&&F!==c&&this.options.updateMissing;if(w||T||x){if(this.logger.log(x?"updateKey":"missingKey",u,l,a,x?F:c),r){const I=this.resolve(a,{...n,keySeparator:!1});I&&I.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let R=[];const U=this.languageUtils.getFallbackCodes(this.options.fallbackLng,n.lng||this.language);if(this.options.saveMissingTo==="fallback"&&U&&U[0])for(let I=0;I<U.length;I++)R.push(U[I]);else this.options.saveMissingTo==="all"?R=this.languageUtils.toResolveHierarchy(n.lng||this.language):R.push(n.lng||this.language);const V=(I,A,Y)=>{const ve=_&&Y!==c?Y:j;this.options.missingKeyHandler?this.options.missingKeyHandler(I,l,A,ve,x,n):this.backendConnector&&this.backendConnector.saveMissing&&this.backendConnector.saveMissing(I,l,A,ve,x,n),this.emit("missingKey",I,l,A,c)};this.options.saveMissing&&(this.options.saveMissingPlurals&&k?R.forEach(I=>{const A=this.pluralResolver.getSuffixes(I,n);N&&n[`defaultValue${this.options.pluralSeparator}zero`]&&A.indexOf(`${this.options.pluralSeparator}zero`)<0&&A.push(`${this.options.pluralSeparator}zero`),A.forEach(Y=>{V([I],a+Y,n[`defaultValue${Y}`]||F)})}):V(R,a,F))}c=this.extendTranslation(c,e,n,f,s),w&&c===a&&this.options.appendNamespaceToMissingKey&&(c=`${l}:${a}`),(w||T)&&this.options.parseMissingKeyHandler&&(this.options.compatibilityAPI!=="v1"?c=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${l}:${a}`:a,T?c:void 0):c=this.options.parseMissingKeyHandler(c))}return i?(f.res=c,f.usedParams=this.getUsedParamsDetails(n),f):c}extendTranslation(e,n,s,i,r){var a=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...s},s.lng||this.language||i.usedLng,i.usedNS,i.usedKey,{resolved:i});else if(!s.skipInterpolation){s.interpolation&&this.interpolator.init({...s,interpolation:{...this.options.interpolation,...s.interpolation}});const u=Z(e)&&(s&&s.interpolation&&s.interpolation.skipOnVariables!==void 0?s.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let d;if(u){const c=e.match(this.interpolator.nestingRegexp);d=c&&c.length}let f=s.replace&&!Z(s.replace)?s.replace:s;if(this.options.interpolation.defaultVariables&&(f={...this.options.interpolation.defaultVariables,...f}),e=this.interpolator.interpolate(e,f,s.lng||this.language||i.usedLng,s),u){const c=e.match(this.interpolator.nestingRegexp),h=c&&c.length;d<h&&(s.nest=!1)}!s.lng&&this.options.compatibilityAPI!=="v1"&&i&&i.res&&(s.lng=this.language||i.usedLng),s.nest!==!1&&(e=this.interpolator.nest(e,function(){for(var c=arguments.length,h=new Array(c),m=0;m<c;m++)h[m]=arguments[m];return r&&r[0]===h[0]&&!s.context?(a.logger.warn(`It seems you are nesting recursively key: ${h[0]} in key: ${n[0]}`),null):a.translate(...h,n)},s)),s.interpolation&&this.interpolator.reset()}const o=s.postProcess||this.options.postProcess,l=Z(o)?[o]:o;return e!=null&&l&&l.length&&s.applyPostProcessor!==!1&&(e=nu.handle(l,e,n,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...i,usedParams:this.getUsedParamsDetails(s)},...s}:s,this)),e}resolve(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s,i,r,a,o;return Z(e)&&(e=[e]),e.forEach(l=>{if(this.isValidLookup(s))return;const u=this.extractFromKey(l,n),d=u.key;i=d;let f=u.namespaces;this.options.fallbackNS&&(f=f.concat(this.options.fallbackNS));const c=n.count!==void 0&&!Z(n.count),h=c&&!n.ordinal&&n.count===0&&this.pluralResolver.shouldUseIntlApi(),m=n.context!==void 0&&(Z(n.context)||typeof n.context=="number")&&n.context!=="",p=n.lngs?n.lngs:this.languageUtils.toResolveHierarchy(n.lng||this.language,n.fallbackLng);f.forEach(g=>{this.isValidLookup(s)||(o=g,!Po[`${p[0]}-${g}`]&&this.utils&&this.utils.hasLoadedNamespace&&!this.utils.hasLoadedNamespace(o)&&(Po[`${p[0]}-${g}`]=!0,this.logger.warn(`key "${i}" for languages "${p.join(", ")}" won't get resolved as namespace "${o}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),p.forEach(y=>{if(this.isValidLookup(s))return;a=y;const C=[d];if(this.i18nFormat&&this.i18nFormat.addLookupKeys)this.i18nFormat.addLookupKeys(C,d,y,g,n);else{let T;c&&(T=this.pluralResolver.getSuffix(y,n.count,n));const w=`${this.options.pluralSeparator}zero`,k=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(c&&(C.push(d+T),n.ordinal&&T.indexOf(k)===0&&C.push(d+T.replace(k,this.options.pluralSeparator)),h&&C.push(d+w)),m){const _=`${d}${this.options.contextSeparator}${n.context}`;C.push(_),c&&(C.push(_+T),n.ordinal&&T.indexOf(k)===0&&C.push(_+T.replace(k,this.options.pluralSeparator)),h&&C.push(_+w))}}let S;for(;S=C.pop();)this.isValidLookup(s)||(r=S,s=this.getResource(y,g,S,n))}))})}),{res:s,usedKey:i,exactUsedKey:r,usedLng:a,usedNS:o}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,n,s){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,n,s,i):this.resourceStore.getResource(e,n,s,i)}getUsedParamsDetails(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],s=e.replace&&!Z(e.replace);let i=s?e.replace:e;if(s&&typeof e.count<"u"&&(i.count=e.count),this.options.interpolation.defaultVariables&&(i={...this.options.interpolation.defaultVariables,...i}),!s){i={...i};for(const r of n)delete i[r]}return i}static hasDefaultValue(e){const n="defaultValue";for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&n===s.substring(0,n.length)&&e[s]!==void 0)return!0;return!1}}const ir=t=>t.charAt(0).toUpperCase()+t.slice(1);class Oo{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=wt.create("languageUtils")}getScriptPartFromCode(e){if(e=ii(e),!e||e.indexOf("-")<0)return null;const n=e.split("-");return n.length===2||(n.pop(),n[n.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(n.join("-"))}getLanguagePartFromCode(e){if(e=ii(e),!e||e.indexOf("-")<0)return e;const n=e.split("-");return this.formatLanguageCode(n[0])}formatLanguageCode(e){if(Z(e)&&e.indexOf("-")>-1){if(typeof Intl<"u"&&typeof Intl.getCanonicalLocales<"u")try{let i=Intl.getCanonicalLocales(e)[0];if(i&&this.options.lowerCaseLng&&(i=i.toLowerCase()),i)return i}catch{}const n=["hans","hant","latn","cyrl","cans","mong","arab"];let s=e.split("-");return this.options.lowerCaseLng?s=s.map(i=>i.toLowerCase()):s.length===2?(s[0]=s[0].toLowerCase(),s[1]=s[1].toUpperCase(),n.indexOf(s[1].toLowerCase())>-1&&(s[1]=ir(s[1].toLowerCase()))):s.length===3&&(s[0]=s[0].toLowerCase(),s[1].length===2&&(s[1]=s[1].toUpperCase()),s[0]!=="sgn"&&s[2].length===2&&(s[2]=s[2].toUpperCase()),n.indexOf(s[1].toLowerCase())>-1&&(s[1]=ir(s[1].toLowerCase())),n.indexOf(s[2].toLowerCase())>-1&&(s[2]=ir(s[2].toLowerCase()))),s.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let n;return e.forEach(s=>{if(n)return;const i=this.formatLanguageCode(s);(!this.options.supportedLngs||this.isSupportedCode(i))&&(n=i)}),!n&&this.options.supportedLngs&&e.forEach(s=>{if(n)return;const i=this.getLanguagePartFromCode(s);if(this.isSupportedCode(i))return n=i;n=this.options.supportedLngs.find(r=>{if(r===i)return r;if(!(r.indexOf("-")<0&&i.indexOf("-")<0)&&(r.indexOf("-")>0&&i.indexOf("-")<0&&r.substring(0,r.indexOf("-"))===i||r.indexOf(i)===0&&i.length>1))return r})}),n||(n=this.getFallbackCodes(this.options.fallbackLng)[0]),n}getFallbackCodes(e,n){if(!e)return[];if(typeof e=="function"&&(e=e(n)),Z(e)&&(e=[e]),Array.isArray(e))return e;if(!n)return e.default||[];let s=e[n];return s||(s=e[this.getScriptPartFromCode(n)]),s||(s=e[this.formatLanguageCode(n)]),s||(s=e[this.getLanguagePartFromCode(n)]),s||(s=e.default),s||[]}toResolveHierarchy(e,n){const s=this.getFallbackCodes(n||this.options.fallbackLng||[],e),i=[],r=a=>{a&&(this.isSupportedCode(a)?i.push(a):this.logger.warn(`rejecting language code not found in supportedLngs: ${a}`))};return Z(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&r(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&r(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&r(this.getLanguagePartFromCode(e))):Z(e)&&r(this.formatLanguageCode(e)),s.forEach(a=>{i.indexOf(a)<0&&r(this.formatLanguageCode(a))}),i}}let fv=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],pv={1:t=>+(t>1),2:t=>+(t!=1),3:t=>0,4:t=>t%10==1&&t%100!=11?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2,5:t=>t==0?0:t==1?1:t==2?2:t%100>=3&&t%100<=10?3:t%100>=11?4:5,6:t=>t==1?0:t>=2&&t<=4?1:2,7:t=>t==1?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2,8:t=>t==1?0:t==2?1:t!=8&&t!=11?2:3,9:t=>+(t>=2),10:t=>t==1?0:t==2?1:t<7?2:t<11?3:4,11:t=>t==1||t==11?0:t==2||t==12?1:t>2&&t<20?2:3,12:t=>+(t%10!=1||t%100==11),13:t=>+(t!==0),14:t=>t==1?0:t==2?1:t==3?2:3,15:t=>t%10==1&&t%100!=11?0:t%10>=2&&(t%100<10||t%100>=20)?1:2,16:t=>t%10==1&&t%100!=11?0:t!==0?1:2,17:t=>t==1||t%10==1&&t%100!=11?0:1,18:t=>t==0?0:t==1?1:2,19:t=>t==1?0:t==0||t%100>1&&t%100<11?1:t%100>10&&t%100<20?2:3,20:t=>t==1?0:t==0||t%100>0&&t%100<20?1:2,21:t=>t%100==1?1:t%100==2?2:t%100==3||t%100==4?3:0,22:t=>t==1?0:t==2?1:(t<0||t>10)&&t%10==0?2:3};const mv=["v1","v2","v3"],gv=["v4"],No={zero:0,one:1,two:2,few:3,many:4,other:5},bv=()=>{const t={};return fv.forEach(e=>{e.lngs.forEach(n=>{t[n]={numbers:e.nr,plurals:pv[e.fc]}})}),t};class vv{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.languageUtils=e,this.options=n,this.logger=wt.create("pluralResolver"),(!this.options.compatibilityJSON||gv.includes(this.options.compatibilityJSON))&&(typeof Intl>"u"||!Intl.PluralRules)&&(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=bv(),this.pluralRulesCache={}}addRule(e,n){this.rules[e]=n}clearCache(){this.pluralRulesCache={}}getRule(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.shouldUseIntlApi()){const s=ii(e==="dev"?"en":e),i=n.ordinal?"ordinal":"cardinal",r=JSON.stringify({cleanedCode:s,type:i});if(r in this.pluralRulesCache)return this.pluralRulesCache[r];let a;try{a=new Intl.PluralRules(s,{type:i})}catch{if(!e.match(/-|_/))return;const l=this.languageUtils.getLanguagePartFromCode(e);a=this.getRule(l,n)}return this.pluralRulesCache[r]=a,a}return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}needsPlural(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=this.getRule(e,n);return this.shouldUseIntlApi()?s&&s.resolvedOptions().pluralCategories.length>1:s&&s.numbers.length>1}getPluralFormsOfKey(e,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.getSuffixes(e,s).map(i=>`${n}${i}`)}getSuffixes(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=this.getRule(e,n);return s?this.shouldUseIntlApi()?s.resolvedOptions().pluralCategories.sort((i,r)=>No[i]-No[r]).map(i=>`${this.options.prepend}${n.ordinal?`ordinal${this.options.prepend}`:""}${i}`):s.numbers.map(i=>this.getSuffix(e,i,n)):[]}getSuffix(e,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=this.getRule(e,s);return i?this.shouldUseIntlApi()?`${this.options.prepend}${s.ordinal?`ordinal${this.options.prepend}`:""}${i.select(n)}`:this.getSuffixRetroCompatible(i,n):(this.logger.warn(`no plural rule found for: ${e}`),"")}getSuffixRetroCompatible(e,n){const s=e.noAbs?e.plurals(n):e.plurals(Math.abs(n));let i=e.numbers[s];this.options.simplifyPluralSuffix&&e.numbers.length===2&&e.numbers[0]===1&&(i===2?i="plural":i===1&&(i=""));const r=()=>this.options.prepend&&i.toString()?this.options.prepend+i.toString():i.toString();return this.options.compatibilityJSON==="v1"?i===1?"":typeof i=="number"?`_plural_${i.toString()}`:r():this.options.compatibilityJSON==="v2"||this.options.simplifyPluralSuffix&&e.numbers.length===2&&e.numbers[0]===1?r():this.options.prepend&&s.toString()?this.options.prepend+s.toString():s.toString()}shouldUseIntlApi(){return!mv.includes(this.options.compatibilityJSON)}}const Ao=function(t,e,n){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:".",i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,r=rv(t,e,n);return!r&&i&&Z(n)&&(r=Lr(t,n,s),r===void 0&&(r=Lr(e,n,s))),r},rr=t=>t.replace(/\$/g,"$$$$");class yv{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=wt.create("interpolator"),this.options=e,this.format=e.interpolation&&e.interpolation.format||(n=>n),this.init(e)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:n,escapeValue:s,useRawValueToEscape:i,prefix:r,prefixEscaped:a,suffix:o,suffixEscaped:l,formatSeparator:u,unescapeSuffix:d,unescapePrefix:f,nestingPrefix:c,nestingPrefixEscaped:h,nestingSuffix:m,nestingSuffixEscaped:p,nestingOptionsSeparator:g,maxReplaces:y,alwaysFormat:C}=e.interpolation;this.escape=n!==void 0?n:ov,this.escapeValue=s!==void 0?s:!0,this.useRawValueToEscape=i!==void 0?i:!1,this.prefix=r?hn(r):a||"{{",this.suffix=o?hn(o):l||"}}",this.formatSeparator=u||",",this.unescapePrefix=d?"":f||"-",this.unescapeSuffix=this.unescapePrefix?"":d||"",this.nestingPrefix=c?hn(c):h||hn("$t("),this.nestingSuffix=m?hn(m):p||hn(")"),this.nestingOptionsSeparator=g||",",this.maxReplaces=y||1e3,this.alwaysFormat=C!==void 0?C:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(n,s)=>n&&n.source===s?(n.lastIndex=0,n):new RegExp(s,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,n,s,i){let r,a,o;const l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},u=h=>{if(h.indexOf(this.formatSeparator)<0){const y=Ao(n,l,h,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(y,void 0,s,{...i,...n,interpolationkey:h}):y}const m=h.split(this.formatSeparator),p=m.shift().trim(),g=m.join(this.formatSeparator).trim();return this.format(Ao(n,l,p,this.options.keySeparator,this.options.ignoreJSONStructure),g,s,{...i,...n,interpolationkey:p})};this.resetRegExp();const d=i&&i.missingInterpolationHandler||this.options.missingInterpolationHandler,f=i&&i.interpolation&&i.interpolation.skipOnVariables!==void 0?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:h=>rr(h)},{regex:this.regexp,safeValue:h=>this.escapeValue?rr(this.escape(h)):rr(h)}].forEach(h=>{for(o=0;r=h.regex.exec(e);){const m=r[1].trim();if(a=u(m),a===void 0)if(typeof d=="function"){const g=d(e,r,i);a=Z(g)?g:""}else if(i&&Object.prototype.hasOwnProperty.call(i,m))a="";else if(f){a=r[0];continue}else this.logger.warn(`missed to pass in variable ${m} for interpolating ${e}`),a="";else!Z(a)&&!this.useRawValueToEscape&&(a=Ro(a));const p=h.safeValue(a);if(e=e.replace(r[0],p),f?(h.regex.lastIndex+=a.length,h.regex.lastIndex-=r[0].length):h.regex.lastIndex=0,o++,o>=this.maxReplaces)break}}),e}nest(e,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i,r,a;const o=(l,u)=>{const d=this.nestingOptionsSeparator;if(l.indexOf(d)<0)return l;const f=l.split(new RegExp(`${d}[ ]*{`));let c=`{${f[1]}`;l=f[0],c=this.interpolate(c,a);const h=c.match(/'/g),m=c.match(/"/g);(h&&h.length%2===0&&!m||m.length%2!==0)&&(c=c.replace(/'/g,'"'));try{a=JSON.parse(c),u&&(a={...u,...a})}catch(p){return this.logger.warn(`failed parsing options string in nesting for key ${l}`,p),`${l}${d}${c}`}return a.defaultValue&&a.defaultValue.indexOf(this.prefix)>-1&&delete a.defaultValue,l};for(;i=this.nestingRegexp.exec(e);){let l=[];a={...s},a=a.replace&&!Z(a.replace)?a.replace:a,a.applyPostProcessor=!1,delete a.defaultValue;let u=!1;if(i[0].indexOf(this.formatSeparator)!==-1&&!/{.*}/.test(i[1])){const d=i[1].split(this.formatSeparator).map(f=>f.trim());i[1]=d.shift(),l=d,u=!0}if(r=n(o.call(this,i[1].trim(),a),a),r&&i[0]===e&&!Z(r))return r;Z(r)||(r=Ro(r)),r||(this.logger.warn(`missed to resolve ${i[1]} for nesting ${e}`),r=""),u&&(r=l.reduce((d,f)=>this.format(d,f,s.lng,{...s,interpolationkey:i[1].trim()}),r.trim())),e=e.replace(i[0],r),this.regexp.lastIndex=0}return e}}const Sv=t=>{let e=t.toLowerCase().trim();const n={};if(t.indexOf("(")>-1){const s=t.split("(");e=s[0].toLowerCase().trim();const i=s[1].substring(0,s[1].length-1);e==="currency"&&i.indexOf(":")<0?n.currency||(n.currency=i.trim()):e==="relativetime"&&i.indexOf(":")<0?n.range||(n.range=i.trim()):i.split(";").forEach(a=>{if(a){const[o,...l]=a.split(":"),u=l.join(":").trim().replace(/^'+|'+$/g,""),d=o.trim();n[d]||(n[d]=u),u==="false"&&(n[d]=!1),u==="true"&&(n[d]=!0),isNaN(u)||(n[d]=parseInt(u,10))}})}return{formatName:e,formatOptions:n}},fn=t=>{const e={};return(n,s,i)=>{let r=i;i&&i.interpolationkey&&i.formatParams&&i.formatParams[i.interpolationkey]&&i[i.interpolationkey]&&(r={...r,[i.interpolationkey]:void 0});const a=s+JSON.stringify(r);let o=e[a];return o||(o=t(ii(s),i),e[a]=o),o(n)}};class Cv{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=wt.create("formatter"),this.options=e,this.formats={number:fn((n,s)=>{const i=new Intl.NumberFormat(n,{...s});return r=>i.format(r)}),currency:fn((n,s)=>{const i=new Intl.NumberFormat(n,{...s,style:"currency"});return r=>i.format(r)}),datetime:fn((n,s)=>{const i=new Intl.DateTimeFormat(n,{...s});return r=>i.format(r)}),relativetime:fn((n,s)=>{const i=new Intl.RelativeTimeFormat(n,{...s});return r=>i.format(r,s.range||"day")}),list:fn((n,s)=>{const i=new Intl.ListFormat(n,{...s});return r=>i.format(r)})},this.init(e)}init(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};this.formatSeparator=n.interpolation.formatSeparator||","}add(e,n){this.formats[e.toLowerCase().trim()]=n}addCached(e,n){this.formats[e.toLowerCase().trim()]=fn(n)}format(e,n,s){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const r=n.split(this.formatSeparator);if(r.length>1&&r[0].indexOf("(")>1&&r[0].indexOf(")")<0&&r.find(o=>o.indexOf(")")>-1)){const o=r.findIndex(l=>l.indexOf(")")>-1);r[0]=[r[0],...r.splice(1,o)].join(this.formatSeparator)}return r.reduce((o,l)=>{const{formatName:u,formatOptions:d}=Sv(l);if(this.formats[u]){let f=o;try{const c=i&&i.formatParams&&i.formatParams[i.interpolationkey]||{},h=c.locale||c.lng||i.locale||i.lng||s;f=this.formats[u](o,h,{...d,...i,...c})}catch(c){this.logger.warn(c)}return f}else this.logger.warn(`there was no format function for ${u}`);return o},e)}}const Tv=(t,e)=>{t.pending[e]!==void 0&&(delete t.pending[e],t.pendingCount--)};class wv extends Ni{constructor(e,n,s){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};super(),this.backend=e,this.store=n,this.services=s,this.languageUtils=s.languageUtils,this.options=i,this.logger=wt.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=i.maxParallelReads||10,this.readingCalls=0,this.maxRetries=i.maxRetries>=0?i.maxRetries:5,this.retryTimeout=i.retryTimeout>=1?i.retryTimeout:350,this.state={},this.queue=[],this.backend&&this.backend.init&&this.backend.init(s,i.backend,i)}queueLoad(e,n,s,i){const r={},a={},o={},l={};return e.forEach(u=>{let d=!0;n.forEach(f=>{const c=`${u}|${f}`;!s.reload&&this.store.hasResourceBundle(u,f)?this.state[c]=2:this.state[c]<0||(this.state[c]===1?a[c]===void 0&&(a[c]=!0):(this.state[c]=1,d=!1,a[c]===void 0&&(a[c]=!0),r[c]===void 0&&(r[c]=!0),l[f]===void 0&&(l[f]=!0)))}),d||(o[u]=!0)}),(Object.keys(r).length||Object.keys(a).length)&&this.queue.push({pending:a,pendingCount:Object.keys(a).length,loaded:{},errors:[],callback:i}),{toLoad:Object.keys(r),pending:Object.keys(a),toLoadLanguages:Object.keys(o),toLoadNamespaces:Object.keys(l)}}loaded(e,n,s){const i=e.split("|"),r=i[0],a=i[1];n&&this.emit("failedLoading",r,a,n),!n&&s&&this.store.addResourceBundle(r,a,s,void 0,void 0,{skipCopy:!0}),this.state[e]=n?-1:2,n&&s&&(this.state[e]=0);const o={};this.queue.forEach(l=>{iv(l.loaded,[r],a),Tv(l,e),n&&l.errors.push(n),l.pendingCount===0&&!l.done&&(Object.keys(l.loaded).forEach(u=>{o[u]||(o[u]={});const d=l.loaded[u];d.length&&d.forEach(f=>{o[u][f]===void 0&&(o[u][f]=!0)})}),l.done=!0,l.errors.length?l.callback(l.errors):l.callback())}),this.emit("loaded",o),this.queue=this.queue.filter(l=>!l.done)}read(e,n,s){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.retryTimeout,a=arguments.length>5?arguments[5]:void 0;if(!e.length)return a(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:n,fcName:s,tried:i,wait:r,callback:a});return}this.readingCalls++;const o=(u,d)=>{if(this.readingCalls--,this.waitingReads.length>0){const f=this.waitingReads.shift();this.read(f.lng,f.ns,f.fcName,f.tried,f.wait,f.callback)}if(u&&d&&i<this.maxRetries){setTimeout(()=>{this.read.call(this,e,n,s,i+1,r*2,a)},r);return}a(u,d)},l=this.backend[s].bind(this.backend);if(l.length===2){try{const u=l(e,n);u&&typeof u.then=="function"?u.then(d=>o(null,d)).catch(o):o(null,u)}catch(u){o(u)}return}return l(e,n,o)}prepareLoading(e,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),i&&i();Z(e)&&(e=this.languageUtils.toResolveHierarchy(e)),Z(n)&&(n=[n]);const r=this.queueLoad(e,n,s,i);if(!r.toLoad.length)return r.pending.length||i(),null;r.toLoad.forEach(a=>{this.loadOne(a)})}load(e,n,s){this.prepareLoading(e,n,{},s)}reload(e,n,s){this.prepareLoading(e,n,{reload:!0},s)}loadOne(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const s=e.split("|"),i=s[0],r=s[1];this.read(i,r,"read",void 0,void 0,(a,o)=>{a&&this.logger.warn(`${n}loading namespace ${r} for language ${i} failed`,a),!a&&o&&this.logger.log(`${n}loaded namespace ${r} for language ${i}`,o),this.loaded(e,a,o)})}saveMissing(e,n,s,i,r){let a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:()=>{};if(this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(n)){this.logger.warn(`did not save key "${s}" as the namespace "${n}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(s==null||s==="")){if(this.backend&&this.backend.create){const l={...a,isUpdate:r},u=this.backend.create.bind(this.backend);if(u.length<6)try{let d;u.length===5?d=u(e,n,s,i,l):d=u(e,n,s,i),d&&typeof d.then=="function"?d.then(f=>o(null,f)).catch(o):o(null,d)}catch(d){o(d)}else u(e,n,s,i,o,l)}!e||!e[0]||this.store.addResource(e[0],n,s,i)}}}const Do=()=>({debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:t=>{let e={};if(typeof t[1]=="object"&&(e=t[1]),Z(t[1])&&(e.defaultValue=t[1]),Z(t[2])&&(e.tDescription=t[2]),typeof t[2]=="object"||typeof t[3]=="object"){const n=t[3]||t[2];Object.keys(n).forEach(s=>{e[s]=n[s]})}return e},interpolation:{escapeValue:!0,format:t=>t,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),Lo=t=>(Z(t.ns)&&(t.ns=[t.ns]),Z(t.fallbackLng)&&(t.fallbackLng=[t.fallbackLng]),Z(t.fallbackNS)&&(t.fallbackNS=[t.fallbackNS]),t.supportedLngs&&t.supportedLngs.indexOf("cimode")<0&&(t.supportedLngs=t.supportedLngs.concat(["cimode"])),t),Ss=()=>{},kv=t=>{Object.getOwnPropertyNames(Object.getPrototypeOf(t)).forEach(n=>{typeof t[n]=="function"&&(t[n]=t[n].bind(t))})};class Qn extends Ni{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;if(super(),this.options=Lo(e),this.services={},this.logger=wt,this.modules={external:[]},kv(this),n&&!this.isInitialized&&!e.isClone){if(!this.options.initImmediate)return this.init(e,n),this;setTimeout(()=>{this.init(e,n)},0)}}init(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,typeof n=="function"&&(s=n,n={}),!n.defaultNS&&n.defaultNS!==!1&&n.ns&&(Z(n.ns)?n.defaultNS=n.ns:n.ns.indexOf("translation")<0&&(n.defaultNS=n.ns[0]));const i=Do();this.options={...i,...this.options,...Lo(n)},this.options.compatibilityAPI!=="v1"&&(this.options.interpolation={...i.interpolation,...this.options.interpolation}),n.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=n.keySeparator),n.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=n.nsSeparator);const r=d=>d?typeof d=="function"?new d:d:null;if(!this.options.isClone){this.modules.logger?wt.init(r(this.modules.logger),this.options):wt.init(null,this.options);let d;this.modules.formatter?d=this.modules.formatter:typeof Intl<"u"&&(d=Cv);const f=new Oo(this.options);this.store=new xo(this.options.resources,this.options);const c=this.services;c.logger=wt,c.resourceStore=this.store,c.languageUtils=f,c.pluralResolver=new vv(f,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),d&&(!this.options.interpolation.format||this.options.interpolation.format===i.interpolation.format)&&(c.formatter=r(d),c.formatter.init(c,this.options),this.options.interpolation.format=c.formatter.format.bind(c.formatter)),c.interpolator=new yv(this.options),c.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},c.backendConnector=new wv(r(this.modules.backend),c.resourceStore,c,this.options),c.backendConnector.on("*",function(h){for(var m=arguments.length,p=new Array(m>1?m-1:0),g=1;g<m;g++)p[g-1]=arguments[g];e.emit(h,...p)}),this.modules.languageDetector&&(c.languageDetector=r(this.modules.languageDetector),c.languageDetector.init&&c.languageDetector.init(c,this.options.detection,this.options)),this.modules.i18nFormat&&(c.i18nFormat=r(this.modules.i18nFormat),c.i18nFormat.init&&c.i18nFormat.init(this)),this.translator=new ai(this.services,this.options),this.translator.on("*",function(h){for(var m=arguments.length,p=new Array(m>1?m-1:0),g=1;g<m;g++)p[g-1]=arguments[g];e.emit(h,...p)}),this.modules.external.forEach(h=>{h.init&&h.init(this)})}if(this.format=this.options.interpolation.format,s||(s=Ss),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const d=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);d.length>0&&d[0]!=="dev"&&(this.options.lng=d[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(d=>{this[d]=function(){return e.store[d](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(d=>{this[d]=function(){return e.store[d](...arguments),e}});const l=Dn(),u=()=>{const d=(f,c)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),l.resolve(c),s(f,c)};if(this.languages&&this.options.compatibilityAPI!=="v1"&&!this.isInitialized)return d(null,this.t.bind(this));this.changeLanguage(this.options.lng,d)};return this.options.resources||!this.options.initImmediate?u():setTimeout(u,0),l}loadResources(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ss;const i=Z(e)?e:this.language;if(typeof e=="function"&&(s=e),!this.options.resources||this.options.partialBundledLanguages){if(i&&i.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return s();const r=[],a=o=>{if(!o||o==="cimode")return;this.services.languageUtils.toResolveHierarchy(o).forEach(u=>{u!=="cimode"&&r.indexOf(u)<0&&r.push(u)})};i?a(i):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(l=>a(l)),this.options.preload&&this.options.preload.forEach(o=>a(o)),this.services.backendConnector.load(r,this.options.ns,o=>{!o&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),s(o)})}else s(null)}reloadResources(e,n,s){const i=Dn();return typeof e=="function"&&(s=e,e=void 0),typeof n=="function"&&(s=n,n=void 0),e||(e=this.languages),n||(n=this.options.ns),s||(s=Ss),this.services.backendConnector.reload(e,n,r=>{i.resolve(),s(r)}),i}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&nu.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1))for(let n=0;n<this.languages.length;n++){const s=this.languages[n];if(!(["cimode","dev"].indexOf(s)>-1)&&this.store.hasLanguageSomeTranslations(s)){this.resolvedLanguage=s;break}}}changeLanguage(e,n){var s=this;this.isLanguageChangingTo=e;const i=Dn();this.emit("languageChanging",e);const r=l=>{this.language=l,this.languages=this.services.languageUtils.toResolveHierarchy(l),this.resolvedLanguage=void 0,this.setResolvedLanguage(l)},a=(l,u)=>{u?(r(u),this.translator.changeLanguage(u),this.isLanguageChangingTo=void 0,this.emit("languageChanged",u),this.logger.log("languageChanged",u)):this.isLanguageChangingTo=void 0,i.resolve(function(){return s.t(...arguments)}),n&&n(l,function(){return s.t(...arguments)})},o=l=>{!e&&!l&&this.services.languageDetector&&(l=[]);const u=Z(l)?l:this.services.languageUtils.getBestMatchFromCodes(l);u&&(this.language||r(u),this.translator.language||this.translator.changeLanguage(u),this.services.languageDetector&&this.services.languageDetector.cacheUserLanguage&&this.services.languageDetector.cacheUserLanguage(u)),this.loadResources(u,d=>{a(d,u)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?o(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(o):this.services.languageDetector.detect(o):o(e),i}getFixedT(e,n,s){var i=this;const r=function(a,o){let l;if(typeof o!="object"){for(var u=arguments.length,d=new Array(u>2?u-2:0),f=2;f<u;f++)d[f-2]=arguments[f];l=i.options.overloadTranslationOptionHandler([a,o].concat(d))}else l={...o};l.lng=l.lng||r.lng,l.lngs=l.lngs||r.lngs,l.ns=l.ns||r.ns,l.keyPrefix!==""&&(l.keyPrefix=l.keyPrefix||s||r.keyPrefix);const c=i.options.keySeparator||".";let h;return l.keyPrefix&&Array.isArray(a)?h=a.map(m=>`${l.keyPrefix}${c}${m}`):h=l.keyPrefix?`${l.keyPrefix}${c}${a}`:a,i.t(h,l)};return Z(e)?r.lng=e:r.lngs=e,r.ns=n,r.keyPrefix=s,r}t(){return this.translator&&this.translator.translate(...arguments)}exists(){return this.translator&&this.translator.exists(...arguments)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const s=n.lng||this.resolvedLanguage||this.languages[0],i=this.options?this.options.fallbackLng:!1,r=this.languages[this.languages.length-1];if(s.toLowerCase()==="cimode")return!0;const a=(o,l)=>{const u=this.services.backendConnector.state[`${o}|${l}`];return u===-1||u===0||u===2};if(n.precheck){const o=n.precheck(this,a);if(o!==void 0)return o}return!!(this.hasResourceBundle(s,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||a(s,e)&&(!i||a(r,e)))}loadNamespaces(e,n){const s=Dn();return this.options.ns?(Z(e)&&(e=[e]),e.forEach(i=>{this.options.ns.indexOf(i)<0&&this.options.ns.push(i)}),this.loadResources(i=>{s.resolve(),n&&n(i)}),s):(n&&n(),Promise.resolve())}loadLanguages(e,n){const s=Dn();Z(e)&&(e=[e]);const i=this.options.preload||[],r=e.filter(a=>i.indexOf(a)<0&&this.services.languageUtils.isSupportedCode(a));return r.length?(this.options.preload=i.concat(r),this.loadResources(a=>{s.resolve(),n&&n(a)}),s):(n&&n(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),!e)return"rtl";const n=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],s=this.services&&this.services.languageUtils||new Oo(Do());return n.indexOf(s.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;return new Qn(e,n)}cloneInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ss;const s=e.forkResourceStore;s&&delete e.forkResourceStore;const i={...this.options,...e,isClone:!0},r=new Qn(i);return(e.debug!==void 0||e.prefix!==void 0)&&(r.logger=r.logger.clone(e)),["store","services","language"].forEach(o=>{r[o]=this[o]}),r.services={...this.services},r.services.utils={hasLoadedNamespace:r.hasLoadedNamespace.bind(r)},s&&(r.store=new xo(this.store.data,i),r.services.resourceStore=r.store),r.translator=new ai(r.services,i),r.translator.on("*",function(o){for(var l=arguments.length,u=new Array(l>1?l-1:0),d=1;d<l;d++)u[d-1]=arguments[d];r.emit(o,...u)}),r.init(i,n),r.translator.options=i,r.translator.backendConnector.services.utils={hasLoadedNamespace:r.hasLoadedNamespace.bind(r)},r}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const qe=Qn.createInstance();qe.createInstance=Qn.createInstance;qe.createInstance;qe.dir;qe.init;qe.loadResources;qe.reloadResources;qe.use;qe.changeLanguage;qe.getFixedT;qe.t;qe.exists;qe.setDefaultNamespace;qe.hasLoadedNamespace;qe.loadNamespaces;qe.loadLanguages;const su=v.createContext(void 0),Rv=t=>{const{call:e,children:n}=t;return b.jsx(su.Provider,{value:e,children:n})},Ae=()=>v.useContext(su),jr="stream-video",ar={debug:!1,currentLanguage:"en",fallbackLanguage:!1},Ev=(t,e)=>Object.entries(t).reduce((n,[s,i])=>(n[s]={[e]:i},n),{}),Iv=Ev({},jr),ga=t=>t;class _v{constructor(e={}){this.t=ga,this.init=async()=>{try{this.t=await this.i18nInstance.init()}catch(a){console.error(`Failed to initialize translations: ${JSON.stringify(a)}`)}return this},this.changeLanguage=async(a,o)=>{if(!this._checkIsInitialized())return;const l=typeof window<"u"&&window.navigator?window.navigator.language:void 0;await this.i18nInstance.changeLanguage(a||l),o==null||o(this.currentLanguage)},this.registerTranslationsForLanguage=({lng:a,translations:o})=>{this._checkIsInitialized()&&this.i18nInstance.addResourceBundle(a,jr,o,!0,!0)},this._checkIsInitialized=()=>(this.i18nInstance.isInitialized||console.warn("I18n instance is not initialized. Call yourStreamI18nInstance.init()."),this.i18nInstance.isInitialized);const{debug:n=ar.debug,currentLanguage:s=ar.currentLanguage,fallbackLanguage:i=ar.fallbackLanguage,translationsOverrides:r}=e;this.i18nInstance=qe.createInstance({debug:n,defaultNS:jr,fallbackLng:i,interpolation:{escapeValue:!1},keySeparator:!1,lng:s,nsSeparator:!1,parseMissingKeyHandler:a=>a,resources:Iv}),r&&this.i18nInstance.on("initialized",()=>{Object.entries(r).forEach(([a,o])=>{this.registerTranslationsForLanguage({lng:a,translations:o})})})}get currentLanguage(){return this._checkIsInitialized(),this.i18nInstance.language}get isInitialized(){return this.i18nInstance.isInitialized}}const iu=v.createContext({t:ga}),xv=({children:t,...e})=>{const{i18n:n,t:s}=Pv(e);return b.jsx(iu.Provider,{value:{t:s,i18n:n},children:t})},Pv=({i18nInstance:t,language:e,fallbackLanguage:n,translationsOverrides:s})=>{const[i]=v.useState(()=>t||new _v({currentLanguage:e,fallbackLanguage:n,translationsOverrides:s})),[r,a]=v.useState(()=>ga);return v.useEffect(()=>{const{isInitialized:o}=i;if(!o){i.init().then(l=>a(()=>l.i18nInstance.t));return}e&&(i==null?void 0:i.currentLanguage)!==e&&i.changeLanguage(e).catch(l=>{console.log("Error while changing language",l)})},[i,t,e,s]),{i18n:i,t:r}},Ue=()=>v.useContext(iu),Ov=v.createContext(void 0),Nv=({children:t,client:e,i18nInstance:n,language:s,translationsOverrides:i})=>b.jsx(Ov.Provider,{value:e,children:b.jsx(xv,{i18nInstance:n,language:s,translationsOverrides:i,children:t})}),Av=()=>{var t;return typeof navigator>"u"?!1:((t=navigator.product)==null?void 0:t.toLowerCase())==="reactnative"},W=(t,e)=>{const[n,s]=v.useState(()=>{try{return mo.getCurrentValue(t)}catch(i){if(typeof e>"u")throw i;return e}});return v.useEffect(()=>mo.createSubscription(t,s,i=>{console.log("An error occurred while reading an observable",i),e&&s(e)}),[e,t]),n},jo=Object.freeze([]),ce=()=>{const t=Ae();return t?t.state:(console.warn('You are using useCallState() outside a Call context. Please wrap your component in <StreamCall /> and provide a "call" instance.'),new Fl)},ru=()=>{const{recording$:t}=ce();return W(t)},Dv=()=>{const{egress$:t}=ce(),e=W(t);return e?e.broadcasting:!1},Lv=()=>{const{backstage$:t}=ce();return!W(t)},jv=()=>{const{blockedUserIds$:t}=ce();return W(t)},Mv=()=>{const{createdAt$:t}=ce();return W(t)},Fv=()=>{const{endedAt$:t}=ce();return W(t)},Uv=()=>{const{startsAt$:t}=ce();return W(t)},$v=()=>{const{updatedAt$:t}=ce();return W(t)},Vv=()=>{const{createdBy$:t}=ce();return W(t)},Bv=()=>{const{custom$:t}=ce();return W(t)},Hv=()=>{const{egress$:t}=ce();return W(t)},qv=()=>{const{ingress$:t}=ce();return W(t)},Wv=()=>{const{session$:t}=ce();return W(t)},Gv=()=>{const{settings$:t}=ce();return W(t)},Kv=()=>{const{transcribing$:t}=ce();return W(t)},Jv=()=>{const{endedBy$:t}=ce();return W(t)},zv=()=>{const{hasOngoingScreenShare$:t}=ce();return W(t)},Yv=()=>{const{callStatsReport$:t}=ce();return W(t)},Xv=()=>{const{dominantSpeaker$:t}=ce();return W(t)},Zv=()=>{const{members$:t}=ce();return W(t)},Qv=()=>{const{callingState$:t}=ce();return W(t)},ey=()=>{const{startedAt$:t}=ce();return W(t)},ty=({sortBy:t}={})=>{const{participants$:e}=ce(),n=W(e);return v.useMemo(()=>t?[...n].sort(t):n,[n,t])},ny=()=>{const{localParticipant$:t}=ce();return W(t)},sy=()=>{const{remoteParticipants$:t}=ce();return W(t)},iy=()=>{const{participantCount$:t}=ce();return W(t)},ry=()=>{const{anonymousParticipantCount$:t}=ce();return W(t)},ay=()=>{const{thumbnails$:t}=ce();return W(t)},au=()=>{const{ownCapabilities$:t}=ce();return W(t)},oy=(...t)=>{const e=au();return t.every(n=>e==null?void 0:e.includes(n))},cy=()=>{const t=Ae(),{camera:e}=t,{state:n}=e,s=W(n.direction$),i=W(n.mediaStream$),r=W(n.selectedDevice$),{getDevices:a}=va(e),o=W(n.hasBrowserPermission$),l=W(n.isPromptingPermission$);return{camera:e,direction:s,mediaStream:i,get devices(){return a()},hasBrowserPermission:o,isPromptingPermission:l,selectedDevice:r,...ba(W(n.status$),W(n.optimisticStatus$))}},ly=()=>{const t=Ae(),{microphone:e}=t,{state:n}=e,s=W(n.mediaStream$),i=W(n.selectedDevice$),{getDevices:r}=va(e),a=W(n.hasBrowserPermission$),o=W(n.isPromptingPermission$),l=W(n.speakingWhileMuted$);return{microphone:e,mediaStream:s,get devices(){return r()},selectedDevice:i,hasBrowserPermission:a,isPromptingPermission:o,isSpeakingWhileMuted:l,...ba(W(n.status$),W(n.optimisticStatus$))}},uy=()=>{if(Av())throw new Error("This feature is not supported in React Native. Please visit https://getstream.io/video/docs/reactnative/core/camera-and-microphone/#speaker-management for more details");const t=Ae(),{speaker:e}=t,{getDevices:n}=va(e),s=W(e.state.selectedDevice$);return{speaker:e,get devices(){return n()},selectedDevice:s,isDeviceSelectionSupported:e.state.isDeviceSelectionSupported}},dy=()=>{const t=Ae(),{screenShare:e}=t;return{screenShare:e,mediaStream:W(e.state.mediaStream$),...ba(W(e.state.status$),W(e.state.optimisticStatus$))}},hy=()=>{const t=Ae();return W(t.dynascaleManager.incomingVideoSettings$)},fy=()=>{const{closedCaptions$:t}=ce();return W(t)},py=()=>{const{captioning$:t}=ce();return W(t)};function ba(t,e){const n=e??t;return{status:t,optimisticStatus:n,isEnabled:t==="enabled",isMute:t!=="enabled",optimisticIsMute:n!=="enabled",isTogglePending:n!==t}}function va(t){const e=v.useMemo(()=>Gs(jo),[]),[n,s]=v.useState(e),i=W(n,jo);return{getDevices:()=>(n===e&&s(t.listDevices()),i)}}var my=Object.freeze({__proto__:null,useAnonymousParticipantCount:ry,useCallBlockedUserIds:jv,useCallCallingState:Qv,useCallClosedCaptions:fy,useCallCreatedAt:Mv,useCallCreatedBy:Vv,useCallCustomData:Bv,useCallEgress:Hv,useCallEndedAt:Fv,useCallEndedBy:Jv,useCallIngress:qv,useCallMembers:Zv,useCallSession:Wv,useCallSettings:Gv,useCallStartedAt:ey,useCallStartsAt:Uv,useCallState:ce,useCallStatsReport:Yv,useCallThumbnail:ay,useCallUpdatedAt:$v,useCameraState:cy,useDominantSpeaker:Xv,useHasOngoingScreenShare:zv,useHasPermissions:oy,useIncomingVideoSettings:hy,useIsCallCaptioningInProgress:py,useIsCallHLSBroadcastingInProgress:Dv,useIsCallLive:Lv,useIsCallRecordingInProgress:ru,useIsCallTranscribingInProgress:Kv,useLocalParticipant:ny,useMicrophoneState:ly,useOwnCapabilities:au,useParticipantCount:iy,useParticipants:ty,useRemoteParticipants:sy,useScreenShareState:dy,useSpeakerState:uy});const gy=()=>{const t=Ae(),e=ru(),[n,s]=v.useState(!1);return v.useEffect(()=>{s(r=>r&&!1)},[e]),{toggleCallRecording:v.useCallback(async()=>{try{s(!0),e?await(t==null?void 0:t.stopRecording()):await(t==null?void 0:t.startRecording())}catch(r){throw console.error("Failed start recording",r),r}},[t,e]),isAwaitingResponse:n,isCallRecordingInProgress:e}},at=()=>my,et=({canRequestOnly:t,hasPermissionsOnly:e,requiredGrants:n,requireAll:s=!0,children:i})=>{const r=Ae(),{useCallSettings:a,useOwnCapabilities:o}=at(),l=o(),u=a(),d=n[s?"every":"some"](c=>l==null?void 0:l.includes(c));if(e)return d?b.jsx(b.Fragment,{children:i}):null;const f=n.some(c=>r==null?void 0:r.permissionsContext.canRequest(c,u));return t?f?b.jsx(b.Fragment,{children:i}):null:d||f?b.jsx(b.Fragment,{children:i}):null};function Ai(){return typeof window<"u"}function Yt(t){return ou(t)?(t.nodeName||"").toLowerCase():"#document"}function it(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function xt(t){var e;return(e=(ou(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function ou(t){return Ai()?t instanceof Node||t instanceof it(t).Node:!1}function Ee(t){return Ai()?t instanceof Element||t instanceof it(t).Element:!1}function xe(t){return Ai()?t instanceof HTMLElement||t instanceof it(t).HTMLElement:!1}function Mr(t){return!Ai()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof it(t).ShadowRoot}function as(t){const{overflow:e,overflowX:n,overflowY:s,display:i}=rt(t);return/auto|scroll|overlay|hidden|clip/.test(e+s+n)&&!["inline","contents"].includes(i)}function by(t){return["table","td","th"].includes(Yt(t))}function Di(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function ya(t){const e=Li(),n=Ee(t)?rt(t):t;return["transform","translate","scale","rotate","perspective"].some(s=>n[s]?n[s]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(s=>(n.willChange||"").includes(s))||["paint","layout","strict","content"].some(s=>(n.contain||"").includes(s))}function vy(t){let e=Mt(t);for(;xe(e)&&!Dt(e);){if(ya(e))return e;if(Di(e))return null;e=Mt(e)}return null}function Li(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Dt(t){return["html","body","#document"].includes(Yt(t))}function rt(t){return it(t).getComputedStyle(t)}function ji(t){return Ee(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Mt(t){if(Yt(t)==="html")return t;const e=t.assignedSlot||t.parentNode||Mr(t)&&t.host||xt(t);return Mr(e)?e.host:e}function cu(t){const e=Mt(t);return Dt(e)?t.ownerDocument?t.ownerDocument.body:t.body:xe(e)&&as(e)?e:cu(e)}function Wt(t,e,n){var s;e===void 0&&(e=[]),n===void 0&&(n=!0);const i=cu(t),r=i===((s=t.ownerDocument)==null?void 0:s.body),a=it(i);if(r){const o=Fr(a);return e.concat(a,a.visualViewport||[],as(i)?i:[],o&&n?Wt(o):[])}return e.concat(i,Wt(i,[],n))}function Fr(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}const Kt=Math.min,st=Math.max,oi=Math.round,gn=Math.floor,Rt=t=>({x:t,y:t}),yy={left:"right",right:"left",bottom:"top",top:"bottom"},Sy={start:"end",end:"start"};function Ur(t,e,n){return st(t,Kt(e,n))}function xn(t,e){return typeof t=="function"?t(e):t}function Jt(t){return t.split("-")[0]}function Pn(t){return t.split("-")[1]}function lu(t){return t==="x"?"y":"x"}function Sa(t){return t==="y"?"height":"width"}function sn(t){return["top","bottom"].includes(Jt(t))?"y":"x"}function Ca(t){return lu(sn(t))}function Cy(t,e,n){n===void 0&&(n=!1);const s=Pn(t),i=Ca(t),r=Sa(i);let a=i==="x"?s===(n?"end":"start")?"right":"left":s==="start"?"bottom":"top";return e.reference[r]>e.floating[r]&&(a=ci(a)),[a,ci(a)]}function Ty(t){const e=ci(t);return[$r(t),e,$r(e)]}function $r(t){return t.replace(/start|end/g,e=>Sy[e])}function wy(t,e,n){const s=["left","right"],i=["right","left"],r=["top","bottom"],a=["bottom","top"];switch(t){case"top":case"bottom":return n?e?i:s:e?s:i;case"left":case"right":return e?r:a;default:return[]}}function ky(t,e,n,s){const i=Pn(t);let r=wy(Jt(t),n==="start",s);return i&&(r=r.map(a=>a+"-"+i),e&&(r=r.concat(r.map($r)))),r}function ci(t){return t.replace(/left|right|bottom|top/g,e=>yy[e])}function Ry(t){return{top:0,right:0,bottom:0,left:0,...t}}function uu(t){return typeof t!="number"?Ry(t):{top:t,right:t,bottom:t,left:t}}function li(t){const{x:e,y:n,width:s,height:i}=t;return{width:s,height:i,top:n,left:e,right:e+s,bottom:n+i,x:e,y:n}}/*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var Ey=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],ui=Ey.join(","),du=typeof Element>"u",In=du?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,di=!du&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t==null?void 0:t.ownerDocument},hi=function t(e,n){var s;n===void 0&&(n=!0);var i=e==null||(s=e.getAttribute)===null||s===void 0?void 0:s.call(e,"inert"),r=i===""||i==="true",a=r||n&&e&&t(e.parentNode);return a},Iy=function(e){var n,s=e==null||(n=e.getAttribute)===null||n===void 0?void 0:n.call(e,"contenteditable");return s===""||s==="true"},hu=function(e,n,s){if(hi(e))return[];var i=Array.prototype.slice.apply(e.querySelectorAll(ui));return n&&In.call(e,ui)&&i.unshift(e),i=i.filter(s),i},fu=function t(e,n,s){for(var i=[],r=Array.from(e);r.length;){var a=r.shift();if(!hi(a,!1))if(a.tagName==="SLOT"){var o=a.assignedElements(),l=o.length?o:a.children,u=t(l,!0,s);s.flatten?i.push.apply(i,u):i.push({scopeParent:a,candidates:u})}else{var d=In.call(a,ui);d&&s.filter(a)&&(n||!e.includes(a))&&i.push(a);var f=a.shadowRoot||typeof s.getShadowRoot=="function"&&s.getShadowRoot(a),c=!hi(f,!1)&&(!s.shadowRootFilter||s.shadowRootFilter(a));if(f&&c){var h=t(f===!0?a.children:f.children,!0,s);s.flatten?i.push.apply(i,h):i.push({scopeParent:a,candidates:h})}else r.unshift.apply(r,a.children)}}return i},pu=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},mu=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||Iy(e))&&!pu(e)?0:e.tabIndex},_y=function(e,n){var s=mu(e);return s<0&&n&&!pu(e)?0:s},xy=function(e,n){return e.tabIndex===n.tabIndex?e.documentOrder-n.documentOrder:e.tabIndex-n.tabIndex},gu=function(e){return e.tagName==="INPUT"},Py=function(e){return gu(e)&&e.type==="hidden"},Oy=function(e){var n=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(s){return s.tagName==="SUMMARY"});return n},Ny=function(e,n){for(var s=0;s<e.length;s++)if(e[s].checked&&e[s].form===n)return e[s]},Ay=function(e){if(!e.name)return!0;var n=e.form||di(e),s=function(o){return n.querySelectorAll('input[type="radio"][name="'+o+'"]')},i;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")i=s(window.CSS.escape(e.name));else try{i=s(e.name)}catch(a){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",a.message),!1}var r=Ny(i,e.form);return!r||r===e},Dy=function(e){return gu(e)&&e.type==="radio"},Ly=function(e){return Dy(e)&&!Ay(e)},jy=function(e){var n,s=e&&di(e),i=(n=s)===null||n===void 0?void 0:n.host,r=!1;if(s&&s!==e){var a,o,l;for(r=!!((a=i)!==null&&a!==void 0&&(o=a.ownerDocument)!==null&&o!==void 0&&o.contains(i)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!r&&i;){var u,d,f;s=di(i),i=(u=s)===null||u===void 0?void 0:u.host,r=!!((d=i)!==null&&d!==void 0&&(f=d.ownerDocument)!==null&&f!==void 0&&f.contains(i))}}return r},Mo=function(e){var n=e.getBoundingClientRect(),s=n.width,i=n.height;return s===0&&i===0},My=function(e,n){var s=n.displayCheck,i=n.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var r=In.call(e,"details>summary:first-of-type"),a=r?e.parentElement:e;if(In.call(a,"details:not([open]) *"))return!0;if(!s||s==="full"||s==="legacy-full"){if(typeof i=="function"){for(var o=e;e;){var l=e.parentElement,u=di(e);if(l&&!l.shadowRoot&&i(l)===!0)return Mo(e);e.assignedSlot?e=e.assignedSlot:!l&&u!==e.ownerDocument?e=u.host:e=l}e=o}if(jy(e))return!e.getClientRects().length;if(s!=="legacy-full")return!0}else if(s==="non-zero-area")return Mo(e);return!1},Fy=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var n=e.parentElement;n;){if(n.tagName==="FIELDSET"&&n.disabled){for(var s=0;s<n.children.length;s++){var i=n.children.item(s);if(i.tagName==="LEGEND")return In.call(n,"fieldset[disabled] *")?!0:!i.contains(e)}return!0}n=n.parentElement}return!1},Vr=function(e,n){return!(n.disabled||hi(n)||Py(n)||My(n,e)||Oy(n)||Fy(n))},Br=function(e,n){return!(Ly(n)||mu(n)<0||!Vr(e,n))},Uy=function(e){var n=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(n)||n>=0)},$y=function t(e){var n=[],s=[];return e.forEach(function(i,r){var a=!!i.scopeParent,o=a?i.scopeParent:i,l=_y(o,a),u=a?t(i.candidates):o;l===0?a?n.push.apply(n,u):n.push(o):s.push({documentOrder:r,tabIndex:l,item:i,isScope:a,content:u})}),s.sort(xy).reduce(function(i,r){return r.isScope?i.push.apply(i,r.content):i.push(r.content),i},[]).concat(n)},Mi=function(e,n){n=n||{};var s;return n.getShadowRoot?s=fu([e],n.includeContainer,{filter:Br.bind(null,n),flatten:!1,getShadowRoot:n.getShadowRoot,shadowRootFilter:Uy}):s=hu(e,n.includeContainer,Br.bind(null,n)),$y(s)},Vy=function(e,n){n=n||{};var s;return n.getShadowRoot?s=fu([e],n.includeContainer,{filter:Vr.bind(null,n),flatten:!0,getShadowRoot:n.getShadowRoot}):s=hu(e,n.includeContainer,Vr.bind(null,n)),s},bu=function(e,n){if(n=n||{},!e)throw new Error("No node provided");return In.call(e,ui)===!1?!1:Br(n,e)};function vu(){const t=navigator.userAgentData;return t!=null&&t.platform?t.platform:navigator.platform}function yu(){const t=navigator.userAgentData;return t&&Array.isArray(t.brands)?t.brands.map(e=>{let{brand:n,version:s}=e;return n+"/"+s}).join(" "):navigator.userAgent}function By(){return/apple/i.test(navigator.vendor)}function Hr(){const t=/android/i;return t.test(vu())||t.test(yu())}function Hy(){return yu().includes("jsdom/")}const Fo="data-floating-ui-focusable",qy="input:not([type='hidden']):not([disabled]),[contenteditable]:not([contenteditable='false']),textarea:not([disabled])",or="ArrowLeft",cr="ArrowRight",Wy="ArrowUp",Gy="ArrowDown";function Vt(t){let e=t.activeElement;for(;((n=e)==null||(n=n.shadowRoot)==null?void 0:n.activeElement)!=null;){var n;e=e.shadowRoot.activeElement}return e}function Qe(t,e){if(!t||!e)return!1;const n=e.getRootNode==null?void 0:e.getRootNode();if(t.contains(e))return!0;if(n&&Mr(n)){let s=e;for(;s;){if(t===s)return!0;s=s.parentNode||s.host}}return!1}function en(t){return"composedPath"in t?t.composedPath()[0]:t.target}function lr(t,e){if(e==null)return!1;if("composedPath"in t)return t.composedPath().includes(e);const n=t;return n.target!=null&&e.contains(n.target)}function Ky(t){return t.matches("html,body")}function lt(t){return(t==null?void 0:t.ownerDocument)||document}function Su(t){return xe(t)&&t.matches(qy)}function qr(t){return t?t.getAttribute("role")==="combobox"&&Su(t):!1}function fi(t){return t?t.hasAttribute(Fo)?t:t.querySelector("["+Fo+"]")||t:null}function yn(t,e,n){n===void 0&&(n=!0);let s=t.filter(r=>{var a;return r.parentId===e&&((a=r.context)==null?void 0:a.open)}),i=s;for(;i.length;)i=n?t.filter(r=>{var a;return(a=i)==null?void 0:a.some(o=>{var l;return r.parentId===o.id&&((l=r.context)==null?void 0:l.open)})}):t,s=s.concat(i);return s}function Jy(t,e){let n,s=-1;function i(r,a){a>s&&(n=r,s=a),yn(t,r).forEach(l=>{i(l.id,a+1)})}return i(e,0),t.find(r=>r.id===n)}function Uo(t,e){var n;let s=[],i=(n=t.find(r=>r.id===e))==null?void 0:n.parentId;for(;i;){const r=t.find(a=>a.id===i);i=r==null?void 0:r.parentId,r&&(s=s.concat(r))}return s}function Me(t){t.preventDefault(),t.stopPropagation()}function zy(t){return"nativeEvent"in t}function Cu(t){return t.mozInputSource===0&&t.isTrusted?!0:Hr()&&t.pointerType?t.type==="click"&&t.buttons===1:t.detail===0&&!t.pointerType}function Tu(t){return Hy()?!1:!Hr()&&t.width===0&&t.height===0||Hr()&&t.width===1&&t.height===1&&t.pressure===0&&t.detail===0&&t.pointerType==="mouse"||t.width<1&&t.height<1&&t.pressure===0&&t.detail===0&&t.pointerType==="touch"}function $o(t,e){return["mouse","pen"].includes(t)}var Te=typeof document<"u"?v.useLayoutEffect:v.useEffect;const Yy={...fc};function Tt(t){const e=v.useRef(t);return Te(()=>{e.current=t}),e}const Xy=Yy.useInsertionEffect,Zy=Xy||(t=>t());function Fe(t){const e=v.useRef(()=>{});return Zy(()=>{e.current=t}),v.useCallback(function(){for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return e.current==null?void 0:e.current(...s)},[])}function Cs(t,e,n){return Math.floor(t/e)!==n}function Vn(t,e){return e<0||e>=t.current.length}function ur(t,e){return Ve(t,{disabledIndices:e})}function Vo(t,e){return Ve(t,{decrement:!0,startingIndex:t.current.length,disabledIndices:e})}function Ve(t,e){let{startingIndex:n=-1,decrement:s=!1,disabledIndices:i,amount:r=1}=e===void 0?{}:e,a=n;do a+=s?-r:r;while(a>=0&&a<=t.current.length-1&&Ds(t,a,i));return a}function Qy(t,e){let{event:n,orientation:s,loop:i,rtl:r,cols:a,disabledIndices:o,minIndex:l,maxIndex:u,prevIndex:d,stopEvent:f=!1}=e,c=d;if(n.key===Wy){if(f&&Me(n),d===-1)c=u;else if(c=Ve(t,{startingIndex:c,amount:a,decrement:!0,disabledIndices:o}),i&&(d-a<l||c<0)){const h=d%a,m=u%a,p=u-(m-h);m===h?c=u:c=m>h?p:p-a}Vn(t,c)&&(c=d)}if(n.key===Gy&&(f&&Me(n),d===-1?c=l:(c=Ve(t,{startingIndex:d,amount:a,disabledIndices:o}),i&&d+a>u&&(c=Ve(t,{startingIndex:d%a-a,amount:a,disabledIndices:o}))),Vn(t,c)&&(c=d)),s==="both"){const h=gn(d/a);n.key===(r?or:cr)&&(f&&Me(n),d%a!==a-1?(c=Ve(t,{startingIndex:d,disabledIndices:o}),i&&Cs(c,a,h)&&(c=Ve(t,{startingIndex:d-d%a-1,disabledIndices:o}))):i&&(c=Ve(t,{startingIndex:d-d%a-1,disabledIndices:o})),Cs(c,a,h)&&(c=d)),n.key===(r?cr:or)&&(f&&Me(n),d%a!==0?(c=Ve(t,{startingIndex:d,decrement:!0,disabledIndices:o}),i&&Cs(c,a,h)&&(c=Ve(t,{startingIndex:d+(a-d%a),decrement:!0,disabledIndices:o}))):i&&(c=Ve(t,{startingIndex:d+(a-d%a),decrement:!0,disabledIndices:o})),Cs(c,a,h)&&(c=d));const m=gn(u/a)===h;Vn(t,c)&&(i&&m?c=n.key===(r?cr:or)?u:Ve(t,{startingIndex:d-d%a-1,disabledIndices:o}):c=d)}return c}function eS(t,e,n){const s=[];let i=0;return t.forEach((r,a)=>{let{width:o,height:l}=r,u=!1;for(n&&(i=0);!u;){const d=[];for(let f=0;f<o;f++)for(let c=0;c<l;c++)d.push(i+f+c*e);i%e+o<=e&&d.every(f=>s[f]==null)?(d.forEach(f=>{s[f]=a}),u=!0):i++}}),[...s]}function tS(t,e,n,s,i){if(t===-1)return-1;const r=n.indexOf(t),a=e[t];switch(i){case"tl":return r;case"tr":return a?r+a.width-1:r;case"bl":return a?r+(a.height-1)*s:r;case"br":return n.lastIndexOf(t)}}function nS(t,e){return e.flatMap((n,s)=>t.includes(n)?[s]:[])}function Ds(t,e,n){if(n)return n.includes(e);const s=t.current[e];return s==null||s.hasAttribute("disabled")||s.getAttribute("aria-disabled")==="true"}const os=()=>({getShadowRoot:!0,displayCheck:typeof ResizeObserver=="function"&&ResizeObserver.toString().includes("[native code]")?"full":"none"});function wu(t,e){const n=Mi(t,os()),s=n.length;if(s===0)return;const i=Vt(lt(t)),r=n.indexOf(i),a=r===-1?e===1?0:s-1:r+e;return n[a]}function ku(t){return wu(lt(t).body,1)||t}function Ru(t){return wu(lt(t).body,-1)||t}function Bn(t,e){const n=e||t.currentTarget,s=t.relatedTarget;return!s||!Qe(n,s)}function sS(t){Mi(t,os()).forEach(n=>{n.dataset.tabindex=n.getAttribute("tabindex")||"",n.setAttribute("tabindex","-1")})}function Bo(t){t.querySelectorAll("[data-tabindex]").forEach(n=>{const s=n.dataset.tabindex;delete n.dataset.tabindex,s?n.setAttribute("tabindex",s):n.removeAttribute("tabindex")})}function Ho(t,e,n){let{reference:s,floating:i}=t;const r=sn(e),a=Ca(e),o=Sa(a),l=Jt(e),u=r==="y",d=s.x+s.width/2-i.width/2,f=s.y+s.height/2-i.height/2,c=s[o]/2-i[o]/2;let h;switch(l){case"top":h={x:d,y:s.y-i.height};break;case"bottom":h={x:d,y:s.y+s.height};break;case"right":h={x:s.x+s.width,y:f};break;case"left":h={x:s.x-i.width,y:f};break;default:h={x:s.x,y:s.y}}switch(Pn(e)){case"start":h[a]-=c*(n&&u?-1:1);break;case"end":h[a]+=c*(n&&u?-1:1);break}return h}const iS=async(t,e,n)=>{const{placement:s="bottom",strategy:i="absolute",middleware:r=[],platform:a}=n,o=r.filter(Boolean),l=await(a.isRTL==null?void 0:a.isRTL(e));let u=await a.getElementRects({reference:t,floating:e,strategy:i}),{x:d,y:f}=Ho(u,s,l),c=s,h={},m=0;for(let p=0;p<o.length;p++){const{name:g,fn:y}=o[p],{x:C,y:S,data:T,reset:w}=await y({x:d,y:f,initialPlacement:s,placement:c,strategy:i,middlewareData:h,rects:u,platform:a,elements:{reference:t,floating:e}});d=C??d,f=S??f,h={...h,[g]:{...h[g],...T}},w&&m<=50&&(m++,typeof w=="object"&&(w.placement&&(c=w.placement),w.rects&&(u=w.rects===!0?await a.getElementRects({reference:t,floating:e,strategy:i}):w.rects),{x:d,y:f}=Ho(u,c,l)),p=-1)}return{x:d,y:f,placement:c,strategy:i,middlewareData:h}};async function Ta(t,e){var n;e===void 0&&(e={});const{x:s,y:i,platform:r,rects:a,elements:o,strategy:l}=t,{boundary:u="clippingAncestors",rootBoundary:d="viewport",elementContext:f="floating",altBoundary:c=!1,padding:h=0}=xn(e,t),m=uu(h),g=o[c?f==="floating"?"reference":"floating":f],y=li(await r.getClippingRect({element:(n=await(r.isElement==null?void 0:r.isElement(g)))==null||n?g:g.contextElement||await(r.getDocumentElement==null?void 0:r.getDocumentElement(o.floating)),boundary:u,rootBoundary:d,strategy:l})),C=f==="floating"?{x:s,y:i,width:a.floating.width,height:a.floating.height}:a.reference,S=await(r.getOffsetParent==null?void 0:r.getOffsetParent(o.floating)),T=await(r.isElement==null?void 0:r.isElement(S))?await(r.getScale==null?void 0:r.getScale(S))||{x:1,y:1}:{x:1,y:1},w=li(r.convertOffsetParentRelativeRectToViewportRelativeRect?await r.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:C,offsetParent:S,strategy:l}):C);return{top:(y.top-w.top+m.top)/T.y,bottom:(w.bottom-y.bottom+m.bottom)/T.y,left:(y.left-w.left+m.left)/T.x,right:(w.right-y.right+m.right)/T.x}}const rS=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:s,placement:i,rects:r,platform:a,elements:o,middlewareData:l}=e,{element:u,padding:d=0}=xn(t,e)||{};if(u==null)return{};const f=uu(d),c={x:n,y:s},h=Ca(i),m=Sa(h),p=await a.getDimensions(u),g=h==="y",y=g?"top":"left",C=g?"bottom":"right",S=g?"clientHeight":"clientWidth",T=r.reference[m]+r.reference[h]-c[h]-r.floating[m],w=c[h]-r.reference[h],k=await(a.getOffsetParent==null?void 0:a.getOffsetParent(u));let _=k?k[S]:0;(!_||!await(a.isElement==null?void 0:a.isElement(k)))&&(_=o.floating[S]||r.floating[m]);const L=T/2-w/2,$=_/2-p[m]/2-1,N=Kt(f[y],$),F=Kt(f[C],$),D=N,j=_-p[m]-F,x=_/2-p[m]/2+L,R=Ur(D,x,j),U=!l.arrow&&Pn(i)!=null&&x!==R&&r.reference[m]/2-(x<D?N:F)-p[m]/2<0,V=U?x<D?x-D:x-j:0;return{[h]:c[h]+V,data:{[h]:R,centerOffset:x-R-V,...U&&{alignmentOffset:V}},reset:U}}}),aS=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,s;const{placement:i,middlewareData:r,rects:a,initialPlacement:o,platform:l,elements:u}=e,{mainAxis:d=!0,crossAxis:f=!0,fallbackPlacements:c,fallbackStrategy:h="bestFit",fallbackAxisSideDirection:m="none",flipAlignment:p=!0,...g}=xn(t,e);if((n=r.arrow)!=null&&n.alignmentOffset)return{};const y=Jt(i),C=sn(o),S=Jt(o)===o,T=await(l.isRTL==null?void 0:l.isRTL(u.floating)),w=c||(S||!p?[ci(o)]:Ty(o)),k=m!=="none";!c&&k&&w.push(...ky(o,p,m,T));const _=[o,...w],L=await Ta(e,g),$=[];let N=((s=r.flip)==null?void 0:s.overflows)||[];if(d&&$.push(L[y]),f){const x=Cy(i,a,T);$.push(L[x[0]],L[x[1]])}if(N=[...N,{placement:i,overflows:$}],!$.every(x=>x<=0)){var F,D;const x=(((F=r.flip)==null?void 0:F.index)||0)+1,R=_[x];if(R)return{data:{index:x,overflows:N},reset:{placement:R}};let U=(D=N.filter(V=>V.overflows[0]<=0).sort((V,I)=>V.overflows[1]-I.overflows[1])[0])==null?void 0:D.placement;if(!U)switch(h){case"bestFit":{var j;const V=(j=N.filter(I=>{if(k){const A=sn(I.placement);return A===C||A==="y"}return!0}).map(I=>[I.placement,I.overflows.filter(A=>A>0).reduce((A,Y)=>A+Y,0)]).sort((I,A)=>I[1]-A[1])[0])==null?void 0:j[0];V&&(U=V);break}case"initialPlacement":U=o;break}if(i!==U)return{reset:{placement:U}}}return{}}}};async function oS(t,e){const{placement:n,platform:s,elements:i}=t,r=await(s.isRTL==null?void 0:s.isRTL(i.floating)),a=Jt(n),o=Pn(n),l=sn(n)==="y",u=["left","top"].includes(a)?-1:1,d=r&&l?-1:1,f=xn(e,t);let{mainAxis:c,crossAxis:h,alignmentAxis:m}=typeof f=="number"?{mainAxis:f,crossAxis:0,alignmentAxis:null}:{mainAxis:f.mainAxis||0,crossAxis:f.crossAxis||0,alignmentAxis:f.alignmentAxis};return o&&typeof m=="number"&&(h=o==="end"?m*-1:m),l?{x:h*d,y:c*u}:{x:c*u,y:h*d}}const cS=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,s;const{x:i,y:r,placement:a,middlewareData:o}=e,l=await oS(e,t);return a===((n=o.offset)==null?void 0:n.placement)&&(s=o.arrow)!=null&&s.alignmentOffset?{}:{x:i+l.x,y:r+l.y,data:{...l,placement:a}}}}},lS=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:s,placement:i}=e,{mainAxis:r=!0,crossAxis:a=!1,limiter:o={fn:g=>{let{x:y,y:C}=g;return{x:y,y:C}}},...l}=xn(t,e),u={x:n,y:s},d=await Ta(e,l),f=sn(Jt(i)),c=lu(f);let h=u[c],m=u[f];if(r){const g=c==="y"?"top":"left",y=c==="y"?"bottom":"right",C=h+d[g],S=h-d[y];h=Ur(C,h,S)}if(a){const g=f==="y"?"top":"left",y=f==="y"?"bottom":"right",C=m+d[g],S=m-d[y];m=Ur(C,m,S)}const p=o.fn({...e,[c]:h,[f]:m});return{...p,data:{x:p.x-n,y:p.y-s,enabled:{[c]:r,[f]:a}}}}}},uS=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var n,s;const{placement:i,rects:r,platform:a,elements:o}=e,{apply:l=()=>{},...u}=xn(t,e),d=await Ta(e,u),f=Jt(i),c=Pn(i),h=sn(i)==="y",{width:m,height:p}=r.floating;let g,y;f==="top"||f==="bottom"?(g=f,y=c===(await(a.isRTL==null?void 0:a.isRTL(o.floating))?"start":"end")?"left":"right"):(y=f,g=c==="end"?"top":"bottom");const C=p-d.top-d.bottom,S=m-d.left-d.right,T=Kt(p-d[g],C),w=Kt(m-d[y],S),k=!e.middlewareData.shift;let _=T,L=w;if((n=e.middlewareData.shift)!=null&&n.enabled.x&&(L=S),(s=e.middlewareData.shift)!=null&&s.enabled.y&&(_=C),k&&!c){const N=st(d.left,0),F=st(d.right,0),D=st(d.top,0),j=st(d.bottom,0);h?L=m-2*(N!==0||F!==0?N+F:st(d.left,d.right)):_=p-2*(D!==0||j!==0?D+j:st(d.top,d.bottom))}await l({...e,availableWidth:L,availableHeight:_});const $=await a.getDimensions(o.floating);return m!==$.width||p!==$.height?{reset:{rects:!0}}:{}}}};function Eu(t){const e=rt(t);let n=parseFloat(e.width)||0,s=parseFloat(e.height)||0;const i=xe(t),r=i?t.offsetWidth:n,a=i?t.offsetHeight:s,o=oi(n)!==r||oi(s)!==a;return o&&(n=r,s=a),{width:n,height:s,$:o}}function wa(t){return Ee(t)?t:t.contextElement}function Sn(t){const e=wa(t);if(!xe(e))return Rt(1);const n=e.getBoundingClientRect(),{width:s,height:i,$:r}=Eu(e);let a=(r?oi(n.width):n.width)/s,o=(r?oi(n.height):n.height)/i;return(!a||!Number.isFinite(a))&&(a=1),(!o||!Number.isFinite(o))&&(o=1),{x:a,y:o}}const dS=Rt(0);function Iu(t){const e=it(t);return!Li()||!e.visualViewport?dS:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function hS(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==it(t)?!1:e}function rn(t,e,n,s){e===void 0&&(e=!1),n===void 0&&(n=!1);const i=t.getBoundingClientRect(),r=wa(t);let a=Rt(1);e&&(s?Ee(s)&&(a=Sn(s)):a=Sn(t));const o=hS(r,n,s)?Iu(r):Rt(0);let l=(i.left+o.x)/a.x,u=(i.top+o.y)/a.y,d=i.width/a.x,f=i.height/a.y;if(r){const c=it(r),h=s&&Ee(s)?it(s):s;let m=c,p=Fr(m);for(;p&&s&&h!==m;){const g=Sn(p),y=p.getBoundingClientRect(),C=rt(p),S=y.left+(p.clientLeft+parseFloat(C.paddingLeft))*g.x,T=y.top+(p.clientTop+parseFloat(C.paddingTop))*g.y;l*=g.x,u*=g.y,d*=g.x,f*=g.y,l+=S,u+=T,m=it(p),p=Fr(m)}}return li({width:d,height:f,x:l,y:u})}function ka(t,e){const n=ji(t).scrollLeft;return e?e.left+n:rn(xt(t)).left+n}function _u(t,e,n){n===void 0&&(n=!1);const s=t.getBoundingClientRect(),i=s.left+e.scrollLeft-(n?0:ka(t,s)),r=s.top+e.scrollTop;return{x:i,y:r}}function fS(t){let{elements:e,rect:n,offsetParent:s,strategy:i}=t;const r=i==="fixed",a=xt(s),o=e?Di(e.floating):!1;if(s===a||o&&r)return n;let l={scrollLeft:0,scrollTop:0},u=Rt(1);const d=Rt(0),f=xe(s);if((f||!f&&!r)&&((Yt(s)!=="body"||as(a))&&(l=ji(s)),xe(s))){const h=rn(s);u=Sn(s),d.x=h.x+s.clientLeft,d.y=h.y+s.clientTop}const c=a&&!f&&!r?_u(a,l,!0):Rt(0);return{width:n.width*u.x,height:n.height*u.y,x:n.x*u.x-l.scrollLeft*u.x+d.x+c.x,y:n.y*u.y-l.scrollTop*u.y+d.y+c.y}}function pS(t){return Array.from(t.getClientRects())}function mS(t){const e=xt(t),n=ji(t),s=t.ownerDocument.body,i=st(e.scrollWidth,e.clientWidth,s.scrollWidth,s.clientWidth),r=st(e.scrollHeight,e.clientHeight,s.scrollHeight,s.clientHeight);let a=-n.scrollLeft+ka(t);const o=-n.scrollTop;return rt(s).direction==="rtl"&&(a+=st(e.clientWidth,s.clientWidth)-i),{width:i,height:r,x:a,y:o}}function gS(t,e){const n=it(t),s=xt(t),i=n.visualViewport;let r=s.clientWidth,a=s.clientHeight,o=0,l=0;if(i){r=i.width,a=i.height;const u=Li();(!u||u&&e==="fixed")&&(o=i.offsetLeft,l=i.offsetTop)}return{width:r,height:a,x:o,y:l}}function bS(t,e){const n=rn(t,!0,e==="fixed"),s=n.top+t.clientTop,i=n.left+t.clientLeft,r=xe(t)?Sn(t):Rt(1),a=t.clientWidth*r.x,o=t.clientHeight*r.y,l=i*r.x,u=s*r.y;return{width:a,height:o,x:l,y:u}}function qo(t,e,n){let s;if(e==="viewport")s=gS(t,n);else if(e==="document")s=mS(xt(t));else if(Ee(e))s=bS(e,n);else{const i=Iu(t);s={x:e.x-i.x,y:e.y-i.y,width:e.width,height:e.height}}return li(s)}function xu(t,e){const n=Mt(t);return n===e||!Ee(n)||Dt(n)?!1:rt(n).position==="fixed"||xu(n,e)}function vS(t,e){const n=e.get(t);if(n)return n;let s=Wt(t,[],!1).filter(o=>Ee(o)&&Yt(o)!=="body"),i=null;const r=rt(t).position==="fixed";let a=r?Mt(t):t;for(;Ee(a)&&!Dt(a);){const o=rt(a),l=ya(a);!l&&o.position==="fixed"&&(i=null),(r?!l&&!i:!l&&o.position==="static"&&!!i&&["absolute","fixed"].includes(i.position)||as(a)&&!l&&xu(t,a))?s=s.filter(d=>d!==a):i=o,a=Mt(a)}return e.set(t,s),s}function yS(t){let{element:e,boundary:n,rootBoundary:s,strategy:i}=t;const a=[...n==="clippingAncestors"?Di(e)?[]:vS(e,this._c):[].concat(n),s],o=a[0],l=a.reduce((u,d)=>{const f=qo(e,d,i);return u.top=st(f.top,u.top),u.right=Kt(f.right,u.right),u.bottom=Kt(f.bottom,u.bottom),u.left=st(f.left,u.left),u},qo(e,o,i));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function SS(t){const{width:e,height:n}=Eu(t);return{width:e,height:n}}function CS(t,e,n){const s=xe(e),i=xt(e),r=n==="fixed",a=rn(t,!0,r,e);let o={scrollLeft:0,scrollTop:0};const l=Rt(0);if(s||!s&&!r)if((Yt(e)!=="body"||as(i))&&(o=ji(e)),s){const c=rn(e,!0,r,e);l.x=c.x+e.clientLeft,l.y=c.y+e.clientTop}else i&&(l.x=ka(i));const u=i&&!s&&!r?_u(i,o):Rt(0),d=a.left+o.scrollLeft-l.x-u.x,f=a.top+o.scrollTop-l.y-u.y;return{x:d,y:f,width:a.width,height:a.height}}function dr(t){return rt(t).position==="static"}function Wo(t,e){if(!xe(t)||rt(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return xt(t)===n&&(n=n.ownerDocument.body),n}function Pu(t,e){const n=it(t);if(Di(t))return n;if(!xe(t)){let i=Mt(t);for(;i&&!Dt(i);){if(Ee(i)&&!dr(i))return i;i=Mt(i)}return n}let s=Wo(t,e);for(;s&&by(s)&&dr(s);)s=Wo(s,e);return s&&Dt(s)&&dr(s)&&!ya(s)?n:s||vy(t)||n}const TS=async function(t){const e=this.getOffsetParent||Pu,n=this.getDimensions,s=await n(t.floating);return{reference:CS(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:s.width,height:s.height}}};function wS(t){return rt(t).direction==="rtl"}const kS={convertOffsetParentRelativeRectToViewportRelativeRect:fS,getDocumentElement:xt,getClippingRect:yS,getOffsetParent:Pu,getElementRects:TS,getClientRects:pS,getDimensions:SS,getScale:Sn,isElement:Ee,isRTL:wS};function Ou(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function RS(t,e){let n=null,s;const i=xt(t);function r(){var o;clearTimeout(s),(o=n)==null||o.disconnect(),n=null}function a(o,l){o===void 0&&(o=!1),l===void 0&&(l=1),r();const u=t.getBoundingClientRect(),{left:d,top:f,width:c,height:h}=u;if(o||e(),!c||!h)return;const m=gn(f),p=gn(i.clientWidth-(d+c)),g=gn(i.clientHeight-(f+h)),y=gn(d),S={rootMargin:-m+"px "+-p+"px "+-g+"px "+-y+"px",threshold:st(0,Kt(1,l))||1};let T=!0;function w(k){const _=k[0].intersectionRatio;if(_!==l){if(!T)return a();_?a(!1,_):s=setTimeout(()=>{a(!1,1e-7)},1e3)}_===1&&!Ou(u,t.getBoundingClientRect())&&a(),T=!1}try{n=new IntersectionObserver(w,{...S,root:i.ownerDocument})}catch{n=new IntersectionObserver(w,S)}n.observe(t)}return a(!0),r}function Nu(t,e,n,s){s===void 0&&(s={});const{ancestorScroll:i=!0,ancestorResize:r=!0,elementResize:a=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:l=!1}=s,u=wa(t),d=i||r?[...u?Wt(u):[],...Wt(e)]:[];d.forEach(y=>{i&&y.addEventListener("scroll",n,{passive:!0}),r&&y.addEventListener("resize",n)});const f=u&&o?RS(u,n):null;let c=-1,h=null;a&&(h=new ResizeObserver(y=>{let[C]=y;C&&C.target===u&&h&&(h.unobserve(e),cancelAnimationFrame(c),c=requestAnimationFrame(()=>{var S;(S=h)==null||S.observe(e)})),n()}),u&&!l&&h.observe(u),h.observe(e));let m,p=l?rn(t):null;l&&g();function g(){const y=rn(t);p&&!Ou(p,y)&&n(),p=y,m=requestAnimationFrame(g)}return n(),()=>{var y;d.forEach(C=>{i&&C.removeEventListener("scroll",n),r&&C.removeEventListener("resize",n)}),f==null||f(),(y=h)==null||y.disconnect(),h=null,l&&cancelAnimationFrame(m)}}const ES=cS,IS=lS,_S=aS,xS=uS,Go=rS,PS=(t,e,n)=>{const s=new Map,i={platform:kS,...n},r={...i.platform,_c:s};return iS(t,e,{...i,platform:r})};var Ls=typeof document<"u"?v.useLayoutEffect:v.useEffect;function pi(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let n,s,i;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(n=t.length,n!==e.length)return!1;for(s=n;s--!==0;)if(!pi(t[s],e[s]))return!1;return!0}if(i=Object.keys(t),n=i.length,n!==Object.keys(e).length)return!1;for(s=n;s--!==0;)if(!{}.hasOwnProperty.call(e,i[s]))return!1;for(s=n;s--!==0;){const r=i[s];if(!(r==="_owner"&&t.$$typeof)&&!pi(t[r],e[r]))return!1}return!0}return t!==t&&e!==e}function Au(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function Ko(t,e){const n=Au(t);return Math.round(e*n)/n}function hr(t){const e=v.useRef(t);return Ls(()=>{e.current=t}),e}function OS(t){t===void 0&&(t={});const{placement:e="bottom",strategy:n="absolute",middleware:s=[],platform:i,elements:{reference:r,floating:a}={},transform:o=!0,whileElementsMounted:l,open:u}=t,[d,f]=v.useState({x:0,y:0,strategy:n,placement:e,middlewareData:{},isPositioned:!1}),[c,h]=v.useState(s);pi(c,s)||h(s);const[m,p]=v.useState(null),[g,y]=v.useState(null),C=v.useCallback(I=>{I!==k.current&&(k.current=I,p(I))},[]),S=v.useCallback(I=>{I!==_.current&&(_.current=I,y(I))},[]),T=r||m,w=a||g,k=v.useRef(null),_=v.useRef(null),L=v.useRef(d),$=l!=null,N=hr(l),F=hr(i),D=hr(u),j=v.useCallback(()=>{if(!k.current||!_.current)return;const I={placement:e,strategy:n,middleware:c};F.current&&(I.platform=F.current),PS(k.current,_.current,I).then(A=>{const Y={...A,isPositioned:D.current!==!1};x.current&&!pi(L.current,Y)&&(L.current=Y,mc.flushSync(()=>{f(Y)}))})},[c,e,n,F,D]);Ls(()=>{u===!1&&L.current.isPositioned&&(L.current.isPositioned=!1,f(I=>({...I,isPositioned:!1})))},[u]);const x=v.useRef(!1);Ls(()=>(x.current=!0,()=>{x.current=!1}),[]),Ls(()=>{if(T&&(k.current=T),w&&(_.current=w),T&&w){if(N.current)return N.current(T,w,j);j()}},[T,w,j,N,$]);const R=v.useMemo(()=>({reference:k,floating:_,setReference:C,setFloating:S}),[C,S]),U=v.useMemo(()=>({reference:T,floating:w}),[T,w]),V=v.useMemo(()=>{const I={position:n,left:0,top:0};if(!U.floating)return I;const A=Ko(U.floating,d.x),Y=Ko(U.floating,d.y);return o?{...I,transform:"translate("+A+"px, "+Y+"px)",...Au(U.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:A,top:Y}},[n,o,U.floating,d.x,d.y]);return v.useMemo(()=>({...d,update:j,refs:R,elements:U,floatingStyles:V}),[d,j,R,U,V])}const NS=t=>{function e(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:t,fn(n){const{element:s,padding:i}=typeof t=="function"?t(n):t;return s&&e(s)?s.current!=null?Go({element:s.current,padding:i}).fn(n):{}:s?Go({element:s,padding:i}).fn(n):{}}}},AS=(t,e)=>({...ES(t),options:[t,e]}),DS=(t,e)=>({...IS(t),options:[t,e]}),Du=(t,e)=>({..._S(t),options:[t,e]}),LS=(t,e)=>({...xS(t),options:[t,e]}),jS=(t,e)=>({...NS(t),options:[t,e]});function MS(t,e){const n=t.compareDocumentPosition(e);return n&Node.DOCUMENT_POSITION_FOLLOWING||n&Node.DOCUMENT_POSITION_CONTAINED_BY?-1:n&Node.DOCUMENT_POSITION_PRECEDING||n&Node.DOCUMENT_POSITION_CONTAINS?1:0}const Lu=v.createContext({register:()=>{},unregister:()=>{},map:new Map,elementsRef:{current:[]}});function FS(t){const{children:e,elementsRef:n,labelsRef:s}=t,[i,r]=v.useState(()=>new Set),a=v.useCallback(u=>{r(d=>new Set(d).add(u))},[]),o=v.useCallback(u=>{r(d=>{const f=new Set(d);return f.delete(u),f})},[]),l=v.useMemo(()=>{const u=new Map;return Array.from(i.keys()).sort(MS).forEach((f,c)=>{u.set(f,c)}),u},[i]);return b.jsx(Lu.Provider,{value:v.useMemo(()=>({register:a,unregister:o,map:l,elementsRef:n,labelsRef:s}),[a,o,l,n,s]),children:e})}function US(t){t===void 0&&(t={});const{label:e}=t,{register:n,unregister:s,map:i,elementsRef:r,labelsRef:a}=v.useContext(Lu),[o,l]=v.useState(null),u=v.useRef(null),d=v.useCallback(f=>{if(u.current=f,o!==null&&(r.current[o]=f,a)){var c;const h=e!==void 0;a.current[o]=h?e:(c=f==null?void 0:f.textContent)!=null?c:null}},[o,r,a,e]);return Te(()=>{const f=u.current;if(f)return n(f),()=>{s(f)}},[n,s]),Te(()=>{const f=u.current?i.get(u.current):null;f!=null&&l(f)},[i]),v.useMemo(()=>({ref:d,index:o??-1}),[o,d])}const $S="data-floating-ui-focusable",Jo="active",zo="selected",cs="ArrowLeft",ls="ArrowRight",ju="ArrowUp",Fi="ArrowDown",VS={...fc};let Yo=!1,BS=0;const Xo=()=>"floating-ui-"+Math.random().toString(36).slice(2,6)+BS++;function HS(){const[t,e]=v.useState(()=>Yo?Xo():void 0);return Te(()=>{t==null&&e(Xo())},[]),v.useEffect(()=>{Yo=!0},[]),t}const qS=VS.useId,Ui=qS||HS,WS=v.forwardRef(function(e,n){const{context:{placement:s,elements:{floating:i},middlewareData:{arrow:r,shift:a}},width:o=14,height:l=7,tipRadius:u=0,strokeWidth:d=0,staticOffset:f,stroke:c,d:h,style:{transform:m,...p}={},...g}=e,y=Ui(),[C,S]=v.useState(!1);if(Te(()=>{if(!i)return;rt(i).direction==="rtl"&&S(!0)},[i]),!i)return null;const[T,w]=s.split("-"),k=T==="top"||T==="bottom";let _=f;(k&&a!=null&&a.x||!k&&a!=null&&a.y)&&(_=null);const L=d*2,$=L/2,N=o/2*(u/-8+1),F=l/2*u/4,D=!!h,j=_&&w==="end"?"bottom":"top";let x=_&&w==="end"?"right":"left";_&&C&&(x=w==="end"?"left":"right");const R=(r==null?void 0:r.x)!=null?_||r.x:"",U=(r==null?void 0:r.y)!=null?_||r.y:"",V=h||"M0,0"+(" H"+o)+(" L"+(o-N)+","+(l-F))+(" Q"+o/2+","+l+" "+N+","+(l-F))+" Z",I={top:D?"rotate(180deg)":"",left:D?"rotate(90deg)":"rotate(-90deg)",bottom:D?"":"rotate(180deg)",right:D?"rotate(-90deg)":"rotate(90deg)"}[T];return b.jsxs("svg",{...g,"aria-hidden":!0,ref:n,width:D?o:o+L,height:o,viewBox:"0 0 "+o+" "+(l>o?l:o),style:{position:"absolute",pointerEvents:"none",[x]:R,[j]:U,[T]:k||D?"100%":"calc(100% - "+L/2+"px)",transform:[I,m].filter(A=>!!A).join(" "),...p},children:[L>0&&b.jsx("path",{clipPath:"url(#"+y+")",fill:"none",stroke:c,strokeWidth:L+(h?0:1),d:V}),b.jsx("path",{stroke:L&&!h?g.fill:"none",d:V}),b.jsx("clipPath",{id:y,children:b.jsx("rect",{x:-$,y:$*(D?-1:1),width:o+L,height:o})})]})});function GS(){const t=new Map;return{emit(e,n){var s;(s=t.get(e))==null||s.forEach(i=>i(n))},on(e,n){t.has(e)||t.set(e,new Set),t.get(e).add(n)},off(e,n){var s;(s=t.get(e))==null||s.delete(n)}}}const KS=v.createContext(null),JS=v.createContext(null),Ra=()=>{var t;return((t=v.useContext(KS))==null?void 0:t.id)||null},$i=()=>v.useContext(JS);function es(t){return"data-floating-ui-"+t}function Zo(t){t.current!==-1&&(clearTimeout(t.current),t.current=-1)}let Qo=0;function Zt(t,e){e===void 0&&(e={});const{preventScroll:n=!1,cancelPrevious:s=!0,sync:i=!1}=e;s&&cancelAnimationFrame(Qo);const r=()=>t==null?void 0:t.focus({preventScroll:n});i?r():Qo=requestAnimationFrame(r)}function zS(t){return(t==null?void 0:t.ownerDocument)||document}let pn=new WeakMap,Ts=new WeakSet,ws={},fr=0;const YS=()=>typeof HTMLElement<"u"&&"inert"in HTMLElement.prototype,Mu=t=>t&&(t.host||Mu(t.parentNode)),XS=(t,e)=>e.map(n=>{if(t.contains(n))return n;const s=Mu(n);return t.contains(s)?s:null}).filter(n=>n!=null);function ZS(t,e,n,s){const i="data-floating-ui-inert",r=s?"inert":n?"aria-hidden":null,a=XS(e,t),o=new Set,l=new Set(a),u=[];ws[i]||(ws[i]=new WeakMap);const d=ws[i];a.forEach(f),c(e),o.clear();function f(h){!h||o.has(h)||(o.add(h),h.parentNode&&f(h.parentNode))}function c(h){!h||l.has(h)||[].forEach.call(h.children,m=>{if(Yt(m)!=="script")if(o.has(m))c(m);else{const p=r?m.getAttribute(r):null,g=p!==null&&p!=="false",y=pn.get(m)||0,C=r?y+1:y,S=(d.get(m)||0)+1;pn.set(m,C),d.set(m,S),u.push(m),C===1&&g&&Ts.add(m),S===1&&m.setAttribute(i,""),!g&&r&&m.setAttribute(r,r==="inert"?"":"true")}})}return fr++,()=>{u.forEach(h=>{const m=pn.get(h)||0,p=r?m-1:m,g=(d.get(h)||0)-1;pn.set(h,p),d.set(h,g),p||(!Ts.has(h)&&r&&h.removeAttribute(r),Ts.delete(h)),g||h.removeAttribute(i)}),fr--,fr||(pn=new WeakMap,pn=new WeakMap,Ts=new WeakSet,ws={})}}function ec(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!1);const s=zS(t[0]).body;return ZS(t.concat(Array.from(s.querySelectorAll("[aria-live]"))),s,e,n)}const Vi={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"fixed",whiteSpace:"nowrap",width:"1px",top:0,left:0},mi=v.forwardRef(function(e,n){const[s,i]=v.useState();Te(()=>{By()&&i("button")},[]);const r={ref:n,tabIndex:0,role:s,"aria-hidden":s?void 0:!0,[es("focus-guard")]:"",style:Vi};return b.jsx("span",{...e,...r})}),Fu=v.createContext(null),tc=es("portal");function QS(t){t===void 0&&(t={});const{id:e,root:n}=t,s=Ui(),i=Uu(),[r,a]=v.useState(null),o=v.useRef(null);return Te(()=>()=>{r==null||r.remove(),queueMicrotask(()=>{o.current=null})},[r]),Te(()=>{if(!s||o.current)return;const l=e?document.getElementById(e):null;if(!l)return;const u=document.createElement("div");u.id=s,u.setAttribute(tc,""),l.appendChild(u),o.current=u,a(u)},[e,s]),Te(()=>{if(n===null||!s||o.current)return;let l=n||(i==null?void 0:i.portalNode);l&&!Ee(l)&&(l=l.current),l=l||document.body;let u=null;e&&(u=document.createElement("div"),u.id=e,l.appendChild(u));const d=document.createElement("div");d.id=s,d.setAttribute(tc,""),l=u||l,l.appendChild(d),o.current=d,a(d)},[e,n,s,i]),r}function eC(t){const{children:e,id:n,root:s,preserveTabOrder:i=!0}=t,r=QS({id:n,root:s}),[a,o]=v.useState(null),l=v.useRef(null),u=v.useRef(null),d=v.useRef(null),f=v.useRef(null),c=a==null?void 0:a.modal,h=a==null?void 0:a.open,m=!!a&&!a.modal&&a.open&&i&&!!(s||r);return v.useEffect(()=>{if(!r||!i||c)return;function p(g){r&&Bn(g)&&(g.type==="focusin"?Bo:sS)(r)}return r.addEventListener("focusin",p,!0),r.addEventListener("focusout",p,!0),()=>{r.removeEventListener("focusin",p,!0),r.removeEventListener("focusout",p,!0)}},[r,i,c]),v.useEffect(()=>{r&&(h||Bo(r))},[h,r]),b.jsxs(Fu.Provider,{value:v.useMemo(()=>({preserveTabOrder:i,beforeOutsideRef:l,afterOutsideRef:u,beforeInsideRef:d,afterInsideRef:f,portalNode:r,setFocusManagerState:o}),[i,r]),children:[m&&r&&b.jsx(mi,{"data-type":"outside",ref:l,onFocus:p=>{if(Bn(p,r)){var g;(g=d.current)==null||g.focus()}else{const y=a?a.domReference:null,C=Ru(y);C==null||C.focus()}}}),m&&r&&b.jsx("span",{"aria-owns":r.id,style:Vi}),r&&mc.createPortal(e,r),m&&r&&b.jsx(mi,{"data-type":"outside",ref:u,onFocus:p=>{if(Bn(p,r)){var g;(g=f.current)==null||g.focus()}else{const y=a?a.domReference:null,C=ku(y);C==null||C.focus(),a!=null&&a.closeOnFocusOut&&(a==null||a.onOpenChange(!1,p.nativeEvent,"focus-out"))}}})]})}const Uu=()=>v.useContext(Fu);function nc(t){return v.useMemo(()=>e=>{t.forEach(n=>{n&&(n.current=e)})},t)}const tC=20;let Qt=[];function nC(t){Qt=Qt.filter(e=>e.isConnected),t&&Yt(t)!=="body"&&(Qt.push(t),Qt.length>tC&&(Qt=Qt.slice(-20)))}function sc(){return Qt.slice().reverse().find(t=>t.isConnected)}function sC(t){const e=os();return bu(t,e)?t:Mi(t,e)[0]||t}function ic(t,e){var n;if(!e.current.includes("floating")&&!((n=t.getAttribute("role"))!=null&&n.includes("dialog")))return;const s=os(),r=Vy(t,s).filter(o=>{const l=o.getAttribute("data-tabindex")||"";return bu(o,s)||o.hasAttribute("data-tabindex")&&!l.startsWith("-")}),a=t.getAttribute("tabindex");e.current.includes("floating")||r.length===0?a!=="0"&&t.setAttribute("tabindex","0"):(a!=="-1"||t.hasAttribute("data-tabindex")&&t.getAttribute("data-tabindex")!=="-1")&&(t.setAttribute("tabindex","-1"),t.setAttribute("data-tabindex","-1"))}const iC=v.forwardRef(function(e,n){return b.jsx("button",{...e,type:"button",ref:n,tabIndex:-1,style:Vi})});function rC(t){const{context:e,children:n,disabled:s=!1,order:i=["content"],guards:r=!0,initialFocus:a=0,returnFocus:o=!0,restoreFocus:l=!1,modal:u=!0,visuallyHiddenDismiss:d=!1,closeOnFocusOut:f=!0,outsideElementsInert:c=!1,getInsideElements:h=()=>[]}=t,{open:m,onOpenChange:p,events:g,dataRef:y,elements:{domReference:C,floating:S}}=e,T=Fe(()=>{var te;return(te=y.current.floatingContext)==null?void 0:te.nodeId}),w=Fe(h),k=typeof a=="number"&&a<0,_=qr(C)&&k,L=YS(),$=L?r:!0,N=!$||L&&c,F=Tt(i),D=Tt(a),j=Tt(o),x=$i(),R=Uu(),U=v.useRef(null),V=v.useRef(null),I=v.useRef(!1),A=v.useRef(!1),Y=v.useRef(-1),ve=R!=null,G=fi(S),Pe=Fe(function(te){return te===void 0&&(te=G),te?Mi(te,os()):[]}),Oe=Fe(te=>{const ie=Pe(te);return F.current.map(Q=>C&&Q==="reference"?C:G&&Q==="floating"?G:ie).filter(Boolean).flat()});v.useEffect(()=>{if(s||!u)return;function te(Q){if(Q.key==="Tab"){Qe(G,Vt(lt(G)))&&Pe().length===0&&!_&&Me(Q);const ae=Oe(),oe=en(Q);F.current[0]==="reference"&&oe===C&&(Me(Q),Q.shiftKey?Zt(ae[ae.length-1]):Zt(ae[1])),F.current[1]==="floating"&&oe===G&&Q.shiftKey&&(Me(Q),Zt(ae[0]))}}const ie=lt(G);return ie.addEventListener("keydown",te),()=>{ie.removeEventListener("keydown",te)}},[s,C,G,u,F,_,Pe,Oe]),v.useEffect(()=>{if(s||!S)return;function te(ie){const Q=en(ie),oe=Pe().indexOf(Q);oe!==-1&&(Y.current=oe)}return S.addEventListener("focusin",te),()=>{S.removeEventListener("focusin",te)}},[s,S,Pe]),v.useEffect(()=>{if(s||!f)return;function te(){A.current=!0,setTimeout(()=>{A.current=!1})}function ie(Q){const ae=Q.relatedTarget,oe=Q.currentTarget;queueMicrotask(()=>{const Ye=T(),Ce=!(Qe(C,ae)||Qe(S,ae)||Qe(ae,S)||Qe(R==null?void 0:R.portalNode,ae)||ae!=null&&ae.hasAttribute(es("focus-guard"))||x&&(yn(x.nodesRef.current,Ye).find(me=>{var le,ge;return Qe((le=me.context)==null?void 0:le.elements.floating,ae)||Qe((ge=me.context)==null?void 0:ge.elements.domReference,ae)})||Uo(x.nodesRef.current,Ye).find(me=>{var le,ge,Xe;return[(le=me.context)==null?void 0:le.elements.floating,fi((ge=me.context)==null?void 0:ge.elements.floating)].includes(ae)||((Xe=me.context)==null?void 0:Xe.elements.domReference)===ae})));if(oe===C&&G&&ic(G,F),l&&Ce&&Vt(lt(G))===lt(G).body){xe(G)&&G.focus();const me=Y.current,le=Pe(),ge=le[me]||le[le.length-1]||G;xe(ge)&&ge.focus()}(_||!u)&&ae&&Ce&&!A.current&&ae!==sc()&&(I.current=!0,p(!1,Q,"focus-out"))})}if(S&&xe(C))return C.addEventListener("focusout",ie),C.addEventListener("pointerdown",te),S.addEventListener("focusout",ie),()=>{C.removeEventListener("focusout",ie),C.removeEventListener("pointerdown",te),S.removeEventListener("focusout",ie)}},[s,C,S,G,u,x,R,p,f,l,Pe,_,T,F]);const We=v.useRef(null),ye=v.useRef(null),je=nc([We,R==null?void 0:R.beforeInsideRef]),ot=nc([ye,R==null?void 0:R.afterInsideRef]);v.useEffect(()=>{var te,ie;if(s||!S)return;const Q=Array.from((R==null||(te=R.portalNode)==null?void 0:te.querySelectorAll("["+es("portal")+"]"))||[]),ae=x?Uo(x.nodesRef.current,T()):[],oe=x&&!u?ae.map(le=>{var ge;return(ge=le.context)==null?void 0:ge.elements.floating}):[],Ye=(ie=ae.find(le=>{var ge;return qr(((ge=le.context)==null?void 0:ge.elements.domReference)||null)}))==null||(ie=ie.context)==null?void 0:ie.elements.domReference,Ce=[S,Ye,...Q,...oe,...w(),U.current,V.current,We.current,ye.current,R==null?void 0:R.beforeOutsideRef.current,R==null?void 0:R.afterOutsideRef.current,F.current.includes("reference")||_?C:null].filter(le=>le!=null),me=u||_?ec(Ce,!N,N):ec(Ce);return()=>{me()}},[s,C,S,u,F,R,_,$,N,x,T,w]),Te(()=>{if(s||!xe(G))return;const te=lt(G),ie=Vt(te);queueMicrotask(()=>{const Q=Oe(G),ae=D.current,oe=(typeof ae=="number"?Q[ae]:ae.current)||G,Ye=Qe(G,ie);!k&&!Ye&&m&&Zt(oe,{preventScroll:oe===G})})},[s,m,G,k,Oe,D]),Te(()=>{if(s||!G)return;let te=!1;const ie=lt(G),Q=Vt(ie);nC(Q);function ae(Ce){let{reason:me,event:le,nested:ge}=Ce;if(["hover","safe-polygon"].includes(me)&&le.type==="mouseleave"&&(I.current=!0),me==="outside-press")if(ge)I.current=!1,te=!0;else if(Cu(le)||Tu(le))I.current=!1;else{let Xe=!1;document.createElement("div").focus({get preventScroll(){return Xe=!0,!1}}),Xe?(I.current=!1,te=!0):I.current=!0}}g.on("openchange",ae);const oe=ie.createElement("span");oe.setAttribute("tabindex","-1"),oe.setAttribute("aria-hidden","true"),Object.assign(oe.style,Vi),ve&&C&&C.insertAdjacentElement("afterend",oe);function Ye(){if(typeof j.current=="boolean"){const Ce=C||sc();return Ce&&Ce.isConnected?Ce:oe}return j.current.current||oe}return()=>{g.off("openchange",ae);const Ce=Vt(ie),me=Qe(S,Ce)||x&&yn(x.nodesRef.current,T()).some(ge=>{var Xe;return Qe((Xe=ge.context)==null?void 0:Xe.elements.floating,Ce)}),le=Ye();queueMicrotask(()=>{const ge=sC(le);j.current&&!I.current&&xe(ge)&&(!(ge!==Ce&&Ce!==ie.body)||me)&&ge.focus({preventScroll:te}),oe.remove()})}},[s,S,G,j,y,g,x,ve,C,T]),v.useEffect(()=>{queueMicrotask(()=>{I.current=!1})},[s]),Te(()=>{if(!s&&R)return R.setFocusManagerState({modal:u,closeOnFocusOut:f,open:m,onOpenChange:p,domReference:C}),()=>{R.setFocusManagerState(null)}},[s,R,u,m,p,f,C]),Te(()=>{s||G&&ic(G,F)},[s,G,F]);function St(te){return s||!d||!u?null:b.jsx(iC,{ref:te==="start"?U:V,onClick:ie=>p(!1,ie.nativeEvent),children:typeof d=="string"?d:"Dismiss"})}const ct=!s&&$&&(u?!_:!0)&&(ve||u);return b.jsxs(b.Fragment,{children:[ct&&b.jsx(mi,{"data-type":"inside",ref:je,onFocus:te=>{if(u){const Q=Oe();Zt(i[0]==="reference"?Q[0]:Q[Q.length-1])}else if(R!=null&&R.preserveTabOrder&&R.portalNode)if(I.current=!1,Bn(te,R.portalNode)){const Q=ku(C);Q==null||Q.focus()}else{var ie;(ie=R.beforeOutsideRef.current)==null||ie.focus()}}}),!_&&St("start"),n,St("end"),ct&&b.jsx(mi,{"data-type":"inside",ref:ot,onFocus:te=>{if(u)Zt(Oe()[0]);else if(R!=null&&R.preserveTabOrder&&R.portalNode)if(f&&(I.current=!0),Bn(te,R.portalNode)){const Q=Ru(C);Q==null||Q.focus()}else{var ie;(ie=R.afterOutsideRef.current)==null||ie.focus()}}})]})}let ks=0;function aC(){const t=/iP(hone|ad|od)|iOS/.test(vu()),e=document.body.style,s=Math.round(document.documentElement.getBoundingClientRect().left)+document.documentElement.scrollLeft?"paddingLeft":"paddingRight",i=window.innerWidth-document.documentElement.clientWidth,r=e.left?parseFloat(e.left):window.scrollX,a=e.top?parseFloat(e.top):window.scrollY;if(e.overflow="hidden",i&&(e[s]=i+"px"),t){var o,l;const u=((o=window.visualViewport)==null?void 0:o.offsetLeft)||0,d=((l=window.visualViewport)==null?void 0:l.offsetTop)||0;Object.assign(e,{position:"fixed",top:-(a-Math.floor(d))+"px",left:-(r-Math.floor(u))+"px",right:"0"})}return()=>{Object.assign(e,{overflow:"",[s]:""}),t&&(Object.assign(e,{position:"",top:"",left:"",right:""}),window.scrollTo(r,a))}}let rc=()=>{};const oC=v.forwardRef(function(e,n){const{lockScroll:s=!1,...i}=e;return Te(()=>{if(s)return ks++,ks===1&&(rc=aC()),()=>{ks--,ks===0&&rc()}},[s]),b.jsx("div",{ref:n,...i,style:{position:"fixed",overflow:"auto",top:0,right:0,bottom:0,left:0,...i.style}})});function ac(t){return xe(t.target)&&t.target.tagName==="BUTTON"}function cC(t){return xe(t.target)&&t.target.tagName==="A"}function oc(t){return Su(t)}function lC(t,e){e===void 0&&(e={});const{open:n,onOpenChange:s,dataRef:i,elements:{domReference:r}}=t,{enabled:a=!0,event:o="click",toggle:l=!0,ignoreMouse:u=!1,keyboardHandlers:d=!0,stickIfOpen:f=!0}=e,c=v.useRef(),h=v.useRef(!1),m=v.useMemo(()=>({onPointerDown(p){c.current=p.pointerType},onMouseDown(p){const g=c.current;p.button===0&&o!=="click"&&($o(g)&&u||(n&&l&&(!(i.current.openEvent&&f)||i.current.openEvent.type==="mousedown")?s(!1,p.nativeEvent,"click"):(p.preventDefault(),s(!0,p.nativeEvent,"click"))))},onClick(p){const g=c.current;if(o==="mousedown"&&c.current){c.current=void 0;return}$o(g)&&u||(n&&l&&(!(i.current.openEvent&&f)||i.current.openEvent.type==="click")?s(!1,p.nativeEvent,"click"):s(!0,p.nativeEvent,"click"))},onKeyDown(p){c.current=void 0,!(p.defaultPrevented||!d||ac(p))&&(p.key===" "&&!oc(r)&&(p.preventDefault(),h.current=!0),!cC(p)&&p.key==="Enter"&&s(!(n&&l),p.nativeEvent,"click"))},onKeyUp(p){p.defaultPrevented||!d||ac(p)||oc(r)||p.key===" "&&h.current&&(h.current=!1,s(!(n&&l),p.nativeEvent,"click"))}}),[i,r,o,u,d,s,n,f,l]);return v.useMemo(()=>a?{reference:m}:{},[a,m])}const uC={pointerdown:"onPointerDown",mousedown:"onMouseDown",click:"onClick"},dC={pointerdown:"onPointerDownCapture",mousedown:"onMouseDownCapture",click:"onClickCapture"},cc=t=>{var e,n;return{escapeKey:typeof t=="boolean"?t:(e=t==null?void 0:t.escapeKey)!=null?e:!1,outsidePress:typeof t=="boolean"?t:(n=t==null?void 0:t.outsidePress)!=null?n:!0}};function hC(t,e){e===void 0&&(e={});const{open:n,onOpenChange:s,elements:i,dataRef:r}=t,{enabled:a=!0,escapeKey:o=!0,outsidePress:l=!0,outsidePressEvent:u="pointerdown",referencePress:d=!1,referencePressEvent:f="pointerdown",ancestorScroll:c=!1,bubbles:h,capture:m}=e,p=$i(),g=Fe(typeof l=="function"?l:()=>!1),y=typeof l=="function"?g:l,C=v.useRef(!1),S=v.useRef(!1),{escapeKey:T,outsidePress:w}=cc(h),{escapeKey:k,outsidePress:_}=cc(m),L=v.useRef(!1),$=Fe(R=>{var U;if(!n||!a||!o||R.key!=="Escape"||L.current)return;const V=(U=r.current.floatingContext)==null?void 0:U.nodeId,I=p?yn(p.nodesRef.current,V):[];if(!T&&(R.stopPropagation(),I.length>0)){let A=!0;if(I.forEach(Y=>{var ve;if((ve=Y.context)!=null&&ve.open&&!Y.context.dataRef.current.__escapeKeyBubbles){A=!1;return}}),!A)return}s(!1,zy(R)?R.nativeEvent:R,"escape-key")}),N=Fe(R=>{var U;const V=()=>{var I;$(R),(I=en(R))==null||I.removeEventListener("keydown",V)};(U=en(R))==null||U.addEventListener("keydown",V)}),F=Fe(R=>{var U;const V=C.current;C.current=!1;const I=S.current;if(S.current=!1,u==="click"&&I||V||typeof y=="function"&&!y(R))return;const A=en(R),Y="["+es("inert")+"]",ve=lt(i.floating).querySelectorAll(Y);let G=Ee(A)?A:null;for(;G&&!Dt(G);){const ye=Mt(G);if(Dt(ye)||!Ee(ye))break;G=ye}if(ve.length&&Ee(A)&&!Ky(A)&&!Qe(A,i.floating)&&Array.from(ve).every(ye=>!Qe(G,ye)))return;if(xe(A)&&x){const ye=Dt(A),je=rt(A),ot=/auto|scroll/,St=ye||ot.test(je.overflowX),ct=ye||ot.test(je.overflowY),te=St&&A.clientWidth>0&&A.scrollWidth>A.clientWidth,ie=ct&&A.clientHeight>0&&A.scrollHeight>A.clientHeight,Q=je.direction==="rtl",ae=ie&&(Q?R.offsetX<=A.offsetWidth-A.clientWidth:R.offsetX>A.clientWidth),oe=te&&R.offsetY>A.clientHeight;if(ae||oe)return}const Pe=(U=r.current.floatingContext)==null?void 0:U.nodeId,Oe=p&&yn(p.nodesRef.current,Pe).some(ye=>{var je;return lr(R,(je=ye.context)==null?void 0:je.elements.floating)});if(lr(R,i.floating)||lr(R,i.domReference)||Oe)return;const We=p?yn(p.nodesRef.current,Pe):[];if(We.length>0){let ye=!0;if(We.forEach(je=>{var ot;if((ot=je.context)!=null&&ot.open&&!je.context.dataRef.current.__outsidePressBubbles){ye=!1;return}}),!ye)return}s(!1,R,"outside-press")}),D=Fe(R=>{var U;const V=()=>{var I;F(R),(I=en(R))==null||I.removeEventListener(u,V)};(U=en(R))==null||U.addEventListener(u,V)});v.useEffect(()=>{if(!n||!a)return;r.current.__escapeKeyBubbles=T,r.current.__outsidePressBubbles=w;let R=-1;function U(ve){s(!1,ve,"ancestor-scroll")}function V(){window.clearTimeout(R),L.current=!0}function I(){R=window.setTimeout(()=>{L.current=!1},Li()?5:0)}const A=lt(i.floating);o&&(A.addEventListener("keydown",k?N:$,k),A.addEventListener("compositionstart",V),A.addEventListener("compositionend",I)),y&&A.addEventListener(u,_?D:F,_);let Y=[];return c&&(Ee(i.domReference)&&(Y=Wt(i.domReference)),Ee(i.floating)&&(Y=Y.concat(Wt(i.floating))),!Ee(i.reference)&&i.reference&&i.reference.contextElement&&(Y=Y.concat(Wt(i.reference.contextElement)))),Y=Y.filter(ve=>{var G;return ve!==((G=A.defaultView)==null?void 0:G.visualViewport)}),Y.forEach(ve=>{ve.addEventListener("scroll",U,{passive:!0})}),()=>{o&&(A.removeEventListener("keydown",k?N:$,k),A.removeEventListener("compositionstart",V),A.removeEventListener("compositionend",I)),y&&A.removeEventListener(u,_?D:F,_),Y.forEach(ve=>{ve.removeEventListener("scroll",U)}),window.clearTimeout(R)}},[r,i,o,y,u,n,s,c,a,T,w,$,k,N,F,_,D]),v.useEffect(()=>{C.current=!1},[y,u]);const j=v.useMemo(()=>({onKeyDown:$,...d&&{[uC[f]]:R=>{s(!1,R.nativeEvent,"reference-press")},...f!=="click"&&{onClick(R){s(!1,R.nativeEvent,"reference-press")}}}}),[$,s,d,f]),x=v.useMemo(()=>({onKeyDown:$,onMouseDown(){S.current=!0},onMouseUp(){S.current=!0},[dC[u]]:()=>{C.current=!0}}),[$,u]);return v.useMemo(()=>a?{reference:j,floating:x}:{},[a,j,x])}function fC(t){const{open:e=!1,onOpenChange:n,elements:s}=t,i=Ui(),r=v.useRef({}),[a]=v.useState(()=>GS()),o=Ra()!=null,[l,u]=v.useState(s.reference),d=Fe((h,m,p)=>{r.current.openEvent=h?m:void 0,a.emit("openchange",{open:h,event:m,reason:p,nested:o}),n==null||n(h,m,p)}),f=v.useMemo(()=>({setPositionReference:u}),[]),c=v.useMemo(()=>({reference:l||s.reference||null,floating:s.floating||null,domReference:s.reference}),[l,s.reference,s.floating]);return v.useMemo(()=>({dataRef:r,open:e,onOpenChange:d,elements:c,events:a,floatingId:i,refs:f}),[e,d,c,a,i,f])}function $u(t){t===void 0&&(t={});const{nodeId:e}=t,n=fC({...t,elements:{reference:null,floating:null,...t.elements}}),s=t.rootContext||n,i=s.elements,[r,a]=v.useState(null),[o,l]=v.useState(null),d=(i==null?void 0:i.domReference)||r,f=v.useRef(null),c=$i();Te(()=>{d&&(f.current=d)},[d]);const h=OS({...t,elements:{...i,...o&&{reference:o}}}),m=v.useCallback(S=>{const T=Ee(S)?{getBoundingClientRect:()=>S.getBoundingClientRect(),getClientRects:()=>S.getClientRects(),contextElement:S}:S;l(T),h.refs.setReference(T)},[h.refs]),p=v.useCallback(S=>{(Ee(S)||S===null)&&(f.current=S,a(S)),(Ee(h.refs.reference.current)||h.refs.reference.current===null||S!==null&&!Ee(S))&&h.refs.setReference(S)},[h.refs]),g=v.useMemo(()=>({...h.refs,setReference:p,setPositionReference:m,domReference:f}),[h.refs,p,m]),y=v.useMemo(()=>({...h.elements,domReference:d}),[h.elements,d]),C=v.useMemo(()=>({...h,...s,refs:g,elements:y,nodeId:e}),[h,g,y,e,s]);return Te(()=>{s.dataRef.current.floatingContext=C;const S=c==null?void 0:c.nodesRef.current.find(T=>T.id===e);S&&(S.context=C)}),v.useMemo(()=>({...h,context:C,refs:g,elements:y}),[h,g,y,C])}function pr(t,e,n){const s=new Map,i=n==="item";let r=t;if(i&&t){const{[Jo]:a,[zo]:o,...l}=t;r=l}return{...n==="floating"&&{tabIndex:-1,[$S]:""},...r,...e.map(a=>{const o=a?a[n]:null;return typeof o=="function"?t?o(t):null:o}).concat(t).reduce((a,o)=>(o&&Object.entries(o).forEach(l=>{let[u,d]=l;if(!(i&&[Jo,zo].includes(u)))if(u.indexOf("on")===0){if(s.has(u)||s.set(u,[]),typeof d=="function"){var f;(f=s.get(u))==null||f.push(d),a[u]=function(){for(var c,h=arguments.length,m=new Array(h),p=0;p<h;p++)m[p]=arguments[p];return(c=s.get(u))==null?void 0:c.map(g=>g(...m)).find(g=>g!==void 0)}}}else a[u]=d}),a),{})}}function pC(t){t===void 0&&(t=[]);const e=t.map(o=>o==null?void 0:o.reference),n=t.map(o=>o==null?void 0:o.floating),s=t.map(o=>o==null?void 0:o.item),i=v.useCallback(o=>pr(o,t,"reference"),e),r=v.useCallback(o=>pr(o,t,"floating"),n),a=v.useCallback(o=>pr(o,t,"item"),s);return v.useMemo(()=>({getReferenceProps:i,getFloatingProps:r,getItemProps:a}),[i,r,a])}const mC="Escape";function Bi(t,e,n){switch(t){case"vertical":return e;case"horizontal":return n;default:return e||n}}function Rs(t,e){return Bi(e,t===ju||t===Fi,t===cs||t===ls)}function mr(t,e,n){return Bi(e,t===Fi,n?t===cs:t===ls)||t==="Enter"||t===" "||t===""}function lc(t,e,n){return Bi(e,n?t===cs:t===ls,t===Fi)}function uc(t,e,n,s){const i=n?t===ls:t===cs,r=t===ju;return e==="both"||e==="horizontal"&&s&&s>1?t===mC:Bi(e,i,r)}function gC(t,e){const{open:n,onOpenChange:s,elements:i,floatingId:r}=t,{listRef:a,activeIndex:o,onNavigate:l=()=>{},enabled:u=!0,selectedIndex:d=null,allowEscape:f=!1,loop:c=!1,nested:h=!1,rtl:m=!1,virtual:p=!1,focusItemOnOpen:g="auto",focusItemOnHover:y=!0,openOnArrowKeyDown:C=!0,disabledIndices:S=void 0,orientation:T="vertical",parentOrientation:w,cols:k=1,scrollItemIntoView:_=!0,virtualItemRef:L,itemSizes:$,dense:N=!1}=e,F=fi(i.floating),D=Tt(F),j=Ra(),x=$i();Te(()=>{t.dataRef.current.orientation=T},[t,T]);const R=Fe(()=>{l(I.current===-1?null:I.current)}),U=qr(i.domReference),V=v.useRef(g),I=v.useRef(d??-1),A=v.useRef(null),Y=v.useRef(!0),ve=v.useRef(R),G=v.useRef(!!i.floating),Pe=v.useRef(n),Oe=v.useRef(!1),We=v.useRef(!1),ye=Tt(S),je=Tt(n),ot=Tt(_),St=Tt(d),[ct,te]=v.useState(),[ie,Q]=v.useState(),ae=Fe(()=>{function K(B){if(p){var q;(q=B.id)!=null&&q.endsWith("-fui-option")&&(B.id=r+"-"+Math.random().toString(16).slice(2,10)),te(B.id),x==null||x.events.emit("virtualfocus",B),L&&(L.current=B)}else Zt(B,{sync:Oe.current,preventScroll:!0})}const ne=a.current[I.current],H=We.current;ne&&K(ne),(Oe.current?B=>B():requestAnimationFrame)(()=>{const B=a.current[I.current]||ne;if(!B)return;ne||K(B);const q=ot.current;q&&Ye&&(H||!Y.current)&&(B.scrollIntoView==null||B.scrollIntoView(typeof q=="boolean"?{block:"nearest",inline:"nearest"}:q))})});Te(()=>{u&&(n&&i.floating?V.current&&d!=null&&(We.current=!0,I.current=d,R()):G.current&&(I.current=-1,ve.current()))},[u,n,i.floating,d,R]),Te(()=>{if(u&&n&&i.floating)if(o==null){if(Oe.current=!1,St.current!=null)return;if(G.current&&(I.current=-1,ae()),(!Pe.current||!G.current)&&V.current&&(A.current!=null||V.current===!0&&A.current==null)){let K=0;const ne=()=>{a.current[0]==null?(K<2&&(K?requestAnimationFrame:queueMicrotask)(ne),K++):(I.current=A.current==null||mr(A.current,T,m)||h?ur(a,ye.current):Vo(a,ye.current),A.current=null,R())};ne()}}else Vn(a,o)||(I.current=o,ae(),We.current=!1)},[u,n,i.floating,o,St,h,a,T,m,R,ae,ye]),Te(()=>{var K;if(!u||i.floating||!x||p||!G.current)return;const ne=x.nodesRef.current,H=(K=ne.find(q=>q.id===j))==null||(K=K.context)==null?void 0:K.elements.floating,fe=Vt(lt(i.floating)),B=ne.some(q=>q.context&&Qe(q.context.elements.floating,fe));H&&!B&&Y.current&&H.focus({preventScroll:!0})},[u,i.floating,x,j,p]),Te(()=>{if(!u||!x||!p||j)return;function K(ne){Q(ne.id),L&&(L.current=ne)}return x.events.on("virtualfocus",K),()=>{x.events.off("virtualfocus",K)}},[u,x,p,j,L]),Te(()=>{ve.current=R,Pe.current=n,G.current=!!i.floating}),Te(()=>{n||(A.current=null)},[n]);const oe=o!=null,Ye=v.useMemo(()=>{function K(H){if(!n)return;const fe=a.current.indexOf(H);fe!==-1&&I.current!==fe&&(I.current=fe,R())}return{onFocus(H){let{currentTarget:fe}=H;Oe.current=!0,K(fe)},onClick:H=>{let{currentTarget:fe}=H;return fe.focus({preventScroll:!0})},...y&&{onMouseMove(H){let{currentTarget:fe}=H;Oe.current=!0,We.current=!1,K(fe)},onPointerLeave(H){let{pointerType:fe}=H;if(!(!Y.current||fe==="touch")&&(Oe.current=!0,I.current=-1,R(),!p)){var B;(B=D.current)==null||B.focus({preventScroll:!0})}}}}},[n,D,y,a,R,p]),Ce=v.useCallback(()=>{var K;return w??(x==null||(K=x.nodesRef.current.find(ne=>ne.id===j))==null||(K=K.context)==null||(K=K.dataRef)==null?void 0:K.current.orientation)},[j,x,w]),me=Fe(K=>{if(Y.current=!1,Oe.current=!0,K.which===229||!je.current&&K.currentTarget===D.current)return;if(h&&uc(K.key,T,m,k)){Rs(K.key,Ce())||Me(K),s(!1,K.nativeEvent,"list-navigation"),xe(i.domReference)&&(p?x==null||x.events.emit("virtualfocus",i.domReference):i.domReference.focus());return}const ne=I.current,H=ur(a,S),fe=Vo(a,S);if(U||(K.key==="Home"&&(Me(K),I.current=H,R()),K.key==="End"&&(Me(K),I.current=fe,R())),k>1){const B=$||Array.from({length:a.current.length},()=>({width:1,height:1})),q=eS(B,k,N),X=q.findIndex(ke=>ke!=null&&!Ds(a,ke,S)),ue=q.reduce((ke,re,J)=>re!=null&&!Ds(a,re,S)?J:ke,-1),Ge=q[Qy({current:q.map(ke=>ke!=null?a.current[ke]:null)},{event:K,orientation:T,loop:c,rtl:m,cols:k,disabledIndices:nS([...S||a.current.map((ke,re)=>Ds(a,re)?re:void 0),void 0],q),minIndex:X,maxIndex:ue,prevIndex:tS(I.current>fe?H:I.current,B,q,k,K.key===Fi?"bl":K.key===(m?cs:ls)?"tr":"tl"),stopEvent:!0})];if(Ge!=null&&(I.current=Ge,R()),T==="both")return}if(Rs(K.key,T)){if(Me(K),n&&!p&&Vt(K.currentTarget.ownerDocument)===K.currentTarget){I.current=mr(K.key,T,m)?H:fe,R();return}mr(K.key,T,m)?c?I.current=ne>=fe?f&&ne!==a.current.length?-1:H:Ve(a,{startingIndex:ne,disabledIndices:S}):I.current=Math.min(fe,Ve(a,{startingIndex:ne,disabledIndices:S})):c?I.current=ne<=H?f&&ne!==-1?a.current.length:fe:Ve(a,{startingIndex:ne,decrement:!0,disabledIndices:S}):I.current=Math.max(H,Ve(a,{startingIndex:ne,decrement:!0,disabledIndices:S})),Vn(a,I.current)&&(I.current=-1),R()}}),le=v.useMemo(()=>p&&n&&oe&&{"aria-activedescendant":ie||ct},[p,n,oe,ie,ct]),ge=v.useMemo(()=>({"aria-orientation":T==="both"?void 0:T,...U?{}:le,onKeyDown:me,onPointerMove(){Y.current=!0}}),[le,me,T,U]),Xe=v.useMemo(()=>{function K(H){g==="auto"&&Cu(H.nativeEvent)&&(V.current=!0)}function ne(H){V.current=g,g==="auto"&&Tu(H.nativeEvent)&&(V.current=!0)}return{...le,onKeyDown(H){Y.current=!1;const fe=H.key.startsWith("Arrow"),B=["Home","End"].includes(H.key),q=fe||B,X=lc(H.key,T,m),ue=uc(H.key,T,m,k),Ge=lc(H.key,Ce(),m),ke=Rs(H.key,T),re=(h?Ge:ke)||H.key==="Enter"||H.key.trim()==="";if(p&&n){const Xt=x==null?void 0:x.nodesRef.current.find(ds=>ds.parentId==null),Ut=x&&Xt?Jy(x.nodesRef.current,Xt.id):null;if(q&&Ut&&L){const ds=new KeyboardEvent("keydown",{key:H.key,bubbles:!0});if(X||ue){var J,nt;const sd=((J=Ut.context)==null?void 0:J.elements.domReference)===H.currentTarget,Aa=ue&&!sd?(nt=Ut.context)==null?void 0:nt.elements.domReference:X?a.current.find(Da=>(Da==null?void 0:Da.id)===ct):null;Aa&&(Me(H),Aa.dispatchEvent(ds),Q(void 0))}if((ke||B)&&Ut.context&&Ut.context.open&&Ut.parentId&&H.currentTarget!==Ut.context.elements.domReference){var dn;Me(H),(dn=Ut.context.elements.domReference)==null||dn.dispatchEvent(ds);return}}return me(H)}if(!(!n&&!C&&fe)){if(re){const Xt=Rs(H.key,Ce());A.current=h&&Xt?null:H.key}if(h){Ge&&(Me(H),n?(I.current=ur(a,ye.current),R()):s(!0,H.nativeEvent,"list-navigation"));return}ke&&(d!=null&&(I.current=d),Me(H),!n&&C?s(!0,H.nativeEvent,"list-navigation"):me(H),n&&R())}},onFocus(){n&&!p&&(I.current=-1,R())},onPointerDown:ne,onPointerEnter:ne,onMouseDown:K,onClick:K}},[ct,le,k,me,ye,g,a,h,R,s,n,C,T,Ce,m,d,x,p,L]);return v.useMemo(()=>u?{reference:Xe,floating:ge,item:Ye}:{},[u,Xe,ge,Ye])}const bC=new Map([["select","listbox"],["combobox","listbox"],["label",!1]]);function vC(t,e){var n,s;e===void 0&&(e={});const{open:i,elements:r,floatingId:a}=t,{enabled:o=!0,role:l="dialog"}=e,u=Ui(),d=((n=r.domReference)==null?void 0:n.id)||u,f=v.useMemo(()=>{var C;return((C=fi(r.floating))==null?void 0:C.id)||a},[r.floating,a]),c=(s=bC.get(l))!=null?s:l,m=Ra()!=null,p=v.useMemo(()=>c==="tooltip"||l==="label"?{["aria-"+(l==="label"?"labelledby":"describedby")]:i?f:void 0}:{"aria-expanded":i?"true":"false","aria-haspopup":c==="alertdialog"?"dialog":c,"aria-controls":i?f:void 0,...c==="listbox"&&{role:"combobox"},...c==="menu"&&{id:d},...c==="menu"&&m&&{role:"menuitem"},...l==="select"&&{"aria-autocomplete":"none"},...l==="combobox"&&{"aria-autocomplete":"list"}},[c,f,m,i,d,l]),g=v.useMemo(()=>{const C={id:f,...c&&{role:c}};return c==="tooltip"||l==="label"?C:{...C,...c==="menu"&&{"aria-labelledby":d}}},[c,f,d,l]),y=v.useCallback(C=>{let{active:S,selected:T}=C;const w={role:"option",...S&&{id:f+"-fui-option"}};switch(l){case"select":return{...w,"aria-selected":S&&T};case"combobox":return{...w,"aria-selected":T}}return{}},[f,l]);return v.useMemo(()=>o?{reference:p,floating:g,item:y}:{},[o,p,g,y])}function yC(t,e){var n;const{open:s,dataRef:i}=t,{listRef:r,activeIndex:a,onMatch:o,onTypingChange:l,enabled:u=!0,findMatch:d=null,resetMs:f=750,ignoreKeys:c=[],selectedIndex:h=null}=e,m=v.useRef(-1),p=v.useRef(""),g=v.useRef((n=h??a)!=null?n:-1),y=v.useRef(null),C=Fe(o),S=Fe(l),T=Tt(d),w=Tt(c);Te(()=>{s&&(Zo(m),y.current=null,p.current="")},[s]),Te(()=>{if(s&&p.current===""){var N;g.current=(N=h??a)!=null?N:-1}},[s,h,a]);const k=Fe(N=>{N?i.current.typing||(i.current.typing=N,S(N)):i.current.typing&&(i.current.typing=N,S(N))}),_=Fe(N=>{function F(U,V,I){const A=T.current?T.current(V,I):V.find(Y=>(Y==null?void 0:Y.toLocaleLowerCase().indexOf(I.toLocaleLowerCase()))===0);return A?U.indexOf(A):-1}const D=r.current;if(p.current.length>0&&p.current[0]!==" "&&(F(D,D,p.current)===-1?k(!1):N.key===" "&&Me(N)),D==null||w.current.includes(N.key)||N.key.length!==1||N.ctrlKey||N.metaKey||N.altKey)return;s&&N.key!==" "&&(Me(N),k(!0)),D.every(U=>{var V,I;return U?((V=U[0])==null?void 0:V.toLocaleLowerCase())!==((I=U[1])==null?void 0:I.toLocaleLowerCase()):!0})&&p.current===N.key&&(p.current="",g.current=y.current),p.current+=N.key,Zo(m),m.current=window.setTimeout(()=>{p.current="",g.current=y.current,k(!1)},f);const x=g.current,R=F(D,[...D.slice((x||0)+1),...D.slice(0,(x||0)+1)],p.current);R!==-1?(C(R),y.current=R):N.key!==" "&&(p.current="",k(!1))}),L=v.useMemo(()=>({onKeyDown:_}),[_]),$=v.useMemo(()=>({onKeyDown:_,onKeyUp(N){N.key===" "&&k(!1)}}),[_,k]);return v.useMemo(()=>u?{reference:L,floating:$}:{},[u,L,$])}const ts=({participant:t,trackType:e="audioTrack",...n})=>{const s=Ae(),[i,r]=v.useState(null),{userId:a,sessionId:o}=t;return v.useEffect(()=>{if(!s||!i)return;const l=s.bindAudioElement(i,o,e);return()=>{l==null||l()}},[s,o,i,e]),b.jsx("audio",{autoPlay:!0,...n,ref:r,"data-user-id":a,"data-session-id":o,"data-track-type":e})};ts.displayName="Audio";const Vu=t=>{const{participants:e,audioProps:n}=t;return b.jsx(b.Fragment,{children:e.map(s=>{if(s.isLocalParticipant)return null;const{audioStream:i,screenShareAudioStream:r,sessionId:a}=s,l=At(s)&&i&&b.jsx(ts,{...n,trackType:"audioTrack",participant:s}),d=ki(s)&&r&&b.jsx(ts,{...n,trackType:"screenShareAudioTrack",participant:s});return b.jsxs(v.Fragment,{children:[l,d]},a)})})};Vu.displayName="ParticipantsAudio";const Bu=v.createContext(void 0),Hi=()=>v.useContext(Bu),Ea=({middleware:t=[],placement:e,strategy:n,offset:s=10})=>{const{refs:i,x:r,y:a,update:o,elements:{domReference:l,floating:u},context:d}=$u({placement:e,strategy:n,middleware:[AS(s),DS(),Du(),LS({padding:10,apply:({availableHeight:f,elements:c})=>{Object.assign(c.floating.style,{maxHeight:`${f}px`})}}),...t]});return v.useEffect(()=>{if(!l||!u)return;const f=Nu(l,u,o);return()=>f()},[l,u,o]),{refs:i,x:r,y:a,domReference:l,floating:u,strategy:n,context:d}},Hu=10,SC=(t,e=Hu)=>{const[n,s]=v.useState(null);return v.useEffect(()=>{if(!t)return;const i=()=>{const a=t;if(!(a.scrollHeight>a.clientHeight))return s(null);if(a.scrollTop<=e)return s("top");if(Math.abs(a.scrollHeight-a.scrollTop-a.clientHeight)<=e)return s("bottom");s("between")},r=new ResizeObserver(i);return r.observe(t),t.addEventListener("scroll",i),()=>{t.removeEventListener("scroll",i),r.disconnect()}},[t,e]),n},CC=(t,e=Hu)=>{const[n,s]=v.useState(null);return v.useEffect(()=>{if(!t)return;const i=()=>{const a=t;if(!(a.scrollWidth>a.clientWidth))return s(null);if(a.scrollLeft<=e)return s("start");if(Math.abs(a.scrollWidth-a.scrollLeft-a.clientWidth)<=e)return s("end");s("between")},r=new ResizeObserver(i);return r.observe(t),t.addEventListener("scroll",i),()=>{t.removeEventListener("scroll",i),r.disconnect()}},[t,e]),n},Ia=t=>{const e=Ae(),{useHasPermissions:n}=at(),s=n(t),[i,r]=v.useState(!1);return v.useEffect(()=>{s&&r(!1)},[s]),{requestPermission:v.useCallback(async()=>{if(s)return!0;const o=!!(e!=null&&e.permissionsContext.canRequest(t));if(i||!o)return!1;r(!0);try{await(e==null?void 0:e.requestPermissions({permissions:[t]}))}catch(l){throw r(!1),new Error(`requestPermission failed: ${l}`)}return!1},[e,s,i,t]),hasPermission:s,canRequestPermission:!!(e!=null&&e.permissionsContext.canRequest(t)),isAwaitingPermission:i}};function qu(t,e){const{t:n}=Ue();return v.useMemo(()=>{let s=null,i=null;const r=t.map((a,o)=>{const l=a.deviceId===e,u={deviceId:a.deviceId,label:a.label,isSelected:l};return l&&(s=u,i=o),u});if(s===null||i===null){const a={deviceId:"default",label:n("Default"),isSelected:!0};s=a,i=0,r.unshift(a)}return{deviceList:r,selectedDeviceInfo:s,selectedIndex:i}},[t,e,n])}var Cn;(function(t){t.PORTAL="portal",t.MENU="menu"})(Cn||(Cn={}));const Wu=v.createContext({}),_a=()=>v.useContext(Wu),TC=({children:t,refs:e})=>{const n=v.useMemo(()=>`str-video-portal-${Math.random().toString(36).substring(2,9)}`,[]);return b.jsxs(b.Fragment,{children:[b.jsx("div",{id:n,className:"str-video__portal"}),b.jsx(oC,{children:b.jsx(eC,{id:n,children:b.jsx("div",{className:"str-video__portal-content",ref:e.setFloating,children:t})})})]})},xa=({ToggleButton:t,placement:e="top-start",strategy:n="absolute",offset:s,visualType:i=Cn.MENU,children:r,onToggle:a})=>{const[o,l]=v.useState(!1),u=v.useRef(a);u.current=a;const{floating:d,domReference:f,refs:c,x:h,y:m}=Ea({placement:e,strategy:n,offset:s});return v.useEffect(()=>{const p=f==null?void 0:f.ownerDocument,g=C=>{var S,T;!d&&(f!=null&&f.contains(C.target))?(l(!0),(S=u.current)==null||S.call(u,!0)):d&&!(d!=null&&d.contains(C.target))&&(l(!1),(T=u.current)==null||T.call(u,!1))},y=C=>{var S;C.key&&C.key.toLowerCase()==="escape"&&!C.altKey&&!C.ctrlKey&&(l(!1),(S=u.current)==null||S.call(u,!1))};return p==null||p.addEventListener("click",g,{capture:!0}),p==null||p.addEventListener("keydown",y),()=>{p==null||p.removeEventListener("click",g,{capture:!0}),p==null||p.removeEventListener("keydown",y)}},[d,f]),b.jsxs(b.Fragment,{children:[o&&b.jsx(Wu.Provider,{value:{close:()=>l(!1)},children:i===Cn.PORTAL?b.jsx(TC,{refs:c,children:r}):i===Cn.MENU?b.jsx("div",{className:"str-video__menu-container",ref:c.setFloating,style:{position:n,top:m??0,left:h??0,overflowY:"auto"},role:"menu",children:r}):null}),b.jsx(t,{menuShown:o,ref:c.setReference})]})},wC=({children:t,onItemClick:e})=>{const n=v.useRef(null);return b.jsx("ul",{className:"str-video__generic-menu",ref:n,onClick:s=>{var i;e&&s.target!==n.current&&((i=n.current)!=null&&i.contains(s.target))&&e(s)},children:t})},$e=({children:t,...e})=>b.jsx("li",{className:"str-video__generic-menu--item",children:b.jsx("button",{...e,children:t})}),_e=({className:t,icon:e})=>b.jsx("span",{className:Ne("str-video__icon",e&&`str-video__icon--${e}`,t)});function Gu(t){const[e,n]=v.useState(document.pictureInPictureElement===t);return!t&&e&&n(!1),v.useEffect(()=>{if(!t)return;const s=()=>{n(document.pictureInPictureElement===t)};return t.addEventListener("enterpictureinpicture",s),t.addEventListener("leavepictureinpicture",s),()=>{t.removeEventListener("enterpictureinpicture",s),t.removeEventListener("leavepictureinpicture",s)}},[t]),e}const kC=()=>{const{participant:t,participantViewElement:e,videoElement:n}=Hi(),[s,i]=v.useState(!!document.fullscreenElement),r=Ae(),a=Gu(n??void 0),{t:o}=Ue(),{pin:l,sessionId:u,userId:d}=t,f=At(t),c=gt(t),h=bt(t),m=ki(t),p=()=>r==null?void 0:r.blockUser(d),g=()=>r==null?void 0:r.muteUser(d,"audio"),y=()=>r==null?void 0:r.muteUser(d,"video"),C=()=>r==null?void 0:r.muteUser(d,"screenshare"),S=()=>r==null?void 0:r.muteUser(d,"screenshare_audio"),T=D=>()=>{r==null||r.updateUserPermissions({user_id:d,grant_permissions:[D]})},w=D=>()=>{r==null||r.updateUserPermissions({user_id:d,revoke_permissions:[D]})},k=()=>{l?r==null||r.unpin(u):r==null||r.pin(u)},_=()=>{r==null||r.pinForEveryone({user_id:d,session_id:u}).catch(D=>{console.error(`Failed to pin participant ${d}`,D)})},L=()=>{r==null||r.unpinForEveryone({user_id:d,session_id:u}).catch(D=>{console.error(`Failed to unpin participant ${d}`,D)})},$=()=>s?document.exitFullscreen().catch(console.error):e==null?void 0:e.requestFullscreen().catch(console.error);v.useEffect(()=>{const D=()=>{i(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",D),()=>{document.removeEventListener("fullscreenchange",D)}},[]);const N=()=>n&&!a?n.requestPictureInPicture().catch(console.error):document.exitPictureInPicture().catch(console.error),{close:F}=_a()||{};return b.jsxs(wC,{onItemClick:F,children:[b.jsxs($e,{onClick:k,disabled:l&&!l.isLocalPin,children:[b.jsx(_e,{icon:"pin"}),o(l?"Unpin":"Pin")]}),b.jsxs(et,{requiredGrants:[z.PIN_FOR_EVERYONE],children:[b.jsxs($e,{onClick:_,disabled:l&&!l.isLocalPin,children:[b.jsx(_e,{icon:"pin"}),o("Pin for everyone")]}),b.jsxs($e,{onClick:L,disabled:!l||l.isLocalPin,children:[b.jsx(_e,{icon:"pin"}),o("Unpin for everyone")]})]}),b.jsx(et,{requiredGrants:[z.BLOCK_USERS],children:b.jsxs($e,{onClick:p,children:[b.jsx(_e,{icon:"not-allowed"}),o("Block")]})}),b.jsxs(et,{requiredGrants:[z.MUTE_USERS],children:[c&&b.jsxs($e,{onClick:y,children:[b.jsx(_e,{icon:"camera-off-outline"}),o("Turn off video")]}),h&&b.jsxs($e,{onClick:C,children:[b.jsx(_e,{icon:"screen-share-off"}),o("Turn off screen share")]}),f&&b.jsxs($e,{onClick:g,children:[b.jsx(_e,{icon:"no-audio"}),o("Mute audio")]}),m&&b.jsxs($e,{onClick:S,children:[b.jsx(_e,{icon:"no-audio"}),o("Mute screen share audio")]})]}),e&&typeof e.requestFullscreen<"u"&&b.jsx($e,{onClick:$,children:o("{{ direction }} fullscreen",{direction:o(s?"Leave":"Enter")})}),n&&document.pictureInPictureEnabled&&b.jsx($e,{onClick:N,children:o("{{ direction }} picture-in-picture",{direction:o(a?"Leave":"Enter")})}),b.jsxs(et,{requiredGrants:[z.UPDATE_CALL_PERMISSIONS],children:[b.jsx($e,{onClick:T(z.SEND_AUDIO),children:o("Allow audio")}),b.jsx($e,{onClick:T(z.SEND_VIDEO),children:o("Allow video")}),b.jsx($e,{onClick:T(z.SCREENSHARE),children:o("Allow screen sharing")}),b.jsx($e,{onClick:w(z.SEND_AUDIO),children:o("Disable audio")}),b.jsx($e,{onClick:w(z.SEND_VIDEO),children:o("Disable video")}),b.jsx($e,{onClick:w(z.SCREENSHARE),children:o("Disable screen sharing")})]})]})},Ku=t=>t===null?!1:!v.isValidElement(t),Ju=(t,e)=>{if(t){if(typeof t=="function")return t(e);t.current=e}};v.forwardRef(function({stream:e,...n},s){const[i,r]=v.useState(null);return v.useEffect(()=>{if(!(!i||!e)&&e!==i.srcObject)return i.srcObject=e,(vo.isSafari()||vo.isFirefox())&&setTimeout(()=>{i.srcObject=e,i.play().catch(a=>{console.error("Failed to play stream",a)})},0),()=>{i.pause(),i.srcObject=null}},[e,i]),b.jsx("video",{autoPlay:!0,playsInline:!0,...n,ref:a=>{Ju(s,a),r(a)}})});const zu=v.forwardRef(function({participant:e,style:n,children:s},i){const[r,a]=v.useState(!1),o=e.name||e.userId;return b.jsxs("div",{className:"str-video__video-placeholder",style:n,ref:i,children:[(!e.image||r)&&(o?b.jsx(RC,{name:o}):b.jsx("div",{className:"str-video__video-placeholder__no-video-label",children:s})),e.image&&!r&&b.jsx("img",{onError:()=>a(!0),alt:o,className:"str-video__video-placeholder__avatar",src:e.image})]})}),RC=t=>{const{name:e}=t,n=e.split(" ").slice(0,2).map(s=>s[0]).join("");return b.jsx("div",{className:"str-video__video-placeholder__initials-fallback",children:n})},EC=v.forwardRef(function(e,n){const{t:s}=Ue();return b.jsx(zu,{ref:n,...e,children:s("Video is disabled")})}),IC=v.forwardRef(function(e,n){const{t:s}=Ue();return b.jsx(zu,{ref:n,...e,children:s("Video is playing in a popup")})}),Yu=({enabled:t=!0,mirror:e,trackType:n,participant:s,className:i,VideoPlaceholder:r=EC,PictureInPicturePlaceholder:a=IC,refs:o,...l})=>{const{sessionId:u,videoStream:d,screenShareStream:f,viewportVisibilityState:c,isLocalParticipant:h,userId:m}=s,p=Ae(),[g,y]=v.useState(null),[C,S]=v.useState(!0),[T,w]=v.useState(!0),k=Gu(g??void 0),_=n==="videoTrack"?d:n==="screenShareTrack"?f:void 0;if(v.useLayoutEffect(()=>{if(!p||!g||n==="none")return;const j=p.bindVideoElement(g,u,n);return()=>{j==null||j()}},[p,n,u,g]),v.useEffect(()=>{if(!_||!g)return;const[j]=_.getVideoTracks();if(!j)return;const x=()=>{S(g.paused);const{width:R=0,height:U=0}=j.getSettings();w(R>=U)};return S(g.paused),g.addEventListener("play",x),g.addEventListener("pause",x),j.addEventListener("unmute",x),()=>{g.removeEventListener("play",x),g.removeEventListener("pause",x),j.removeEventListener("unmute",x),S(!0)}},[_,g]),!p)return null;const L=n==="videoTrack"?gt(s):n==="screenShareTrack"?bt(s):!1,$=n==="none"||(c==null?void 0:c[n])===Re.INVISIBLE,N=!t||!L||$,F=e===void 0?h&&n==="videoTrack":e,D=n==="screenShareTrack";return b.jsxs(b.Fragment,{children:[!N&&b.jsx("video",{...l,className:Ne("str-video__video",i,{"str-video__video--not-playing":C,"str-video__video--tall":!T,"str-video__video--mirror":F,"str-video__video--screen-share":D}),"data-user-id":m,"data-session-id":u,ref:j=>{var x;y(j),(x=o==null?void 0:o.setVideoElement)==null||x.call(o,j)}}),k&&a&&b.jsx(a,{style:{position:"absolute"},participant:s}),(N||C)&&r&&b.jsx(r,{style:{position:"absolute"},participant:s,ref:o==null?void 0:o.setVideoPlaceholderElement})]})};Yu.displayName="Video";const _C=({trackedElement:t,dynascaleManager:e,sessionId:n,trackType:s})=>{const i=Ae(),r=e??(i==null?void 0:i.dynascaleManager);v.useEffect(()=>{if(!t||!r||!i||s==="none")return;const a=r.trackElementVisibility(t,n,s);return()=>{a()}},[t,r,i,n,s])};v.createContext(void 0);const vt=v.forwardRef(function(e,n){const{icon:s,enabled:i,variant:r,onClick:a,className:o,...l}=e;return b.jsx("button",{className:Ne("str-video__call-controls__button",o,{[`str-video__call-controls__button--variant-${r}`]:r,"str-video__call-controls__button--enabled":i}),onClick:u=>{u.preventDefault(),a==null||a(u)},ref:n,...l,children:b.jsx(_e,{icon:s})})}),un=v.forwardRef(function({disabled:e,caption:n,children:s,className:i,active:r,Menu:a,menuPlacement:o,menuOffset:l,title:u,ToggleMenuButton:d=xC,variant:f,onClick:c,onMenuToggle:h,...m},p){return b.jsxs("div",{className:Ne("str-video__composite-button",i,{"str-video__composite-button--caption":n,"str-video__composite-button--menu":a}),title:u,ref:p,children:[b.jsxs("div",{className:Ne("str-video__composite-button__button-group",{"str-video__composite-button__button-group--active":r,"str-video__composite-button__button-group--active-primary":r&&f==="primary","str-video__composite-button__button-group--active-secondary":r&&f==="secondary","str-video__composite-button__button-group--disabled":e}),children:[b.jsx("button",{type:"button",className:"str-video__composite-button__button",onClick:g=>{g.preventDefault(),c==null||c(g)},disabled:e,...m,children:s}),a&&b.jsx(xa,{offset:l,placement:o,ToggleButton:d,onToggle:h,children:Ku(a)?b.jsx(a,{}):a})]}),n&&b.jsx("div",{className:"str-video__composite-button__caption",children:n})]})}),xC=v.forwardRef(function({menuShown:e},n){return b.jsx(vt,{className:Ne("str-video__menu-toggle-button",{"str-video__menu-toggle-button--active":e}),icon:e?"caret-down":"caret-up",ref:n})}),gi=t=>{const{isVisible:e,message:n,children:s,visibilityTimeout:i,resetIsVisible:r,placement:a="top",iconClassName:o="str-video__notification__icon",close:l}=t,{refs:u,x:d,y:f,strategy:c}=Ea({placement:a,strategy:"absolute"});return v.useEffect(()=>{if(!e||!i||!r)return;const h=setTimeout(()=>{r()},i);return()=>clearTimeout(h)},[e,r,i]),b.jsxs("div",{ref:u.setReference,children:[e&&b.jsxs("div",{className:"str-video__notification",ref:u.setFloating,style:{position:c,top:f??0,left:d??0,overflowY:"auto"},children:[o&&b.jsx("i",{className:o}),b.jsx("span",{className:"str-video__notification__message",children:n}),l?b.jsx("i",{className:"str-video__icon str-video__icon--close str-video__notification__close",onClick:l}):null]}),s]})},Pa=t=>{const{permission:e,isAwaitingApproval:n,messageApproved:s,messageAwaitingApproval:i,messageRevoked:r,visibilityTimeout:a=3500,children:o}=t,{useHasPermissions:l}=at(),u=l(e),d=v.useRef(u),[f,c]=v.useState();v.useEffect(()=>{u&&!d.current?(c("granted"),d.current=!0):!u&&d.current&&(c("revoked"),d.current=!1)},[u]);const h=v.useCallback(()=>c(void 0),[]);return n?b.jsx(gi,{isVisible:n&&!u,message:i,children:o}):b.jsx(gi,{isVisible:!!f,visibilityTimeout:a,resetIsVisible:h,message:f==="granted"?s:r,children:o})},PC=({children:t,text:e,placement:n})=>{const{useMicrophoneState:s}=at(),{isSpeakingWhileMuted:i}=s(),{t:r}=Ue(),a=e??r("You are muted. Unmute to speak.");return b.jsx(gi,{message:a,isVisible:i,placement:n||"top-start",children:t})},OC=({className:t,type:e="spinner",text:n,tooltip:s})=>b.jsxs("div",{className:Ne("str-video__loading-indicator",t),title:s,children:[b.jsx("div",{className:Ne("str-video__loading-indicator__icon",e)}),n&&b.jsx("p",{className:"str-video__loading-indicator-text",children:n})]}),NC=({children:t,referenceElement:e,tooltipClassName:n,tooltipPlacement:s="top",visible:i=!1})=>{const r=v.useRef(null),{refs:a,x:o,y:l,strategy:u,context:d}=Ea({placement:s,strategy:"absolute",middleware:[jS({element:r})]});return v.useEffect(()=>{a.setReference(e)},[e,a]),i?b.jsxs("div",{className:Ne("str-video__tooltip",n),ref:a.setFloating,style:{position:u,top:l??0,left:o??0},children:[b.jsx(WS,{ref:r,context:d,fill:"var(--str-video__tooltip--background-color)"}),t]}):null},AC=({onMouseEnter:t,onMouseLeave:e}={})=>{const[n,s]=v.useState(!1),i=v.useCallback(a=>{s(!0),t==null||t(a)},[t]),r=v.useCallback(a=>{s(!1),e==null||e(a)},[e]);return{handleMouseEnter:i,handleMouseLeave:r,tooltipVisible:n}},us=({title:t,tooltipClassName:e,tooltipPlacement:n,tooltipDisabled:s,...i})=>{const{handleMouseEnter:r,handleMouseLeave:a,tooltipVisible:o}=AC(),[l,u]=v.useState(null),d=!s&&!!t&&o;return b.jsxs(b.Fragment,{children:[b.jsx(NC,{referenceElement:l,visible:d,tooltipClassName:e,tooltipPlacement:n,children:t||""}),b.jsx("div",{ref:u,onMouseEnter:r,onMouseLeave:a,...i})]})};v.forwardRef(function(e,n){return b.jsx(un,{ref:n,active:!0,variant:"secondary","data-testid":"recording-stop-button",children:b.jsx(_e,{icon:"recording-off"})})});const DC=({caption:t})=>{const{t:e}=Ue(),{toggleCallRecording:n,isAwaitingResponse:s,isCallRecordingInProgress:i}=gy();let r=t??e("Record call");return s&&(r=e(i?"Waiting for recording to stop...":"Waiting for recording to start...")),b.jsx(et,{requiredGrants:[z.START_RECORD_CALL,z.STOP_RECORD_CALL],children:b.jsx(un,{active:i,caption:t,variant:"secondary","data-testid":i?"recording-stop-button":"recording-start-button",title:r,onClick:s?void 0:n,children:s?b.jsx(OC,{}):b.jsx(_e,{icon:i?"recording-on":"recording-off"})})})},Xu={":like:":"👍",":raise-hand:":"✋",":fireworks:":"🎉",":dislike:":"👎",":heart:":"❤️",":smile:":"😀"},LC=({participant:{reaction:t,sessionId:e},hideAfterTimeoutInMs:n=5500,emojiReactionMap:s=Xu})=>{const i=Ae();if(v.useEffect(()=>{if(!i||!t)return;const a=setTimeout(()=>{i.resetReaction(e)},n);return()=>{clearTimeout(a)}},[i,n,t,e]),!t)return null;const{emoji_code:r}=t;return b.jsx("div",{className:"str-video__reaction",children:b.jsx("span",{className:"str-video__reaction__emoji",children:r&&s[r]})})},jC=[{type:"reaction",emoji_code:":like:"},{type:"raised-hand",emoji_code:":raise-hand:"},{type:"reaction",emoji_code:":fireworks:"},{type:"reaction",emoji_code:":dislike:"},{type:"reaction",emoji_code:":heart:"},{type:"reaction",emoji_code:":smile:"}],MC=({reactions:t=jC})=>b.jsx(et,{requiredGrants:[z.CREATE_REACTION],children:b.jsx(xa,{placement:"top",ToggleButton:FC,visualType:Cn.MENU,children:b.jsx(UC,{reactions:t})})}),FC=v.forwardRef(function({menuShown:e},n){const{t:s}=Ue();return b.jsx(us,{title:s("Reactions"),tooltipDisabled:e,children:b.jsx(un,{ref:n,active:e,variant:"primary",children:b.jsx(_e,{icon:"reactions"})})})}),UC=({reactions:t,layout:e="horizontal"})=>{const n=Ae(),{close:s}=_a();return b.jsx("div",{className:Ne("str-video__reactions-menu",{"str-video__reactions-menu--horizontal":e==="horizontal","str-video__reactions-menu--vertical":e==="vertical"}),children:t.map(i=>b.jsx("button",{type:"button",className:"str-video__reactions-menu__button",onClick:()=>{n==null||n.sendReaction(i),s==null||s()},children:i.emoji_code&&Xu[i.emoji_code]},i.emoji_code))})},Oa=(t,e)=>{const n=he(["react-sdk"]);return async()=>{try{await e()}catch(s){if(t.onError){t.onError(s);return}$C(s)||n("error","Call control handler failed",s)}}};function $C(t){return t instanceof DOMException&&t.name==="NotAllowedError"}const VC=t=>{const{t:e}=Ue(),{caption:n}=t,{useHasOngoingScreenShare:s,useScreenShareState:i,useCallSettings:r}=at(),a=s(),{hasPermission:o,requestPermission:l,isAwaitingPermission:u}=Ia(z.SCREENSHARE),d=r(),f=d==null?void 0:d.screensharing.enabled,{screenShare:c,optimisticIsMute:h}=i(),m=!h,p=!m&&(a||f===!1),g=Oa(t,async()=>{o?await c.toggle():await l()});return b.jsx(et,{requiredGrants:[z.SCREENSHARE],children:b.jsx(Pa,{permission:z.SCREENSHARE,isAwaitingApproval:u,messageApproved:e("You can now share your screen."),messageAwaitingApproval:e("Awaiting for an approval to share screen."),messageRevoked:e("You can no longer share your screen."),children:b.jsx(us,{title:n??e("Share screen"),children:b.jsx(un,{active:a||m,caption:n,variant:"primary","data-testid":a?"screen-share-stop-button":"screen-share-start-button",disabled:p,onClick:g,children:b.jsx(_e,{icon:a?"screen-share-on":"screen-share-off"})})})})})},Zu=v.createContext({}),BC=t=>{const{children:e,icon:n,defaultSelectedLabel:s,defaultSelectedIndex:i,handleSelect:r}=t,[a,o]=v.useState(!1),[l,u]=v.useState(null),[d,f]=v.useState(i),[c,h]=v.useState(s),{refs:m,context:p}=$u({placement:"bottom-start",open:a,onOpenChange:o,whileElementsMounted:Nu,middleware:[Du()]}),g=v.useRef([]),y=v.useRef([]),C=v.useCallback(j=>{f(j),r(j||0),o(!1),j!==null&&h(y.current[j])},[r]),S=j=>{a?u(j):C(j)},T=gC(p,{listRef:g,activeIndex:l,selectedIndex:d,onNavigate:u}),w=yC(p,{listRef:y,activeIndex:l,selectedIndex:d,onMatch:S}),k=lC(p),_=hC(p),L=vC(p,{role:"listbox"}),{getReferenceProps:$,getFloatingProps:N,getItemProps:F}=pC([T,w,k,_,L]),D=v.useMemo(()=>({activeIndex:l,selectedIndex:d,getItemProps:F,handleSelect:C}),[l,d,F,C]);return b.jsxs("div",{className:"str-video__dropdown",children:[b.jsxs("div",{className:"str-video__dropdown-selected",ref:m.setReference,tabIndex:0,...$(),children:[b.jsxs("label",{className:"str-video__dropdown-selected__label",children:[n&&b.jsx(_e,{className:"str-video__dropdown-selected__icon",icon:n}),c]}),b.jsx(_e,{className:"str-video__dropdown-selected__chevron",icon:a?"chevron-up":"chevron-down"})]}),b.jsx(Zu.Provider,{value:D,children:a&&b.jsx(rC,{context:p,modal:!1,children:b.jsx("div",{className:"str-video__dropdown-list",ref:m.setFloating,...N(),children:b.jsx(FS,{elementsRef:g,labelsRef:y,children:e})})})})]})},HC=t=>{const{selected:e,label:n,icon:s}=t,{getItemProps:i,handleSelect:r}=v.useContext(Zu),{ref:a,index:o}=US();return b.jsxs("div",{className:Ne("str-video__dropdown-option",{"str-video__dropdown-option--selected":e}),ref:a,...i({onClick:()=>r(o)}),children:[s&&b.jsx(_e,{className:"str-video__dropdown-icon",icon:s}),b.jsx("span",{className:"str-video__dropdown-label",children:n})]})},qC=t=>{const{children:e,icon:n,handleSelect:s,defaultSelectedLabel:i,defaultSelectedIndex:r}=t;return b.jsx(BC,{icon:n,handleSelect:s,defaultSelectedIndex:r,defaultSelectedLabel:i,children:e})},WC=({disabled:t,id:e,label:n,onChange:s,name:i,selected:r,defaultChecked:a,value:o})=>b.jsxs("label",{className:Ne("str-video__device-settings__option",{"str-video__device-settings__option--selected":r,"str-video__device-settings__option--disabled":t}),htmlFor:e,children:[b.jsx("input",{type:"radio",name:i,onChange:s,value:o,id:e,checked:r,defaultChecked:a,disabled:t}),n]}),GC=t=>{const{devices:e=[],selectedDeviceId:n,title:s,type:i,onChange:r}=t,{close:a}=_a(),{deviceList:o}=qu(e,n);return b.jsxs("div",{className:"str-video__device-settings__device-kind",children:[s&&b.jsx("div",{className:"str-video__device-settings__device-selector-title",children:s}),o.map(l=>b.jsx(WC,{id:`${i}--${l.deviceId}`,value:l.deviceId,label:l.label,onChange:u=>{const d=u.target.value;d!=="default"&&(r==null||r(d)),a==null||a()},name:i,selected:l.isSelected},l.deviceId))]})},KC=t=>{const{devices:e=[],selectedDeviceId:n,title:s,onChange:i,icon:r}=t,{deviceList:a,selectedDeviceInfo:o,selectedIndex:l}=qu(e,n),u=v.useCallback(d=>{const f=a[d].deviceId;f!=="default"&&(i==null||i(f))},[a,i]);return b.jsxs("div",{className:"str-video__device-settings__device-kind",children:[b.jsx("div",{className:"str-video__device-settings__device-selector-title",children:s}),b.jsx(qC,{icon:r,defaultSelectedIndex:l,defaultSelectedLabel:o.label,handleSelect:u,children:a.map(d=>b.jsx(HC,{icon:r,label:d.label,selected:d.isSelected},d.deviceId))})]})},Qu=t=>{const{visualType:e="list",icon:n,...s}=t;return e==="list"?b.jsx(GC,{...s}):b.jsx(KC,{...s,icon:n})},JC=({title:t,visualType:e})=>{const{useMicrophoneState:n}=at(),{microphone:s,selectedDevice:i,devices:r}=n();return b.jsx(Qu,{devices:r||[],selectedDeviceId:i,type:"audioinput",onChange:async a=>{await s.select(a)},title:t,visualType:e,icon:"mic"})},zC=({title:t,visualType:e})=>{const{useCameraState:n}=at(),{camera:s,devices:i,selectedDevice:r}=n();return b.jsx(Qu,{devices:i||[],type:"videoinput",selectedDeviceId:r,onChange:async a=>{await s.select(a)},title:t,visualType:e,icon:"camera"})};v.forwardRef(function({menuShown:e},n){const{t:s}=Ue();return b.jsx(vt,{className:Ne("str-video__device-settings__button",{"str-video__device-settings__button--active":e}),title:s("Toggle device menu"),icon:"device-settings",ref:n})});const YC=t=>{const{t:e}=Ue(),{caption:n,Menu:s=b.jsx(JC,{visualType:"list"}),menuPlacement:i="top",onMenuToggle:r,...a}=t,{hasPermission:o,requestPermission:l,isAwaitingPermission:u}=Ia(z.SEND_AUDIO),{useMicrophoneState:d}=at(),{microphone:f,optimisticIsMute:c,hasBrowserPermission:h,isPromptingPermission:m}=d(),[p,g]=v.useState(!1),y=Oa(t,async()=>{o?await f.toggle():await l()});return b.jsx(et,{requiredGrants:[z.SEND_AUDIO],children:b.jsx(Pa,{permission:z.SEND_AUDIO,isAwaitingApproval:u,messageApproved:e("You can now speak."),messageAwaitingApproval:e("Awaiting for an approval to speak."),messageRevoked:e("You can no longer speak."),children:b.jsx(us,{title:o?h?n??e("Mic"):e("Check your browser mic permissions"):e("You have no permission to share your audio"),tooltipDisabled:p,children:b.jsxs(un,{active:c,caption:n,variant:"secondary",disabled:!h||!o,"data-testid":c?"audio-unmute-button":"audio-mute-button",onClick:y,Menu:s,menuPlacement:i,menuOffset:16,...a,onMenuToggle:C=>{g(C),r==null||r(C)},children:[b.jsx(_e,{icon:c?"mic-off":"mic"}),(!h||!o)&&b.jsx("span",{className:"str-video__no-media-permission",children:"!"}),m&&b.jsx("span",{className:"str-video__pending-permission",title:e("Waiting for permission"),children:"?"})]})})})})},XC=t=>{const{t:e}=Ue(),{caption:n,Menu:s=b.jsx(zC,{visualType:"list"}),menuPlacement:i="top",onMenuToggle:r,...a}=t,{hasPermission:o,requestPermission:l,isAwaitingPermission:u}=Ia(z.SEND_VIDEO),{useCameraState:d,useCallSettings:f}=at(),{camera:c,optimisticIsMute:h,hasBrowserPermission:m,isPromptingPermission:p}=d(),g=f(),y=g==null?void 0:g.video.enabled,[C,S]=v.useState(!1),T=Oa(t,async()=>{o?await c.toggle():await l()});return b.jsx(et,{requiredGrants:[z.SEND_VIDEO],children:b.jsx(Pa,{permission:z.SEND_VIDEO,isAwaitingApproval:u,messageApproved:e("You can now share your video."),messageAwaitingApproval:e("Awaiting for an approval to share your video."),messageRevoked:e("You can no longer share your video."),children:b.jsx(us,{title:o?m?y?n||e("Video"):e("Video publishing is disabled by the system"):e("Check your browser video permissions"):e("You have no permission to share your video"),tooltipDisabled:C,children:b.jsxs(un,{active:h,caption:n,variant:"secondary",disabled:!m||!o||!y,"data-testid":h?"video-unmute-button":"video-mute-button",onClick:T,Menu:s,menuPlacement:i,menuOffset:16,...a,onMenuToggle:w=>{S(w),r==null||r(w)},children:[b.jsx(_e,{icon:h?"camera-off":"camera"}),(!m||!o||!y)&&b.jsx("span",{className:"str-video__no-media-permission",children:"!"}),p&&b.jsx("span",{className:"str-video__pending-permission",title:e("Waiting for permission"),children:"?"})]})})})})};v.forwardRef(function({menuShown:e},n){const{t:s}=Ue();return b.jsx(us,{title:s("Leave call"),tooltipDisabled:e,children:b.jsx(vt,{icon:e?"close":"call-end",variant:e?"active":"danger","data-testid":"leave-call-button",ref:n})})});const ZC=({disabled:t,caption:e,onClick:n,onLeave:s})=>{const i=Ae(),{t:r}=Ue(),a=v.useCallback(async o=>{n?n(o):i&&(await i.leave(),s==null||s())},[n,s,i]);return b.jsx(vt,{disabled:t,icon:"call-end",variant:"danger",title:e??r("Leave call"),"data-testid":"cancel-call-button",onClick:a})},QC=({onLeave:t})=>b.jsxs("div",{className:"str-video__call-controls",children:[b.jsx(et,{requiredGrants:[z.SEND_AUDIO],children:b.jsx(PC,{children:b.jsx(YC,{})})}),b.jsx(et,{requiredGrants:[z.SEND_VIDEO],children:b.jsx(XC,{})}),b.jsx(et,{requiredGrants:[z.CREATE_REACTION],children:b.jsx(MC,{})}),b.jsx(et,{requiredGrants:[z.SCREENSHARE],children:b.jsx(VC,{})}),b.jsx(et,{requiredGrants:[z.START_RECORD_CALL,z.STOP_RECORD_CALL],children:b.jsx(DC,{})}),b.jsx(ZC,{onLeave:t})]});v.lazy(()=>ad(()=>import("./latency-chart-Bj5OSYzg.es-CRgRXBsT.js"),__vite__mapDeps([0,1,2])));var dc;(function(t){t.GOOD="Good",t.OK="Ok",t.BAD="Bad"})(dc||(dc={}));v.forwardRef(function(e,n){const{t:s}=Ue(),{caption:i,menuShown:r}=e;return b.jsx(un,{ref:n,active:r,caption:i,title:i||s("Statistics"),"data-testid":"stats-button",children:b.jsx(_e,{icon:"stats"})})});v.forwardRef(function(e,n){return b.jsx(vt,{enabled:e.menuShown,icon:"ellipsis",ref:n})});v.forwardRef(function(e,n){return b.jsx(vt,{enabled:e.menuShown,icon:"filter",ref:n})});v.createContext(null);M.JOINING+"",M.RINGING+"",M.MIGRATING+"",M.RECONNECTING+"",M.RECONNECTING_FAILED+"",M.OFFLINE+"",M.IDLE+"",M.UNKNOWN+"",M.JOINED+"",M.LEFT+"";v.forwardRef(function(e,n){const{permissionRequests:s,handleUpdatePermission:i,...r}=e,{t:a}=Ue();return b.jsx("div",{className:"str-video__permission-requests-list",ref:n,...r,children:s.map((o,l)=>{const{user:u,permissions:d}=o;return b.jsx(v.Fragment,{children:d.map(f=>b.jsxs("div",{className:"str-video__permission-request",children:[b.jsx("div",{className:"str-video__permission-request__message",children:eT(u.name||u.id,f,a)}),b.jsx(gr,{className:"str-video__permission-request__button--allow",type:"button",onClick:i(o,"grant"),children:a("Allow")}),b.jsx(gr,{className:"str-video__permission-request__button--reject",type:"button",onClick:i(o,"revoke"),children:a("Revoke")}),b.jsx(gr,{className:"str-video__permission-request__button--reject",type:"button",onClick:i(o,"dismiss"),children:a("Dismiss")})]},f))},`${u.id}/${l}`)})})});const gr=t=>{const{className:e,...n}=t;return b.jsx("button",{className:Ne("str-video__permission-request__button",e),...n})},eT=(t,e,n)=>{switch(e){case z.SEND_AUDIO:return n("{{ userName }} is requesting to speak",{userName:t});case z.SEND_VIDEO:return n("{{ userName }} is requesting to share their camera",{userName:t});case z.SCREENSHARE:return n("{{ userName }} is requesting to present their screen",{userName:t});default:return n("{{ userName }} is requesting permission: {{ permission }}",{userName:t,permission:e})}},tT=({as:t="div",className:e,children:n,...s})=>b.jsx(t,{...s,className:Ne("str-video",e),children:n}),nT=v.forwardRef(function(e,n){return b.jsx(vt,{enabled:e.menuShown,icon:"ellipsis",ref:n})}),sT=()=>{const t=Ae(),{t:e}=Ue(),n=()=>{t==null||t.screenShare.disable()};return b.jsxs("div",{className:"str-video__screen-share-overlay",children:[b.jsx(_e,{icon:"screen-share-off"}),b.jsx("span",{className:"str-video__screen-share-overlay__title",children:e("You are presenting your screen")}),b.jsxs("button",{onClick:n,className:"str-video__screen-share-overlay__button",children:[b.jsx(_e,{icon:"close"})," ",e("Stop Screen Sharing")]})]})},Na=({indicatorsVisible:t=!0,menuPlacement:e="bottom-start",showMenuButton:n=!0,ParticipantActionsContextMenu:s=kC})=>{const{participant:i,trackType:r}=Hi(),a=bt(i);return i.isLocalParticipant&&a&&r==="screenShareTrack"?b.jsxs(b.Fragment,{children:[b.jsx(sT,{}),b.jsx(hc,{indicatorsVisible:t})]}):b.jsxs(b.Fragment,{children:[n&&b.jsx(xa,{strategy:"fixed",placement:e,ToggleButton:nT,children:b.jsx(s,{})}),b.jsx(LC,{participant:i}),b.jsx(hc,{indicatorsVisible:t})]})},hc=({indicatorsVisible:t=!0})=>{const{participant:e}=Hi(),{isLocalParticipant:n,connectionQuality:s,pin:i,sessionId:r,name:a,userId:o}=e,l=Ae(),{t:u}=Ue(),d=!!s&&xr.ConnectionQuality[s].toLowerCase(),f=At(e),c=gt(e),h=!!i&&i.isLocalPin;return b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"str-video__participant-details",children:b.jsxs("span",{className:"str-video__participant-details__name",children:[a||o,t&&!f&&b.jsx("span",{className:"str-video__participant-details__name--audio-muted"}),t&&!c&&b.jsx("span",{className:"str-video__participant-details__name--video-muted"}),t&&h&&b.jsx("span",{title:u("Unpin"),onClick:()=>l==null?void 0:l.unpin(r),className:"str-video__participant-details__name--pinned"}),t&&b.jsx(iT,{})]})}),t&&b.jsx(gi,{isVisible:n&&s===xr.ConnectionQuality.POOR,message:u("Poor connection quality"),children:d&&b.jsx("span",{className:Ne("str-video__participant-details__connection-quality",`str-video__participant-details__connection-quality--${d}`),title:d})})]})},iT=()=>{const{participant:t}=Hi(),{isSpeaking:e,isDominantSpeaker:n}=t;return b.jsxs("span",{className:Ne("str-video__speech-indicator",e&&"str-video__speech-indicator--speaking",n&&"str-video__speech-indicator--dominant"),children:[b.jsx("span",{className:"str-video__speech-indicator__bar"}),b.jsx("span",{className:"str-video__speech-indicator__bar"}),b.jsx("span",{className:"str-video__speech-indicator__bar"})]})},js=v.forwardRef(function({participant:e,trackType:n="videoTrack",mirror:s,muteAudio:i,refs:{setVideoElement:r,setVideoPlaceholderElement:a}={},className:o,VideoPlaceholder:l,PictureInPicturePlaceholder:u,ParticipantViewUI:d=Na},f){const{isLocalParticipant:c,isSpeaking:h,isDominantSpeaker:m,sessionId:p}=e,g=At(e),y=gt(e),C=ki(e),[S,T]=v.useState(null),[w,k]=v.useState(null),[_,L]=v.useState(null);_C({sessionId:p,trackedElement:S,trackType:n});const{useIncomingVideoSettings:$}=at(),{isParticipantVideoEnabled:N}=$(),F=v.useMemo(()=>({participant:e,participantViewElement:S,videoElement:w,videoPlaceholderElement:_,trackType:n}),[w,_,e,S,n]),D=v.useMemo(()=>({setVideoElement:j=>{r==null||r(j),k(j)},setVideoPlaceholderElement:j=>{a==null||a(j),L(j)}}),[r,a]);return b.jsx("div",{"data-testid":"participant-view",ref:j=>{Ju(f,j),T(j)},className:Ne("str-video__participant-view",m&&"str-video__participant-view--dominant-speaker",h&&"str-video__participant-view--speaking",!y&&"str-video__participant-view--no-video",!g&&"str-video__participant-view--no-audio",o),children:b.jsxs(Bu.Provider,{value:F,children:[!c&&!i&&b.jsxs(b.Fragment,{children:[g&&b.jsx(ts,{participant:e,trackType:"audioTrack"}),C&&b.jsx(ts,{participant:e,trackType:"screenShareAudioTrack"})]}),b.jsx(Yu,{VideoPlaceholder:l,PictureInPicturePlaceholder:u,participant:e,trackType:n,refs:D,enabled:c||n!=="videoTrack"||N(e.sessionId),mirror:s,autoPlay:!0}),Ku(d)?b.jsx(d,{}):d]})})});js.displayName="ParticipantView";const ed=Rv;ed.displayName="StreamCall";var rT="Joining",aT="Mic",oT="Ringing",cT="Speakers",lT="Video",uT="Live",dT="Reactions",hT="Statistics",fT="Invite",pT="Join",mT="You",gT="Me",bT="Unknown",vT="Default",yT="Refresh",ST="Allow",CT="Revoke",TT="Dismiss",wT="Pinned",kT="Unpin",RT="Pin",ET="Block",IT="Enter",_T="Leave",xT="Participants",PT=", and ({{ count }}) anonymous",OT={Joining:rT,Mic:aT,"No internet connection":"No internet connection","Re-connecting":"Re-connecting",Ringing:oT,"Screen Share":"Screen Share","Select a Camera":"Select a Camera","Select a Mic":"Select a Mic","Select Speakers":"Select Speakers",Speakers:cT,Video:lT,"You are muted. Unmute to speak.":"You are muted. Unmute to speak.",Live:uT,"You can now speak.":"You can now speak.","Awaiting for an approval to speak.":"Awaiting for an approval to speak.","You can no longer speak.":"You can no longer speak.","You can now share your video.":"You can now share your video.","Awaiting for an approval to share your video.":"Awaiting for an approval to share your video.","You can no longer share your video.":"You can no longer share your video.","Waiting for recording to stop...":"Waiting for recording to stop...","Waiting for recording to start...":"Waiting for recording to start...","Record call":"Record call",Reactions:dT,Statistics:hT,"You can now share your screen.":"You can now share your screen.","Awaiting for an approval to share screen.":"Awaiting for an approval to share screen.","You can no longer share your screen.":"You can no longer share your screen.","Share screen":"Share screen","Incoming Call...":"Incoming Call...","Calling...":"Calling...","Mute All":"Mute All",Invite:fT,Join:pT,You:mT,Me:gT,Unknown:bT,"Toggle device menu":"Toggle device menu",Default:vT,"Call Recordings":"Call Recordings",Refresh:yT,"Check your browser video permissions":"Check your browser video permissions","Video publishing is disabled by the system":"Video publishing is disabled by the system","You have no permission to share your video":"You have no permission to share your video","You have no permission to share your audio":"You have no permission to share your audio","You are presenting your screen":"You are presenting your screen","Stop Screen Sharing":"Stop Screen Sharing",Allow:ST,Revoke:CT,Dismiss:TT,"Microphone on":"Microphone on","Microphone off":"Microphone off","Camera on":"Camera on","Camera off":"Camera off","No camera found":"No camera found","Video is disabled":"Video is disabled",Pinned:wT,Unpin:kT,Pin:RT,"Pin for everyone":"Pin for everyone","Unpin for everyone":"Unpin for everyone",Block:ET,"Turn off video":"Turn off video","Turn off screen share":"Turn off screen share","Mute audio":"Mute audio","Mute screen share audio":"Mute screen share audio","Allow audio":"Allow audio","Allow video":"Allow video","Allow screen sharing":"Allow screen sharing","Disable audio":"Disable audio","Disable video":"Disable video","Disable screen sharing":"Disable screen sharing",Enter:IT,Leave:_T,"Leave call":"Leave call","End call for all":"End call for all","{{ direction }} fullscreen":"{{ direction }} fullscreen","{{ direction }} picture-in-picture":"{{ direction }} picture-in-picture","Dominant Speaker":"Dominant Speaker","Poor connection quality":"Poor connection quality. Please check your internet connection.",Participants:xT,Anonymous:PT,"No participants found":"No participants found","Participants ({{ numberOfParticipants }})":"Participants ({{ numberOfParticipants }})","{{ userName }} is sharing their screen":"{{ userName }} is sharing their screen","{{ userName }} is requesting to speak":"{{ userName }} is requesting to speak","{{ userName }} is requesting to share their camera":"{{ userName }} is requesting to share their camera","{{ userName }} is requesting to present their screen":"{{ userName }} is requesting to present their screen","{{ userName }} is requesting permission: {{ permission }}":"{{ userName }} is requesting permission: {{ permission }}"};const NT={en:OT},td=t=>b.jsx(Nv,{translationsOverrides:NT,...t});td.displayName="StreamVideo";function Ms(t,e){return"$and"in e?e.$and.every(n=>Ms(t,n)):"$or"in e?e.$or.some(n=>Ms(t,n)):"$not"in e?!Ms(t,e.$not):AT(t,e)}function AT(t,e){let n=!0;for(const s of Object.keys(e)){const i=e[s],r=i&&typeof i=="object",a=t[s];if(r&&"$eq"in i)n&&(n=i.$eq===a);else if(r&&"$neq"in i)n&&(n=i.$neq!==a);else if(r&&"$in"in i)n&&(n=i.$in.includes(a));else if(r&&"$contains"in i)if(Array.isArray(a)){const o=i;n&&(n=a.includes(o.$contains))}else n=!1;else n&&(n=i===a);if(!n)return!1}return!0}const DT=({excludeLocalParticipant:t=!1,filterParticipants:e})=>{const{useParticipants:n,useRemoteParticipants:s}=at(),i=n(),r=s();return v.useMemo(()=>{const a=t?r:i;return e?LT(a,e):a},[i,r,t,e])},LT=(t,e)=>{const n=typeof e=="function"?e:s=>Ms({userId:s.userId,isSpeaking:s.isSpeaking,isDominantSpeaker:s.isDominantSpeaker,name:s.name,roles:s.roles,isPinned:vg(s),hasVideo:gt(s),hasAudio:At(s)},e);return t.filter(n)},jT=(t,e)=>{v.useEffect(()=>{if(t)return e?t.setSortParticipantsBy(jt(oa,FT)):t.setSortParticipantsBy(Cg),()=>{MT(t)}},[t,e])},MT=t=>{const e=Gl.get(t.type);t.setSortParticipantsBy(e.options.sortParticipantsBy||Yn)},FT=(t,e)=>t.isLocalParticipant?1:e.isLocalParticipant?-1:0,UT=(t,e,n)=>{const[s,i]=v.useState({vertical:typeof n=="number"?n:null,horizontal:typeof n=="number"?n:null});return v.useEffect(()=>{if(!e||!t||typeof n=="number"||typeof n>"u")return;let r=null,a=null;const o=new ResizeObserver((l,u)=>{if(l.length>1){const c=e.firstChild;c&&(a=c.clientHeight,r=c.clientWidth,u.unobserve(e))}if(a===null||r===null)return;const d=Math.floor(t.clientHeight/a),f=Math.floor(t.clientWidth/r);i(c=>c.vertical!==d||c.horizontal!==f?{vertical:d,horizontal:f}:c)});return o.observe(t),o.observe(e),()=>{o.disconnect()}},[e,n,t]),s},$T=()=>b.jsx(Na,{menuPlacement:"top-end"}),nd=({ParticipantViewUIBar:t=$T,ParticipantViewUISpotlight:e=Na,VideoPlaceholder:n,PictureInPicturePlaceholder:s,participantsBarPosition:i="bottom",participantsBarLimit:r,mirrorLocalParticipantVideo:a=!0,excludeLocalParticipant:o=!1,filterParticipants:l,pageArrowsVisible:u=!0,muted:d})=>{const f=Ae(),{useParticipants:c,useRemoteParticipants:h}=at(),m=c(),p=h(),[g,...y]=DT({excludeLocalParticipant:o,filterParticipants:l}),[C,S]=v.useState(null),[T,w]=v.useState(null),[k,_]=v.useState(null),L=g&&bt(g),$=UT(k,T,r),N=i==="left"||i==="right",F=i==="top"||i==="bottom";v.useEffect(()=>{if(!C||!f)return;const V=f.setViewport(C);return()=>V()},[C,f]);const D=m.length===2;jT(f,D);let j=y;const x=N?$.vertical:$.horizontal;typeof r<"u"&&x!==null&&(j=y.slice(0,x-(L?1:0)));const R=a?void 0:!1;if(!f)return null;const U=i&&(j.length>0||L);return b.jsxs("div",{className:"str-video__speaker-layout__wrapper",children:[!d&&b.jsx(Vu,{participants:p}),b.jsxs("div",{className:Ne("str-video__speaker-layout",i&&`str-video__speaker-layout--variant-${i}`),children:[b.jsx("div",{className:"str-video__speaker-layout__spotlight",children:g&&b.jsx(js,{participant:g,muteAudio:!0,mirror:R,trackType:L?"screenShareTrack":"videoTrack",ParticipantViewUI:e,VideoPlaceholder:n,PictureInPicturePlaceholder:s})}),U&&b.jsxs("div",{ref:_,className:"str-video__speaker-layout__participants-bar-buttons-wrapper",children:[b.jsx("div",{className:"str-video__speaker-layout__participants-bar-wrapper",ref:S,children:b.jsxs("div",{ref:w,className:"str-video__speaker-layout__participants-bar",children:[L&&b.jsx("div",{className:"str-video__speaker-layout__participant-tile",children:b.jsx(js,{participant:g,ParticipantViewUI:t,VideoPlaceholder:n,PictureInPicturePlaceholder:s,mirror:R,muteAudio:!0})},g.sessionId),j.map(V=>b.jsx("div",{className:"str-video__speaker-layout__participant-tile",children:b.jsx(js,{participant:V,ParticipantViewUI:t,VideoPlaceholder:n,PictureInPicturePlaceholder:s,mirror:R,muteAudio:!0})},V.sessionId))]})}),u&&N&&b.jsx(BT,{scrollWrapper:C}),u&&F&&b.jsx(VT,{scrollWrapper:C})]})]})]})};nd.displayName="SpeakerLayout";const VT=({scrollWrapper:t})=>{const e=CC(t),n=()=>{t==null||t.scrollBy({left:-150,behavior:"smooth"})},s=()=>{t==null||t.scrollBy({left:150,behavior:"smooth"})};return b.jsxs(b.Fragment,{children:[e&&e!=="start"&&b.jsx(vt,{onClick:n,icon:"caret-left",className:"str-video__speaker-layout__participants-bar--button-left"}),e&&e!=="end"&&b.jsx(vt,{onClick:s,icon:"caret-right",className:"str-video__speaker-layout__participants-bar--button-right"})]})},BT=({scrollWrapper:t})=>{const e=SC(t),n=()=>{t==null||t.scrollBy({top:-150,behavior:"smooth"})},s=()=>{t==null||t.scrollBy({top:150,behavior:"smooth"})};return b.jsxs(b.Fragment,{children:[e&&e!=="top"&&b.jsx(vt,{onClick:n,icon:"caret-up",className:"str-video__speaker-layout__participants-bar--button-top"}),e&&e!=="bottom"&&b.jsx(vt,{onClick:s,icon:"caret-down",className:"str-video__speaker-layout__participants-bar--button-bottom"})]})},[HT,qT,WT]="1.14.4".split(".");Ng({type:xr.SdkType.REACT,major:HT,minor:qT,patch:WT});const GT="8wdwgns6ss3h",ZT=()=>{const{id:t}=od(),[e,n]=v.useState(null),[s,i]=v.useState(null),[r,a]=v.useState(!0),{authUser:o,isLoading:l}=cd(),{data:u}=ld({queryKey:["streamToken"],queryFn:fd,enabled:!!o});return v.useEffect(()=>{(async()=>{if(!(!u.token||!o||!t))try{console.log("Initializing Stream video client...");const f={id:o._id,name:o.fullName,image:o.profilePic},c=new $t({apiKey:GT,user:f,token:u.token}),h=c.call("default",t);await h.join({create:!0}),console.log("Joined call successfully"),n(c),i(h)}catch(f){console.error("Error joining call:",f),dd.error("Could not join the call. Please try again.")}finally{a(!1)}})()},[u,o,t]),l||r?b.jsx(ud,{}):b.jsx("div",{className:"h-screen flex flex-col items-center justify-center",children:b.jsx("div",{className:"relative",children:e&&s?b.jsx(td,{client:e,children:b.jsx(ed,{call:s,children:b.jsx(KT,{})})}):b.jsx("div",{className:"flex items-center justify-center h-full",children:b.jsx("p",{children:"Could not initialize call. Please refresh or try again later."})})})})},KT=()=>{const{useCallCallingState:t}=at(),e=t(),n=hd();return e===M.LEFT?n("/"):b.jsxs(tT,{children:[b.jsx(nd,{}),b.jsx(QC,{})]})};export{ZT as default};
